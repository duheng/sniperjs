{"remainingRequest":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/babel-loader/lib/index.js??ref--4-2!/Users/Aaron/Desktop/work/qunar/work/sniperjs/example/node/node_modules/react-router/esm/react-router.js","dependencies":[{"path":"/Users/Aaron/Desktop/work/qunar/work/sniperjs/example/node/node_modules/react-router/esm/react-router.js","hash":"29b811eb25342111d988d7117072748a"},{"path":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/cache-loader-hash/dist/cjs.js","hash":"d62e2d390167bf8193569f1644327c55"},{"path":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/babel-loader/lib/index.js","hash":"19adf3159c902f1ed7907f3931384270"}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlByb21wdCA9IFByb21wdDsKZXhwb3J0cy5SZWRpcmVjdCA9IFJlZGlyZWN0OwpleHBvcnRzLmdlbmVyYXRlUGF0aCA9IGdlbmVyYXRlUGF0aDsKZXhwb3J0cy5tYXRjaFBhdGggPSBtYXRjaFBhdGg7CmV4cG9ydHMudXNlSGlzdG9yeSA9IHVzZUhpc3Rvcnk7CmV4cG9ydHMudXNlTG9jYXRpb24gPSB1c2VMb2NhdGlvbjsKZXhwb3J0cy51c2VQYXJhbXMgPSB1c2VQYXJhbXM7CmV4cG9ydHMudXNlUm91dGVNYXRjaCA9IHVzZVJvdXRlTWF0Y2g7CmV4cG9ydHMud2l0aFJvdXRlciA9IHdpdGhSb3V0ZXI7CmV4cG9ydHMuX19Sb3V0ZXJDb250ZXh0ID0gZXhwb3J0cy5fX0hpc3RvcnlDb250ZXh0ID0gZXhwb3J0cy5Td2l0Y2ggPSBleHBvcnRzLlN0YXRpY1JvdXRlciA9IGV4cG9ydHMuUm91dGVyID0gZXhwb3J0cy5Sb3V0ZSA9IGV4cG9ydHMuTWVtb3J5Um91dGVyID0gdm9pZCAwOwoKdmFyIF9pbmhlcml0c0xvb3NlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHNMb29zZSIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInByb3AtdHlwZXMiKSk7Cgp2YXIgX2hpc3RvcnkgPSByZXF1aXJlKCJoaXN0b3J5Iik7Cgp2YXIgX3RpbnlXYXJuaW5nID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ0aW55LXdhcm5pbmciKSk7Cgp2YXIgX21pbmlDcmVhdGVSZWFjdENvbnRleHQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIm1pbmktY3JlYXRlLXJlYWN0LWNvbnRleHQiKSk7Cgp2YXIgX3RpbnlJbnZhcmlhbnQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInRpbnktaW52YXJpYW50IikpOwoKdmFyIF9leHRlbmRzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZXh0ZW5kcyIpKTsKCnZhciBfcGF0aFRvUmVnZXhwID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJwYXRoLXRvLXJlZ2V4cCIpKTsKCnZhciBfcmVhY3RJcyA9IHJlcXVpcmUoInJlYWN0LWlzIik7Cgp2YXIgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlIikpOwoKdmFyIF9ob2lzdE5vblJlYWN0U3RhdGljcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiaG9pc3Qtbm9uLXJlYWN0LXN0YXRpY3MiKSk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKLy8gVE9ETzogUmVwbGFjZSB3aXRoIFJlYWN0LmNyZWF0ZUNvbnRleHQgb25jZSB3ZSBjYW4gYXNzdW1lIFJlYWN0IDE2Kwp2YXIgY3JlYXRlTmFtZWRDb250ZXh0ID0gZnVuY3Rpb24gY3JlYXRlTmFtZWRDb250ZXh0KG5hbWUpIHsKICB2YXIgY29udGV4dCA9ICgwLCBfbWluaUNyZWF0ZVJlYWN0Q29udGV4dC5kZWZhdWx0KSgpOwogIGNvbnRleHQuZGlzcGxheU5hbWUgPSBuYW1lOwogIHJldHVybiBjb250ZXh0Owp9OwoKdmFyIGhpc3RvcnlDb250ZXh0ID0gLyojX19QVVJFX18qL2NyZWF0ZU5hbWVkQ29udGV4dCgiUm91dGVyLUhpc3RvcnkiKTsKZXhwb3J0cy5fX0hpc3RvcnlDb250ZXh0ID0gaGlzdG9yeUNvbnRleHQ7CnZhciBjb250ZXh0ID0gLyojX19QVVJFX18qL2NyZWF0ZU5hbWVkQ29udGV4dCgiUm91dGVyIik7Ci8qKgogKiBUaGUgcHVibGljIEFQSSBmb3IgcHV0dGluZyBoaXN0b3J5IG9uIGNvbnRleHQuCiAqLwoKZXhwb3J0cy5fX1JvdXRlckNvbnRleHQgPSBjb250ZXh0OwoKdmFyIFJvdXRlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkgewogICgwLCBfaW5oZXJpdHNMb29zZTIuZGVmYXVsdCkoUm91dGVyLCBfUmVhY3QkQ29tcG9uZW50KTsKCiAgUm91dGVyLmNvbXB1dGVSb290TWF0Y2ggPSBmdW5jdGlvbiBjb21wdXRlUm9vdE1hdGNoKHBhdGhuYW1lKSB7CiAgICByZXR1cm4gewogICAgICBwYXRoOiAiLyIsCiAgICAgIHVybDogIi8iLAogICAgICBwYXJhbXM6IHt9LAogICAgICBpc0V4YWN0OiBwYXRobmFtZSA9PT0gIi8iCiAgICB9OwogIH07CgogIGZ1bmN0aW9uIFJvdXRlcihwcm9wcykgewogICAgdmFyIF90aGlzOwoKICAgIF90aGlzID0gX1JlYWN0JENvbXBvbmVudC5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzOwogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIGxvY2F0aW9uOiBwcm9wcy5oaXN0b3J5LmxvY2F0aW9uCiAgICB9OyAvLyBUaGlzIGlzIGEgYml0IG9mIGEgaGFjay4gV2UgaGF2ZSB0byBzdGFydCBsaXN0ZW5pbmcgZm9yIGxvY2F0aW9uCiAgICAvLyBjaGFuZ2VzIGhlcmUgaW4gdGhlIGNvbnN0cnVjdG9yIGluIGNhc2UgdGhlcmUgYXJlIGFueSA8UmVkaXJlY3Q+cwogICAgLy8gb24gdGhlIGluaXRpYWwgcmVuZGVyLiBJZiB0aGVyZSBhcmUsIHRoZXkgd2lsbCByZXBsYWNlL3B1c2ggd2hlbgogICAgLy8gdGhleSBtb3VudCBhbmQgc2luY2UgY0RNIGZpcmVzIGluIGNoaWxkcmVuIGJlZm9yZSBwYXJlbnRzLCB3ZSBtYXkKICAgIC8vIGdldCBhIG5ldyBsb2NhdGlvbiBiZWZvcmUgdGhlIDxSb3V0ZXI+IGlzIG1vdW50ZWQuCgogICAgX3RoaXMuX2lzTW91bnRlZCA9IGZhbHNlOwogICAgX3RoaXMuX3BlbmRpbmdMb2NhdGlvbiA9IG51bGw7CgogICAgaWYgKCFwcm9wcy5zdGF0aWNDb250ZXh0KSB7CiAgICAgIF90aGlzLnVubGlzdGVuID0gcHJvcHMuaGlzdG9yeS5saXN0ZW4oZnVuY3Rpb24gKGxvY2F0aW9uKSB7CiAgICAgICAgaWYgKF90aGlzLl9pc01vdW50ZWQpIHsKICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMuX3BlbmRpbmdMb2NhdGlvbiA9IGxvY2F0aW9uOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgdmFyIF9wcm90byA9IFJvdXRlci5wcm90b3R5cGU7CgogIF9wcm90by5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgdGhpcy5faXNNb3VudGVkID0gdHJ1ZTsKCiAgICBpZiAodGhpcy5fcGVuZGluZ0xvY2F0aW9uKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGxvY2F0aW9uOiB0aGlzLl9wZW5kaW5nTG9jYXRpb24KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgX3Byb3RvLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7CiAgICBpZiAodGhpcy51bmxpc3RlbikgewogICAgICB0aGlzLnVubGlzdGVuKCk7CiAgICAgIHRoaXMuX2lzTW91bnRlZCA9IGZhbHNlOwogICAgICB0aGlzLl9wZW5kaW5nTG9jYXRpb24gPSBudWxsOwogICAgfQogIH07CgogIF9wcm90by5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoY29udGV4dC5Qcm92aWRlciwgewogICAgICB2YWx1ZTogewogICAgICAgIGhpc3Rvcnk6IHRoaXMucHJvcHMuaGlzdG9yeSwKICAgICAgICBsb2NhdGlvbjogdGhpcy5zdGF0ZS5sb2NhdGlvbiwKICAgICAgICBtYXRjaDogUm91dGVyLmNvbXB1dGVSb290TWF0Y2godGhpcy5zdGF0ZS5sb2NhdGlvbi5wYXRobmFtZSksCiAgICAgICAgc3RhdGljQ29udGV4dDogdGhpcy5wcm9wcy5zdGF0aWNDb250ZXh0CiAgICAgIH0KICAgIH0sIC8qI19fUFVSRV9fKi9fcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KGhpc3RvcnlDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgIGNoaWxkcmVuOiB0aGlzLnByb3BzLmNoaWxkcmVuIHx8IG51bGwsCiAgICAgIHZhbHVlOiB0aGlzLnByb3BzLmhpc3RvcnkKICAgIH0pKTsKICB9OwoKICByZXR1cm4gUm91dGVyOwp9KF9yZWFjdC5kZWZhdWx0LkNvbXBvbmVudCk7CgpleHBvcnRzLlJvdXRlciA9IFJvdXRlcjsKCmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iKSB7CiAgUm91dGVyLnByb3BUeXBlcyA9IHsKICAgIGNoaWxkcmVuOiBfcHJvcFR5cGVzLmRlZmF1bHQubm9kZSwKICAgIGhpc3Rvcnk6IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QuaXNSZXF1aXJlZCwKICAgIHN0YXRpY0NvbnRleHQ6IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QKICB9OwoKICBSb3V0ZXIucHJvdG90eXBlLmNvbXBvbmVudERpZFVwZGF0ZSA9IGZ1bmN0aW9uIChwcmV2UHJvcHMpIHsKICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlXYXJuaW5nLmRlZmF1bHQpKHByZXZQcm9wcy5oaXN0b3J5ID09PSB0aGlzLnByb3BzLmhpc3RvcnksICJZb3UgY2Fubm90IGNoYW5nZSA8Um91dGVyIGhpc3Rvcnk+IikgOiB2b2lkIDA7CiAgfTsKfQovKioKICogVGhlIHB1YmxpYyBBUEkgZm9yIGEgPFJvdXRlcj4gdGhhdCBzdG9yZXMgbG9jYXRpb24gaW4gbWVtb3J5LgogKi8KCgp2YXIgTWVtb3J5Um91dGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7CiAgKDAsIF9pbmhlcml0c0xvb3NlMi5kZWZhdWx0KShNZW1vcnlSb3V0ZXIsIF9SZWFjdCRDb21wb25lbnQpOwoKICBmdW5jdGlvbiBNZW1vcnlSb3V0ZXIoKSB7CiAgICB2YXIgX3RoaXM7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfUmVhY3QkQ29tcG9uZW50LmNhbGwuYXBwbHkoX1JlYWN0JENvbXBvbmVudCwgW3RoaXNdLmNvbmNhdChhcmdzKSkgfHwgdGhpczsKICAgIF90aGlzLmhpc3RvcnkgPSAoMCwgX2hpc3RvcnkuY3JlYXRlTWVtb3J5SGlzdG9yeSkoX3RoaXMucHJvcHMpOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgdmFyIF9wcm90byA9IE1lbW9yeVJvdXRlci5wcm90b3R5cGU7CgogIF9wcm90by5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgIGhpc3Rvcnk6IHRoaXMuaGlzdG9yeSwKICAgICAgY2hpbGRyZW46IHRoaXMucHJvcHMuY2hpbGRyZW4KICAgIH0pOwogIH07CgogIHJldHVybiBNZW1vcnlSb3V0ZXI7Cn0oX3JlYWN0LmRlZmF1bHQuQ29tcG9uZW50KTsKCmV4cG9ydHMuTWVtb3J5Um91dGVyID0gTWVtb3J5Um91dGVyOwoKaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIpIHsKICBNZW1vcnlSb3V0ZXIucHJvcFR5cGVzID0gewogICAgaW5pdGlhbEVudHJpZXM6IF9wcm9wVHlwZXMuZGVmYXVsdC5hcnJheSwKICAgIGluaXRpYWxJbmRleDogX3Byb3BUeXBlcy5kZWZhdWx0Lm51bWJlciwKICAgIGdldFVzZXJDb25maXJtYXRpb246IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLAogICAga2V5TGVuZ3RoOiBfcHJvcFR5cGVzLmRlZmF1bHQubnVtYmVyLAogICAgY2hpbGRyZW46IF9wcm9wVHlwZXMuZGVmYXVsdC5ub2RlCiAgfTsKCiAgTWVtb3J5Um91dGVyLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHsKICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlXYXJuaW5nLmRlZmF1bHQpKCF0aGlzLnByb3BzLmhpc3RvcnksICI8TWVtb3J5Um91dGVyPiBpZ25vcmVzIHRoZSBoaXN0b3J5IHByb3AuIFRvIHVzZSBhIGN1c3RvbSBoaXN0b3J5LCAiICsgInVzZSBgaW1wb3J0IHsgUm91dGVyIH1gIGluc3RlYWQgb2YgYGltcG9ydCB7IE1lbW9yeVJvdXRlciBhcyBSb3V0ZXIgfWAuIikgOiB2b2lkIDA7CiAgfTsKfQoKdmFyIExpZmVjeWNsZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkgewogICgwLCBfaW5oZXJpdHNMb29zZTIuZGVmYXVsdCkoTGlmZWN5Y2xlLCBfUmVhY3QkQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gTGlmZWN5Y2xlKCkgewogICAgcmV0dXJuIF9SZWFjdCRDb21wb25lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwogIH0KCiAgdmFyIF9wcm90byA9IExpZmVjeWNsZS5wcm90b3R5cGU7CgogIF9wcm90by5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgaWYgKHRoaXMucHJvcHMub25Nb3VudCkgdGhpcy5wcm9wcy5vbk1vdW50LmNhbGwodGhpcywgdGhpcyk7CiAgfTsKCiAgX3Byb3RvLmNvbXBvbmVudERpZFVwZGF0ZSA9IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHsKICAgIGlmICh0aGlzLnByb3BzLm9uVXBkYXRlKSB0aGlzLnByb3BzLm9uVXBkYXRlLmNhbGwodGhpcywgdGhpcywgcHJldlByb3BzKTsKICB9OwoKICBfcHJvdG8uY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHsKICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkgdGhpcy5wcm9wcy5vblVubW91bnQuY2FsbCh0aGlzLCB0aGlzKTsKICB9OwoKICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkgewogICAgcmV0dXJuIG51bGw7CiAgfTsKCiAgcmV0dXJuIExpZmVjeWNsZTsKfShfcmVhY3QuZGVmYXVsdC5Db21wb25lbnQpOwovKioKICogVGhlIHB1YmxpYyBBUEkgZm9yIHByb21wdGluZyB0aGUgdXNlciBiZWZvcmUgbmF2aWdhdGluZyBhd2F5IGZyb20gYSBzY3JlZW4uCiAqLwoKCmZ1bmN0aW9uIFByb21wdChfcmVmKSB7CiAgdmFyIG1lc3NhZ2UgPSBfcmVmLm1lc3NhZ2UsCiAgICAgIF9yZWYkd2hlbiA9IF9yZWYud2hlbiwKICAgICAgd2hlbiA9IF9yZWYkd2hlbiA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9yZWYkd2hlbjsKICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoY29udGV4dC5Db25zdW1lciwgbnVsbCwgZnVuY3Rpb24gKGNvbnRleHQpIHsKICAgICFjb250ZXh0ID8gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIiA/ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSwgIllvdSBzaG91bGQgbm90IHVzZSA8UHJvbXB0PiBvdXRzaWRlIGEgPFJvdXRlcj4iKSA6ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSkgOiB2b2lkIDA7CiAgICBpZiAoIXdoZW4gfHwgY29udGV4dC5zdGF0aWNDb250ZXh0KSByZXR1cm4gbnVsbDsKICAgIHZhciBtZXRob2QgPSBjb250ZXh0Lmhpc3RvcnkuYmxvY2s7CiAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoTGlmZWN5Y2xlLCB7CiAgICAgIG9uTW91bnQ6IGZ1bmN0aW9uIG9uTW91bnQoc2VsZikgewogICAgICAgIHNlbGYucmVsZWFzZSA9IG1ldGhvZChtZXNzYWdlKTsKICAgICAgfSwKICAgICAgb25VcGRhdGU6IGZ1bmN0aW9uIG9uVXBkYXRlKHNlbGYsIHByZXZQcm9wcykgewogICAgICAgIGlmIChwcmV2UHJvcHMubWVzc2FnZSAhPT0gbWVzc2FnZSkgewogICAgICAgICAgc2VsZi5yZWxlYXNlKCk7CiAgICAgICAgICBzZWxmLnJlbGVhc2UgPSBtZXRob2QobWVzc2FnZSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBvblVubW91bnQ6IGZ1bmN0aW9uIG9uVW5tb3VudChzZWxmKSB7CiAgICAgICAgc2VsZi5yZWxlYXNlKCk7CiAgICAgIH0sCiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UKICAgIH0pOwogIH0pOwp9CgppZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIikgewogIHZhciBtZXNzYWdlVHlwZSA9IF9wcm9wVHlwZXMuZGVmYXVsdC5vbmVPZlR5cGUoW19wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLCBfcHJvcFR5cGVzLmRlZmF1bHQuc3RyaW5nXSk7CgogIFByb21wdC5wcm9wVHlwZXMgPSB7CiAgICB3aGVuOiBfcHJvcFR5cGVzLmRlZmF1bHQuYm9vbCwKICAgIG1lc3NhZ2U6IG1lc3NhZ2VUeXBlLmlzUmVxdWlyZWQKICB9Owp9Cgp2YXIgY2FjaGUgPSB7fTsKdmFyIGNhY2hlTGltaXQgPSAxMDAwMDsKdmFyIGNhY2hlQ291bnQgPSAwOwoKZnVuY3Rpb24gY29tcGlsZVBhdGgocGF0aCkgewogIGlmIChjYWNoZVtwYXRoXSkgcmV0dXJuIGNhY2hlW3BhdGhdOwoKICB2YXIgZ2VuZXJhdG9yID0gX3BhdGhUb1JlZ2V4cC5kZWZhdWx0LmNvbXBpbGUocGF0aCk7CgogIGlmIChjYWNoZUNvdW50IDwgY2FjaGVMaW1pdCkgewogICAgY2FjaGVbcGF0aF0gPSBnZW5lcmF0b3I7CiAgICBjYWNoZUNvdW50Kys7CiAgfQoKICByZXR1cm4gZ2VuZXJhdG9yOwp9Ci8qKgogKiBQdWJsaWMgQVBJIGZvciBnZW5lcmF0aW5nIGEgVVJMIHBhdGhuYW1lIGZyb20gYSBwYXRoIGFuZCBwYXJhbWV0ZXJzLgogKi8KCgpmdW5jdGlvbiBnZW5lcmF0ZVBhdGgocGF0aCwgcGFyYW1zKSB7CiAgaWYgKHBhdGggPT09IHZvaWQgMCkgewogICAgcGF0aCA9ICIvIjsKICB9CgogIGlmIChwYXJhbXMgPT09IHZvaWQgMCkgewogICAgcGFyYW1zID0ge307CiAgfQoKICByZXR1cm4gcGF0aCA9PT0gIi8iID8gcGF0aCA6IGNvbXBpbGVQYXRoKHBhdGgpKHBhcmFtcywgewogICAgcHJldHR5OiB0cnVlCiAgfSk7Cn0KLyoqCiAqIFRoZSBwdWJsaWMgQVBJIGZvciBuYXZpZ2F0aW5nIHByb2dyYW1tYXRpY2FsbHkgd2l0aCBhIGNvbXBvbmVudC4KICovCgoKZnVuY3Rpb24gUmVkaXJlY3QoX3JlZikgewogIHZhciBjb21wdXRlZE1hdGNoID0gX3JlZi5jb21wdXRlZE1hdGNoLAogICAgICB0byA9IF9yZWYudG8sCiAgICAgIF9yZWYkcHVzaCA9IF9yZWYucHVzaCwKICAgICAgcHVzaCA9IF9yZWYkcHVzaCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJHB1c2g7CiAgcmV0dXJuIC8qI19fUFVSRV9fKi9fcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KGNvbnRleHQuQ29uc3VtZXIsIG51bGwsIGZ1bmN0aW9uIChjb250ZXh0KSB7CiAgICAhY29udGV4dCA/IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlJbnZhcmlhbnQuZGVmYXVsdCkoZmFsc2UsICJZb3Ugc2hvdWxkIG5vdCB1c2UgPFJlZGlyZWN0PiBvdXRzaWRlIGEgPFJvdXRlcj4iKSA6ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSkgOiB2b2lkIDA7CiAgICB2YXIgaGlzdG9yeSA9IGNvbnRleHQuaGlzdG9yeSwKICAgICAgICBzdGF0aWNDb250ZXh0ID0gY29udGV4dC5zdGF0aWNDb250ZXh0OwogICAgdmFyIG1ldGhvZCA9IHB1c2ggPyBoaXN0b3J5LnB1c2ggOiBoaXN0b3J5LnJlcGxhY2U7CiAgICB2YXIgbG9jYXRpb24gPSAoMCwgX2hpc3RvcnkuY3JlYXRlTG9jYXRpb24pKGNvbXB1dGVkTWF0Y2ggPyB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gZ2VuZXJhdGVQYXRoKHRvLCBjb21wdXRlZE1hdGNoLnBhcmFtcykgOiAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCB0bywgewogICAgICBwYXRobmFtZTogZ2VuZXJhdGVQYXRoKHRvLnBhdGhuYW1lLCBjb21wdXRlZE1hdGNoLnBhcmFtcykKICAgIH0pIDogdG8pOyAvLyBXaGVuIHJlbmRlcmluZyBpbiBhIHN0YXRpYyBjb250ZXh0LAogICAgLy8gc2V0IHRoZSBuZXcgbG9jYXRpb24gaW1tZWRpYXRlbHkuCgogICAgaWYgKHN0YXRpY0NvbnRleHQpIHsKICAgICAgbWV0aG9kKGxvY2F0aW9uKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcmV0dXJuIC8qI19fUFVSRV9fKi9fcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KExpZmVjeWNsZSwgewogICAgICBvbk1vdW50OiBmdW5jdGlvbiBvbk1vdW50KCkgewogICAgICAgIG1ldGhvZChsb2NhdGlvbik7CiAgICAgIH0sCiAgICAgIG9uVXBkYXRlOiBmdW5jdGlvbiBvblVwZGF0ZShzZWxmLCBwcmV2UHJvcHMpIHsKICAgICAgICB2YXIgcHJldkxvY2F0aW9uID0gKDAsIF9oaXN0b3J5LmNyZWF0ZUxvY2F0aW9uKShwcmV2UHJvcHMudG8pOwoKICAgICAgICBpZiAoISgwLCBfaGlzdG9yeS5sb2NhdGlvbnNBcmVFcXVhbCkocHJldkxvY2F0aW9uLCAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCBsb2NhdGlvbiwgewogICAgICAgICAga2V5OiBwcmV2TG9jYXRpb24ua2V5CiAgICAgICAgfSkpKSB7CiAgICAgICAgICBtZXRob2QobG9jYXRpb24pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdG86IHRvCiAgICB9KTsKICB9KTsKfQoKaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIpIHsKICBSZWRpcmVjdC5wcm9wVHlwZXMgPSB7CiAgICBwdXNoOiBfcHJvcFR5cGVzLmRlZmF1bHQuYm9vbCwKICAgIGZyb206IF9wcm9wVHlwZXMuZGVmYXVsdC5zdHJpbmcsCiAgICB0bzogX3Byb3BUeXBlcy5kZWZhdWx0Lm9uZU9mVHlwZShbX3Byb3BUeXBlcy5kZWZhdWx0LnN0cmluZywgX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdF0pLmlzUmVxdWlyZWQKICB9Owp9Cgp2YXIgY2FjaGUkMSA9IHt9Owp2YXIgY2FjaGVMaW1pdCQxID0gMTAwMDA7CnZhciBjYWNoZUNvdW50JDEgPSAwOwoKZnVuY3Rpb24gY29tcGlsZVBhdGgkMShwYXRoLCBvcHRpb25zKSB7CiAgdmFyIGNhY2hlS2V5ID0gIiIgKyBvcHRpb25zLmVuZCArIG9wdGlvbnMuc3RyaWN0ICsgb3B0aW9ucy5zZW5zaXRpdmU7CiAgdmFyIHBhdGhDYWNoZSA9IGNhY2hlJDFbY2FjaGVLZXldIHx8IChjYWNoZSQxW2NhY2hlS2V5XSA9IHt9KTsKICBpZiAocGF0aENhY2hlW3BhdGhdKSByZXR1cm4gcGF0aENhY2hlW3BhdGhdOwogIHZhciBrZXlzID0gW107CiAgdmFyIHJlZ2V4cCA9ICgwLCBfcGF0aFRvUmVnZXhwLmRlZmF1bHQpKHBhdGgsIGtleXMsIG9wdGlvbnMpOwogIHZhciByZXN1bHQgPSB7CiAgICByZWdleHA6IHJlZ2V4cCwKICAgIGtleXM6IGtleXMKICB9OwoKICBpZiAoY2FjaGVDb3VudCQxIDwgY2FjaGVMaW1pdCQxKSB7CiAgICBwYXRoQ2FjaGVbcGF0aF0gPSByZXN1bHQ7CiAgICBjYWNoZUNvdW50JDErKzsKICB9CgogIHJldHVybiByZXN1bHQ7Cn0KLyoqCiAqIFB1YmxpYyBBUEkgZm9yIG1hdGNoaW5nIGEgVVJMIHBhdGhuYW1lIHRvIGEgcGF0aC4KICovCgoKZnVuY3Rpb24gbWF0Y2hQYXRoKHBhdGhuYW1lLCBvcHRpb25zKSB7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgb3B0aW9ucyA9IHt9OwogIH0KCiAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiB8fCBBcnJheS5pc0FycmF5KG9wdGlvbnMpKSB7CiAgICBvcHRpb25zID0gewogICAgICBwYXRoOiBvcHRpb25zCiAgICB9OwogIH0KCiAgdmFyIF9vcHRpb25zID0gb3B0aW9ucywKICAgICAgcGF0aCA9IF9vcHRpb25zLnBhdGgsCiAgICAgIF9vcHRpb25zJGV4YWN0ID0gX29wdGlvbnMuZXhhY3QsCiAgICAgIGV4YWN0ID0gX29wdGlvbnMkZXhhY3QgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkZXhhY3QsCiAgICAgIF9vcHRpb25zJHN0cmljdCA9IF9vcHRpb25zLnN0cmljdCwKICAgICAgc3RyaWN0ID0gX29wdGlvbnMkc3RyaWN0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHN0cmljdCwKICAgICAgX29wdGlvbnMkc2Vuc2l0aXZlID0gX29wdGlvbnMuc2Vuc2l0aXZlLAogICAgICBzZW5zaXRpdmUgPSBfb3B0aW9ucyRzZW5zaXRpdmUgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkc2Vuc2l0aXZlOwogIHZhciBwYXRocyA9IFtdLmNvbmNhdChwYXRoKTsKICByZXR1cm4gcGF0aHMucmVkdWNlKGZ1bmN0aW9uIChtYXRjaGVkLCBwYXRoKSB7CiAgICBpZiAoIXBhdGggJiYgcGF0aCAhPT0gIiIpIHJldHVybiBudWxsOwogICAgaWYgKG1hdGNoZWQpIHJldHVybiBtYXRjaGVkOwoKICAgIHZhciBfY29tcGlsZVBhdGggPSBjb21waWxlUGF0aCQxKHBhdGgsIHsKICAgICAgZW5kOiBleGFjdCwKICAgICAgc3RyaWN0OiBzdHJpY3QsCiAgICAgIHNlbnNpdGl2ZTogc2Vuc2l0aXZlCiAgICB9KSwKICAgICAgICByZWdleHAgPSBfY29tcGlsZVBhdGgucmVnZXhwLAogICAgICAgIGtleXMgPSBfY29tcGlsZVBhdGgua2V5czsKCiAgICB2YXIgbWF0Y2ggPSByZWdleHAuZXhlYyhwYXRobmFtZSk7CiAgICBpZiAoIW1hdGNoKSByZXR1cm4gbnVsbDsKICAgIHZhciB1cmwgPSBtYXRjaFswXSwKICAgICAgICB2YWx1ZXMgPSBtYXRjaC5zbGljZSgxKTsKICAgIHZhciBpc0V4YWN0ID0gcGF0aG5hbWUgPT09IHVybDsKICAgIGlmIChleGFjdCAmJiAhaXNFeGFjdCkgcmV0dXJuIG51bGw7CiAgICByZXR1cm4gewogICAgICBwYXRoOiBwYXRoLAogICAgICAvLyB0aGUgcGF0aCB1c2VkIHRvIG1hdGNoCiAgICAgIHVybDogcGF0aCA9PT0gIi8iICYmIHVybCA9PT0gIiIgPyAiLyIgOiB1cmwsCiAgICAgIC8vIHRoZSBtYXRjaGVkIHBvcnRpb24gb2YgdGhlIFVSTAogICAgICBpc0V4YWN0OiBpc0V4YWN0LAogICAgICAvLyB3aGV0aGVyIG9yIG5vdCB3ZSBtYXRjaGVkIGV4YWN0bHkKICAgICAgcGFyYW1zOiBrZXlzLnJlZHVjZShmdW5jdGlvbiAobWVtbywga2V5LCBpbmRleCkgewogICAgICAgIG1lbW9ba2V5Lm5hbWVdID0gdmFsdWVzW2luZGV4XTsKICAgICAgICByZXR1cm4gbWVtbzsKICAgICAgfSwge30pCiAgICB9OwogIH0sIG51bGwpOwp9CgpmdW5jdGlvbiBpc0VtcHR5Q2hpbGRyZW4oY2hpbGRyZW4pIHsKICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuQ2hpbGRyZW4uY291bnQoY2hpbGRyZW4pID09PSAwOwp9CgpmdW5jdGlvbiBldmFsQ2hpbGRyZW5EZXYoY2hpbGRyZW4sIHByb3BzLCBwYXRoKSB7CiAgdmFyIHZhbHVlID0gY2hpbGRyZW4ocHJvcHMpOwogIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlXYXJuaW5nLmRlZmF1bHQpKHZhbHVlICE9PSB1bmRlZmluZWQsICJZb3UgcmV0dXJuZWQgYHVuZGVmaW5lZGAgZnJvbSB0aGUgYGNoaWxkcmVuYCBmdW5jdGlvbiBvZiAiICsgKCI8Um91dGUiICsgKHBhdGggPyAiIHBhdGg9XCIiICsgcGF0aCArICJcIiIgOiAiIikgKyAiPiwgYnV0IHlvdSAiKSArICJzaG91bGQgaGF2ZSByZXR1cm5lZCBhIFJlYWN0IGVsZW1lbnQgb3IgYG51bGxgIikgOiB2b2lkIDA7CiAgcmV0dXJuIHZhbHVlIHx8IG51bGw7Cn0KLyoqCiAqIFRoZSBwdWJsaWMgQVBJIGZvciBtYXRjaGluZyBhIHNpbmdsZSBwYXRoIGFuZCByZW5kZXJpbmcuCiAqLwoKCnZhciBSb3V0ZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkgewogICgwLCBfaW5oZXJpdHNMb29zZTIuZGVmYXVsdCkoUm91dGUsIF9SZWFjdCRDb21wb25lbnQpOwoKICBmdW5jdGlvbiBSb3V0ZSgpIHsKICAgIHJldHVybiBfUmVhY3QkQ29tcG9uZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKICB9CgogIHZhciBfcHJvdG8gPSBSb3V0ZS5wcm90b3R5cGU7CgogIF9wcm90by5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHJldHVybiAvKiNfX1BVUkVfXyovX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChjb250ZXh0LkNvbnN1bWVyLCBudWxsLCBmdW5jdGlvbiAoY29udGV4dCQxKSB7CiAgICAgICFjb250ZXh0JDEgPyBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iID8gKDAsIF90aW55SW52YXJpYW50LmRlZmF1bHQpKGZhbHNlLCAiWW91IHNob3VsZCBub3QgdXNlIDxSb3V0ZT4gb3V0c2lkZSBhIDxSb3V0ZXI+IikgOiAoMCwgX3RpbnlJbnZhcmlhbnQuZGVmYXVsdCkoZmFsc2UpIDogdm9pZCAwOwogICAgICB2YXIgbG9jYXRpb24gPSBfdGhpcy5wcm9wcy5sb2NhdGlvbiB8fCBjb250ZXh0JDEubG9jYXRpb247CiAgICAgIHZhciBtYXRjaCA9IF90aGlzLnByb3BzLmNvbXB1dGVkTWF0Y2ggPyBfdGhpcy5wcm9wcy5jb21wdXRlZE1hdGNoIC8vIDxTd2l0Y2g+IGFscmVhZHkgY29tcHV0ZWQgdGhlIG1hdGNoIGZvciB1cwogICAgICA6IF90aGlzLnByb3BzLnBhdGggPyBtYXRjaFBhdGgobG9jYXRpb24ucGF0aG5hbWUsIF90aGlzLnByb3BzKSA6IGNvbnRleHQkMS5tYXRjaDsKICAgICAgdmFyIHByb3BzID0gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgY29udGV4dCQxLCB7CiAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgIG1hdGNoOiBtYXRjaAogICAgICB9KTsKICAgICAgdmFyIF90aGlzJHByb3BzID0gX3RoaXMucHJvcHMsCiAgICAgICAgICBjaGlsZHJlbiA9IF90aGlzJHByb3BzLmNoaWxkcmVuLAogICAgICAgICAgY29tcG9uZW50ID0gX3RoaXMkcHJvcHMuY29tcG9uZW50LAogICAgICAgICAgcmVuZGVyID0gX3RoaXMkcHJvcHMucmVuZGVyOyAvLyBQcmVhY3QgdXNlcyBhbiBlbXB0eSBhcnJheSBhcyBjaGlsZHJlbiBieQogICAgICAvLyBkZWZhdWx0LCBzbyB1c2UgbnVsbCBpZiB0aGF0J3MgdGhlIGNhc2UuCgogICAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikgJiYgaXNFbXB0eUNoaWxkcmVuKGNoaWxkcmVuKSkgewogICAgICAgIGNoaWxkcmVuID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9fcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KGNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICB2YWx1ZTogcHJvcHMKICAgICAgfSwgcHJvcHMubWF0Y2ggPyBjaGlsZHJlbiA/IHR5cGVvZiBjaGlsZHJlbiA9PT0gImZ1bmN0aW9uIiA/IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyBldmFsQ2hpbGRyZW5EZXYoY2hpbGRyZW4sIHByb3BzLCBfdGhpcy5wcm9wcy5wYXRoKSA6IGNoaWxkcmVuKHByb3BzKSA6IGNoaWxkcmVuIDogY29tcG9uZW50ID8gLyojX19QVVJFX18qL19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50LCBwcm9wcykgOiByZW5kZXIgPyByZW5kZXIocHJvcHMpIDogbnVsbCA6IHR5cGVvZiBjaGlsZHJlbiA9PT0gImZ1bmN0aW9uIiA/IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyBldmFsQ2hpbGRyZW5EZXYoY2hpbGRyZW4sIHByb3BzLCBfdGhpcy5wcm9wcy5wYXRoKSA6IGNoaWxkcmVuKHByb3BzKSA6IG51bGwpOwogICAgfSk7CiAgfTsKCiAgcmV0dXJuIFJvdXRlOwp9KF9yZWFjdC5kZWZhdWx0LkNvbXBvbmVudCk7CgpleHBvcnRzLlJvdXRlID0gUm91dGU7CgppZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIikgewogIFJvdXRlLnByb3BUeXBlcyA9IHsKICAgIGNoaWxkcmVuOiBfcHJvcFR5cGVzLmRlZmF1bHQub25lT2ZUeXBlKFtfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYywgX3Byb3BUeXBlcy5kZWZhdWx0Lm5vZGVdKSwKICAgIGNvbXBvbmVudDogZnVuY3Rpb24gY29tcG9uZW50KHByb3BzLCBwcm9wTmFtZSkgewogICAgICBpZiAocHJvcHNbcHJvcE5hbWVdICYmICEoMCwgX3JlYWN0SXMuaXNWYWxpZEVsZW1lbnRUeXBlKShwcm9wc1twcm9wTmFtZV0pKSB7CiAgICAgICAgcmV0dXJuIG5ldyBFcnJvcigiSW52YWxpZCBwcm9wICdjb21wb25lbnQnIHN1cHBsaWVkIHRvICdSb3V0ZSc6IHRoZSBwcm9wIGlzIG5vdCBhIHZhbGlkIFJlYWN0IGNvbXBvbmVudCIpOwogICAgICB9CiAgICB9LAogICAgZXhhY3Q6IF9wcm9wVHlwZXMuZGVmYXVsdC5ib29sLAogICAgbG9jYXRpb246IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QsCiAgICBwYXRoOiBfcHJvcFR5cGVzLmRlZmF1bHQub25lT2ZUeXBlKFtfcHJvcFR5cGVzLmRlZmF1bHQuc3RyaW5nLCBfcHJvcFR5cGVzLmRlZmF1bHQuYXJyYXlPZihfcHJvcFR5cGVzLmRlZmF1bHQuc3RyaW5nKV0pLAogICAgcmVuZGVyOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYywKICAgIHNlbnNpdGl2ZTogX3Byb3BUeXBlcy5kZWZhdWx0LmJvb2wsCiAgICBzdHJpY3Q6IF9wcm9wVHlwZXMuZGVmYXVsdC5ib29sCiAgfTsKCiAgUm91dGUucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkgewogICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIiA/ICgwLCBfdGlueVdhcm5pbmcuZGVmYXVsdCkoISh0aGlzLnByb3BzLmNoaWxkcmVuICYmICFpc0VtcHR5Q2hpbGRyZW4odGhpcy5wcm9wcy5jaGlsZHJlbikgJiYgdGhpcy5wcm9wcy5jb21wb25lbnQpLCAiWW91IHNob3VsZCBub3QgdXNlIDxSb3V0ZSBjb21wb25lbnQ+IGFuZCA8Um91dGUgY2hpbGRyZW4+IGluIHRoZSBzYW1lIHJvdXRlOyA8Um91dGUgY29tcG9uZW50PiB3aWxsIGJlIGlnbm9yZWQiKSA6IHZvaWQgMDsKICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlXYXJuaW5nLmRlZmF1bHQpKCEodGhpcy5wcm9wcy5jaGlsZHJlbiAmJiAhaXNFbXB0eUNoaWxkcmVuKHRoaXMucHJvcHMuY2hpbGRyZW4pICYmIHRoaXMucHJvcHMucmVuZGVyKSwgIllvdSBzaG91bGQgbm90IHVzZSA8Um91dGUgcmVuZGVyPiBhbmQgPFJvdXRlIGNoaWxkcmVuPiBpbiB0aGUgc2FtZSByb3V0ZTsgPFJvdXRlIHJlbmRlcj4gd2lsbCBiZSBpZ25vcmVkIikgOiB2b2lkIDA7CiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iID8gKDAsIF90aW55V2FybmluZy5kZWZhdWx0KSghKHRoaXMucHJvcHMuY29tcG9uZW50ICYmIHRoaXMucHJvcHMucmVuZGVyKSwgIllvdSBzaG91bGQgbm90IHVzZSA8Um91dGUgY29tcG9uZW50PiBhbmQgPFJvdXRlIHJlbmRlcj4gaW4gdGhlIHNhbWUgcm91dGU7IDxSb3V0ZSByZW5kZXI+IHdpbGwgYmUgaWdub3JlZCIpIDogdm9pZCAwOwogIH07CgogIFJvdXRlLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiAocHJldlByb3BzKSB7CiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iID8gKDAsIF90aW55V2FybmluZy5kZWZhdWx0KSghKHRoaXMucHJvcHMubG9jYXRpb24gJiYgIXByZXZQcm9wcy5sb2NhdGlvbiksICc8Um91dGU+IGVsZW1lbnRzIHNob3VsZCBub3QgY2hhbmdlIGZyb20gdW5jb250cm9sbGVkIHRvIGNvbnRyb2xsZWQgKG9yIHZpY2UgdmVyc2EpLiBZb3UgaW5pdGlhbGx5IHVzZWQgbm8gImxvY2F0aW9uIiBwcm9wIGFuZCB0aGVuIHByb3ZpZGVkIG9uZSBvbiBhIHN1YnNlcXVlbnQgcmVuZGVyLicpIDogdm9pZCAwOwogICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIiA/ICgwLCBfdGlueVdhcm5pbmcuZGVmYXVsdCkoISghdGhpcy5wcm9wcy5sb2NhdGlvbiAmJiBwcmV2UHJvcHMubG9jYXRpb24pLCAnPFJvdXRlPiBlbGVtZW50cyBzaG91bGQgbm90IGNoYW5nZSBmcm9tIGNvbnRyb2xsZWQgdG8gdW5jb250cm9sbGVkIChvciB2aWNlIHZlcnNhKS4gWW91IHByb3ZpZGVkIGEgImxvY2F0aW9uIiBwcm9wIGluaXRpYWxseSBidXQgb21pdHRlZCBpdCBvbiBhIHN1YnNlcXVlbnQgcmVuZGVyLicpIDogdm9pZCAwOwogIH07Cn0KCmZ1bmN0aW9uIGFkZExlYWRpbmdTbGFzaChwYXRoKSB7CiAgcmV0dXJuIHBhdGguY2hhckF0KDApID09PSAiLyIgPyBwYXRoIDogIi8iICsgcGF0aDsKfQoKZnVuY3Rpb24gYWRkQmFzZW5hbWUoYmFzZW5hbWUsIGxvY2F0aW9uKSB7CiAgaWYgKCFiYXNlbmFtZSkgcmV0dXJuIGxvY2F0aW9uOwogIHJldHVybiAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCBsb2NhdGlvbiwgewogICAgcGF0aG5hbWU6IGFkZExlYWRpbmdTbGFzaChiYXNlbmFtZSkgKyBsb2NhdGlvbi5wYXRobmFtZQogIH0pOwp9CgpmdW5jdGlvbiBzdHJpcEJhc2VuYW1lKGJhc2VuYW1lLCBsb2NhdGlvbikgewogIGlmICghYmFzZW5hbWUpIHJldHVybiBsb2NhdGlvbjsKICB2YXIgYmFzZSA9IGFkZExlYWRpbmdTbGFzaChiYXNlbmFtZSk7CiAgaWYgKGxvY2F0aW9uLnBhdGhuYW1lLmluZGV4T2YoYmFzZSkgIT09IDApIHJldHVybiBsb2NhdGlvbjsKICByZXR1cm4gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgbG9jYXRpb24sIHsKICAgIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZS5zdWJzdHIoYmFzZS5sZW5ndGgpCiAgfSk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVVSTChsb2NhdGlvbikgewogIHJldHVybiB0eXBlb2YgbG9jYXRpb24gPT09ICJzdHJpbmciID8gbG9jYXRpb24gOiAoMCwgX2hpc3RvcnkuY3JlYXRlUGF0aCkobG9jYXRpb24pOwp9CgpmdW5jdGlvbiBzdGF0aWNIYW5kbGVyKG1ldGhvZE5hbWUpIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIiA/ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSwgIllvdSBjYW5ub3QgJXMgd2l0aCA8U3RhdGljUm91dGVyPiIsIG1ldGhvZE5hbWUpIDogKDAsIF90aW55SW52YXJpYW50LmRlZmF1bHQpKGZhbHNlKTsKICB9Owp9CgpmdW5jdGlvbiBub29wKCkge30KLyoqCiAqIFRoZSBwdWJsaWMgdG9wLWxldmVsIEFQSSBmb3IgYSAic3RhdGljIiA8Um91dGVyPiwgc28tY2FsbGVkIGJlY2F1c2UgaXQKICogY2FuJ3QgYWN0dWFsbHkgY2hhbmdlIHRoZSBjdXJyZW50IGxvY2F0aW9uLiBJbnN0ZWFkLCBpdCBqdXN0IHJlY29yZHMKICogbG9jYXRpb24gY2hhbmdlcyBpbiBhIGNvbnRleHQgb2JqZWN0LiBVc2VmdWwgbWFpbmx5IGluIHRlc3RpbmcgYW5kCiAqIHNlcnZlci1yZW5kZXJpbmcgc2NlbmFyaW9zLgogKi8KCgp2YXIgU3RhdGljUm91dGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7CiAgKDAsIF9pbmhlcml0c0xvb3NlMi5kZWZhdWx0KShTdGF0aWNSb3V0ZXIsIF9SZWFjdCRDb21wb25lbnQpOwoKICBmdW5jdGlvbiBTdGF0aWNSb3V0ZXIoKSB7CiAgICB2YXIgX3RoaXM7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfUmVhY3QkQ29tcG9uZW50LmNhbGwuYXBwbHkoX1JlYWN0JENvbXBvbmVudCwgW3RoaXNdLmNvbmNhdChhcmdzKSkgfHwgdGhpczsKCiAgICBfdGhpcy5oYW5kbGVQdXNoID0gZnVuY3Rpb24gKGxvY2F0aW9uKSB7CiAgICAgIHJldHVybiBfdGhpcy5uYXZpZ2F0ZVRvKGxvY2F0aW9uLCAiUFVTSCIpOwogICAgfTsKCiAgICBfdGhpcy5oYW5kbGVSZXBsYWNlID0gZnVuY3Rpb24gKGxvY2F0aW9uKSB7CiAgICAgIHJldHVybiBfdGhpcy5uYXZpZ2F0ZVRvKGxvY2F0aW9uLCAiUkVQTEFDRSIpOwogICAgfTsKCiAgICBfdGhpcy5oYW5kbGVMaXN0ZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBub29wOwogICAgfTsKCiAgICBfdGhpcy5oYW5kbGVCbG9jayA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5vb3A7CiAgICB9OwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIHZhciBfcHJvdG8gPSBTdGF0aWNSb3V0ZXIucHJvdG90eXBlOwoKICBfcHJvdG8ubmF2aWdhdGVUbyA9IGZ1bmN0aW9uIG5hdmlnYXRlVG8obG9jYXRpb24sIGFjdGlvbikgewogICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICBfdGhpcyRwcm9wcyRiYXNlbmFtZSA9IF90aGlzJHByb3BzLmJhc2VuYW1lLAogICAgICAgIGJhc2VuYW1lID0gX3RoaXMkcHJvcHMkYmFzZW5hbWUgPT09IHZvaWQgMCA/ICIiIDogX3RoaXMkcHJvcHMkYmFzZW5hbWUsCiAgICAgICAgX3RoaXMkcHJvcHMkY29udGV4dCA9IF90aGlzJHByb3BzLmNvbnRleHQsCiAgICAgICAgY29udGV4dCA9IF90aGlzJHByb3BzJGNvbnRleHQgPT09IHZvaWQgMCA/IHt9IDogX3RoaXMkcHJvcHMkY29udGV4dDsKICAgIGNvbnRleHQuYWN0aW9uID0gYWN0aW9uOwogICAgY29udGV4dC5sb2NhdGlvbiA9IGFkZEJhc2VuYW1lKGJhc2VuYW1lLCAoMCwgX2hpc3RvcnkuY3JlYXRlTG9jYXRpb24pKGxvY2F0aW9uKSk7CiAgICBjb250ZXh0LnVybCA9IGNyZWF0ZVVSTChjb250ZXh0LmxvY2F0aW9uKTsKICB9OwoKICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkgewogICAgdmFyIF90aGlzJHByb3BzMiA9IHRoaXMucHJvcHMsCiAgICAgICAgX3RoaXMkcHJvcHMyJGJhc2VuYW1lID0gX3RoaXMkcHJvcHMyLmJhc2VuYW1lLAogICAgICAgIGJhc2VuYW1lID0gX3RoaXMkcHJvcHMyJGJhc2VuYW1lID09PSB2b2lkIDAgPyAiIiA6IF90aGlzJHByb3BzMiRiYXNlbmFtZSwKICAgICAgICBfdGhpcyRwcm9wczIkY29udGV4dCA9IF90aGlzJHByb3BzMi5jb250ZXh0LAogICAgICAgIGNvbnRleHQgPSBfdGhpcyRwcm9wczIkY29udGV4dCA9PT0gdm9pZCAwID8ge30gOiBfdGhpcyRwcm9wczIkY29udGV4dCwKICAgICAgICBfdGhpcyRwcm9wczIkbG9jYXRpb24gPSBfdGhpcyRwcm9wczIubG9jYXRpb24sCiAgICAgICAgbG9jYXRpb24gPSBfdGhpcyRwcm9wczIkbG9jYXRpb24gPT09IHZvaWQgMCA/ICIvIiA6IF90aGlzJHByb3BzMiRsb2NhdGlvbiwKICAgICAgICByZXN0ID0gKDAsIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlMi5kZWZhdWx0KShfdGhpcyRwcm9wczIsIFsiYmFzZW5hbWUiLCAiY29udGV4dCIsICJsb2NhdGlvbiJdKTsKICAgIHZhciBoaXN0b3J5ID0gewogICAgICBjcmVhdGVIcmVmOiBmdW5jdGlvbiBjcmVhdGVIcmVmKHBhdGgpIHsKICAgICAgICByZXR1cm4gYWRkTGVhZGluZ1NsYXNoKGJhc2VuYW1lICsgY3JlYXRlVVJMKHBhdGgpKTsKICAgICAgfSwKICAgICAgYWN0aW9uOiAiUE9QIiwKICAgICAgbG9jYXRpb246IHN0cmlwQmFzZW5hbWUoYmFzZW5hbWUsICgwLCBfaGlzdG9yeS5jcmVhdGVMb2NhdGlvbikobG9jYXRpb24pKSwKICAgICAgcHVzaDogdGhpcy5oYW5kbGVQdXNoLAogICAgICByZXBsYWNlOiB0aGlzLmhhbmRsZVJlcGxhY2UsCiAgICAgIGdvOiBzdGF0aWNIYW5kbGVyKCJnbyIpLAogICAgICBnb0JhY2s6IHN0YXRpY0hhbmRsZXIoImdvQmFjayIpLAogICAgICBnb0ZvcndhcmQ6IHN0YXRpY0hhbmRsZXIoImdvRm9yd2FyZCIpLAogICAgICBsaXN0ZW46IHRoaXMuaGFuZGxlTGlzdGVuLAogICAgICBibG9jazogdGhpcy5oYW5kbGVCbG9jawogICAgfTsKICAgIHJldHVybiAvKiNfX1BVUkVfXyovX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChSb3V0ZXIsICgwLCBfZXh0ZW5kczIuZGVmYXVsdCkoe30sIHJlc3QsIHsKICAgICAgaGlzdG9yeTogaGlzdG9yeSwKICAgICAgc3RhdGljQ29udGV4dDogY29udGV4dAogICAgfSkpOwogIH07CgogIHJldHVybiBTdGF0aWNSb3V0ZXI7Cn0oX3JlYWN0LmRlZmF1bHQuQ29tcG9uZW50KTsKCmV4cG9ydHMuU3RhdGljUm91dGVyID0gU3RhdGljUm91dGVyOwoKaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIpIHsKICBTdGF0aWNSb3V0ZXIucHJvcFR5cGVzID0gewogICAgYmFzZW5hbWU6IF9wcm9wVHlwZXMuZGVmYXVsdC5zdHJpbmcsCiAgICBjb250ZXh0OiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LAogICAgbG9jYXRpb246IF9wcm9wVHlwZXMuZGVmYXVsdC5vbmVPZlR5cGUoW19wcm9wVHlwZXMuZGVmYXVsdC5zdHJpbmcsIF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3RdKQogIH07CgogIFN0YXRpY1JvdXRlci5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iID8gKDAsIF90aW55V2FybmluZy5kZWZhdWx0KSghdGhpcy5wcm9wcy5oaXN0b3J5LCAiPFN0YXRpY1JvdXRlcj4gaWdub3JlcyB0aGUgaGlzdG9yeSBwcm9wLiBUbyB1c2UgYSBjdXN0b20gaGlzdG9yeSwgIiArICJ1c2UgYGltcG9ydCB7IFJvdXRlciB9YCBpbnN0ZWFkIG9mIGBpbXBvcnQgeyBTdGF0aWNSb3V0ZXIgYXMgUm91dGVyIH1gLiIpIDogdm9pZCAwOwogIH07Cn0KLyoqCiAqIFRoZSBwdWJsaWMgQVBJIGZvciByZW5kZXJpbmcgdGhlIGZpcnN0IDxSb3V0ZT4gdGhhdCBtYXRjaGVzLgogKi8KCgp2YXIgU3dpdGNoID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7CiAgKDAsIF9pbmhlcml0c0xvb3NlMi5kZWZhdWx0KShTd2l0Y2gsIF9SZWFjdCRDb21wb25lbnQpOwoKICBmdW5jdGlvbiBTd2l0Y2goKSB7CiAgICByZXR1cm4gX1JlYWN0JENvbXBvbmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CiAgfQoKICB2YXIgX3Byb3RvID0gU3dpdGNoLnByb3RvdHlwZTsKCiAgX3Byb3RvLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgcmV0dXJuIC8qI19fUFVSRV9fKi9fcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KGNvbnRleHQuQ29uc3VtZXIsIG51bGwsIGZ1bmN0aW9uIChjb250ZXh0KSB7CiAgICAgICFjb250ZXh0ID8gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIiA/ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSwgIllvdSBzaG91bGQgbm90IHVzZSA8U3dpdGNoPiBvdXRzaWRlIGEgPFJvdXRlcj4iKSA6ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSkgOiB2b2lkIDA7CiAgICAgIHZhciBsb2NhdGlvbiA9IF90aGlzLnByb3BzLmxvY2F0aW9uIHx8IGNvbnRleHQubG9jYXRpb247CiAgICAgIHZhciBlbGVtZW50LCBtYXRjaDsgLy8gV2UgdXNlIFJlYWN0LkNoaWxkcmVuLmZvckVhY2ggaW5zdGVhZCBvZiBSZWFjdC5DaGlsZHJlbi50b0FycmF5KCkuZmluZCgpCiAgICAgIC8vIGhlcmUgYmVjYXVzZSB0b0FycmF5IGFkZHMga2V5cyB0byBhbGwgY2hpbGQgZWxlbWVudHMgYW5kIHdlIGRvIG5vdCB3YW50CiAgICAgIC8vIHRvIHRyaWdnZXIgYW4gdW5tb3VudC9yZW1vdW50IGZvciB0d28gPFJvdXRlPnMgdGhhdCByZW5kZXIgdGhlIHNhbWUKICAgICAgLy8gY29tcG9uZW50IGF0IGRpZmZlcmVudCBVUkxzLgoKICAgICAgX3JlYWN0LmRlZmF1bHQuQ2hpbGRyZW4uZm9yRWFjaChfdGhpcy5wcm9wcy5jaGlsZHJlbiwgZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgaWYgKG1hdGNoID09IG51bGwgJiYgLyojX19QVVJFX18qL19yZWFjdC5kZWZhdWx0LmlzVmFsaWRFbGVtZW50KGNoaWxkKSkgewogICAgICAgICAgZWxlbWVudCA9IGNoaWxkOwogICAgICAgICAgdmFyIHBhdGggPSBjaGlsZC5wcm9wcy5wYXRoIHx8IGNoaWxkLnByb3BzLmZyb207CiAgICAgICAgICBtYXRjaCA9IHBhdGggPyBtYXRjaFBhdGgobG9jYXRpb24ucGF0aG5hbWUsICgwLCBfZXh0ZW5kczIuZGVmYXVsdCkoe30sIGNoaWxkLnByb3BzLCB7CiAgICAgICAgICAgIHBhdGg6IHBhdGgKICAgICAgICAgIH0pKSA6IGNvbnRleHQubWF0Y2g7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHJldHVybiBtYXRjaCA/IC8qI19fUFVSRV9fKi9fcmVhY3QuZGVmYXVsdC5jbG9uZUVsZW1lbnQoZWxlbWVudCwgewogICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICBjb21wdXRlZE1hdGNoOiBtYXRjaAogICAgICB9KSA6IG51bGw7CiAgICB9KTsKICB9OwoKICByZXR1cm4gU3dpdGNoOwp9KF9yZWFjdC5kZWZhdWx0LkNvbXBvbmVudCk7CgpleHBvcnRzLlN3aXRjaCA9IFN3aXRjaDsKCmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iKSB7CiAgU3dpdGNoLnByb3BUeXBlcyA9IHsKICAgIGNoaWxkcmVuOiBfcHJvcFR5cGVzLmRlZmF1bHQubm9kZSwKICAgIGxvY2F0aW9uOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0CiAgfTsKCiAgU3dpdGNoLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiAocHJldlByb3BzKSB7CiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iID8gKDAsIF90aW55V2FybmluZy5kZWZhdWx0KSghKHRoaXMucHJvcHMubG9jYXRpb24gJiYgIXByZXZQcm9wcy5sb2NhdGlvbiksICc8U3dpdGNoPiBlbGVtZW50cyBzaG91bGQgbm90IGNoYW5nZSBmcm9tIHVuY29udHJvbGxlZCB0byBjb250cm9sbGVkIChvciB2aWNlIHZlcnNhKS4gWW91IGluaXRpYWxseSB1c2VkIG5vICJsb2NhdGlvbiIgcHJvcCBhbmQgdGhlbiBwcm92aWRlZCBvbmUgb24gYSBzdWJzZXF1ZW50IHJlbmRlci4nKSA6IHZvaWQgMDsKICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlXYXJuaW5nLmRlZmF1bHQpKCEoIXRoaXMucHJvcHMubG9jYXRpb24gJiYgcHJldlByb3BzLmxvY2F0aW9uKSwgJzxTd2l0Y2g+IGVsZW1lbnRzIHNob3VsZCBub3QgY2hhbmdlIGZyb20gY29udHJvbGxlZCB0byB1bmNvbnRyb2xsZWQgKG9yIHZpY2UgdmVyc2EpLiBZb3UgcHJvdmlkZWQgYSAibG9jYXRpb24iIHByb3AgaW5pdGlhbGx5IGJ1dCBvbWl0dGVkIGl0IG9uIGEgc3Vic2VxdWVudCByZW5kZXIuJykgOiB2b2lkIDA7CiAgfTsKfQovKioKICogQSBwdWJsaWMgaGlnaGVyLW9yZGVyIGNvbXBvbmVudCB0byBhY2Nlc3MgdGhlIGltcGVyYXRpdmUgQVBJCiAqLwoKCmZ1bmN0aW9uIHdpdGhSb3V0ZXIoQ29tcG9uZW50KSB7CiAgdmFyIGRpc3BsYXlOYW1lID0gIndpdGhSb3V0ZXIoIiArIChDb21wb25lbnQuZGlzcGxheU5hbWUgfHwgQ29tcG9uZW50Lm5hbWUpICsgIikiOwoKICB2YXIgQyA9IGZ1bmN0aW9uIEMocHJvcHMpIHsKICAgIHZhciB3cmFwcGVkQ29tcG9uZW50UmVmID0gcHJvcHMud3JhcHBlZENvbXBvbmVudFJlZiwKICAgICAgICByZW1haW5pbmdQcm9wcyA9ICgwLCBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTIuZGVmYXVsdCkocHJvcHMsIFsid3JhcHBlZENvbXBvbmVudFJlZiJdKTsKICAgIHJldHVybiAvKiNfX1BVUkVfXyovX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChjb250ZXh0LkNvbnN1bWVyLCBudWxsLCBmdW5jdGlvbiAoY29udGV4dCkgewogICAgICAhY29udGV4dCA/IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlJbnZhcmlhbnQuZGVmYXVsdCkoZmFsc2UsICJZb3Ugc2hvdWxkIG5vdCB1c2UgPCIgKyBkaXNwbGF5TmFtZSArICIgLz4gb3V0c2lkZSBhIDxSb3V0ZXI+IikgOiAoMCwgX3RpbnlJbnZhcmlhbnQuZGVmYXVsdCkoZmFsc2UpIDogdm9pZCAwOwogICAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29tcG9uZW50LCAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCByZW1haW5pbmdQcm9wcywgY29udGV4dCwgewogICAgICAgIHJlZjogd3JhcHBlZENvbXBvbmVudFJlZgogICAgICB9KSk7CiAgICB9KTsKICB9OwoKICBDLmRpc3BsYXlOYW1lID0gZGlzcGxheU5hbWU7CiAgQy5XcmFwcGVkQ29tcG9uZW50ID0gQ29tcG9uZW50OwoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIikgewogICAgQy5wcm9wVHlwZXMgPSB7CiAgICAgIHdyYXBwZWRDb21wb25lbnRSZWY6IF9wcm9wVHlwZXMuZGVmYXVsdC5vbmVPZlR5cGUoW19wcm9wVHlwZXMuZGVmYXVsdC5zdHJpbmcsIF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLCBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0XSkKICAgIH07CiAgfQoKICByZXR1cm4gKDAsIF9ob2lzdE5vblJlYWN0U3RhdGljcy5kZWZhdWx0KShDLCBDb21wb25lbnQpOwp9Cgp2YXIgdXNlQ29udGV4dCA9IF9yZWFjdC5kZWZhdWx0LnVzZUNvbnRleHQ7CgpmdW5jdGlvbiB1c2VIaXN0b3J5KCkgewogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iKSB7CiAgICAhKHR5cGVvZiB1c2VDb250ZXh0ID09PSAiZnVuY3Rpb24iKSA/IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlJbnZhcmlhbnQuZGVmYXVsdCkoZmFsc2UsICJZb3UgbXVzdCB1c2UgUmVhY3QgPj0gMTYuOCBpbiBvcmRlciB0byB1c2UgdXNlSGlzdG9yeSgpIikgOiAoMCwgX3RpbnlJbnZhcmlhbnQuZGVmYXVsdCkoZmFsc2UpIDogdm9pZCAwOwogIH0KCiAgcmV0dXJuIHVzZUNvbnRleHQoaGlzdG9yeUNvbnRleHQpOwp9CgpmdW5jdGlvbiB1c2VMb2NhdGlvbigpIHsKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIikgewogICAgISh0eXBlb2YgdXNlQ29udGV4dCA9PT0gImZ1bmN0aW9uIikgPyBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iID8gKDAsIF90aW55SW52YXJpYW50LmRlZmF1bHQpKGZhbHNlLCAiWW91IG11c3QgdXNlIFJlYWN0ID49IDE2LjggaW4gb3JkZXIgdG8gdXNlIHVzZUxvY2F0aW9uKCkiKSA6ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSkgOiB2b2lkIDA7CiAgfQoKICByZXR1cm4gdXNlQ29udGV4dChjb250ZXh0KS5sb2NhdGlvbjsKfQoKZnVuY3Rpb24gdXNlUGFyYW1zKCkgewogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iKSB7CiAgICAhKHR5cGVvZiB1c2VDb250ZXh0ID09PSAiZnVuY3Rpb24iKSA/IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIgPyAoMCwgX3RpbnlJbnZhcmlhbnQuZGVmYXVsdCkoZmFsc2UsICJZb3UgbXVzdCB1c2UgUmVhY3QgPj0gMTYuOCBpbiBvcmRlciB0byB1c2UgdXNlUGFyYW1zKCkiKSA6ICgwLCBfdGlueUludmFyaWFudC5kZWZhdWx0KShmYWxzZSkgOiB2b2lkIDA7CiAgfQoKICB2YXIgbWF0Y2ggPSB1c2VDb250ZXh0KGNvbnRleHQpLm1hdGNoOwogIHJldHVybiBtYXRjaCA/IG1hdGNoLnBhcmFtcyA6IHt9Owp9CgpmdW5jdGlvbiB1c2VSb3V0ZU1hdGNoKHBhdGgpIHsKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICJwcm9kdWN0aW9uIikgewogICAgISh0eXBlb2YgdXNlQ29udGV4dCA9PT0gImZ1bmN0aW9uIikgPyBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gInByb2R1Y3Rpb24iID8gKDAsIF90aW55SW52YXJpYW50LmRlZmF1bHQpKGZhbHNlLCAiWW91IG11c3QgdXNlIFJlYWN0ID49IDE2LjggaW4gb3JkZXIgdG8gdXNlIHVzZVJvdXRlTWF0Y2goKSIpIDogKDAsIF90aW55SW52YXJpYW50LmRlZmF1bHQpKGZhbHNlKSA6IHZvaWQgMDsKICB9CgogIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CiAgdmFyIG1hdGNoID0gdXNlQ29udGV4dChjb250ZXh0KS5tYXRjaDsKICByZXR1cm4gcGF0aCA/IG1hdGNoUGF0aChsb2NhdGlvbi5wYXRobmFtZSwgcGF0aCkgOiBtYXRjaDsKfQoKaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAicHJvZHVjdGlvbiIpIHsKICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsKICAgIHZhciBnbG9iYWwgPSB3aW5kb3c7CiAgICB2YXIga2V5ID0gIl9fcmVhY3Rfcm91dGVyX2J1aWxkX18iOwogICAgdmFyIGJ1aWxkTmFtZXMgPSB7CiAgICAgIGNqczogIkNvbW1vbkpTIiwKICAgICAgZXNtOiAiRVMgbW9kdWxlcyIsCiAgICAgIHVtZDogIlVNRCIKICAgIH07CgogICAgaWYgKGdsb2JhbFtrZXldICYmIGdsb2JhbFtrZXldICE9PSAiZXNtIikgewogICAgICB2YXIgaW5pdGlhbEJ1aWxkTmFtZSA9IGJ1aWxkTmFtZXNbZ2xvYmFsW2tleV1dOwogICAgICB2YXIgc2Vjb25kYXJ5QnVpbGROYW1lID0gYnVpbGROYW1lc1siZXNtIl07IC8vIFRPRE86IEFkZCBsaW5rIHRvIGFydGljbGUgdGhhdCBleHBsYWlucyBpbiBkZXRhaWwgaG93IHRvIGF2b2lkCiAgICAgIC8vIGxvYWRpbmcgMiBkaWZmZXJlbnQgYnVpbGRzLgoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJZb3UgYXJlIGxvYWRpbmcgdGhlICIgKyBzZWNvbmRhcnlCdWlsZE5hbWUgKyAiIGJ1aWxkIG9mIFJlYWN0IFJvdXRlciAiICsgKCJvbiBhIHBhZ2UgdGhhdCBpcyBhbHJlYWR5IHJ1bm5pbmcgdGhlICIgKyBpbml0aWFsQnVpbGROYW1lICsgIiAiKSArICJidWlsZCwgc28gdGhpbmdzIHdvbid0IHdvcmsgcmlnaHQuIik7CiAgICB9CgogICAgZ2xvYmFsW2tleV0gPSAiZXNtIjsKICB9Cn0="},null]}