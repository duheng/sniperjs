{"remainingRequest":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/babel-loader/lib/index.js??ref--4-2!/Users/Aaron/Desktop/work/qunar/work/sniperjs/example/node/node_modules/react-dom/cjs/react-dom.production.min.js","dependencies":[{"path":"/Users/Aaron/Desktop/work/qunar/work/sniperjs/example/node/node_modules/react-dom/cjs/react-dom.production.min.js","hash":"c9a8a8e3b0f6384e9190875e317e96b6"},{"path":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/cache-loader-hash/dist/cjs.js","hash":"d62e2d390167bf8193569f1644327c55"},{"path":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/babel-loader/lib/index.js","hash":"19adf3159c902f1ed7907f3931384270"}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqIEBsaWNlbnNlIFJlYWN0IHYxNi4xNC4wCiAqIHJlYWN0LWRvbS5wcm9kdWN0aW9uLm1pbi5qcwogKgogKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICoKICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICovCgovKgogTW9kZXJuaXpyIDMuMC4wcHJlIChDdXN0b20gQnVpbGQpIHwgTUlUCiovCid1c2Ugc3RyaWN0JzsKCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7ICJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKdmFyIGFhID0gcmVxdWlyZSgicmVhY3QiKSwKICAgIG4gPSByZXF1aXJlKCJvYmplY3QtYXNzaWduIiksCiAgICByID0gcmVxdWlyZSgic2NoZWR1bGVyIik7CgpmdW5jdGlvbiB1KGEpIHsKICBmb3IgKHZhciBiID0gImh0dHBzOi8vcmVhY3Rqcy5vcmcvZG9jcy9lcnJvci1kZWNvZGVyLmh0bWw/aW52YXJpYW50PSIgKyBhLCBjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykgewogICAgYiArPSAiJmFyZ3NbXT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3VtZW50c1tjXSk7CiAgfQoKICByZXR1cm4gIk1pbmlmaWVkIFJlYWN0IGVycm9yICMiICsgYSArICI7IHZpc2l0ICIgKyBiICsgIiBmb3IgdGhlIGZ1bGwgbWVzc2FnZSBvciB1c2UgdGhlIG5vbi1taW5pZmllZCBkZXYgZW52aXJvbm1lbnQgZm9yIGZ1bGwgZXJyb3JzIGFuZCBhZGRpdGlvbmFsIGhlbHBmdWwgd2FybmluZ3MuIjsKfQoKaWYgKCFhYSkgdGhyb3cgRXJyb3IodSgyMjcpKTsKCmZ1bmN0aW9uIGJhKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHsKICB2YXIgbCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMyk7CgogIHRyeSB7CiAgICBiLmFwcGx5KGMsIGwpOwogIH0gY2F0Y2ggKG0pIHsKICAgIHRoaXMub25FcnJvcihtKTsKICB9Cn0KCnZhciBkYSA9ICExLAogICAgZWEgPSBudWxsLAogICAgZmEgPSAhMSwKICAgIGhhID0gbnVsbCwKICAgIGlhID0gewogIG9uRXJyb3I6IGZ1bmN0aW9uIG9uRXJyb3IoYSkgewogICAgZGEgPSAhMDsKICAgIGVhID0gYTsKICB9Cn07CgpmdW5jdGlvbiBqYShhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7CiAgZGEgPSAhMTsKICBlYSA9IG51bGw7CiAgYmEuYXBwbHkoaWEsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIGthKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHsKICBqYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICBpZiAoZGEpIHsKICAgIGlmIChkYSkgewogICAgICB2YXIgbCA9IGVhOwogICAgICBkYSA9ICExOwogICAgICBlYSA9IG51bGw7CiAgICB9IGVsc2UgdGhyb3cgRXJyb3IodSgxOTgpKTsKCiAgICBmYSB8fCAoZmEgPSAhMCwgaGEgPSBsKTsKICB9Cn0KCnZhciBsYSA9IG51bGwsCiAgICBtYSA9IG51bGwsCiAgICBuYSA9IG51bGw7CgpmdW5jdGlvbiBvYShhLCBiLCBjKSB7CiAgdmFyIGQgPSBhLnR5cGUgfHwgInVua25vd24tZXZlbnQiOwogIGEuY3VycmVudFRhcmdldCA9IG5hKGMpOwogIGthKGQsIGIsIHZvaWQgMCwgYSk7CiAgYS5jdXJyZW50VGFyZ2V0ID0gbnVsbDsKfQoKdmFyIHBhID0gbnVsbCwKICAgIHFhID0ge307CgpmdW5jdGlvbiByYSgpIHsKICBpZiAocGEpIGZvciAodmFyIGEgaW4gcWEpIHsKICAgIHZhciBiID0gcWFbYV0sCiAgICAgICAgYyA9IHBhLmluZGV4T2YoYSk7CiAgICBpZiAoISgtMSA8IGMpKSB0aHJvdyBFcnJvcih1KDk2LCBhKSk7CgogICAgaWYgKCFzYVtjXSkgewogICAgICBpZiAoIWIuZXh0cmFjdEV2ZW50cykgdGhyb3cgRXJyb3IodSg5NywgYSkpOwogICAgICBzYVtjXSA9IGI7CiAgICAgIGMgPSBiLmV2ZW50VHlwZXM7CgogICAgICBmb3IgKHZhciBkIGluIGMpIHsKICAgICAgICB2YXIgZSA9IHZvaWQgMDsKICAgICAgICB2YXIgZiA9IGNbZF0sCiAgICAgICAgICAgIGcgPSBiLAogICAgICAgICAgICBoID0gZDsKICAgICAgICBpZiAodGEuaGFzT3duUHJvcGVydHkoaCkpIHRocm93IEVycm9yKHUoOTksIGgpKTsKICAgICAgICB0YVtoXSA9IGY7CiAgICAgICAgdmFyIGsgPSBmLnBoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzOwoKICAgICAgICBpZiAoaykgewogICAgICAgICAgZm9yIChlIGluIGspIHsKICAgICAgICAgICAgay5oYXNPd25Qcm9wZXJ0eShlKSAmJiB1YShrW2VdLCBnLCBoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBlID0gITA7CiAgICAgICAgfSBlbHNlIGYucmVnaXN0cmF0aW9uTmFtZSA/ICh1YShmLnJlZ2lzdHJhdGlvbk5hbWUsIGcsIGgpLCBlID0gITApIDogZSA9ICExOwoKICAgICAgICBpZiAoIWUpIHRocm93IEVycm9yKHUoOTgsIGQsIGEpKTsKICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gdWEoYSwgYiwgYykgewogIGlmICh2YVthXSkgdGhyb3cgRXJyb3IodSgxMDAsIGEpKTsKICB2YVthXSA9IGI7CiAgd2FbYV0gPSBiLmV2ZW50VHlwZXNbY10uZGVwZW5kZW5jaWVzOwp9Cgp2YXIgc2EgPSBbXSwKICAgIHRhID0ge30sCiAgICB2YSA9IHt9LAogICAgd2EgPSB7fTsKCmZ1bmN0aW9uIHhhKGEpIHsKICB2YXIgYiA9ICExLAogICAgICBjOwoKICBmb3IgKGMgaW4gYSkgewogICAgaWYgKGEuaGFzT3duUHJvcGVydHkoYykpIHsKICAgICAgdmFyIGQgPSBhW2NdOwoKICAgICAgaWYgKCFxYS5oYXNPd25Qcm9wZXJ0eShjKSB8fCBxYVtjXSAhPT0gZCkgewogICAgICAgIGlmIChxYVtjXSkgdGhyb3cgRXJyb3IodSgxMDIsIGMpKTsKICAgICAgICBxYVtjXSA9IGQ7CiAgICAgICAgYiA9ICEwOwogICAgICB9CiAgICB9CiAgfQoKICBiICYmIHJhKCk7Cn0KCnZhciB5YSA9ICEoInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCksCiAgICB6YSA9IG51bGwsCiAgICBBYSA9IG51bGwsCiAgICBCYSA9IG51bGw7CgpmdW5jdGlvbiBDYShhKSB7CiAgaWYgKGEgPSBtYShhKSkgewogICAgaWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiB6YSkgdGhyb3cgRXJyb3IodSgyODApKTsKICAgIHZhciBiID0gYS5zdGF0ZU5vZGU7CiAgICBiICYmIChiID0gbGEoYiksIHphKGEuc3RhdGVOb2RlLCBhLnR5cGUsIGIpKTsKICB9Cn0KCmZ1bmN0aW9uIERhKGEpIHsKICBBYSA/IEJhID8gQmEucHVzaChhKSA6IEJhID0gW2FdIDogQWEgPSBhOwp9CgpmdW5jdGlvbiBFYSgpIHsKICBpZiAoQWEpIHsKICAgIHZhciBhID0gQWEsCiAgICAgICAgYiA9IEJhOwogICAgQmEgPSBBYSA9IG51bGw7CiAgICBDYShhKTsKICAgIGlmIChiKSBmb3IgKGEgPSAwOyBhIDwgYi5sZW5ndGg7IGErKykgewogICAgICBDYShiW2FdKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIEZhKGEsIGIpIHsKICByZXR1cm4gYShiKTsKfQoKZnVuY3Rpb24gR2EoYSwgYiwgYywgZCwgZSkgewogIHJldHVybiBhKGIsIGMsIGQsIGUpOwp9CgpmdW5jdGlvbiBIYSgpIHt9Cgp2YXIgSWEgPSBGYSwKICAgIEphID0gITEsCiAgICBLYSA9ICExOwoKZnVuY3Rpb24gTGEoKSB7CiAgaWYgKG51bGwgIT09IEFhIHx8IG51bGwgIT09IEJhKSBIYSgpLCBFYSgpOwp9CgpmdW5jdGlvbiBNYShhLCBiLCBjKSB7CiAgaWYgKEthKSByZXR1cm4gYShiLCBjKTsKICBLYSA9ICEwOwoKICB0cnkgewogICAgcmV0dXJuIElhKGEsIGIsIGMpOwogIH0gZmluYWxseSB7CiAgICBLYSA9ICExLCBMYSgpOwogIH0KfQoKdmFyIE5hID0gL15bOkEtWl9hLXpcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyRkZcdTAzNzAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQy1cdTIwMERcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRF1bOkEtWl9hLXpcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyRkZcdTAzNzAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQy1cdTIwMERcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRFwtLjAtOVx1MDBCN1x1MDMwMC1cdTAzNkZcdTIwM0YtXHUyMDQwXSokLywKICAgIE9hID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwKICAgIFBhID0ge30sCiAgICBRYSA9IHt9OwoKZnVuY3Rpb24gUmEoYSkgewogIGlmIChPYS5jYWxsKFFhLCBhKSkgcmV0dXJuICEwOwogIGlmIChPYS5jYWxsKFBhLCBhKSkgcmV0dXJuICExOwogIGlmIChOYS50ZXN0KGEpKSByZXR1cm4gUWFbYV0gPSAhMDsKICBQYVthXSA9ICEwOwogIHJldHVybiAhMTsKfQoKZnVuY3Rpb24gU2EoYSwgYiwgYywgZCkgewogIGlmIChudWxsICE9PSBjICYmIDAgPT09IGMudHlwZSkgcmV0dXJuICExOwoKICBzd2l0Y2ggKF90eXBlb2YoYikpIHsKICAgIGNhc2UgImZ1bmN0aW9uIjoKICAgIGNhc2UgInN5bWJvbCI6CiAgICAgIHJldHVybiAhMDsKCiAgICBjYXNlICJib29sZWFuIjoKICAgICAgaWYgKGQpIHJldHVybiAhMTsKICAgICAgaWYgKG51bGwgIT09IGMpIHJldHVybiAhYy5hY2NlcHRzQm9vbGVhbnM7CiAgICAgIGEgPSBhLnRvTG93ZXJDYXNlKCkuc2xpY2UoMCwgNSk7CiAgICAgIHJldHVybiAiZGF0YS0iICE9PSBhICYmICJhcmlhLSIgIT09IGE7CgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuICExOwogIH0KfQoKZnVuY3Rpb24gVGEoYSwgYiwgYywgZCkgewogIGlmIChudWxsID09PSBiIHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYiB8fCBTYShhLCBiLCBjLCBkKSkgcmV0dXJuICEwOwogIGlmIChkKSByZXR1cm4gITE7CiAgaWYgKG51bGwgIT09IGMpIHN3aXRjaCAoYy50eXBlKSB7CiAgICBjYXNlIDM6CiAgICAgIHJldHVybiAhYjsKCiAgICBjYXNlIDQ6CiAgICAgIHJldHVybiAhMSA9PT0gYjsKCiAgICBjYXNlIDU6CiAgICAgIHJldHVybiBpc05hTihiKTsKCiAgICBjYXNlIDY6CiAgICAgIHJldHVybiBpc05hTihiKSB8fCAxID4gYjsKICB9CiAgcmV0dXJuICExOwp9CgpmdW5jdGlvbiB2KGEsIGIsIGMsIGQsIGUsIGYpIHsKICB0aGlzLmFjY2VwdHNCb29sZWFucyA9IDIgPT09IGIgfHwgMyA9PT0gYiB8fCA0ID09PSBiOwogIHRoaXMuYXR0cmlidXRlTmFtZSA9IGQ7CiAgdGhpcy5hdHRyaWJ1dGVOYW1lc3BhY2UgPSBlOwogIHRoaXMubXVzdFVzZVByb3BlcnR5ID0gYzsKICB0aGlzLnByb3BlcnR5TmFtZSA9IGE7CiAgdGhpcy50eXBlID0gYjsKICB0aGlzLnNhbml0aXplVVJMID0gZjsKfQoKdmFyIEMgPSB7fTsKImNoaWxkcmVuIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIGRlZmF1bHRWYWx1ZSBkZWZhdWx0Q2hlY2tlZCBpbm5lckhUTUwgc3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIHN1cHByZXNzSHlkcmF0aW9uV2FybmluZyBzdHlsZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgQ1thXSA9IG5ldyB2KGEsIDAsICExLCBhLCBudWxsLCAhMSk7Cn0pOwpbWyJhY2NlcHRDaGFyc2V0IiwgImFjY2VwdC1jaGFyc2V0Il0sIFsiY2xhc3NOYW1lIiwgImNsYXNzIl0sIFsiaHRtbEZvciIsICJmb3IiXSwgWyJodHRwRXF1aXYiLCAiaHR0cC1lcXVpdiJdXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgdmFyIGIgPSBhWzBdOwogIENbYl0gPSBuZXcgdihiLCAxLCAhMSwgYVsxXSwgbnVsbCwgITEpOwp9KTsKWyJjb250ZW50RWRpdGFibGUiLCAiZHJhZ2dhYmxlIiwgInNwZWxsQ2hlY2siLCAidmFsdWUiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgQ1thXSA9IG5ldyB2KGEsIDIsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExKTsKfSk7ClsiYXV0b1JldmVyc2UiLCAiZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCIsICJmb2N1c2FibGUiLCAicHJlc2VydmVBbHBoYSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHsKICBDW2FdID0gbmV3IHYoYSwgMiwgITEsIGEsIG51bGwsICExKTsKfSk7CiJhbGxvd0Z1bGxTY3JlZW4gYXN5bmMgYXV0b0ZvY3VzIGF1dG9QbGF5IGNvbnRyb2xzIGRlZmF1bHQgZGVmZXIgZGlzYWJsZWQgZGlzYWJsZVBpY3R1cmVJblBpY3R1cmUgZm9ybU5vVmFsaWRhdGUgaGlkZGVuIGxvb3Agbm9Nb2R1bGUgbm9WYWxpZGF0ZSBvcGVuIHBsYXlzSW5saW5lIHJlYWRPbmx5IHJlcXVpcmVkIHJldmVyc2VkIHNjb3BlZCBzZWFtbGVzcyBpdGVtU2NvcGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkgewogIENbYV0gPSBuZXcgdihhLCAzLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSk7Cn0pOwpbImNoZWNrZWQiLCAibXVsdGlwbGUiLCAibXV0ZWQiLCAic2VsZWN0ZWQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgQ1thXSA9IG5ldyB2KGEsIDMsICEwLCBhLCBudWxsLCAhMSk7Cn0pOwpbImNhcHR1cmUiLCAiZG93bmxvYWQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgQ1thXSA9IG5ldyB2KGEsIDQsICExLCBhLCBudWxsLCAhMSk7Cn0pOwpbImNvbHMiLCAicm93cyIsICJzaXplIiwgInNwYW4iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgQ1thXSA9IG5ldyB2KGEsIDYsICExLCBhLCBudWxsLCAhMSk7Cn0pOwpbInJvd1NwYW4iLCAic3RhcnQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgQ1thXSA9IG5ldyB2KGEsIDUsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExKTsKfSk7CnZhciBVYSA9IC9bXC06XShbYS16XSkvZzsKCmZ1bmN0aW9uIFZhKGEpIHsKICByZXR1cm4gYVsxXS50b1VwcGVyQ2FzZSgpOwp9CgoiYWNjZW50LWhlaWdodCBhbGlnbm1lbnQtYmFzZWxpbmUgYXJhYmljLWZvcm0gYmFzZWxpbmUtc2hpZnQgY2FwLWhlaWdodCBjbGlwLXBhdGggY2xpcC1ydWxlIGNvbG9yLWludGVycG9sYXRpb24gY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIGNvbG9yLXByb2ZpbGUgY29sb3ItcmVuZGVyaW5nIGRvbWluYW50LWJhc2VsaW5lIGVuYWJsZS1iYWNrZ3JvdW5kIGZpbGwtb3BhY2l0eSBmaWxsLXJ1bGUgZmxvb2QtY29sb3IgZmxvb2Qtb3BhY2l0eSBmb250LWZhbWlseSBmb250LXNpemUgZm9udC1zaXplLWFkanVzdCBmb250LXN0cmV0Y2ggZm9udC1zdHlsZSBmb250LXZhcmlhbnQgZm9udC13ZWlnaHQgZ2x5cGgtbmFtZSBnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsIGdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIGhvcml6LWFkdi14IGhvcml6LW9yaWdpbi14IGltYWdlLXJlbmRlcmluZyBsZXR0ZXItc3BhY2luZyBsaWdodGluZy1jb2xvciBtYXJrZXItZW5kIG1hcmtlci1taWQgbWFya2VyLXN0YXJ0IG92ZXJsaW5lLXBvc2l0aW9uIG92ZXJsaW5lLXRoaWNrbmVzcyBwYWludC1vcmRlciBwYW5vc2UtMSBwb2ludGVyLWV2ZW50cyByZW5kZXJpbmctaW50ZW50IHNoYXBlLXJlbmRlcmluZyBzdG9wLWNvbG9yIHN0b3Atb3BhY2l0eSBzdHJpa2V0aHJvdWdoLXBvc2l0aW9uIHN0cmlrZXRocm91Z2gtdGhpY2tuZXNzIHN0cm9rZS1kYXNoYXJyYXkgc3Ryb2tlLWRhc2hvZmZzZXQgc3Ryb2tlLWxpbmVjYXAgc3Ryb2tlLWxpbmVqb2luIHN0cm9rZS1taXRlcmxpbWl0IHN0cm9rZS1vcGFjaXR5IHN0cm9rZS13aWR0aCB0ZXh0LWFuY2hvciB0ZXh0LWRlY29yYXRpb24gdGV4dC1yZW5kZXJpbmcgdW5kZXJsaW5lLXBvc2l0aW9uIHVuZGVybGluZS10aGlja25lc3MgdW5pY29kZS1iaWRpIHVuaWNvZGUtcmFuZ2UgdW5pdHMtcGVyLWVtIHYtYWxwaGFiZXRpYyB2LWhhbmdpbmcgdi1pZGVvZ3JhcGhpYyB2LW1hdGhlbWF0aWNhbCB2ZWN0b3ItZWZmZWN0IHZlcnQtYWR2LXkgdmVydC1vcmlnaW4teCB2ZXJ0LW9yaWdpbi15IHdvcmQtc3BhY2luZyB3cml0aW5nLW1vZGUgeG1sbnM6eGxpbmsgeC1oZWlnaHQiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkgewogIHZhciBiID0gYS5yZXBsYWNlKFVhLCBWYSk7CiAgQ1tiXSA9IG5ldyB2KGIsIDEsICExLCBhLCBudWxsLCAhMSk7Cn0pOwoieGxpbms6YWN0dWF0ZSB4bGluazphcmNyb2xlIHhsaW5rOnJvbGUgeGxpbms6c2hvdyB4bGluazp0aXRsZSB4bGluazp0eXBlIi5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHsKICB2YXIgYiA9IGEucmVwbGFjZShVYSwgVmEpOwogIENbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCAhMSk7Cn0pOwpbInhtbDpiYXNlIiwgInhtbDpsYW5nIiwgInhtbDpzcGFjZSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHsKICB2YXIgYiA9IGEucmVwbGFjZShVYSwgVmEpOwogIENbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIsICExKTsKfSk7ClsidGFiSW5kZXgiLCAiY3Jvc3NPcmlnaW4iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgQ1thXSA9IG5ldyB2KGEsIDEsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExKTsKfSk7CkMueGxpbmtIcmVmID0gbmV3IHYoInhsaW5rSHJlZiIsIDEsICExLCAieGxpbms6aHJlZiIsICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwgITApOwpbInNyYyIsICJocmVmIiwgImFjdGlvbiIsICJmb3JtQWN0aW9uIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkgewogIENbYV0gPSBuZXcgdihhLCAxLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMCk7Cn0pOwp2YXIgV2EgPSBhYS5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRDsKV2EuaGFzT3duUHJvcGVydHkoIlJlYWN0Q3VycmVudERpc3BhdGNoZXIiKSB8fCAoV2EuUmVhY3RDdXJyZW50RGlzcGF0Y2hlciA9IHsKICBjdXJyZW50OiBudWxsCn0pOwpXYS5oYXNPd25Qcm9wZXJ0eSgiUmVhY3RDdXJyZW50QmF0Y2hDb25maWciKSB8fCAoV2EuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcgPSB7CiAgc3VzcGVuc2U6IG51bGwKfSk7CgpmdW5jdGlvbiBYYShhLCBiLCBjLCBkKSB7CiAgdmFyIGUgPSBDLmhhc093blByb3BlcnR5KGIpID8gQ1tiXSA6IG51bGw7CiAgdmFyIGYgPSBudWxsICE9PSBlID8gMCA9PT0gZS50eXBlIDogZCA/ICExIDogISgyIDwgYi5sZW5ndGgpIHx8ICJvIiAhPT0gYlswXSAmJiAiTyIgIT09IGJbMF0gfHwgIm4iICE9PSBiWzFdICYmICJOIiAhPT0gYlsxXSA/ICExIDogITA7CiAgZiB8fCAoVGEoYiwgYywgZSwgZCkgJiYgKGMgPSBudWxsKSwgZCB8fCBudWxsID09PSBlID8gUmEoYikgJiYgKG51bGwgPT09IGMgPyBhLnJlbW92ZUF0dHJpYnV0ZShiKSA6IGEuc2V0QXR0cmlidXRlKGIsICIiICsgYykpIDogZS5tdXN0VXNlUHJvcGVydHkgPyBhW2UucHJvcGVydHlOYW1lXSA9IG51bGwgPT09IGMgPyAzID09PSBlLnR5cGUgPyAhMSA6ICIiIDogYyA6IChiID0gZS5hdHRyaWJ1dGVOYW1lLCBkID0gZS5hdHRyaWJ1dGVOYW1lc3BhY2UsIG51bGwgPT09IGMgPyBhLnJlbW92ZUF0dHJpYnV0ZShiKSA6IChlID0gZS50eXBlLCBjID0gMyA9PT0gZSB8fCA0ID09PSBlICYmICEwID09PSBjID8gIiIgOiAiIiArIGMsIGQgPyBhLnNldEF0dHJpYnV0ZU5TKGQsIGIsIGMpIDogYS5zZXRBdHRyaWJ1dGUoYiwgYykpKSk7Cn0KCnZhciBZYSA9IC9eKC4qKVtcXFwvXS8sCiAgICBFID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFN5bWJvbCAmJiBTeW1ib2wuZm9yLAogICAgWmEgPSBFID8gU3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpIDogNjAxMDMsCiAgICAkYSA9IEUgPyBTeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKSA6IDYwMTA2LAogICAgYWIgPSBFID8gU3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKSA6IDYwMTA3LAogICAgYmIgPSBFID8gU3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKSA6IDYwMTA4LAogICAgY2IgPSBFID8gU3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKSA6IDYwMTE0LAogICAgZGIgPSBFID8gU3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKSA6IDYwMTA5LAogICAgZWIgPSBFID8gU3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpIDogNjAxMTAsCiAgICBmYiA9IEUgPyBTeW1ib2wuZm9yKCJyZWFjdC5jb25jdXJyZW50X21vZGUiKSA6IDYwMTExLAogICAgZ2IgPSBFID8gU3ltYm9sLmZvcigicmVhY3QuZm9yd2FyZF9yZWYiKSA6IDYwMTEyLAogICAgaGIgPSBFID8gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2UiKSA6IDYwMTEzLAogICAgaWIgPSBFID8gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2VfbGlzdCIpIDogNjAxMjAsCiAgICBqYiA9IEUgPyBTeW1ib2wuZm9yKCJyZWFjdC5tZW1vIikgOiA2MDExNSwKICAgIGtiID0gRSA/IFN5bWJvbC5mb3IoInJlYWN0LmxhenkiKSA6IDYwMTE2LAogICAgbGIgPSBFID8gU3ltYm9sLmZvcigicmVhY3QuYmxvY2siKSA6IDYwMTIxLAogICAgbWIgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgU3ltYm9sICYmIFN5bWJvbC5pdGVyYXRvcjsKCmZ1bmN0aW9uIG5iKGEpIHsKICBpZiAobnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gX3R5cGVvZihhKSkgcmV0dXJuIG51bGw7CiAgYSA9IG1iICYmIGFbbWJdIHx8IGFbIkBAaXRlcmF0b3IiXTsKICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgPyBhIDogbnVsbDsKfQoKZnVuY3Rpb24gb2IoYSkgewogIGlmICgtMSA9PT0gYS5fc3RhdHVzKSB7CiAgICBhLl9zdGF0dXMgPSAwOwogICAgdmFyIGIgPSBhLl9jdG9yOwogICAgYiA9IGIoKTsKICAgIGEuX3Jlc3VsdCA9IGI7CiAgICBiLnRoZW4oZnVuY3Rpb24gKGIpIHsKICAgICAgMCA9PT0gYS5fc3RhdHVzICYmIChiID0gYi5kZWZhdWx0LCBhLl9zdGF0dXMgPSAxLCBhLl9yZXN1bHQgPSBiKTsKICAgIH0sIGZ1bmN0aW9uIChiKSB7CiAgICAgIDAgPT09IGEuX3N0YXR1cyAmJiAoYS5fc3RhdHVzID0gMiwgYS5fcmVzdWx0ID0gYik7CiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIHBiKGEpIHsKICBpZiAobnVsbCA9PSBhKSByZXR1cm4gbnVsbDsKICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEpIHJldHVybiBhLmRpc3BsYXlOYW1lIHx8IGEubmFtZSB8fCBudWxsOwogIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIHJldHVybiBhOwoKICBzd2l0Y2ggKGEpIHsKICAgIGNhc2UgYWI6CiAgICAgIHJldHVybiAiRnJhZ21lbnQiOwoKICAgIGNhc2UgJGE6CiAgICAgIHJldHVybiAiUG9ydGFsIjsKCiAgICBjYXNlIGNiOgogICAgICByZXR1cm4gIlByb2ZpbGVyIjsKCiAgICBjYXNlIGJiOgogICAgICByZXR1cm4gIlN0cmljdE1vZGUiOwoKICAgIGNhc2UgaGI6CiAgICAgIHJldHVybiAiU3VzcGVuc2UiOwoKICAgIGNhc2UgaWI6CiAgICAgIHJldHVybiAiU3VzcGVuc2VMaXN0IjsKICB9CgogIGlmICgib2JqZWN0IiA9PT0gX3R5cGVvZihhKSkgc3dpdGNoIChhLiQkdHlwZW9mKSB7CiAgICBjYXNlIGViOgogICAgICByZXR1cm4gIkNvbnRleHQuQ29uc3VtZXIiOwoKICAgIGNhc2UgZGI6CiAgICAgIHJldHVybiAiQ29udGV4dC5Qcm92aWRlciI7CgogICAgY2FzZSBnYjoKICAgICAgdmFyIGIgPSBhLnJlbmRlcjsKICAgICAgYiA9IGIuZGlzcGxheU5hbWUgfHwgYi5uYW1lIHx8ICIiOwogICAgICByZXR1cm4gYS5kaXNwbGF5TmFtZSB8fCAoIiIgIT09IGIgPyAiRm9yd2FyZFJlZigiICsgYiArICIpIiA6ICJGb3J3YXJkUmVmIik7CgogICAgY2FzZSBqYjoKICAgICAgcmV0dXJuIHBiKGEudHlwZSk7CgogICAgY2FzZSBsYjoKICAgICAgcmV0dXJuIHBiKGEucmVuZGVyKTsKCiAgICBjYXNlIGtiOgogICAgICBpZiAoYSA9IDEgPT09IGEuX3N0YXR1cyA/IGEuX3Jlc3VsdCA6IG51bGwpIHJldHVybiBwYihhKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIHFiKGEpIHsKICB2YXIgYiA9ICIiOwoKICBkbyB7CiAgICBhOiBzd2l0Y2ggKGEudGFnKSB7CiAgICAgIGNhc2UgMzoKICAgICAgY2FzZSA0OgogICAgICBjYXNlIDY6CiAgICAgIGNhc2UgNzoKICAgICAgY2FzZSAxMDoKICAgICAgY2FzZSA5OgogICAgICAgIHZhciBjID0gIiI7CiAgICAgICAgYnJlYWsgYTsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdmFyIGQgPSBhLl9kZWJ1Z093bmVyLAogICAgICAgICAgICBlID0gYS5fZGVidWdTb3VyY2UsCiAgICAgICAgICAgIGYgPSBwYihhLnR5cGUpOwogICAgICAgIGMgPSBudWxsOwogICAgICAgIGQgJiYgKGMgPSBwYihkLnR5cGUpKTsKICAgICAgICBkID0gZjsKICAgICAgICBmID0gIiI7CiAgICAgICAgZSA/IGYgPSAiIChhdCAiICsgZS5maWxlTmFtZS5yZXBsYWNlKFlhLCAiIikgKyAiOiIgKyBlLmxpbmVOdW1iZXIgKyAiKSIgOiBjICYmIChmID0gIiAoY3JlYXRlZCBieSAiICsgYyArICIpIik7CiAgICAgICAgYyA9ICJcbiAgICBpbiAiICsgKGQgfHwgIlVua25vd24iKSArIGY7CiAgICB9CgogICAgYiArPSBjOwogICAgYSA9IGEucmV0dXJuOwogIH0gd2hpbGUgKGEpOwoKICByZXR1cm4gYjsKfQoKZnVuY3Rpb24gcmIoYSkgewogIHN3aXRjaCAoX3R5cGVvZihhKSkgewogICAgY2FzZSAiYm9vbGVhbiI6CiAgICBjYXNlICJudW1iZXIiOgogICAgY2FzZSAib2JqZWN0IjoKICAgIGNhc2UgInN0cmluZyI6CiAgICBjYXNlICJ1bmRlZmluZWQiOgogICAgICByZXR1cm4gYTsKCiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gIiI7CiAgfQp9CgpmdW5jdGlvbiBzYihhKSB7CiAgdmFyIGIgPSBhLnR5cGU7CiAgcmV0dXJuIChhID0gYS5ub2RlTmFtZSkgJiYgImlucHV0IiA9PT0gYS50b0xvd2VyQ2FzZSgpICYmICgiY2hlY2tib3giID09PSBiIHx8ICJyYWRpbyIgPT09IGIpOwp9CgpmdW5jdGlvbiB0YihhKSB7CiAgdmFyIGIgPSBzYihhKSA/ICJjaGVja2VkIiA6ICJ2YWx1ZSIsCiAgICAgIGMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGEuY29uc3RydWN0b3IucHJvdG90eXBlLCBiKSwKICAgICAgZCA9ICIiICsgYVtiXTsKCiAgaWYgKCFhLmhhc093blByb3BlcnR5KGIpICYmICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYy5nZXQgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuc2V0KSB7CiAgICB2YXIgZSA9IGMuZ2V0LAogICAgICAgIGYgPSBjLnNldDsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBiLCB7CiAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBlLmNhbGwodGhpcyk7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGEpIHsKICAgICAgICBkID0gIiIgKyBhOwogICAgICAgIGYuY2FsbCh0aGlzLCBhKTsKICAgICAgfQogICAgfSk7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgYiwgewogICAgICBlbnVtZXJhYmxlOiBjLmVudW1lcmFibGUKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKCkgewogICAgICAgIHJldHVybiBkOwogICAgICB9LAogICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUoYSkgewogICAgICAgIGQgPSAiIiArIGE7CiAgICAgIH0sCiAgICAgIHN0b3BUcmFja2luZzogZnVuY3Rpb24gc3RvcFRyYWNraW5nKCkgewogICAgICAgIGEuX3ZhbHVlVHJhY2tlciA9IG51bGw7CiAgICAgICAgZGVsZXRlIGFbYl07CiAgICAgIH0KICAgIH07CiAgfQp9CgpmdW5jdGlvbiB4YihhKSB7CiAgYS5fdmFsdWVUcmFja2VyIHx8IChhLl92YWx1ZVRyYWNrZXIgPSB0YihhKSk7Cn0KCmZ1bmN0aW9uIHliKGEpIHsKICBpZiAoIWEpIHJldHVybiAhMTsKICB2YXIgYiA9IGEuX3ZhbHVlVHJhY2tlcjsKICBpZiAoIWIpIHJldHVybiAhMDsKICB2YXIgYyA9IGIuZ2V0VmFsdWUoKTsKICB2YXIgZCA9ICIiOwogIGEgJiYgKGQgPSBzYihhKSA/IGEuY2hlY2tlZCA/ICJ0cnVlIiA6ICJmYWxzZSIgOiBhLnZhbHVlKTsKICBhID0gZDsKICByZXR1cm4gYSAhPT0gYyA/IChiLnNldFZhbHVlKGEpLCAhMCkgOiAhMTsKfQoKZnVuY3Rpb24gemIoYSwgYikgewogIHZhciBjID0gYi5jaGVja2VkOwogIHJldHVybiBuKHt9LCBiLCB7CiAgICBkZWZhdWx0Q2hlY2tlZDogdm9pZCAwLAogICAgZGVmYXVsdFZhbHVlOiB2b2lkIDAsCiAgICB2YWx1ZTogdm9pZCAwLAogICAgY2hlY2tlZDogbnVsbCAhPSBjID8gYyA6IGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsQ2hlY2tlZAogIH0pOwp9CgpmdW5jdGlvbiBBYihhLCBiKSB7CiAgdmFyIGMgPSBudWxsID09IGIuZGVmYXVsdFZhbHVlID8gIiIgOiBiLmRlZmF1bHRWYWx1ZSwKICAgICAgZCA9IG51bGwgIT0gYi5jaGVja2VkID8gYi5jaGVja2VkIDogYi5kZWZhdWx0Q2hlY2tlZDsKICBjID0gcmIobnVsbCAhPSBiLnZhbHVlID8gYi52YWx1ZSA6IGMpOwogIGEuX3dyYXBwZXJTdGF0ZSA9IHsKICAgIGluaXRpYWxDaGVja2VkOiBkLAogICAgaW5pdGlhbFZhbHVlOiBjLAogICAgY29udHJvbGxlZDogImNoZWNrYm94IiA9PT0gYi50eXBlIHx8ICJyYWRpbyIgPT09IGIudHlwZSA/IG51bGwgIT0gYi5jaGVja2VkIDogbnVsbCAhPSBiLnZhbHVlCiAgfTsKfQoKZnVuY3Rpb24gQmIoYSwgYikgewogIGIgPSBiLmNoZWNrZWQ7CiAgbnVsbCAhPSBiICYmIFhhKGEsICJjaGVja2VkIiwgYiwgITEpOwp9CgpmdW5jdGlvbiBDYihhLCBiKSB7CiAgQmIoYSwgYik7CiAgdmFyIGMgPSByYihiLnZhbHVlKSwKICAgICAgZCA9IGIudHlwZTsKICBpZiAobnVsbCAhPSBjKSB7CiAgICBpZiAoIm51bWJlciIgPT09IGQpIHsKICAgICAgaWYgKDAgPT09IGMgJiYgIiIgPT09IGEudmFsdWUgfHwgYS52YWx1ZSAhPSBjKSBhLnZhbHVlID0gIiIgKyBjOwogICAgfSBlbHNlIGEudmFsdWUgIT09ICIiICsgYyAmJiAoYS52YWx1ZSA9ICIiICsgYyk7CiAgfSBlbHNlIGlmICgic3VibWl0IiA9PT0gZCB8fCAicmVzZXQiID09PSBkKSB7CiAgICBhLnJlbW92ZUF0dHJpYnV0ZSgidmFsdWUiKTsKICAgIHJldHVybjsKICB9CiAgYi5oYXNPd25Qcm9wZXJ0eSgidmFsdWUiKSA/IERiKGEsIGIudHlwZSwgYykgOiBiLmhhc093blByb3BlcnR5KCJkZWZhdWx0VmFsdWUiKSAmJiBEYihhLCBiLnR5cGUsIHJiKGIuZGVmYXVsdFZhbHVlKSk7CiAgbnVsbCA9PSBiLmNoZWNrZWQgJiYgbnVsbCAhPSBiLmRlZmF1bHRDaGVja2VkICYmIChhLmRlZmF1bHRDaGVja2VkID0gISFiLmRlZmF1bHRDaGVja2VkKTsKfQoKZnVuY3Rpb24gRWIoYSwgYiwgYykgewogIGlmIChiLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpIHx8IGIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpKSB7CiAgICB2YXIgZCA9IGIudHlwZTsKICAgIGlmICghKCJzdWJtaXQiICE9PSBkICYmICJyZXNldCIgIT09IGQgfHwgdm9pZCAwICE9PSBiLnZhbHVlICYmIG51bGwgIT09IGIudmFsdWUpKSByZXR1cm47CiAgICBiID0gIiIgKyBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlOwogICAgYyB8fCBiID09PSBhLnZhbHVlIHx8IChhLnZhbHVlID0gYik7CiAgICBhLmRlZmF1bHRWYWx1ZSA9IGI7CiAgfQoKICBjID0gYS5uYW1lOwogICIiICE9PSBjICYmIChhLm5hbWUgPSAiIik7CiAgYS5kZWZhdWx0Q2hlY2tlZCA9ICEhYS5fd3JhcHBlclN0YXRlLmluaXRpYWxDaGVja2VkOwogICIiICE9PSBjICYmIChhLm5hbWUgPSBjKTsKfQoKZnVuY3Rpb24gRGIoYSwgYiwgYykgewogIGlmICgibnVtYmVyIiAhPT0gYiB8fCBhLm93bmVyRG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPT0gYSkgbnVsbCA9PSBjID8gYS5kZWZhdWx0VmFsdWUgPSAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUgOiBhLmRlZmF1bHRWYWx1ZSAhPT0gIiIgKyBjICYmIChhLmRlZmF1bHRWYWx1ZSA9ICIiICsgYyk7Cn0KCmZ1bmN0aW9uIEZiKGEpIHsKICB2YXIgYiA9ICIiOwogIGFhLkNoaWxkcmVuLmZvckVhY2goYSwgZnVuY3Rpb24gKGEpIHsKICAgIG51bGwgIT0gYSAmJiAoYiArPSBhKTsKICB9KTsKICByZXR1cm4gYjsKfQoKZnVuY3Rpb24gR2IoYSwgYikgewogIGEgPSBuKHsKICAgIGNoaWxkcmVuOiB2b2lkIDAKICB9LCBiKTsKICBpZiAoYiA9IEZiKGIuY2hpbGRyZW4pKSBhLmNoaWxkcmVuID0gYjsKICByZXR1cm4gYTsKfQoKZnVuY3Rpb24gSGIoYSwgYiwgYywgZCkgewogIGEgPSBhLm9wdGlvbnM7CgogIGlmIChiKSB7CiAgICBiID0ge307CgogICAgZm9yICh2YXIgZSA9IDA7IGUgPCBjLmxlbmd0aDsgZSsrKSB7CiAgICAgIGJbIiQiICsgY1tlXV0gPSAhMDsKICAgIH0KCiAgICBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykgewogICAgICBlID0gYi5oYXNPd25Qcm9wZXJ0eSgiJCIgKyBhW2NdLnZhbHVlKSwgYVtjXS5zZWxlY3RlZCAhPT0gZSAmJiAoYVtjXS5zZWxlY3RlZCA9IGUpLCBlICYmIGQgJiYgKGFbY10uZGVmYXVsdFNlbGVjdGVkID0gITApOwogICAgfQogIH0gZWxzZSB7CiAgICBjID0gIiIgKyByYihjKTsKICAgIGIgPSBudWxsOwoKICAgIGZvciAoZSA9IDA7IGUgPCBhLmxlbmd0aDsgZSsrKSB7CiAgICAgIGlmIChhW2VdLnZhbHVlID09PSBjKSB7CiAgICAgICAgYVtlXS5zZWxlY3RlZCA9ICEwOwogICAgICAgIGQgJiYgKGFbZV0uZGVmYXVsdFNlbGVjdGVkID0gITApOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgbnVsbCAhPT0gYiB8fCBhW2VdLmRpc2FibGVkIHx8IChiID0gYVtlXSk7CiAgICB9CgogICAgbnVsbCAhPT0gYiAmJiAoYi5zZWxlY3RlZCA9ICEwKTsKICB9Cn0KCmZ1bmN0aW9uIEliKGEsIGIpIHsKICBpZiAobnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSB0aHJvdyBFcnJvcih1KDkxKSk7CiAgcmV0dXJuIG4oe30sIGIsIHsKICAgIHZhbHVlOiB2b2lkIDAsCiAgICBkZWZhdWx0VmFsdWU6IHZvaWQgMCwKICAgIGNoaWxkcmVuOiAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUKICB9KTsKfQoKZnVuY3Rpb24gSmIoYSwgYikgewogIHZhciBjID0gYi52YWx1ZTsKCiAgaWYgKG51bGwgPT0gYykgewogICAgYyA9IGIuY2hpbGRyZW47CiAgICBiID0gYi5kZWZhdWx0VmFsdWU7CgogICAgaWYgKG51bGwgIT0gYykgewogICAgICBpZiAobnVsbCAhPSBiKSB0aHJvdyBFcnJvcih1KDkyKSk7CgogICAgICBpZiAoQXJyYXkuaXNBcnJheShjKSkgewogICAgICAgIGlmICghKDEgPj0gYy5sZW5ndGgpKSB0aHJvdyBFcnJvcih1KDkzKSk7CiAgICAgICAgYyA9IGNbMF07CiAgICAgIH0KCiAgICAgIGIgPSBjOwogICAgfQoKICAgIG51bGwgPT0gYiAmJiAoYiA9ICIiKTsKICAgIGMgPSBiOwogIH0KCiAgYS5fd3JhcHBlclN0YXRlID0gewogICAgaW5pdGlhbFZhbHVlOiByYihjKQogIH07Cn0KCmZ1bmN0aW9uIEtiKGEsIGIpIHsKICB2YXIgYyA9IHJiKGIudmFsdWUpLAogICAgICBkID0gcmIoYi5kZWZhdWx0VmFsdWUpOwogIG51bGwgIT0gYyAmJiAoYyA9ICIiICsgYywgYyAhPT0gYS52YWx1ZSAmJiAoYS52YWx1ZSA9IGMpLCBudWxsID09IGIuZGVmYXVsdFZhbHVlICYmIGEuZGVmYXVsdFZhbHVlICE9PSBjICYmIChhLmRlZmF1bHRWYWx1ZSA9IGMpKTsKICBudWxsICE9IGQgJiYgKGEuZGVmYXVsdFZhbHVlID0gIiIgKyBkKTsKfQoKZnVuY3Rpb24gTGIoYSkgewogIHZhciBiID0gYS50ZXh0Q29udGVudDsKICBiID09PSBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlICYmICIiICE9PSBiICYmIG51bGwgIT09IGIgJiYgKGEudmFsdWUgPSBiKTsKfQoKdmFyIE1iID0gewogIGh0bWw6ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiwKICBtYXRobWw6ICJodHRwOi8vd3d3LnczLm9yZy8xOTk4L01hdGgvTWF0aE1MIiwKICBzdmc6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKfTsKCmZ1bmN0aW9uIE5iKGEpIHsKICBzd2l0Y2ggKGEpIHsKICAgIGNhc2UgInN2ZyI6CiAgICAgIHJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciOwoKICAgIGNhc2UgIm1hdGgiOgogICAgICByZXR1cm4gImh0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwiOwoKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI7CiAgfQp9CgpmdW5jdGlvbiBPYihhLCBiKSB7CiAgcmV0dXJuIG51bGwgPT0gYSB8fCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgPT09IGEgPyBOYihiKSA6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgPT09IGEgJiYgImZvcmVpZ25PYmplY3QiID09PSBiID8gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIDogYTsKfQoKdmFyIFBiLAogICAgUWIgPSBmdW5jdGlvbiAoYSkgewogIHJldHVybiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIE1TQXBwICYmIE1TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uID8gZnVuY3Rpb24gKGIsIGMsIGQsIGUpIHsKICAgIE1TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGEoYiwgYywgZCwgZSk7CiAgICB9KTsKICB9IDogYTsKfShmdW5jdGlvbiAoYSwgYikgewogIGlmIChhLm5hbWVzcGFjZVVSSSAhPT0gTWIuc3ZnIHx8ICJpbm5lckhUTUwiIGluIGEpIGEuaW5uZXJIVE1MID0gYjtlbHNlIHsKICAgIFBiID0gUGIgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBQYi5pbm5lckhUTUwgPSAiPHN2Zz4iICsgYi52YWx1ZU9mKCkudG9TdHJpbmcoKSArICI8L3N2Zz4iOwoKICAgIGZvciAoYiA9IFBiLmZpcnN0Q2hpbGQ7IGEuZmlyc3RDaGlsZDspIHsKICAgICAgYS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpOwogICAgfQoKICAgIGZvciAoOyBiLmZpcnN0Q2hpbGQ7KSB7CiAgICAgIGEuYXBwZW5kQ2hpbGQoYi5maXJzdENoaWxkKTsKICAgIH0KICB9Cn0pOwoKZnVuY3Rpb24gUmIoYSwgYikgewogIGlmIChiKSB7CiAgICB2YXIgYyA9IGEuZmlyc3RDaGlsZDsKCiAgICBpZiAoYyAmJiBjID09PSBhLmxhc3RDaGlsZCAmJiAzID09PSBjLm5vZGVUeXBlKSB7CiAgICAgIGMubm9kZVZhbHVlID0gYjsKICAgICAgcmV0dXJuOwogICAgfQogIH0KCiAgYS50ZXh0Q29udGVudCA9IGI7Cn0KCmZ1bmN0aW9uIFNiKGEsIGIpIHsKICB2YXIgYyA9IHt9OwogIGNbYS50b0xvd2VyQ2FzZSgpXSA9IGIudG9Mb3dlckNhc2UoKTsKICBjWyJXZWJraXQiICsgYV0gPSAid2Via2l0IiArIGI7CiAgY1siTW96IiArIGFdID0gIm1veiIgKyBiOwogIHJldHVybiBjOwp9Cgp2YXIgVGIgPSB7CiAgYW5pbWF0aW9uZW5kOiBTYigiQW5pbWF0aW9uIiwgIkFuaW1hdGlvbkVuZCIpLAogIGFuaW1hdGlvbml0ZXJhdGlvbjogU2IoIkFuaW1hdGlvbiIsICJBbmltYXRpb25JdGVyYXRpb24iKSwKICBhbmltYXRpb25zdGFydDogU2IoIkFuaW1hdGlvbiIsICJBbmltYXRpb25TdGFydCIpLAogIHRyYW5zaXRpb25lbmQ6IFNiKCJUcmFuc2l0aW9uIiwgIlRyYW5zaXRpb25FbmQiKQp9LAogICAgVWIgPSB7fSwKICAgIFZiID0ge307CnlhICYmIChWYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLCAiQW5pbWF0aW9uRXZlbnQiIGluIHdpbmRvdyB8fCAoZGVsZXRlIFRiLmFuaW1hdGlvbmVuZC5hbmltYXRpb24sIGRlbGV0ZSBUYi5hbmltYXRpb25pdGVyYXRpb24uYW5pbWF0aW9uLCBkZWxldGUgVGIuYW5pbWF0aW9uc3RhcnQuYW5pbWF0aW9uKSwgIlRyYW5zaXRpb25FdmVudCIgaW4gd2luZG93IHx8IGRlbGV0ZSBUYi50cmFuc2l0aW9uZW5kLnRyYW5zaXRpb24pOwoKZnVuY3Rpb24gV2IoYSkgewogIGlmIChVYlthXSkgcmV0dXJuIFViW2FdOwogIGlmICghVGJbYV0pIHJldHVybiBhOwogIHZhciBiID0gVGJbYV0sCiAgICAgIGM7CgogIGZvciAoYyBpbiBiKSB7CiAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eShjKSAmJiBjIGluIFZiKSByZXR1cm4gVWJbYV0gPSBiW2NdOwogIH0KCiAgcmV0dXJuIGE7Cn0KCnZhciBYYiA9IFdiKCJhbmltYXRpb25lbmQiKSwKICAgIFliID0gV2IoImFuaW1hdGlvbml0ZXJhdGlvbiIpLAogICAgWmIgPSBXYigiYW5pbWF0aW9uc3RhcnQiKSwKICAgICRiID0gV2IoInRyYW5zaXRpb25lbmQiKSwKICAgIGFjID0gImFib3J0IGNhbnBsYXkgY2FucGxheXRocm91Z2ggZHVyYXRpb25jaGFuZ2UgZW1wdGllZCBlbmNyeXB0ZWQgZW5kZWQgZXJyb3IgbG9hZGVkZGF0YSBsb2FkZWRtZXRhZGF0YSBsb2Fkc3RhcnQgcGF1c2UgcGxheSBwbGF5aW5nIHByb2dyZXNzIHJhdGVjaGFuZ2Ugc2Vla2VkIHNlZWtpbmcgc3RhbGxlZCBzdXNwZW5kIHRpbWV1cGRhdGUgdm9sdW1lY2hhbmdlIHdhaXRpbmciLnNwbGl0KCIgIiksCiAgICBiYyA9IG5ldyAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFdlYWtNYXAgPyBXZWFrTWFwIDogTWFwKSgpOwoKZnVuY3Rpb24gY2MoYSkgewogIHZhciBiID0gYmMuZ2V0KGEpOwogIHZvaWQgMCA9PT0gYiAmJiAoYiA9IG5ldyBNYXAoKSwgYmMuc2V0KGEsIGIpKTsKICByZXR1cm4gYjsKfQoKZnVuY3Rpb24gZGMoYSkgewogIHZhciBiID0gYSwKICAgICAgYyA9IGE7CiAgaWYgKGEuYWx0ZXJuYXRlKSBmb3IgKDsgYi5yZXR1cm47KSB7CiAgICBiID0gYi5yZXR1cm47CiAgfSBlbHNlIHsKICAgIGEgPSBiOwoKICAgIGRvIHsKICAgICAgYiA9IGEsIDAgIT09IChiLmVmZmVjdFRhZyAmIDEwMjYpICYmIChjID0gYi5yZXR1cm4pLCBhID0gYi5yZXR1cm47CiAgICB9IHdoaWxlIChhKTsKICB9CiAgcmV0dXJuIDMgPT09IGIudGFnID8gYyA6IG51bGw7Cn0KCmZ1bmN0aW9uIGVjKGEpIHsKICBpZiAoMTMgPT09IGEudGFnKSB7CiAgICB2YXIgYiA9IGEubWVtb2l6ZWRTdGF0ZTsKICAgIG51bGwgPT09IGIgJiYgKGEgPSBhLmFsdGVybmF0ZSwgbnVsbCAhPT0gYSAmJiAoYiA9IGEubWVtb2l6ZWRTdGF0ZSkpOwogICAgaWYgKG51bGwgIT09IGIpIHJldHVybiBiLmRlaHlkcmF0ZWQ7CiAgfQoKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gZmMoYSkgewogIGlmIChkYyhhKSAhPT0gYSkgdGhyb3cgRXJyb3IodSgxODgpKTsKfQoKZnVuY3Rpb24gZ2MoYSkgewogIHZhciBiID0gYS5hbHRlcm5hdGU7CgogIGlmICghYikgewogICAgYiA9IGRjKGEpOwogICAgaWYgKG51bGwgPT09IGIpIHRocm93IEVycm9yKHUoMTg4KSk7CiAgICByZXR1cm4gYiAhPT0gYSA/IG51bGwgOiBhOwogIH0KCiAgZm9yICh2YXIgYyA9IGEsIGQgPSBiOzspIHsKICAgIHZhciBlID0gYy5yZXR1cm47CiAgICBpZiAobnVsbCA9PT0gZSkgYnJlYWs7CiAgICB2YXIgZiA9IGUuYWx0ZXJuYXRlOwoKICAgIGlmIChudWxsID09PSBmKSB7CiAgICAgIGQgPSBlLnJldHVybjsKCiAgICAgIGlmIChudWxsICE9PSBkKSB7CiAgICAgICAgYyA9IGQ7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGJyZWFrOwogICAgfQoKICAgIGlmIChlLmNoaWxkID09PSBmLmNoaWxkKSB7CiAgICAgIGZvciAoZiA9IGUuY2hpbGQ7IGY7KSB7CiAgICAgICAgaWYgKGYgPT09IGMpIHJldHVybiBmYyhlKSwgYTsKICAgICAgICBpZiAoZiA9PT0gZCkgcmV0dXJuIGZjKGUpLCBiOwogICAgICAgIGYgPSBmLnNpYmxpbmc7CiAgICAgIH0KCiAgICAgIHRocm93IEVycm9yKHUoMTg4KSk7CiAgICB9CgogICAgaWYgKGMucmV0dXJuICE9PSBkLnJldHVybikgYyA9IGUsIGQgPSBmO2Vsc2UgewogICAgICBmb3IgKHZhciBnID0gITEsIGggPSBlLmNoaWxkOyBoOykgewogICAgICAgIGlmIChoID09PSBjKSB7CiAgICAgICAgICBnID0gITA7CiAgICAgICAgICBjID0gZTsKICAgICAgICAgIGQgPSBmOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAoaCA9PT0gZCkgewogICAgICAgICAgZyA9ICEwOwogICAgICAgICAgZCA9IGU7CiAgICAgICAgICBjID0gZjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaCA9IGguc2libGluZzsKICAgICAgfQoKICAgICAgaWYgKCFnKSB7CiAgICAgICAgZm9yIChoID0gZi5jaGlsZDsgaDspIHsKICAgICAgICAgIGlmIChoID09PSBjKSB7CiAgICAgICAgICAgIGcgPSAhMDsKICAgICAgICAgICAgYyA9IGY7CiAgICAgICAgICAgIGQgPSBlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaCA9PT0gZCkgewogICAgICAgICAgICBnID0gITA7CiAgICAgICAgICAgIGQgPSBmOwogICAgICAgICAgICBjID0gZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgaCA9IGguc2libGluZzsKICAgICAgICB9CgogICAgICAgIGlmICghZykgdGhyb3cgRXJyb3IodSgxODkpKTsKICAgICAgfQogICAgfQogICAgaWYgKGMuYWx0ZXJuYXRlICE9PSBkKSB0aHJvdyBFcnJvcih1KDE5MCkpOwogIH0KCiAgaWYgKDMgIT09IGMudGFnKSB0aHJvdyBFcnJvcih1KDE4OCkpOwogIHJldHVybiBjLnN0YXRlTm9kZS5jdXJyZW50ID09PSBjID8gYSA6IGI7Cn0KCmZ1bmN0aW9uIGhjKGEpIHsKICBhID0gZ2MoYSk7CiAgaWYgKCFhKSByZXR1cm4gbnVsbDsKCiAgZm9yICh2YXIgYiA9IGE7OykgewogICAgaWYgKDUgPT09IGIudGFnIHx8IDYgPT09IGIudGFnKSByZXR1cm4gYjsKICAgIGlmIChiLmNoaWxkKSBiLmNoaWxkLnJldHVybiA9IGIsIGIgPSBiLmNoaWxkO2Vsc2UgewogICAgICBpZiAoYiA9PT0gYSkgYnJlYWs7CgogICAgICBmb3IgKDsgIWIuc2libGluZzspIHsKICAgICAgICBpZiAoIWIucmV0dXJuIHx8IGIucmV0dXJuID09PSBhKSByZXR1cm4gbnVsbDsKICAgICAgICBiID0gYi5yZXR1cm47CiAgICAgIH0KCiAgICAgIGIuc2libGluZy5yZXR1cm4gPSBiLnJldHVybjsKICAgICAgYiA9IGIuc2libGluZzsKICAgIH0KICB9CgogIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBpYyhhLCBiKSB7CiAgaWYgKG51bGwgPT0gYikgdGhyb3cgRXJyb3IodSgzMCkpOwogIGlmIChudWxsID09IGEpIHJldHVybiBiOwoKICBpZiAoQXJyYXkuaXNBcnJheShhKSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoYikpIHJldHVybiBhLnB1c2guYXBwbHkoYSwgYiksIGE7CiAgICBhLnB1c2goYik7CiAgICByZXR1cm4gYTsKICB9CgogIHJldHVybiBBcnJheS5pc0FycmF5KGIpID8gW2FdLmNvbmNhdChiKSA6IFthLCBiXTsKfQoKZnVuY3Rpb24gamMoYSwgYiwgYykgewogIEFycmF5LmlzQXJyYXkoYSkgPyBhLmZvckVhY2goYiwgYykgOiBhICYmIGIuY2FsbChjLCBhKTsKfQoKdmFyIGtjID0gbnVsbDsKCmZ1bmN0aW9uIGxjKGEpIHsKICBpZiAoYSkgewogICAgdmFyIGIgPSBhLl9kaXNwYXRjaExpc3RlbmVycywKICAgICAgICBjID0gYS5fZGlzcGF0Y2hJbnN0YW5jZXM7CiAgICBpZiAoQXJyYXkuaXNBcnJheShiKSkgZm9yICh2YXIgZCA9IDA7IGQgPCBiLmxlbmd0aCAmJiAhYS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpOyBkKyspIHsKICAgICAgb2EoYSwgYltkXSwgY1tkXSk7CiAgICB9IGVsc2UgYiAmJiBvYShhLCBiLCBjKTsKICAgIGEuX2Rpc3BhdGNoTGlzdGVuZXJzID0gbnVsbDsKICAgIGEuX2Rpc3BhdGNoSW5zdGFuY2VzID0gbnVsbDsKICAgIGEuaXNQZXJzaXN0ZW50KCkgfHwgYS5jb25zdHJ1Y3Rvci5yZWxlYXNlKGEpOwogIH0KfQoKZnVuY3Rpb24gbWMoYSkgewogIG51bGwgIT09IGEgJiYgKGtjID0gaWMoa2MsIGEpKTsKICBhID0ga2M7CiAga2MgPSBudWxsOwoKICBpZiAoYSkgewogICAgamMoYSwgbGMpOwogICAgaWYgKGtjKSB0aHJvdyBFcnJvcih1KDk1KSk7CiAgICBpZiAoZmEpIHRocm93IGEgPSBoYSwgZmEgPSAhMSwgaGEgPSBudWxsLCBhOwogIH0KfQoKZnVuY3Rpb24gbmMoYSkgewogIGEgPSBhLnRhcmdldCB8fCBhLnNyY0VsZW1lbnQgfHwgd2luZG93OwogIGEuY29ycmVzcG9uZGluZ1VzZUVsZW1lbnQgJiYgKGEgPSBhLmNvcnJlc3BvbmRpbmdVc2VFbGVtZW50KTsKICByZXR1cm4gMyA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGE7Cn0KCmZ1bmN0aW9uIG9jKGEpIHsKICBpZiAoIXlhKSByZXR1cm4gITE7CiAgYSA9ICJvbiIgKyBhOwogIHZhciBiID0gKGEgaW4gZG9jdW1lbnQpOwogIGIgfHwgKGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgYi5zZXRBdHRyaWJ1dGUoYSwgInJldHVybjsiKSwgYiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBiW2FdKTsKICByZXR1cm4gYjsKfQoKdmFyIHBjID0gW107CgpmdW5jdGlvbiBxYyhhKSB7CiAgYS50b3BMZXZlbFR5cGUgPSBudWxsOwogIGEubmF0aXZlRXZlbnQgPSBudWxsOwogIGEudGFyZ2V0SW5zdCA9IG51bGw7CiAgYS5hbmNlc3RvcnMubGVuZ3RoID0gMDsKICAxMCA+IHBjLmxlbmd0aCAmJiBwYy5wdXNoKGEpOwp9CgpmdW5jdGlvbiByYyhhLCBiLCBjLCBkKSB7CiAgaWYgKHBjLmxlbmd0aCkgewogICAgdmFyIGUgPSBwYy5wb3AoKTsKICAgIGUudG9wTGV2ZWxUeXBlID0gYTsKICAgIGUuZXZlbnRTeXN0ZW1GbGFncyA9IGQ7CiAgICBlLm5hdGl2ZUV2ZW50ID0gYjsKICAgIGUudGFyZ2V0SW5zdCA9IGM7CiAgICByZXR1cm4gZTsKICB9CgogIHJldHVybiB7CiAgICB0b3BMZXZlbFR5cGU6IGEsCiAgICBldmVudFN5c3RlbUZsYWdzOiBkLAogICAgbmF0aXZlRXZlbnQ6IGIsCiAgICB0YXJnZXRJbnN0OiBjLAogICAgYW5jZXN0b3JzOiBbXQogIH07Cn0KCmZ1bmN0aW9uIHNjKGEpIHsKICB2YXIgYiA9IGEudGFyZ2V0SW5zdCwKICAgICAgYyA9IGI7CgogIGRvIHsKICAgIGlmICghYykgewogICAgICBhLmFuY2VzdG9ycy5wdXNoKGMpOwogICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgZCA9IGM7CiAgICBpZiAoMyA9PT0gZC50YWcpIGQgPSBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO2Vsc2UgewogICAgICBmb3IgKDsgZC5yZXR1cm47KSB7CiAgICAgICAgZCA9IGQucmV0dXJuOwogICAgICB9CgogICAgICBkID0gMyAhPT0gZC50YWcgPyBudWxsIDogZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbzsKICAgIH0KICAgIGlmICghZCkgYnJlYWs7CiAgICBiID0gYy50YWc7CiAgICA1ICE9PSBiICYmIDYgIT09IGIgfHwgYS5hbmNlc3RvcnMucHVzaChjKTsKICAgIGMgPSB0YyhkKTsKICB9IHdoaWxlIChjKTsKCiAgZm9yIChjID0gMDsgYyA8IGEuYW5jZXN0b3JzLmxlbmd0aDsgYysrKSB7CiAgICBiID0gYS5hbmNlc3RvcnNbY107CiAgICB2YXIgZSA9IG5jKGEubmF0aXZlRXZlbnQpOwogICAgZCA9IGEudG9wTGV2ZWxUeXBlOwogICAgdmFyIGYgPSBhLm5hdGl2ZUV2ZW50LAogICAgICAgIGcgPSBhLmV2ZW50U3lzdGVtRmxhZ3M7CiAgICAwID09PSBjICYmIChnIHw9IDY0KTsKCiAgICBmb3IgKHZhciBoID0gbnVsbCwgayA9IDA7IGsgPCBzYS5sZW5ndGg7IGsrKykgewogICAgICB2YXIgbCA9IHNhW2tdOwogICAgICBsICYmIChsID0gbC5leHRyYWN0RXZlbnRzKGQsIGIsIGYsIGUsIGcpKSAmJiAoaCA9IGljKGgsIGwpKTsKICAgIH0KCiAgICBtYyhoKTsKICB9Cn0KCmZ1bmN0aW9uIHVjKGEsIGIsIGMpIHsKICBpZiAoIWMuaGFzKGEpKSB7CiAgICBzd2l0Y2ggKGEpIHsKICAgICAgY2FzZSAic2Nyb2xsIjoKICAgICAgICB2YyhiLCAic2Nyb2xsIiwgITApOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAiZm9jdXMiOgogICAgICBjYXNlICJibHVyIjoKICAgICAgICB2YyhiLCAiZm9jdXMiLCAhMCk7CiAgICAgICAgdmMoYiwgImJsdXIiLCAhMCk7CiAgICAgICAgYy5zZXQoImJsdXIiLCBudWxsKTsKICAgICAgICBjLnNldCgiZm9jdXMiLCBudWxsKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgImNhbmNlbCI6CiAgICAgIGNhc2UgImNsb3NlIjoKICAgICAgICBvYyhhKSAmJiB2YyhiLCBhLCAhMCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICJpbnZhbGlkIjoKICAgICAgY2FzZSAic3VibWl0IjoKICAgICAgY2FzZSAicmVzZXQiOgogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICAtMSA9PT0gYWMuaW5kZXhPZihhKSAmJiBGKGEsIGIpOwogICAgfQoKICAgIGMuc2V0KGEsIG51bGwpOwogIH0KfQoKdmFyIHdjLAogICAgeGMsCiAgICB5YywKICAgIHpjID0gITEsCiAgICBBYyA9IFtdLAogICAgQmMgPSBudWxsLAogICAgQ2MgPSBudWxsLAogICAgRGMgPSBudWxsLAogICAgRWMgPSBuZXcgTWFwKCksCiAgICBGYyA9IG5ldyBNYXAoKSwKICAgIEdjID0gW10sCiAgICBIYyA9ICJtb3VzZWRvd24gbW91c2V1cCB0b3VjaGNhbmNlbCB0b3VjaGVuZCB0b3VjaHN0YXJ0IGF1eGNsaWNrIGRibGNsaWNrIHBvaW50ZXJjYW5jZWwgcG9pbnRlcmRvd24gcG9pbnRlcnVwIGRyYWdlbmQgZHJhZ3N0YXJ0IGRyb3AgY29tcG9zaXRpb25lbmQgY29tcG9zaXRpb25zdGFydCBrZXlkb3duIGtleXByZXNzIGtleXVwIGlucHV0IHRleHRJbnB1dCBjbG9zZSBjYW5jZWwgY29weSBjdXQgcGFzdGUgY2xpY2sgY2hhbmdlIGNvbnRleHRtZW51IHJlc2V0IHN1Ym1pdCIuc3BsaXQoIiAiKSwKICAgIEljID0gImZvY3VzIGJsdXIgZHJhZ2VudGVyIGRyYWdsZWF2ZSBtb3VzZW92ZXIgbW91c2VvdXQgcG9pbnRlcm92ZXIgcG9pbnRlcm91dCBnb3Rwb2ludGVyY2FwdHVyZSBsb3N0cG9pbnRlcmNhcHR1cmUiLnNwbGl0KCIgIik7CgpmdW5jdGlvbiBKYyhhLCBiKSB7CiAgdmFyIGMgPSBjYyhiKTsKICBIYy5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgICB1YyhhLCBiLCBjKTsKICB9KTsKICBJYy5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgICB1YyhhLCBiLCBjKTsKICB9KTsKfQoKZnVuY3Rpb24gS2MoYSwgYiwgYywgZCwgZSkgewogIHJldHVybiB7CiAgICBibG9ja2VkT246IGEsCiAgICB0b3BMZXZlbFR5cGU6IGIsCiAgICBldmVudFN5c3RlbUZsYWdzOiBjIHwgMzIsCiAgICBuYXRpdmVFdmVudDogZSwKICAgIGNvbnRhaW5lcjogZAogIH07Cn0KCmZ1bmN0aW9uIExjKGEsIGIpIHsKICBzd2l0Y2ggKGEpIHsKICAgIGNhc2UgImZvY3VzIjoKICAgIGNhc2UgImJsdXIiOgogICAgICBCYyA9IG51bGw7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgImRyYWdlbnRlciI6CiAgICBjYXNlICJkcmFnbGVhdmUiOgogICAgICBDYyA9IG51bGw7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgIm1vdXNlb3ZlciI6CiAgICBjYXNlICJtb3VzZW91dCI6CiAgICAgIERjID0gbnVsbDsKICAgICAgYnJlYWs7CgogICAgY2FzZSAicG9pbnRlcm92ZXIiOgogICAgY2FzZSAicG9pbnRlcm91dCI6CiAgICAgIEVjLmRlbGV0ZShiLnBvaW50ZXJJZCk7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjoKICAgIGNhc2UgImxvc3Rwb2ludGVyY2FwdHVyZSI6CiAgICAgIEZjLmRlbGV0ZShiLnBvaW50ZXJJZCk7CiAgfQp9CgpmdW5jdGlvbiBNYyhhLCBiLCBjLCBkLCBlLCBmKSB7CiAgaWYgKG51bGwgPT09IGEgfHwgYS5uYXRpdmVFdmVudCAhPT0gZikgcmV0dXJuIGEgPSBLYyhiLCBjLCBkLCBlLCBmKSwgbnVsbCAhPT0gYiAmJiAoYiA9IE5jKGIpLCBudWxsICE9PSBiICYmIHhjKGIpKSwgYTsKICBhLmV2ZW50U3lzdGVtRmxhZ3MgfD0gZDsKICByZXR1cm4gYTsKfQoKZnVuY3Rpb24gT2MoYSwgYiwgYywgZCwgZSkgewogIHN3aXRjaCAoYikgewogICAgY2FzZSAiZm9jdXMiOgogICAgICByZXR1cm4gQmMgPSBNYyhCYywgYSwgYiwgYywgZCwgZSksICEwOwoKICAgIGNhc2UgImRyYWdlbnRlciI6CiAgICAgIHJldHVybiBDYyA9IE1jKENjLCBhLCBiLCBjLCBkLCBlKSwgITA7CgogICAgY2FzZSAibW91c2VvdmVyIjoKICAgICAgcmV0dXJuIERjID0gTWMoRGMsIGEsIGIsIGMsIGQsIGUpLCAhMDsKCiAgICBjYXNlICJwb2ludGVyb3ZlciI6CiAgICAgIHZhciBmID0gZS5wb2ludGVySWQ7CiAgICAgIEVjLnNldChmLCBNYyhFYy5nZXQoZikgfHwgbnVsbCwgYSwgYiwgYywgZCwgZSkpOwogICAgICByZXR1cm4gITA7CgogICAgY2FzZSAiZ290cG9pbnRlcmNhcHR1cmUiOgogICAgICByZXR1cm4gZiA9IGUucG9pbnRlcklkLCBGYy5zZXQoZiwgTWMoRmMuZ2V0KGYpIHx8IG51bGwsIGEsIGIsIGMsIGQsIGUpKSwgITA7CiAgfQoKICByZXR1cm4gITE7Cn0KCmZ1bmN0aW9uIFBjKGEpIHsKICB2YXIgYiA9IHRjKGEudGFyZ2V0KTsKCiAgaWYgKG51bGwgIT09IGIpIHsKICAgIHZhciBjID0gZGMoYik7CiAgICBpZiAobnVsbCAhPT0gYykgaWYgKGIgPSBjLnRhZywgMTMgPT09IGIpIHsKICAgICAgaWYgKGIgPSBlYyhjKSwgbnVsbCAhPT0gYikgewogICAgICAgIGEuYmxvY2tlZE9uID0gYjsKICAgICAgICByLnVuc3RhYmxlX3J1bldpdGhQcmlvcml0eShhLnByaW9yaXR5LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB5YyhjKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoMyA9PT0gYiAmJiBjLnN0YXRlTm9kZS5oeWRyYXRlKSB7CiAgICAgIGEuYmxvY2tlZE9uID0gMyA9PT0gYy50YWcgPyBjLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIDogbnVsbDsKICAgICAgcmV0dXJuOwogICAgfQogIH0KCiAgYS5ibG9ja2VkT24gPSBudWxsOwp9CgpmdW5jdGlvbiBRYyhhKSB7CiAgaWYgKG51bGwgIT09IGEuYmxvY2tlZE9uKSByZXR1cm4gITE7CiAgdmFyIGIgPSBSYyhhLnRvcExldmVsVHlwZSwgYS5ldmVudFN5c3RlbUZsYWdzLCBhLmNvbnRhaW5lciwgYS5uYXRpdmVFdmVudCk7CgogIGlmIChudWxsICE9PSBiKSB7CiAgICB2YXIgYyA9IE5jKGIpOwogICAgbnVsbCAhPT0gYyAmJiB4YyhjKTsKICAgIGEuYmxvY2tlZE9uID0gYjsKICAgIHJldHVybiAhMTsKICB9CgogIHJldHVybiAhMDsKfQoKZnVuY3Rpb24gU2MoYSwgYiwgYykgewogIFFjKGEpICYmIGMuZGVsZXRlKGIpOwp9CgpmdW5jdGlvbiBUYygpIHsKICBmb3IgKHpjID0gITE7IDAgPCBBYy5sZW5ndGg7KSB7CiAgICB2YXIgYSA9IEFjWzBdOwoKICAgIGlmIChudWxsICE9PSBhLmJsb2NrZWRPbikgewogICAgICBhID0gTmMoYS5ibG9ja2VkT24pOwogICAgICBudWxsICE9PSBhICYmIHdjKGEpOwogICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgYiA9IFJjKGEudG9wTGV2ZWxUeXBlLCBhLmV2ZW50U3lzdGVtRmxhZ3MsIGEuY29udGFpbmVyLCBhLm5hdGl2ZUV2ZW50KTsKICAgIG51bGwgIT09IGIgPyBhLmJsb2NrZWRPbiA9IGIgOiBBYy5zaGlmdCgpOwogIH0KCiAgbnVsbCAhPT0gQmMgJiYgUWMoQmMpICYmIChCYyA9IG51bGwpOwogIG51bGwgIT09IENjICYmIFFjKENjKSAmJiAoQ2MgPSBudWxsKTsKICBudWxsICE9PSBEYyAmJiBRYyhEYykgJiYgKERjID0gbnVsbCk7CiAgRWMuZm9yRWFjaChTYyk7CiAgRmMuZm9yRWFjaChTYyk7Cn0KCmZ1bmN0aW9uIFVjKGEsIGIpIHsKICBhLmJsb2NrZWRPbiA9PT0gYiAmJiAoYS5ibG9ja2VkT24gPSBudWxsLCB6YyB8fCAoemMgPSAhMCwgci51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrKHIudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksIFRjKSkpOwp9CgpmdW5jdGlvbiBWYyhhKSB7CiAgZnVuY3Rpb24gYihiKSB7CiAgICByZXR1cm4gVWMoYiwgYSk7CiAgfQoKICBpZiAoMCA8IEFjLmxlbmd0aCkgewogICAgVWMoQWNbMF0sIGEpOwoKICAgIGZvciAodmFyIGMgPSAxOyBjIDwgQWMubGVuZ3RoOyBjKyspIHsKICAgICAgdmFyIGQgPSBBY1tjXTsKICAgICAgZC5ibG9ja2VkT24gPT09IGEgJiYgKGQuYmxvY2tlZE9uID0gbnVsbCk7CiAgICB9CiAgfQoKICBudWxsICE9PSBCYyAmJiBVYyhCYywgYSk7CiAgbnVsbCAhPT0gQ2MgJiYgVWMoQ2MsIGEpOwogIG51bGwgIT09IERjICYmIFVjKERjLCBhKTsKICBFYy5mb3JFYWNoKGIpOwogIEZjLmZvckVhY2goYik7CgogIGZvciAoYyA9IDA7IGMgPCBHYy5sZW5ndGg7IGMrKykgewogICAgZCA9IEdjW2NdLCBkLmJsb2NrZWRPbiA9PT0gYSAmJiAoZC5ibG9ja2VkT24gPSBudWxsKTsKICB9CgogIGZvciAoOyAwIDwgR2MubGVuZ3RoICYmIChjID0gR2NbMF0sIG51bGwgPT09IGMuYmxvY2tlZE9uKTspIHsKICAgIFBjKGMpLCBudWxsID09PSBjLmJsb2NrZWRPbiAmJiBHYy5zaGlmdCgpOwogIH0KfQoKdmFyIFdjID0ge30sCiAgICBZYyA9IG5ldyBNYXAoKSwKICAgIFpjID0gbmV3IE1hcCgpLAogICAgJGMgPSBbImFib3J0IiwgImFib3J0IiwgWGIsICJhbmltYXRpb25FbmQiLCBZYiwgImFuaW1hdGlvbkl0ZXJhdGlvbiIsIFpiLCAiYW5pbWF0aW9uU3RhcnQiLCAiY2FucGxheSIsICJjYW5QbGF5IiwgImNhbnBsYXl0aHJvdWdoIiwgImNhblBsYXlUaHJvdWdoIiwgImR1cmF0aW9uY2hhbmdlIiwgImR1cmF0aW9uQ2hhbmdlIiwgImVtcHRpZWQiLCAiZW1wdGllZCIsICJlbmNyeXB0ZWQiLCAiZW5jcnlwdGVkIiwgImVuZGVkIiwgImVuZGVkIiwgImVycm9yIiwgImVycm9yIiwgImdvdHBvaW50ZXJjYXB0dXJlIiwgImdvdFBvaW50ZXJDYXB0dXJlIiwgImxvYWQiLCAibG9hZCIsICJsb2FkZWRkYXRhIiwgImxvYWRlZERhdGEiLCAibG9hZGVkbWV0YWRhdGEiLCAibG9hZGVkTWV0YWRhdGEiLCAibG9hZHN0YXJ0IiwgImxvYWRTdGFydCIsICJsb3N0cG9pbnRlcmNhcHR1cmUiLCAibG9zdFBvaW50ZXJDYXB0dXJlIiwgInBsYXlpbmciLCAicGxheWluZyIsICJwcm9ncmVzcyIsICJwcm9ncmVzcyIsICJzZWVraW5nIiwgInNlZWtpbmciLCAic3RhbGxlZCIsICJzdGFsbGVkIiwgInN1c3BlbmQiLCAic3VzcGVuZCIsICJ0aW1ldXBkYXRlIiwgInRpbWVVcGRhdGUiLCAkYiwgInRyYW5zaXRpb25FbmQiLCAid2FpdGluZyIsICJ3YWl0aW5nIl07CgpmdW5jdGlvbiBhZChhLCBiKSB7CiAgZm9yICh2YXIgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYyArPSAyKSB7CiAgICB2YXIgZCA9IGFbY10sCiAgICAgICAgZSA9IGFbYyArIDFdLAogICAgICAgIGYgPSAib24iICsgKGVbMF0udG9VcHBlckNhc2UoKSArIGUuc2xpY2UoMSkpOwogICAgZiA9IHsKICAgICAgcGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6IHsKICAgICAgICBidWJibGVkOiBmLAogICAgICAgIGNhcHR1cmVkOiBmICsgIkNhcHR1cmUiCiAgICAgIH0sCiAgICAgIGRlcGVuZGVuY2llczogW2RdLAogICAgICBldmVudFByaW9yaXR5OiBiCiAgICB9OwogICAgWmMuc2V0KGQsIGIpOwogICAgWWMuc2V0KGQsIGYpOwogICAgV2NbZV0gPSBmOwogIH0KfQoKYWQoImJsdXIgYmx1ciBjYW5jZWwgY2FuY2VsIGNsaWNrIGNsaWNrIGNsb3NlIGNsb3NlIGNvbnRleHRtZW51IGNvbnRleHRNZW51IGNvcHkgY29weSBjdXQgY3V0IGF1eGNsaWNrIGF1eENsaWNrIGRibGNsaWNrIGRvdWJsZUNsaWNrIGRyYWdlbmQgZHJhZ0VuZCBkcmFnc3RhcnQgZHJhZ1N0YXJ0IGRyb3AgZHJvcCBmb2N1cyBmb2N1cyBpbnB1dCBpbnB1dCBpbnZhbGlkIGludmFsaWQga2V5ZG93biBrZXlEb3duIGtleXByZXNzIGtleVByZXNzIGtleXVwIGtleVVwIG1vdXNlZG93biBtb3VzZURvd24gbW91c2V1cCBtb3VzZVVwIHBhc3RlIHBhc3RlIHBhdXNlIHBhdXNlIHBsYXkgcGxheSBwb2ludGVyY2FuY2VsIHBvaW50ZXJDYW5jZWwgcG9pbnRlcmRvd24gcG9pbnRlckRvd24gcG9pbnRlcnVwIHBvaW50ZXJVcCByYXRlY2hhbmdlIHJhdGVDaGFuZ2UgcmVzZXQgcmVzZXQgc2Vla2VkIHNlZWtlZCBzdWJtaXQgc3VibWl0IHRvdWNoY2FuY2VsIHRvdWNoQ2FuY2VsIHRvdWNoZW5kIHRvdWNoRW5kIHRvdWNoc3RhcnQgdG91Y2hTdGFydCB2b2x1bWVjaGFuZ2Ugdm9sdW1lQ2hhbmdlIi5zcGxpdCgiICIpLCAwKTsKYWQoImRyYWcgZHJhZyBkcmFnZW50ZXIgZHJhZ0VudGVyIGRyYWdleGl0IGRyYWdFeGl0IGRyYWdsZWF2ZSBkcmFnTGVhdmUgZHJhZ292ZXIgZHJhZ092ZXIgbW91c2Vtb3ZlIG1vdXNlTW92ZSBtb3VzZW91dCBtb3VzZU91dCBtb3VzZW92ZXIgbW91c2VPdmVyIHBvaW50ZXJtb3ZlIHBvaW50ZXJNb3ZlIHBvaW50ZXJvdXQgcG9pbnRlck91dCBwb2ludGVyb3ZlciBwb2ludGVyT3ZlciBzY3JvbGwgc2Nyb2xsIHRvZ2dsZSB0b2dnbGUgdG91Y2htb3ZlIHRvdWNoTW92ZSB3aGVlbCB3aGVlbCIuc3BsaXQoIiAiKSwgMSk7CmFkKCRjLCAyKTsKCmZvciAodmFyIGJkID0gImNoYW5nZSBzZWxlY3Rpb25jaGFuZ2UgdGV4dElucHV0IGNvbXBvc2l0aW9uc3RhcnQgY29tcG9zaXRpb25lbmQgY29tcG9zaXRpb251cGRhdGUiLnNwbGl0KCIgIiksIGNkID0gMDsgY2QgPCBiZC5sZW5ndGg7IGNkKyspIHsKICBaYy5zZXQoYmRbY2RdLCAwKTsKfQoKdmFyIGRkID0gci51bnN0YWJsZV9Vc2VyQmxvY2tpbmdQcmlvcml0eSwKICAgIGVkID0gci51bnN0YWJsZV9ydW5XaXRoUHJpb3JpdHksCiAgICBmZCA9ICEwOwoKZnVuY3Rpb24gRihhLCBiKSB7CiAgdmMoYiwgYSwgITEpOwp9CgpmdW5jdGlvbiB2YyhhLCBiLCBjKSB7CiAgdmFyIGQgPSBaYy5nZXQoYik7CgogIHN3aXRjaCAodm9pZCAwID09PSBkID8gMiA6IGQpIHsKICAgIGNhc2UgMDoKICAgICAgZCA9IGdkLmJpbmQobnVsbCwgYiwgMSwgYSk7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgMToKICAgICAgZCA9IGhkLmJpbmQobnVsbCwgYiwgMSwgYSk7CiAgICAgIGJyZWFrOwoKICAgIGRlZmF1bHQ6CiAgICAgIGQgPSBpZC5iaW5kKG51bGwsIGIsIDEsIGEpOwogIH0KCiAgYyA/IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBkLCAhMCkgOiBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgZCwgITEpOwp9CgpmdW5jdGlvbiBnZChhLCBiLCBjLCBkKSB7CiAgSmEgfHwgSGEoKTsKICB2YXIgZSA9IGlkLAogICAgICBmID0gSmE7CiAgSmEgPSAhMDsKCiAgdHJ5IHsKICAgIEdhKGUsIGEsIGIsIGMsIGQpOwogIH0gZmluYWxseSB7CiAgICAoSmEgPSBmKSB8fCBMYSgpOwogIH0KfQoKZnVuY3Rpb24gaGQoYSwgYiwgYywgZCkgewogIGVkKGRkLCBpZC5iaW5kKG51bGwsIGEsIGIsIGMsIGQpKTsKfQoKZnVuY3Rpb24gaWQoYSwgYiwgYywgZCkgewogIGlmIChmZCkgaWYgKDAgPCBBYy5sZW5ndGggJiYgLTEgPCBIYy5pbmRleE9mKGEpKSBhID0gS2MobnVsbCwgYSwgYiwgYywgZCksIEFjLnB1c2goYSk7ZWxzZSB7CiAgICB2YXIgZSA9IFJjKGEsIGIsIGMsIGQpOwogICAgaWYgKG51bGwgPT09IGUpIExjKGEsIGQpO2Vsc2UgaWYgKC0xIDwgSGMuaW5kZXhPZihhKSkgYSA9IEtjKGUsIGEsIGIsIGMsIGQpLCBBYy5wdXNoKGEpO2Vsc2UgaWYgKCFPYyhlLCBhLCBiLCBjLCBkKSkgewogICAgICBMYyhhLCBkKTsKICAgICAgYSA9IHJjKGEsIGQsIG51bGwsIGIpOwoKICAgICAgdHJ5IHsKICAgICAgICBNYShzYywgYSk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgcWMoYSk7CiAgICAgIH0KICAgIH0KICB9Cn0KCmZ1bmN0aW9uIFJjKGEsIGIsIGMsIGQpIHsKICBjID0gbmMoZCk7CiAgYyA9IHRjKGMpOwoKICBpZiAobnVsbCAhPT0gYykgewogICAgdmFyIGUgPSBkYyhjKTsKICAgIGlmIChudWxsID09PSBlKSBjID0gbnVsbDtlbHNlIHsKICAgICAgdmFyIGYgPSBlLnRhZzsKCiAgICAgIGlmICgxMyA9PT0gZikgewogICAgICAgIGMgPSBlYyhlKTsKICAgICAgICBpZiAobnVsbCAhPT0gYykgcmV0dXJuIGM7CiAgICAgICAgYyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoMyA9PT0gZikgewogICAgICAgIGlmIChlLnN0YXRlTm9kZS5oeWRyYXRlKSByZXR1cm4gMyA9PT0gZS50YWcgPyBlLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIDogbnVsbDsKICAgICAgICBjID0gbnVsbDsKICAgICAgfSBlbHNlIGUgIT09IGMgJiYgKGMgPSBudWxsKTsKICAgIH0KICB9CgogIGEgPSByYyhhLCBkLCBjLCBiKTsKCiAgdHJ5IHsKICAgIE1hKHNjLCBhKTsKICB9IGZpbmFsbHkgewogICAgcWMoYSk7CiAgfQoKICByZXR1cm4gbnVsbDsKfQoKdmFyIGpkID0gewogIGFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiAhMCwKICBib3JkZXJJbWFnZU91dHNldDogITAsCiAgYm9yZGVySW1hZ2VTbGljZTogITAsCiAgYm9yZGVySW1hZ2VXaWR0aDogITAsCiAgYm94RmxleDogITAsCiAgYm94RmxleEdyb3VwOiAhMCwKICBib3hPcmRpbmFsR3JvdXA6ICEwLAogIGNvbHVtbkNvdW50OiAhMCwKICBjb2x1bW5zOiAhMCwKICBmbGV4OiAhMCwKICBmbGV4R3JvdzogITAsCiAgZmxleFBvc2l0aXZlOiAhMCwKICBmbGV4U2hyaW5rOiAhMCwKICBmbGV4TmVnYXRpdmU6ICEwLAogIGZsZXhPcmRlcjogITAsCiAgZ3JpZEFyZWE6ICEwLAogIGdyaWRSb3c6ICEwLAogIGdyaWRSb3dFbmQ6ICEwLAogIGdyaWRSb3dTcGFuOiAhMCwKICBncmlkUm93U3RhcnQ6ICEwLAogIGdyaWRDb2x1bW46ICEwLAogIGdyaWRDb2x1bW5FbmQ6ICEwLAogIGdyaWRDb2x1bW5TcGFuOiAhMCwKICBncmlkQ29sdW1uU3RhcnQ6ICEwLAogIGZvbnRXZWlnaHQ6ICEwLAogIGxpbmVDbGFtcDogITAsCiAgbGluZUhlaWdodDogITAsCiAgb3BhY2l0eTogITAsCiAgb3JkZXI6ICEwLAogIG9ycGhhbnM6ICEwLAogIHRhYlNpemU6ICEwLAogIHdpZG93czogITAsCiAgekluZGV4OiAhMCwKICB6b29tOiAhMCwKICBmaWxsT3BhY2l0eTogITAsCiAgZmxvb2RPcGFjaXR5OiAhMCwKICBzdG9wT3BhY2l0eTogITAsCiAgc3Ryb2tlRGFzaGFycmF5OiAhMCwKICBzdHJva2VEYXNob2Zmc2V0OiAhMCwKICBzdHJva2VNaXRlcmxpbWl0OiAhMCwKICBzdHJva2VPcGFjaXR5OiAhMCwKICBzdHJva2VXaWR0aDogITAKfSwKICAgIGtkID0gWyJXZWJraXQiLCAibXMiLCAiTW96IiwgIk8iXTsKT2JqZWN0LmtleXMoamQpLmZvckVhY2goZnVuY3Rpb24gKGEpIHsKICBrZC5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7CiAgICBiID0gYiArIGEuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhLnN1YnN0cmluZygxKTsKICAgIGpkW2JdID0gamRbYV07CiAgfSk7Cn0pOwoKZnVuY3Rpb24gbGQoYSwgYiwgYykgewogIHJldHVybiBudWxsID09IGIgfHwgImJvb2xlYW4iID09PSB0eXBlb2YgYiB8fCAiIiA9PT0gYiA/ICIiIDogYyB8fCAibnVtYmVyIiAhPT0gdHlwZW9mIGIgfHwgMCA9PT0gYiB8fCBqZC5oYXNPd25Qcm9wZXJ0eShhKSAmJiBqZFthXSA/ICgiIiArIGIpLnRyaW0oKSA6IGIgKyAicHgiOwp9CgpmdW5jdGlvbiBtZChhLCBiKSB7CiAgYSA9IGEuc3R5bGU7CgogIGZvciAodmFyIGMgaW4gYikgewogICAgaWYgKGIuaGFzT3duUHJvcGVydHkoYykpIHsKICAgICAgdmFyIGQgPSAwID09PSBjLmluZGV4T2YoIi0tIiksCiAgICAgICAgICBlID0gbGQoYywgYltjXSwgZCk7CiAgICAgICJmbG9hdCIgPT09IGMgJiYgKGMgPSAiY3NzRmxvYXQiKTsKICAgICAgZCA/IGEuc2V0UHJvcGVydHkoYywgZSkgOiBhW2NdID0gZTsKICAgIH0KICB9Cn0KCnZhciBuZCA9IG4oewogIG1lbnVpdGVtOiAhMAp9LCB7CiAgYXJlYTogITAsCiAgYmFzZTogITAsCiAgYnI6ICEwLAogIGNvbDogITAsCiAgZW1iZWQ6ICEwLAogIGhyOiAhMCwKICBpbWc6ICEwLAogIGlucHV0OiAhMCwKICBrZXlnZW46ICEwLAogIGxpbms6ICEwLAogIG1ldGE6ICEwLAogIHBhcmFtOiAhMCwKICBzb3VyY2U6ICEwLAogIHRyYWNrOiAhMCwKICB3YnI6ICEwCn0pOwoKZnVuY3Rpb24gb2QoYSwgYikgewogIGlmIChiKSB7CiAgICBpZiAobmRbYV0gJiYgKG51bGwgIT0gYi5jaGlsZHJlbiB8fCBudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpKSB0aHJvdyBFcnJvcih1KDEzNywgYSwgIiIpKTsKCiAgICBpZiAobnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSB7CiAgICAgIGlmIChudWxsICE9IGIuY2hpbGRyZW4pIHRocm93IEVycm9yKHUoNjApKTsKICAgICAgaWYgKCEoIm9iamVjdCIgPT09IF90eXBlb2YoYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkgJiYgIl9faHRtbCIgaW4gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkpIHRocm93IEVycm9yKHUoNjEpKTsKICAgIH0KCiAgICBpZiAobnVsbCAhPSBiLnN0eWxlICYmICJvYmplY3QiICE9PSBfdHlwZW9mKGIuc3R5bGUpKSB0aHJvdyBFcnJvcih1KDYyLCAiIikpOwogIH0KfQoKZnVuY3Rpb24gcGQoYSwgYikgewogIGlmICgtMSA9PT0gYS5pbmRleE9mKCItIikpIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGIuaXM7CgogIHN3aXRjaCAoYSkgewogICAgY2FzZSAiYW5ub3RhdGlvbi14bWwiOgogICAgY2FzZSAiY29sb3ItcHJvZmlsZSI6CiAgICBjYXNlICJmb250LWZhY2UiOgogICAgY2FzZSAiZm9udC1mYWNlLXNyYyI6CiAgICBjYXNlICJmb250LWZhY2UtdXJpIjoKICAgIGNhc2UgImZvbnQtZmFjZS1mb3JtYXQiOgogICAgY2FzZSAiZm9udC1mYWNlLW5hbWUiOgogICAgY2FzZSAibWlzc2luZy1nbHlwaCI6CiAgICAgIHJldHVybiAhMTsKCiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gITA7CiAgfQp9Cgp2YXIgcWQgPSBNYi5odG1sOwoKZnVuY3Rpb24gcmQoYSwgYikgewogIGEgPSA5ID09PSBhLm5vZGVUeXBlIHx8IDExID09PSBhLm5vZGVUeXBlID8gYSA6IGEub3duZXJEb2N1bWVudDsKICB2YXIgYyA9IGNjKGEpOwogIGIgPSB3YVtiXTsKCiAgZm9yICh2YXIgZCA9IDA7IGQgPCBiLmxlbmd0aDsgZCsrKSB7CiAgICB1YyhiW2RdLCBhLCBjKTsKICB9Cn0KCmZ1bmN0aW9uIHNkKCkge30KCmZ1bmN0aW9uIHRkKGEpIHsKICBhID0gYSB8fCAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBkb2N1bWVudCA/IGRvY3VtZW50IDogdm9pZCAwKTsKICBpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhKSByZXR1cm4gbnVsbDsKCiAgdHJ5IHsKICAgIHJldHVybiBhLmFjdGl2ZUVsZW1lbnQgfHwgYS5ib2R5OwogIH0gY2F0Y2ggKGIpIHsKICAgIHJldHVybiBhLmJvZHk7CiAgfQp9CgpmdW5jdGlvbiB1ZChhKSB7CiAgZm9yICg7IGEgJiYgYS5maXJzdENoaWxkOykgewogICAgYSA9IGEuZmlyc3RDaGlsZDsKICB9CgogIHJldHVybiBhOwp9CgpmdW5jdGlvbiB2ZChhLCBiKSB7CiAgdmFyIGMgPSB1ZChhKTsKICBhID0gMDsKCiAgZm9yICh2YXIgZDsgYzspIHsKICAgIGlmICgzID09PSBjLm5vZGVUeXBlKSB7CiAgICAgIGQgPSBhICsgYy50ZXh0Q29udGVudC5sZW5ndGg7CiAgICAgIGlmIChhIDw9IGIgJiYgZCA+PSBiKSByZXR1cm4gewogICAgICAgIG5vZGU6IGMsCiAgICAgICAgb2Zmc2V0OiBiIC0gYQogICAgICB9OwogICAgICBhID0gZDsKICAgIH0KCiAgICBhOiB7CiAgICAgIGZvciAoOyBjOykgewogICAgICAgIGlmIChjLm5leHRTaWJsaW5nKSB7CiAgICAgICAgICBjID0gYy5uZXh0U2libGluZzsKICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgfQoKICAgICAgICBjID0gYy5wYXJlbnROb2RlOwogICAgICB9CgogICAgICBjID0gdm9pZCAwOwogICAgfQoKICAgIGMgPSB1ZChjKTsKICB9Cn0KCmZ1bmN0aW9uIHdkKGEsIGIpIHsKICByZXR1cm4gYSAmJiBiID8gYSA9PT0gYiA/ICEwIDogYSAmJiAzID09PSBhLm5vZGVUeXBlID8gITEgOiBiICYmIDMgPT09IGIubm9kZVR5cGUgPyB3ZChhLCBiLnBhcmVudE5vZGUpIDogImNvbnRhaW5zIiBpbiBhID8gYS5jb250YWlucyhiKSA6IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAhIShhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgMTYpIDogITEgOiAhMTsKfQoKZnVuY3Rpb24geGQoKSB7CiAgZm9yICh2YXIgYSA9IHdpbmRvdywgYiA9IHRkKCk7IGIgaW5zdGFuY2VvZiBhLkhUTUxJRnJhbWVFbGVtZW50OykgewogICAgdHJ5IHsKICAgICAgdmFyIGMgPSAic3RyaW5nIiA9PT0gdHlwZW9mIGIuY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgfSBjYXRjaCAoZCkgewogICAgICBjID0gITE7CiAgICB9CgogICAgaWYgKGMpIGEgPSBiLmNvbnRlbnRXaW5kb3c7ZWxzZSBicmVhazsKICAgIGIgPSB0ZChhLmRvY3VtZW50KTsKICB9CgogIHJldHVybiBiOwp9CgpmdW5jdGlvbiB5ZChhKSB7CiAgdmFyIGIgPSBhICYmIGEubm9kZU5hbWUgJiYgYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogIHJldHVybiBiICYmICgiaW5wdXQiID09PSBiICYmICgidGV4dCIgPT09IGEudHlwZSB8fCAic2VhcmNoIiA9PT0gYS50eXBlIHx8ICJ0ZWwiID09PSBhLnR5cGUgfHwgInVybCIgPT09IGEudHlwZSB8fCAicGFzc3dvcmQiID09PSBhLnR5cGUpIHx8ICJ0ZXh0YXJlYSIgPT09IGIgfHwgInRydWUiID09PSBhLmNvbnRlbnRFZGl0YWJsZSk7Cn0KCnZhciB6ZCA9ICIkIiwKICAgIEFkID0gIi8kIiwKICAgIEJkID0gIiQ/IiwKICAgIENkID0gIiQhIiwKICAgIERkID0gbnVsbCwKICAgIEVkID0gbnVsbDsKCmZ1bmN0aW9uIEZkKGEsIGIpIHsKICBzd2l0Y2ggKGEpIHsKICAgIGNhc2UgImJ1dHRvbiI6CiAgICBjYXNlICJpbnB1dCI6CiAgICBjYXNlICJzZWxlY3QiOgogICAgY2FzZSAidGV4dGFyZWEiOgogICAgICByZXR1cm4gISFiLmF1dG9Gb2N1czsKICB9CgogIHJldHVybiAhMTsKfQoKZnVuY3Rpb24gR2QoYSwgYikgewogIHJldHVybiAidGV4dGFyZWEiID09PSBhIHx8ICJvcHRpb24iID09PSBhIHx8ICJub3NjcmlwdCIgPT09IGEgfHwgInN0cmluZyIgPT09IHR5cGVvZiBiLmNoaWxkcmVuIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYi5jaGlsZHJlbiB8fCAib2JqZWN0IiA9PT0gX3R5cGVvZihiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSAmJiBudWxsICE9PSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MICYmIG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTC5fX2h0bWw7Cn0KCnZhciBIZCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBzZXRUaW1lb3V0ID8gc2V0VGltZW91dCA6IHZvaWQgMCwKICAgIElkID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGNsZWFyVGltZW91dCA/IGNsZWFyVGltZW91dCA6IHZvaWQgMDsKCmZ1bmN0aW9uIEpkKGEpIHsKICBmb3IgKDsgbnVsbCAhPSBhOyBhID0gYS5uZXh0U2libGluZykgewogICAgdmFyIGIgPSBhLm5vZGVUeXBlOwogICAgaWYgKDEgPT09IGIgfHwgMyA9PT0gYikgYnJlYWs7CiAgfQoKICByZXR1cm4gYTsKfQoKZnVuY3Rpb24gS2QoYSkgewogIGEgPSBhLnByZXZpb3VzU2libGluZzsKCiAgZm9yICh2YXIgYiA9IDA7IGE7KSB7CiAgICBpZiAoOCA9PT0gYS5ub2RlVHlwZSkgewogICAgICB2YXIgYyA9IGEuZGF0YTsKCiAgICAgIGlmIChjID09PSB6ZCB8fCBjID09PSBDZCB8fCBjID09PSBCZCkgewogICAgICAgIGlmICgwID09PSBiKSByZXR1cm4gYTsKICAgICAgICBiLS07CiAgICAgIH0gZWxzZSBjID09PSBBZCAmJiBiKys7CiAgICB9CgogICAgYSA9IGEucHJldmlvdXNTaWJsaW5nOwogIH0KCiAgcmV0dXJuIG51bGw7Cn0KCnZhciBMZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpLAogICAgTWQgPSAiX19yZWFjdEludGVybmFsSW5zdGFuY2UkIiArIExkLAogICAgTmQgPSAiX19yZWFjdEV2ZW50SGFuZGxlcnMkIiArIExkLAogICAgT2QgPSAiX19yZWFjdENvbnRhaW5lcmUkIiArIExkOwoKZnVuY3Rpb24gdGMoYSkgewogIHZhciBiID0gYVtNZF07CiAgaWYgKGIpIHJldHVybiBiOwoKICBmb3IgKHZhciBjID0gYS5wYXJlbnROb2RlOyBjOykgewogICAgaWYgKGIgPSBjW09kXSB8fCBjW01kXSkgewogICAgICBjID0gYi5hbHRlcm5hdGU7CiAgICAgIGlmIChudWxsICE9PSBiLmNoaWxkIHx8IG51bGwgIT09IGMgJiYgbnVsbCAhPT0gYy5jaGlsZCkgZm9yIChhID0gS2QoYSk7IG51bGwgIT09IGE7KSB7CiAgICAgICAgaWYgKGMgPSBhW01kXSkgcmV0dXJuIGM7CiAgICAgICAgYSA9IEtkKGEpOwogICAgICB9CiAgICAgIHJldHVybiBiOwogICAgfQoKICAgIGEgPSBjOwogICAgYyA9IGEucGFyZW50Tm9kZTsKICB9CgogIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBOYyhhKSB7CiAgYSA9IGFbTWRdIHx8IGFbT2RdOwogIHJldHVybiAhYSB8fCA1ICE9PSBhLnRhZyAmJiA2ICE9PSBhLnRhZyAmJiAxMyAhPT0gYS50YWcgJiYgMyAhPT0gYS50YWcgPyBudWxsIDogYTsKfQoKZnVuY3Rpb24gUGQoYSkgewogIGlmICg1ID09PSBhLnRhZyB8fCA2ID09PSBhLnRhZykgcmV0dXJuIGEuc3RhdGVOb2RlOwogIHRocm93IEVycm9yKHUoMzMpKTsKfQoKZnVuY3Rpb24gUWQoYSkgewogIHJldHVybiBhW05kXSB8fCBudWxsOwp9CgpmdW5jdGlvbiBSZChhKSB7CiAgZG8gewogICAgYSA9IGEucmV0dXJuOwogIH0gd2hpbGUgKGEgJiYgNSAhPT0gYS50YWcpOwoKICByZXR1cm4gYSA/IGEgOiBudWxsOwp9CgpmdW5jdGlvbiBTZChhLCBiKSB7CiAgdmFyIGMgPSBhLnN0YXRlTm9kZTsKICBpZiAoIWMpIHJldHVybiBudWxsOwogIHZhciBkID0gbGEoYyk7CiAgaWYgKCFkKSByZXR1cm4gbnVsbDsKICBjID0gZFtiXTsKCiAgYTogc3dpdGNoIChiKSB7CiAgICBjYXNlICJvbkNsaWNrIjoKICAgIGNhc2UgIm9uQ2xpY2tDYXB0dXJlIjoKICAgIGNhc2UgIm9uRG91YmxlQ2xpY2siOgogICAgY2FzZSAib25Eb3VibGVDbGlja0NhcHR1cmUiOgogICAgY2FzZSAib25Nb3VzZURvd24iOgogICAgY2FzZSAib25Nb3VzZURvd25DYXB0dXJlIjoKICAgIGNhc2UgIm9uTW91c2VNb3ZlIjoKICAgIGNhc2UgIm9uTW91c2VNb3ZlQ2FwdHVyZSI6CiAgICBjYXNlICJvbk1vdXNlVXAiOgogICAgY2FzZSAib25Nb3VzZVVwQ2FwdHVyZSI6CiAgICBjYXNlICJvbk1vdXNlRW50ZXIiOgogICAgICAoZCA9ICFkLmRpc2FibGVkKSB8fCAoYSA9IGEudHlwZSwgZCA9ICEoImJ1dHRvbiIgPT09IGEgfHwgImlucHV0IiA9PT0gYSB8fCAic2VsZWN0IiA9PT0gYSB8fCAidGV4dGFyZWEiID09PSBhKSk7CiAgICAgIGEgPSAhZDsKICAgICAgYnJlYWsgYTsKCiAgICBkZWZhdWx0OgogICAgICBhID0gITE7CiAgfQoKICBpZiAoYSkgcmV0dXJuIG51bGw7CiAgaWYgKGMgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGMpIHRocm93IEVycm9yKHUoMjMxLCBiLCBfdHlwZW9mKGMpKSk7CiAgcmV0dXJuIGM7Cn0KCmZ1bmN0aW9uIFRkKGEsIGIsIGMpIHsKICBpZiAoYiA9IFNkKGEsIGMuZGlzcGF0Y2hDb25maWcucGhhc2VkUmVnaXN0cmF0aW9uTmFtZXNbYl0pKSBjLl9kaXNwYXRjaExpc3RlbmVycyA9IGljKGMuX2Rpc3BhdGNoTGlzdGVuZXJzLCBiKSwgYy5fZGlzcGF0Y2hJbnN0YW5jZXMgPSBpYyhjLl9kaXNwYXRjaEluc3RhbmNlcywgYSk7Cn0KCmZ1bmN0aW9uIFVkKGEpIHsKICBpZiAoYSAmJiBhLmRpc3BhdGNoQ29uZmlnLnBoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzKSB7CiAgICBmb3IgKHZhciBiID0gYS5fdGFyZ2V0SW5zdCwgYyA9IFtdOyBiOykgewogICAgICBjLnB1c2goYiksIGIgPSBSZChiKTsKICAgIH0KCiAgICBmb3IgKGIgPSBjLmxlbmd0aDsgMCA8IGItLTspIHsKICAgICAgVGQoY1tiXSwgImNhcHR1cmVkIiwgYSk7CiAgICB9CgogICAgZm9yIChiID0gMDsgYiA8IGMubGVuZ3RoOyBiKyspIHsKICAgICAgVGQoY1tiXSwgImJ1YmJsZWQiLCBhKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIFZkKGEsIGIsIGMpIHsKICBhICYmIGMgJiYgYy5kaXNwYXRjaENvbmZpZy5yZWdpc3RyYXRpb25OYW1lICYmIChiID0gU2QoYSwgYy5kaXNwYXRjaENvbmZpZy5yZWdpc3RyYXRpb25OYW1lKSkgJiYgKGMuX2Rpc3BhdGNoTGlzdGVuZXJzID0gaWMoYy5fZGlzcGF0Y2hMaXN0ZW5lcnMsIGIpLCBjLl9kaXNwYXRjaEluc3RhbmNlcyA9IGljKGMuX2Rpc3BhdGNoSW5zdGFuY2VzLCBhKSk7Cn0KCmZ1bmN0aW9uIFdkKGEpIHsKICBhICYmIGEuZGlzcGF0Y2hDb25maWcucmVnaXN0cmF0aW9uTmFtZSAmJiBWZChhLl90YXJnZXRJbnN0LCBudWxsLCBhKTsKfQoKZnVuY3Rpb24gWGQoYSkgewogIGpjKGEsIFVkKTsKfQoKdmFyIFlkID0gbnVsbCwKICAgIFpkID0gbnVsbCwKICAgICRkID0gbnVsbDsKCmZ1bmN0aW9uIGFlKCkgewogIGlmICgkZCkgcmV0dXJuICRkOwogIHZhciBhLAogICAgICBiID0gWmQsCiAgICAgIGMgPSBiLmxlbmd0aCwKICAgICAgZCwKICAgICAgZSA9ICJ2YWx1ZSIgaW4gWWQgPyBZZC52YWx1ZSA6IFlkLnRleHRDb250ZW50LAogICAgICBmID0gZS5sZW5ndGg7CgogIGZvciAoYSA9IDA7IGEgPCBjICYmIGJbYV0gPT09IGVbYV07IGErKykgewogICAgOwogIH0KCiAgdmFyIGcgPSBjIC0gYTsKCiAgZm9yIChkID0gMTsgZCA8PSBnICYmIGJbYyAtIGRdID09PSBlW2YgLSBkXTsgZCsrKSB7CiAgICA7CiAgfQoKICByZXR1cm4gJGQgPSBlLnNsaWNlKGEsIDEgPCBkID8gMSAtIGQgOiB2b2lkIDApOwp9CgpmdW5jdGlvbiBiZSgpIHsKICByZXR1cm4gITA7Cn0KCmZ1bmN0aW9uIGNlKCkgewogIHJldHVybiAhMTsKfQoKZnVuY3Rpb24gRyhhLCBiLCBjLCBkKSB7CiAgdGhpcy5kaXNwYXRjaENvbmZpZyA9IGE7CiAgdGhpcy5fdGFyZ2V0SW5zdCA9IGI7CiAgdGhpcy5uYXRpdmVFdmVudCA9IGM7CiAgYSA9IHRoaXMuY29uc3RydWN0b3IuSW50ZXJmYWNlOwoKICBmb3IgKHZhciBlIGluIGEpIHsKICAgIGEuaGFzT3duUHJvcGVydHkoZSkgJiYgKChiID0gYVtlXSkgPyB0aGlzW2VdID0gYihjKSA6ICJ0YXJnZXQiID09PSBlID8gdGhpcy50YXJnZXQgPSBkIDogdGhpc1tlXSA9IGNbZV0pOwogIH0KCiAgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAobnVsbCAhPSBjLmRlZmF1bHRQcmV2ZW50ZWQgPyBjLmRlZmF1bHRQcmV2ZW50ZWQgOiAhMSA9PT0gYy5yZXR1cm5WYWx1ZSkgPyBiZSA6IGNlOwogIHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSBjZTsKICByZXR1cm4gdGhpczsKfQoKbihHLnByb3RvdHlwZSwgewogIHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdCgpIHsKICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9ICEwOwogICAgdmFyIGEgPSB0aGlzLm5hdGl2ZUV2ZW50OwogICAgYSAmJiAoYS5wcmV2ZW50RGVmYXVsdCA/IGEucHJldmVudERlZmF1bHQoKSA6ICJ1bmtub3duIiAhPT0gdHlwZW9mIGEucmV0dXJuVmFsdWUgJiYgKGEucmV0dXJuVmFsdWUgPSAhMSksIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gYmUpOwogIH0sCiAgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oKSB7CiAgICB2YXIgYSA9IHRoaXMubmF0aXZlRXZlbnQ7CiAgICBhICYmIChhLnN0b3BQcm9wYWdhdGlvbiA/IGEuc3RvcFByb3BhZ2F0aW9uKCkgOiAidW5rbm93biIgIT09IHR5cGVvZiBhLmNhbmNlbEJ1YmJsZSAmJiAoYS5jYW5jZWxCdWJibGUgPSAhMCksIHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSBiZSk7CiAgfSwKICBwZXJzaXN0OiBmdW5jdGlvbiBwZXJzaXN0KCkgewogICAgdGhpcy5pc1BlcnNpc3RlbnQgPSBiZTsKICB9LAogIGlzUGVyc2lzdGVudDogY2UsCiAgZGVzdHJ1Y3RvcjogZnVuY3Rpb24gZGVzdHJ1Y3RvcigpIHsKICAgIHZhciBhID0gdGhpcy5jb25zdHJ1Y3Rvci5JbnRlcmZhY2UsCiAgICAgICAgYjsKCiAgICBmb3IgKGIgaW4gYSkgewogICAgICB0aGlzW2JdID0gbnVsbDsKICAgIH0KCiAgICB0aGlzLm5hdGl2ZUV2ZW50ID0gdGhpcy5fdGFyZ2V0SW5zdCA9IHRoaXMuZGlzcGF0Y2hDb25maWcgPSBudWxsOwogICAgdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gY2U7CiAgICB0aGlzLl9kaXNwYXRjaEluc3RhbmNlcyA9IHRoaXMuX2Rpc3BhdGNoTGlzdGVuZXJzID0gbnVsbDsKICB9Cn0pOwpHLkludGVyZmFjZSA9IHsKICB0eXBlOiBudWxsLAogIHRhcmdldDogbnVsbCwKICBjdXJyZW50VGFyZ2V0OiBmdW5jdGlvbiBjdXJyZW50VGFyZ2V0KCkgewogICAgcmV0dXJuIG51bGw7CiAgfSwKICBldmVudFBoYXNlOiBudWxsLAogIGJ1YmJsZXM6IG51bGwsCiAgY2FuY2VsYWJsZTogbnVsbCwKICB0aW1lU3RhbXA6IGZ1bmN0aW9uIHRpbWVTdGFtcChhKSB7CiAgICByZXR1cm4gYS50aW1lU3RhbXAgfHwgRGF0ZS5ub3coKTsKICB9LAogIGRlZmF1bHRQcmV2ZW50ZWQ6IG51bGwsCiAgaXNUcnVzdGVkOiBudWxsCn07CgpHLmV4dGVuZCA9IGZ1bmN0aW9uIChhKSB7CiAgZnVuY3Rpb24gYigpIHt9CgogIGZ1bmN0aW9uIGMoKSB7CiAgICByZXR1cm4gZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KCiAgdmFyIGQgPSB0aGlzOwogIGIucHJvdG90eXBlID0gZC5wcm90b3R5cGU7CiAgdmFyIGUgPSBuZXcgYigpOwogIG4oZSwgYy5wcm90b3R5cGUpOwogIGMucHJvdG90eXBlID0gZTsKICBjLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGM7CiAgYy5JbnRlcmZhY2UgPSBuKHt9LCBkLkludGVyZmFjZSwgYSk7CiAgYy5leHRlbmQgPSBkLmV4dGVuZDsKICBkZShjKTsKICByZXR1cm4gYzsKfTsKCmRlKEcpOwoKZnVuY3Rpb24gZWUoYSwgYiwgYywgZCkgewogIGlmICh0aGlzLmV2ZW50UG9vbC5sZW5ndGgpIHsKICAgIHZhciBlID0gdGhpcy5ldmVudFBvb2wucG9wKCk7CiAgICB0aGlzLmNhbGwoZSwgYSwgYiwgYywgZCk7CiAgICByZXR1cm4gZTsKICB9CgogIHJldHVybiBuZXcgdGhpcyhhLCBiLCBjLCBkKTsKfQoKZnVuY3Rpb24gZmUoYSkgewogIGlmICghKGEgaW5zdGFuY2VvZiB0aGlzKSkgdGhyb3cgRXJyb3IodSgyNzkpKTsKICBhLmRlc3RydWN0b3IoKTsKICAxMCA+IHRoaXMuZXZlbnRQb29sLmxlbmd0aCAmJiB0aGlzLmV2ZW50UG9vbC5wdXNoKGEpOwp9CgpmdW5jdGlvbiBkZShhKSB7CiAgYS5ldmVudFBvb2wgPSBbXTsKICBhLmdldFBvb2xlZCA9IGVlOwogIGEucmVsZWFzZSA9IGZlOwp9Cgp2YXIgZ2UgPSBHLmV4dGVuZCh7CiAgZGF0YTogbnVsbAp9KSwKICAgIGhlID0gRy5leHRlbmQoewogIGRhdGE6IG51bGwKfSksCiAgICBpZSA9IFs5LCAxMywgMjcsIDMyXSwKICAgIGplID0geWEgJiYgIkNvbXBvc2l0aW9uRXZlbnQiIGluIHdpbmRvdywKICAgIGtlID0gbnVsbDsKeWEgJiYgImRvY3VtZW50TW9kZSIgaW4gZG9jdW1lbnQgJiYgKGtlID0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlKTsKdmFyIGxlID0geWEgJiYgIlRleHRFdmVudCIgaW4gd2luZG93ICYmICFrZSwKICAgIG1lID0geWEgJiYgKCFqZSB8fCBrZSAmJiA4IDwga2UgJiYgMTEgPj0ga2UpLAogICAgbmUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDMyKSwKICAgIG9lID0gewogIGJlZm9yZUlucHV0OiB7CiAgICBwaGFzZWRSZWdpc3RyYXRpb25OYW1lczogewogICAgICBidWJibGVkOiAib25CZWZvcmVJbnB1dCIsCiAgICAgIGNhcHR1cmVkOiAib25CZWZvcmVJbnB1dENhcHR1cmUiCiAgICB9LAogICAgZGVwZW5kZW5jaWVzOiBbImNvbXBvc2l0aW9uZW5kIiwgImtleXByZXNzIiwgInRleHRJbnB1dCIsICJwYXN0ZSJdCiAgfSwKICBjb21wb3NpdGlvbkVuZDogewogICAgcGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6IHsKICAgICAgYnViYmxlZDogIm9uQ29tcG9zaXRpb25FbmQiLAogICAgICBjYXB0dXJlZDogIm9uQ29tcG9zaXRpb25FbmRDYXB0dXJlIgogICAgfSwKICAgIGRlcGVuZGVuY2llczogImJsdXIgY29tcG9zaXRpb25lbmQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikKICB9LAogIGNvbXBvc2l0aW9uU3RhcnQ6IHsKICAgIHBoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzOiB7CiAgICAgIGJ1YmJsZWQ6ICJvbkNvbXBvc2l0aW9uU3RhcnQiLAogICAgICBjYXB0dXJlZDogIm9uQ29tcG9zaXRpb25TdGFydENhcHR1cmUiCiAgICB9LAogICAgZGVwZW5kZW5jaWVzOiAiYmx1ciBjb21wb3NpdGlvbnN0YXJ0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpCiAgfSwKICBjb21wb3NpdGlvblVwZGF0ZTogewogICAgcGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6IHsKICAgICAgYnViYmxlZDogIm9uQ29tcG9zaXRpb25VcGRhdGUiLAogICAgICBjYXB0dXJlZDogIm9uQ29tcG9zaXRpb25VcGRhdGVDYXB0dXJlIgogICAgfSwKICAgIGRlcGVuZGVuY2llczogImJsdXIgY29tcG9zaXRpb251cGRhdGUga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikKICB9Cn0sCiAgICBwZSA9ICExOwoKZnVuY3Rpb24gcWUoYSwgYikgewogIHN3aXRjaCAoYSkgewogICAgY2FzZSAia2V5dXAiOgogICAgICByZXR1cm4gLTEgIT09IGllLmluZGV4T2YoYi5rZXlDb2RlKTsKCiAgICBjYXNlICJrZXlkb3duIjoKICAgICAgcmV0dXJuIDIyOSAhPT0gYi5rZXlDb2RlOwoKICAgIGNhc2UgImtleXByZXNzIjoKICAgIGNhc2UgIm1vdXNlZG93biI6CiAgICBjYXNlICJibHVyIjoKICAgICAgcmV0dXJuICEwOwoKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiAhMTsKICB9Cn0KCmZ1bmN0aW9uIHJlKGEpIHsKICBhID0gYS5kZXRhaWw7CiAgcmV0dXJuICJvYmplY3QiID09PSBfdHlwZW9mKGEpICYmICJkYXRhIiBpbiBhID8gYS5kYXRhIDogbnVsbDsKfQoKdmFyIHNlID0gITE7CgpmdW5jdGlvbiB0ZShhLCBiKSB7CiAgc3dpdGNoIChhKSB7CiAgICBjYXNlICJjb21wb3NpdGlvbmVuZCI6CiAgICAgIHJldHVybiByZShiKTsKCiAgICBjYXNlICJrZXlwcmVzcyI6CiAgICAgIGlmICgzMiAhPT0gYi53aGljaCkgcmV0dXJuIG51bGw7CiAgICAgIHBlID0gITA7CiAgICAgIHJldHVybiBuZTsKCiAgICBjYXNlICJ0ZXh0SW5wdXQiOgogICAgICByZXR1cm4gYSA9IGIuZGF0YSwgYSA9PT0gbmUgJiYgcGUgPyBudWxsIDogYTsKCiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gbnVsbDsKICB9Cn0KCmZ1bmN0aW9uIHVlKGEsIGIpIHsKICBpZiAoc2UpIHJldHVybiAiY29tcG9zaXRpb25lbmQiID09PSBhIHx8ICFqZSAmJiBxZShhLCBiKSA/IChhID0gYWUoKSwgJGQgPSBaZCA9IFlkID0gbnVsbCwgc2UgPSAhMSwgYSkgOiBudWxsOwoKICBzd2l0Y2ggKGEpIHsKICAgIGNhc2UgInBhc3RlIjoKICAgICAgcmV0dXJuIG51bGw7CgogICAgY2FzZSAia2V5cHJlc3MiOgogICAgICBpZiAoIShiLmN0cmxLZXkgfHwgYi5hbHRLZXkgfHwgYi5tZXRhS2V5KSB8fCBiLmN0cmxLZXkgJiYgYi5hbHRLZXkpIHsKICAgICAgICBpZiAoYi5jaGFyICYmIDEgPCBiLmNoYXIubGVuZ3RoKSByZXR1cm4gYi5jaGFyOwogICAgICAgIGlmIChiLndoaWNoKSByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShiLndoaWNoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CgogICAgY2FzZSAiY29tcG9zaXRpb25lbmQiOgogICAgICByZXR1cm4gbWUgJiYgImtvIiAhPT0gYi5sb2NhbGUgPyBudWxsIDogYi5kYXRhOwoKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBudWxsOwogIH0KfQoKdmFyIHZlID0gewogIGV2ZW50VHlwZXM6IG9lLAogIGV4dHJhY3RFdmVudHM6IGZ1bmN0aW9uIGV4dHJhY3RFdmVudHMoYSwgYiwgYywgZCkgewogICAgdmFyIGU7CiAgICBpZiAoamUpIGI6IHsKICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgY2FzZSAiY29tcG9zaXRpb25zdGFydCI6CiAgICAgICAgICB2YXIgZiA9IG9lLmNvbXBvc2l0aW9uU3RhcnQ7CiAgICAgICAgICBicmVhayBiOwoKICAgICAgICBjYXNlICJjb21wb3NpdGlvbmVuZCI6CiAgICAgICAgICBmID0gb2UuY29tcG9zaXRpb25FbmQ7CiAgICAgICAgICBicmVhayBiOwoKICAgICAgICBjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6CiAgICAgICAgICBmID0gb2UuY29tcG9zaXRpb25VcGRhdGU7CiAgICAgICAgICBicmVhayBiOwogICAgICB9CgogICAgICBmID0gdm9pZCAwOwogICAgfSBlbHNlIHNlID8gcWUoYSwgYykgJiYgKGYgPSBvZS5jb21wb3NpdGlvbkVuZCkgOiAia2V5ZG93biIgPT09IGEgJiYgMjI5ID09PSBjLmtleUNvZGUgJiYgKGYgPSBvZS5jb21wb3NpdGlvblN0YXJ0KTsKICAgIGYgPyAobWUgJiYgImtvIiAhPT0gYy5sb2NhbGUgJiYgKHNlIHx8IGYgIT09IG9lLmNvbXBvc2l0aW9uU3RhcnQgPyBmID09PSBvZS5jb21wb3NpdGlvbkVuZCAmJiBzZSAmJiAoZSA9IGFlKCkpIDogKFlkID0gZCwgWmQgPSAidmFsdWUiIGluIFlkID8gWWQudmFsdWUgOiBZZC50ZXh0Q29udGVudCwgc2UgPSAhMCkpLCBmID0gZ2UuZ2V0UG9vbGVkKGYsIGIsIGMsIGQpLCBlID8gZi5kYXRhID0gZSA6IChlID0gcmUoYyksIG51bGwgIT09IGUgJiYgKGYuZGF0YSA9IGUpKSwgWGQoZiksIGUgPSBmKSA6IGUgPSBudWxsOwogICAgKGEgPSBsZSA/IHRlKGEsIGMpIDogdWUoYSwgYykpID8gKGIgPSBoZS5nZXRQb29sZWQob2UuYmVmb3JlSW5wdXQsIGIsIGMsIGQpLCBiLmRhdGEgPSBhLCBYZChiKSkgOiBiID0gbnVsbDsKICAgIHJldHVybiBudWxsID09PSBlID8gYiA6IG51bGwgPT09IGIgPyBlIDogW2UsIGJdOwogIH0KfSwKICAgIHdlID0gewogIGNvbG9yOiAhMCwKICBkYXRlOiAhMCwKICBkYXRldGltZTogITAsCiAgImRhdGV0aW1lLWxvY2FsIjogITAsCiAgZW1haWw6ICEwLAogIG1vbnRoOiAhMCwKICBudW1iZXI6ICEwLAogIHBhc3N3b3JkOiAhMCwKICByYW5nZTogITAsCiAgc2VhcmNoOiAhMCwKICB0ZWw6ICEwLAogIHRleHQ6ICEwLAogIHRpbWU6ICEwLAogIHVybDogITAsCiAgd2VlazogITAKfTsKCmZ1bmN0aW9uIHhlKGEpIHsKICB2YXIgYiA9IGEgJiYgYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgcmV0dXJuICJpbnB1dCIgPT09IGIgPyAhIXdlW2EudHlwZV0gOiAidGV4dGFyZWEiID09PSBiID8gITAgOiAhMTsKfQoKdmFyIHllID0gewogIGNoYW5nZTogewogICAgcGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6IHsKICAgICAgYnViYmxlZDogIm9uQ2hhbmdlIiwKICAgICAgY2FwdHVyZWQ6ICJvbkNoYW5nZUNhcHR1cmUiCiAgICB9LAogICAgZGVwZW5kZW5jaWVzOiAiYmx1ciBjaGFuZ2UgY2xpY2sgZm9jdXMgaW5wdXQga2V5ZG93biBrZXl1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIikKICB9Cn07CgpmdW5jdGlvbiB6ZShhLCBiLCBjKSB7CiAgYSA9IEcuZ2V0UG9vbGVkKHllLmNoYW5nZSwgYSwgYiwgYyk7CiAgYS50eXBlID0gImNoYW5nZSI7CiAgRGEoYyk7CiAgWGQoYSk7CiAgcmV0dXJuIGE7Cn0KCnZhciBBZSA9IG51bGwsCiAgICBCZSA9IG51bGw7CgpmdW5jdGlvbiBDZShhKSB7CiAgbWMoYSk7Cn0KCmZ1bmN0aW9uIERlKGEpIHsKICB2YXIgYiA9IFBkKGEpOwogIGlmICh5YihiKSkgcmV0dXJuIGE7Cn0KCmZ1bmN0aW9uIEVlKGEsIGIpIHsKICBpZiAoImNoYW5nZSIgPT09IGEpIHJldHVybiBiOwp9Cgp2YXIgRmUgPSAhMTsKeWEgJiYgKEZlID0gb2MoImlucHV0IikgJiYgKCFkb2N1bWVudC5kb2N1bWVudE1vZGUgfHwgOSA8IGRvY3VtZW50LmRvY3VtZW50TW9kZSkpOwoKZnVuY3Rpb24gR2UoKSB7CiAgQWUgJiYgKEFlLmRldGFjaEV2ZW50KCJvbnByb3BlcnR5Y2hhbmdlIiwgSGUpLCBCZSA9IEFlID0gbnVsbCk7Cn0KCmZ1bmN0aW9uIEhlKGEpIHsKICBpZiAoInZhbHVlIiA9PT0gYS5wcm9wZXJ0eU5hbWUgJiYgRGUoQmUpKSBpZiAoYSA9IHplKEJlLCBhLCBuYyhhKSksIEphKSBtYyhhKTtlbHNlIHsKICAgIEphID0gITA7CgogICAgdHJ5IHsKICAgICAgRmEoQ2UsIGEpOwogICAgfSBmaW5hbGx5IHsKICAgICAgSmEgPSAhMSwgTGEoKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIEllKGEsIGIsIGMpIHsKICAiZm9jdXMiID09PSBhID8gKEdlKCksIEFlID0gYiwgQmUgPSBjLCBBZS5hdHRhY2hFdmVudCgib25wcm9wZXJ0eWNoYW5nZSIsIEhlKSkgOiAiYmx1ciIgPT09IGEgJiYgR2UoKTsKfQoKZnVuY3Rpb24gSmUoYSkgewogIGlmICgic2VsZWN0aW9uY2hhbmdlIiA9PT0gYSB8fCAia2V5dXAiID09PSBhIHx8ICJrZXlkb3duIiA9PT0gYSkgcmV0dXJuIERlKEJlKTsKfQoKZnVuY3Rpb24gS2UoYSwgYikgewogIGlmICgiY2xpY2siID09PSBhKSByZXR1cm4gRGUoYik7Cn0KCmZ1bmN0aW9uIExlKGEsIGIpIHsKICBpZiAoImlucHV0IiA9PT0gYSB8fCAiY2hhbmdlIiA9PT0gYSkgcmV0dXJuIERlKGIpOwp9Cgp2YXIgTWUgPSB7CiAgZXZlbnRUeXBlczogeWUsCiAgX2lzSW5wdXRFdmVudFN1cHBvcnRlZDogRmUsCiAgZXh0cmFjdEV2ZW50czogZnVuY3Rpb24gZXh0cmFjdEV2ZW50cyhhLCBiLCBjLCBkKSB7CiAgICB2YXIgZSA9IGIgPyBQZChiKSA6IHdpbmRvdywKICAgICAgICBmID0gZS5ub2RlTmFtZSAmJiBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICBpZiAoInNlbGVjdCIgPT09IGYgfHwgImlucHV0IiA9PT0gZiAmJiAiZmlsZSIgPT09IGUudHlwZSkgdmFyIGcgPSBFZTtlbHNlIGlmICh4ZShlKSkgewogICAgICBpZiAoRmUpIGcgPSBMZTtlbHNlIHsKICAgICAgICBnID0gSmU7CiAgICAgICAgdmFyIGggPSBJZTsKICAgICAgfQogICAgfSBlbHNlIChmID0gZS5ub2RlTmFtZSkgJiYgImlucHV0IiA9PT0gZi50b0xvd2VyQ2FzZSgpICYmICgiY2hlY2tib3giID09PSBlLnR5cGUgfHwgInJhZGlvIiA9PT0gZS50eXBlKSAmJiAoZyA9IEtlKTsKICAgIGlmIChnICYmIChnID0gZyhhLCBiKSkpIHJldHVybiB6ZShnLCBjLCBkKTsKICAgIGggJiYgaChhLCBlLCBiKTsKICAgICJibHVyIiA9PT0gYSAmJiAoYSA9IGUuX3dyYXBwZXJTdGF0ZSkgJiYgYS5jb250cm9sbGVkICYmICJudW1iZXIiID09PSBlLnR5cGUgJiYgRGIoZSwgIm51bWJlciIsIGUudmFsdWUpOwogIH0KfSwKICAgIE5lID0gRy5leHRlbmQoewogIHZpZXc6IG51bGwsCiAgZGV0YWlsOiBudWxsCn0pLAogICAgT2UgPSB7CiAgQWx0OiAiYWx0S2V5IiwKICBDb250cm9sOiAiY3RybEtleSIsCiAgTWV0YTogIm1ldGFLZXkiLAogIFNoaWZ0OiAic2hpZnRLZXkiCn07CgpmdW5jdGlvbiBQZShhKSB7CiAgdmFyIGIgPSB0aGlzLm5hdGl2ZUV2ZW50OwogIHJldHVybiBiLmdldE1vZGlmaWVyU3RhdGUgPyBiLmdldE1vZGlmaWVyU3RhdGUoYSkgOiAoYSA9IE9lW2FdKSA/ICEhYlthXSA6ICExOwp9CgpmdW5jdGlvbiBRZSgpIHsKICByZXR1cm4gUGU7Cn0KCnZhciBSZSA9IDAsCiAgICBTZSA9IDAsCiAgICBUZSA9ICExLAogICAgVWUgPSAhMSwKICAgIFZlID0gTmUuZXh0ZW5kKHsKICBzY3JlZW5YOiBudWxsLAogIHNjcmVlblk6IG51bGwsCiAgY2xpZW50WDogbnVsbCwKICBjbGllbnRZOiBudWxsLAogIHBhZ2VYOiBudWxsLAogIHBhZ2VZOiBudWxsLAogIGN0cmxLZXk6IG51bGwsCiAgc2hpZnRLZXk6IG51bGwsCiAgYWx0S2V5OiBudWxsLAogIG1ldGFLZXk6IG51bGwsCiAgZ2V0TW9kaWZpZXJTdGF0ZTogUWUsCiAgYnV0dG9uOiBudWxsLAogIGJ1dHRvbnM6IG51bGwsCiAgcmVsYXRlZFRhcmdldDogZnVuY3Rpb24gcmVsYXRlZFRhcmdldChhKSB7CiAgICByZXR1cm4gYS5yZWxhdGVkVGFyZ2V0IHx8IChhLmZyb21FbGVtZW50ID09PSBhLnNyY0VsZW1lbnQgPyBhLnRvRWxlbWVudCA6IGEuZnJvbUVsZW1lbnQpOwogIH0sCiAgbW92ZW1lbnRYOiBmdW5jdGlvbiBtb3ZlbWVudFgoYSkgewogICAgaWYgKCJtb3ZlbWVudFgiIGluIGEpIHJldHVybiBhLm1vdmVtZW50WDsKICAgIHZhciBiID0gUmU7CiAgICBSZSA9IGEuc2NyZWVuWDsKICAgIHJldHVybiBUZSA/ICJtb3VzZW1vdmUiID09PSBhLnR5cGUgPyBhLnNjcmVlblggLSBiIDogMCA6IChUZSA9ICEwLCAwKTsKICB9LAogIG1vdmVtZW50WTogZnVuY3Rpb24gbW92ZW1lbnRZKGEpIHsKICAgIGlmICgibW92ZW1lbnRZIiBpbiBhKSByZXR1cm4gYS5tb3ZlbWVudFk7CiAgICB2YXIgYiA9IFNlOwogICAgU2UgPSBhLnNjcmVlblk7CiAgICByZXR1cm4gVWUgPyAibW91c2Vtb3ZlIiA9PT0gYS50eXBlID8gYS5zY3JlZW5ZIC0gYiA6IDAgOiAoVWUgPSAhMCwgMCk7CiAgfQp9KSwKICAgIFdlID0gVmUuZXh0ZW5kKHsKICBwb2ludGVySWQ6IG51bGwsCiAgd2lkdGg6IG51bGwsCiAgaGVpZ2h0OiBudWxsLAogIHByZXNzdXJlOiBudWxsLAogIHRhbmdlbnRpYWxQcmVzc3VyZTogbnVsbCwKICB0aWx0WDogbnVsbCwKICB0aWx0WTogbnVsbCwKICB0d2lzdDogbnVsbCwKICBwb2ludGVyVHlwZTogbnVsbCwKICBpc1ByaW1hcnk6IG51bGwKfSksCiAgICBYZSA9IHsKICBtb3VzZUVudGVyOiB7CiAgICByZWdpc3RyYXRpb25OYW1lOiAib25Nb3VzZUVudGVyIiwKICAgIGRlcGVuZGVuY2llczogWyJtb3VzZW91dCIsICJtb3VzZW92ZXIiXQogIH0sCiAgbW91c2VMZWF2ZTogewogICAgcmVnaXN0cmF0aW9uTmFtZTogIm9uTW91c2VMZWF2ZSIsCiAgICBkZXBlbmRlbmNpZXM6IFsibW91c2VvdXQiLCAibW91c2VvdmVyIl0KICB9LAogIHBvaW50ZXJFbnRlcjogewogICAgcmVnaXN0cmF0aW9uTmFtZTogIm9uUG9pbnRlckVudGVyIiwKICAgIGRlcGVuZGVuY2llczogWyJwb2ludGVyb3V0IiwgInBvaW50ZXJvdmVyIl0KICB9LAogIHBvaW50ZXJMZWF2ZTogewogICAgcmVnaXN0cmF0aW9uTmFtZTogIm9uUG9pbnRlckxlYXZlIiwKICAgIGRlcGVuZGVuY2llczogWyJwb2ludGVyb3V0IiwgInBvaW50ZXJvdmVyIl0KICB9Cn0sCiAgICBZZSA9IHsKICBldmVudFR5cGVzOiBYZSwKICBleHRyYWN0RXZlbnRzOiBmdW5jdGlvbiBleHRyYWN0RXZlbnRzKGEsIGIsIGMsIGQsIGUpIHsKICAgIHZhciBmID0gIm1vdXNlb3ZlciIgPT09IGEgfHwgInBvaW50ZXJvdmVyIiA9PT0gYSwKICAgICAgICBnID0gIm1vdXNlb3V0IiA9PT0gYSB8fCAicG9pbnRlcm91dCIgPT09IGE7CiAgICBpZiAoZiAmJiAwID09PSAoZSAmIDMyKSAmJiAoYy5yZWxhdGVkVGFyZ2V0IHx8IGMuZnJvbUVsZW1lbnQpIHx8ICFnICYmICFmKSByZXR1cm4gbnVsbDsKICAgIGYgPSBkLndpbmRvdyA9PT0gZCA/IGQgOiAoZiA9IGQub3duZXJEb2N1bWVudCkgPyBmLmRlZmF1bHRWaWV3IHx8IGYucGFyZW50V2luZG93IDogd2luZG93OwoKICAgIGlmIChnKSB7CiAgICAgIGlmIChnID0gYiwgYiA9IChiID0gYy5yZWxhdGVkVGFyZ2V0IHx8IGMudG9FbGVtZW50KSA/IHRjKGIpIDogbnVsbCwgbnVsbCAhPT0gYikgewogICAgICAgIHZhciBoID0gZGMoYik7CiAgICAgICAgaWYgKGIgIT09IGggfHwgNSAhPT0gYi50YWcgJiYgNiAhPT0gYi50YWcpIGIgPSBudWxsOwogICAgICB9CiAgICB9IGVsc2UgZyA9IG51bGw7CgogICAgaWYgKGcgPT09IGIpIHJldHVybiBudWxsOwoKICAgIGlmICgibW91c2VvdXQiID09PSBhIHx8ICJtb3VzZW92ZXIiID09PSBhKSB7CiAgICAgIHZhciBrID0gVmU7CiAgICAgIHZhciBsID0gWGUubW91c2VMZWF2ZTsKICAgICAgdmFyIG0gPSBYZS5tb3VzZUVudGVyOwogICAgICB2YXIgcCA9ICJtb3VzZSI7CiAgICB9IGVsc2UgaWYgKCJwb2ludGVyb3V0IiA9PT0gYSB8fCAicG9pbnRlcm92ZXIiID09PSBhKSBrID0gV2UsIGwgPSBYZS5wb2ludGVyTGVhdmUsIG0gPSBYZS5wb2ludGVyRW50ZXIsIHAgPSAicG9pbnRlciI7CgogICAgYSA9IG51bGwgPT0gZyA/IGYgOiBQZChnKTsKICAgIGYgPSBudWxsID09IGIgPyBmIDogUGQoYik7CiAgICBsID0gay5nZXRQb29sZWQobCwgZywgYywgZCk7CiAgICBsLnR5cGUgPSBwICsgImxlYXZlIjsKICAgIGwudGFyZ2V0ID0gYTsKICAgIGwucmVsYXRlZFRhcmdldCA9IGY7CiAgICBjID0gay5nZXRQb29sZWQobSwgYiwgYywgZCk7CiAgICBjLnR5cGUgPSBwICsgImVudGVyIjsKICAgIGMudGFyZ2V0ID0gZjsKICAgIGMucmVsYXRlZFRhcmdldCA9IGE7CiAgICBkID0gZzsKICAgIHAgPSBiOwogICAgaWYgKGQgJiYgcCkgYTogewogICAgICBrID0gZDsKICAgICAgbSA9IHA7CiAgICAgIGcgPSAwOwoKICAgICAgZm9yIChhID0gazsgYTsgYSA9IFJkKGEpKSB7CiAgICAgICAgZysrOwogICAgICB9CgogICAgICBhID0gMDsKCiAgICAgIGZvciAoYiA9IG07IGI7IGIgPSBSZChiKSkgewogICAgICAgIGErKzsKICAgICAgfQoKICAgICAgZm9yICg7IDAgPCBnIC0gYTspIHsKICAgICAgICBrID0gUmQoayksIGctLTsKICAgICAgfQoKICAgICAgZm9yICg7IDAgPCBhIC0gZzspIHsKICAgICAgICBtID0gUmQobSksIGEtLTsKICAgICAgfQoKICAgICAgZm9yICg7IGctLTspIHsKICAgICAgICBpZiAoayA9PT0gbSB8fCBrID09PSBtLmFsdGVybmF0ZSkgYnJlYWsgYTsKICAgICAgICBrID0gUmQoayk7CiAgICAgICAgbSA9IFJkKG0pOwogICAgICB9CgogICAgICBrID0gbnVsbDsKICAgIH0gZWxzZSBrID0gbnVsbDsKICAgIG0gPSBrOwoKICAgIGZvciAoayA9IFtdOyBkICYmIGQgIT09IG07KSB7CiAgICAgIGcgPSBkLmFsdGVybmF0ZTsKICAgICAgaWYgKG51bGwgIT09IGcgJiYgZyA9PT0gbSkgYnJlYWs7CiAgICAgIGsucHVzaChkKTsKICAgICAgZCA9IFJkKGQpOwogICAgfQoKICAgIGZvciAoZCA9IFtdOyBwICYmIHAgIT09IG07KSB7CiAgICAgIGcgPSBwLmFsdGVybmF0ZTsKICAgICAgaWYgKG51bGwgIT09IGcgJiYgZyA9PT0gbSkgYnJlYWs7CiAgICAgIGQucHVzaChwKTsKICAgICAgcCA9IFJkKHApOwogICAgfQoKICAgIGZvciAocCA9IDA7IHAgPCBrLmxlbmd0aDsgcCsrKSB7CiAgICAgIFZkKGtbcF0sICJidWJibGVkIiwgbCk7CiAgICB9CgogICAgZm9yIChwID0gZC5sZW5ndGg7IDAgPCBwLS07KSB7CiAgICAgIFZkKGRbcF0sICJjYXB0dXJlZCIsIGMpOwogICAgfQoKICAgIHJldHVybiAwID09PSAoZSAmIDY0KSA/IFtsXSA6IFtsLCBjXTsKICB9Cn07CgpmdW5jdGlvbiBaZShhLCBiKSB7CiAgcmV0dXJuIGEgPT09IGIgJiYgKDAgIT09IGEgfHwgMSAvIGEgPT09IDEgLyBiKSB8fCBhICE9PSBhICYmIGIgIT09IGI7Cn0KCnZhciAkZSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBPYmplY3QuaXMgPyBPYmplY3QuaXMgOiBaZSwKICAgIGFmID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCmZ1bmN0aW9uIGJmKGEsIGIpIHsKICBpZiAoJGUoYSwgYikpIHJldHVybiAhMDsKICBpZiAoIm9iamVjdCIgIT09IF90eXBlb2YoYSkgfHwgbnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gX3R5cGVvZihiKSB8fCBudWxsID09PSBiKSByZXR1cm4gITE7CiAgdmFyIGMgPSBPYmplY3Qua2V5cyhhKSwKICAgICAgZCA9IE9iamVjdC5rZXlzKGIpOwogIGlmIChjLmxlbmd0aCAhPT0gZC5sZW5ndGgpIHJldHVybiAhMTsKCiAgZm9yIChkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHsKICAgIGlmICghYWYuY2FsbChiLCBjW2RdKSB8fCAhJGUoYVtjW2RdXSwgYltjW2RdXSkpIHJldHVybiAhMTsKICB9CgogIHJldHVybiAhMDsKfQoKdmFyIGNmID0geWEgJiYgImRvY3VtZW50TW9kZSIgaW4gZG9jdW1lbnQgJiYgMTEgPj0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlLAogICAgZGYgPSB7CiAgc2VsZWN0OiB7CiAgICBwaGFzZWRSZWdpc3RyYXRpb25OYW1lczogewogICAgICBidWJibGVkOiAib25TZWxlY3QiLAogICAgICBjYXB0dXJlZDogIm9uU2VsZWN0Q2FwdHVyZSIKICAgIH0sCiAgICBkZXBlbmRlbmNpZXM6ICJibHVyIGNvbnRleHRtZW51IGRyYWdlbmQgZm9jdXMga2V5ZG93biBrZXl1cCBtb3VzZWRvd24gbW91c2V1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIikKICB9Cn0sCiAgICBlZiA9IG51bGwsCiAgICBmZiA9IG51bGwsCiAgICBnZiA9IG51bGwsCiAgICBoZiA9ICExOwoKZnVuY3Rpb24gamYoYSwgYikgewogIHZhciBjID0gYi53aW5kb3cgPT09IGIgPyBiLmRvY3VtZW50IDogOSA9PT0gYi5ub2RlVHlwZSA/IGIgOiBiLm93bmVyRG9jdW1lbnQ7CiAgaWYgKGhmIHx8IG51bGwgPT0gZWYgfHwgZWYgIT09IHRkKGMpKSByZXR1cm4gbnVsbDsKICBjID0gZWY7CiAgInNlbGVjdGlvblN0YXJ0IiBpbiBjICYmIHlkKGMpID8gYyA9IHsKICAgIHN0YXJ0OiBjLnNlbGVjdGlvblN0YXJ0LAogICAgZW5kOiBjLnNlbGVjdGlvbkVuZAogIH0gOiAoYyA9IChjLm93bmVyRG9jdW1lbnQgJiYgYy5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3IHx8IHdpbmRvdykuZ2V0U2VsZWN0aW9uKCksIGMgPSB7CiAgICBhbmNob3JOb2RlOiBjLmFuY2hvck5vZGUsCiAgICBhbmNob3JPZmZzZXQ6IGMuYW5jaG9yT2Zmc2V0LAogICAgZm9jdXNOb2RlOiBjLmZvY3VzTm9kZSwKICAgIGZvY3VzT2Zmc2V0OiBjLmZvY3VzT2Zmc2V0CiAgfSk7CiAgcmV0dXJuIGdmICYmIGJmKGdmLCBjKSA/IG51bGwgOiAoZ2YgPSBjLCBhID0gRy5nZXRQb29sZWQoZGYuc2VsZWN0LCBmZiwgYSwgYiksIGEudHlwZSA9ICJzZWxlY3QiLCBhLnRhcmdldCA9IGVmLCBYZChhKSwgYSk7Cn0KCnZhciBrZiA9IHsKICBldmVudFR5cGVzOiBkZiwKICBleHRyYWN0RXZlbnRzOiBmdW5jdGlvbiBleHRyYWN0RXZlbnRzKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgIGUgPSBmIHx8IChkLndpbmRvdyA9PT0gZCA/IGQuZG9jdW1lbnQgOiA5ID09PSBkLm5vZGVUeXBlID8gZCA6IGQub3duZXJEb2N1bWVudCk7CgogICAgaWYgKCEoZiA9ICFlKSkgewogICAgICBhOiB7CiAgICAgICAgZSA9IGNjKGUpOwogICAgICAgIGYgPSB3YS5vblNlbGVjdDsKCiAgICAgICAgZm9yICh2YXIgZyA9IDA7IGcgPCBmLmxlbmd0aDsgZysrKSB7CiAgICAgICAgICBpZiAoIWUuaGFzKGZbZ10pKSB7CiAgICAgICAgICAgIGUgPSAhMTsKICAgICAgICAgICAgYnJlYWsgYTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGUgPSAhMDsKICAgICAgfQoKICAgICAgZiA9ICFlOwogICAgfQoKICAgIGlmIChmKSByZXR1cm4gbnVsbDsKICAgIGUgPSBiID8gUGQoYikgOiB3aW5kb3c7CgogICAgc3dpdGNoIChhKSB7CiAgICAgIGNhc2UgImZvY3VzIjoKICAgICAgICBpZiAoeGUoZSkgfHwgInRydWUiID09PSBlLmNvbnRlbnRFZGl0YWJsZSkgZWYgPSBlLCBmZiA9IGIsIGdmID0gbnVsbDsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgImJsdXIiOgogICAgICAgIGdmID0gZmYgPSBlZiA9IG51bGw7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICJtb3VzZWRvd24iOgogICAgICAgIGhmID0gITA7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICJjb250ZXh0bWVudSI6CiAgICAgIGNhc2UgIm1vdXNldXAiOgogICAgICBjYXNlICJkcmFnZW5kIjoKICAgICAgICByZXR1cm4gaGYgPSAhMSwgamYoYywgZCk7CgogICAgICBjYXNlICJzZWxlY3Rpb25jaGFuZ2UiOgogICAgICAgIGlmIChjZikgYnJlYWs7CgogICAgICBjYXNlICJrZXlkb3duIjoKICAgICAgY2FzZSAia2V5dXAiOgogICAgICAgIHJldHVybiBqZihjLCBkKTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9Cn0sCiAgICBsZiA9IEcuZXh0ZW5kKHsKICBhbmltYXRpb25OYW1lOiBudWxsLAogIGVsYXBzZWRUaW1lOiBudWxsLAogIHBzZXVkb0VsZW1lbnQ6IG51bGwKfSksCiAgICBtZiA9IEcuZXh0ZW5kKHsKICBjbGlwYm9hcmREYXRhOiBmdW5jdGlvbiBjbGlwYm9hcmREYXRhKGEpIHsKICAgIHJldHVybiAiY2xpcGJvYXJkRGF0YSIgaW4gYSA/IGEuY2xpcGJvYXJkRGF0YSA6IHdpbmRvdy5jbGlwYm9hcmREYXRhOwogIH0KfSksCiAgICBuZiA9IE5lLmV4dGVuZCh7CiAgcmVsYXRlZFRhcmdldDogbnVsbAp9KTsKCmZ1bmN0aW9uIG9mKGEpIHsKICB2YXIgYiA9IGEua2V5Q29kZTsKICAiY2hhckNvZGUiIGluIGEgPyAoYSA9IGEuY2hhckNvZGUsIDAgPT09IGEgJiYgMTMgPT09IGIgJiYgKGEgPSAxMykpIDogYSA9IGI7CiAgMTAgPT09IGEgJiYgKGEgPSAxMyk7CiAgcmV0dXJuIDMyIDw9IGEgfHwgMTMgPT09IGEgPyBhIDogMDsKfQoKdmFyIHBmID0gewogIEVzYzogIkVzY2FwZSIsCiAgU3BhY2ViYXI6ICIgIiwKICBMZWZ0OiAiQXJyb3dMZWZ0IiwKICBVcDogIkFycm93VXAiLAogIFJpZ2h0OiAiQXJyb3dSaWdodCIsCiAgRG93bjogIkFycm93RG93biIsCiAgRGVsOiAiRGVsZXRlIiwKICBXaW46ICJPUyIsCiAgTWVudTogIkNvbnRleHRNZW51IiwKICBBcHBzOiAiQ29udGV4dE1lbnUiLAogIFNjcm9sbDogIlNjcm9sbExvY2siLAogIE1velByaW50YWJsZUtleTogIlVuaWRlbnRpZmllZCIKfSwKICAgIHFmID0gewogIDg6ICJCYWNrc3BhY2UiLAogIDk6ICJUYWIiLAogIDEyOiAiQ2xlYXIiLAogIDEzOiAiRW50ZXIiLAogIDE2OiAiU2hpZnQiLAogIDE3OiAiQ29udHJvbCIsCiAgMTg6ICJBbHQiLAogIDE5OiAiUGF1c2UiLAogIDIwOiAiQ2Fwc0xvY2siLAogIDI3OiAiRXNjYXBlIiwKICAzMjogIiAiLAogIDMzOiAiUGFnZVVwIiwKICAzNDogIlBhZ2VEb3duIiwKICAzNTogIkVuZCIsCiAgMzY6ICJIb21lIiwKICAzNzogIkFycm93TGVmdCIsCiAgMzg6ICJBcnJvd1VwIiwKICAzOTogIkFycm93UmlnaHQiLAogIDQwOiAiQXJyb3dEb3duIiwKICA0NTogIkluc2VydCIsCiAgNDY6ICJEZWxldGUiLAogIDExMjogIkYxIiwKICAxMTM6ICJGMiIsCiAgMTE0OiAiRjMiLAogIDExNTogIkY0IiwKICAxMTY6ICJGNSIsCiAgMTE3OiAiRjYiLAogIDExODogIkY3IiwKICAxMTk6ICJGOCIsCiAgMTIwOiAiRjkiLAogIDEyMTogIkYxMCIsCiAgMTIyOiAiRjExIiwKICAxMjM6ICJGMTIiLAogIDE0NDogIk51bUxvY2siLAogIDE0NTogIlNjcm9sbExvY2siLAogIDIyNDogIk1ldGEiCn0sCiAgICByZiA9IE5lLmV4dGVuZCh7CiAga2V5OiBmdW5jdGlvbiBrZXkoYSkgewogICAgaWYgKGEua2V5KSB7CiAgICAgIHZhciBiID0gcGZbYS5rZXldIHx8IGEua2V5OwogICAgICBpZiAoIlVuaWRlbnRpZmllZCIgIT09IGIpIHJldHVybiBiOwogICAgfQoKICAgIHJldHVybiAia2V5cHJlc3MiID09PSBhLnR5cGUgPyAoYSA9IG9mKGEpLCAxMyA9PT0gYSA/ICJFbnRlciIgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKSA6ICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IHFmW2Eua2V5Q29kZV0gfHwgIlVuaWRlbnRpZmllZCIgOiAiIjsKICB9LAogIGxvY2F0aW9uOiBudWxsLAogIGN0cmxLZXk6IG51bGwsCiAgc2hpZnRLZXk6IG51bGwsCiAgYWx0S2V5OiBudWxsLAogIG1ldGFLZXk6IG51bGwsCiAgcmVwZWF0OiBudWxsLAogIGxvY2FsZTogbnVsbCwKICBnZXRNb2RpZmllclN0YXRlOiBRZSwKICBjaGFyQ29kZTogZnVuY3Rpb24gY2hhckNvZGUoYSkgewogICAgcmV0dXJuICJrZXlwcmVzcyIgPT09IGEudHlwZSA/IG9mKGEpIDogMDsKICB9LAogIGtleUNvZGU6IGZ1bmN0aW9uIGtleUNvZGUoYSkgewogICAgcmV0dXJuICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IGEua2V5Q29kZSA6IDA7CiAgfSwKICB3aGljaDogZnVuY3Rpb24gd2hpY2goYSkgewogICAgcmV0dXJuICJrZXlwcmVzcyIgPT09IGEudHlwZSA/IG9mKGEpIDogImtleWRvd24iID09PSBhLnR5cGUgfHwgImtleXVwIiA9PT0gYS50eXBlID8gYS5rZXlDb2RlIDogMDsKICB9Cn0pLAogICAgc2YgPSBWZS5leHRlbmQoewogIGRhdGFUcmFuc2ZlcjogbnVsbAp9KSwKICAgIHRmID0gTmUuZXh0ZW5kKHsKICB0b3VjaGVzOiBudWxsLAogIHRhcmdldFRvdWNoZXM6IG51bGwsCiAgY2hhbmdlZFRvdWNoZXM6IG51bGwsCiAgYWx0S2V5OiBudWxsLAogIG1ldGFLZXk6IG51bGwsCiAgY3RybEtleTogbnVsbCwKICBzaGlmdEtleTogbnVsbCwKICBnZXRNb2RpZmllclN0YXRlOiBRZQp9KSwKICAgIHVmID0gRy5leHRlbmQoewogIHByb3BlcnR5TmFtZTogbnVsbCwKICBlbGFwc2VkVGltZTogbnVsbCwKICBwc2V1ZG9FbGVtZW50OiBudWxsCn0pLAogICAgdmYgPSBWZS5leHRlbmQoewogIGRlbHRhWDogZnVuY3Rpb24gZGVsdGFYKGEpIHsKICAgIHJldHVybiAiZGVsdGFYIiBpbiBhID8gYS5kZWx0YVggOiAid2hlZWxEZWx0YVgiIGluIGEgPyAtYS53aGVlbERlbHRhWCA6IDA7CiAgfSwKICBkZWx0YVk6IGZ1bmN0aW9uIGRlbHRhWShhKSB7CiAgICByZXR1cm4gImRlbHRhWSIgaW4gYSA/IGEuZGVsdGFZIDogIndoZWVsRGVsdGFZIiBpbiBhID8gLWEud2hlZWxEZWx0YVkgOiAid2hlZWxEZWx0YSIgaW4gYSA/IC1hLndoZWVsRGVsdGEgOiAwOwogIH0sCiAgZGVsdGFaOiBudWxsLAogIGRlbHRhTW9kZTogbnVsbAp9KSwKICAgIHdmID0gewogIGV2ZW50VHlwZXM6IFdjLAogIGV4dHJhY3RFdmVudHM6IGZ1bmN0aW9uIGV4dHJhY3RFdmVudHMoYSwgYiwgYywgZCkgewogICAgdmFyIGUgPSBZYy5nZXQoYSk7CiAgICBpZiAoIWUpIHJldHVybiBudWxsOwoKICAgIHN3aXRjaCAoYSkgewogICAgICBjYXNlICJrZXlwcmVzcyI6CiAgICAgICAgaWYgKDAgPT09IG9mKGMpKSByZXR1cm4gbnVsbDsKCiAgICAgIGNhc2UgImtleWRvd24iOgogICAgICBjYXNlICJrZXl1cCI6CiAgICAgICAgYSA9IHJmOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAiYmx1ciI6CiAgICAgIGNhc2UgImZvY3VzIjoKICAgICAgICBhID0gbmY7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICJjbGljayI6CiAgICAgICAgaWYgKDIgPT09IGMuYnV0dG9uKSByZXR1cm4gbnVsbDsKCiAgICAgIGNhc2UgImF1eGNsaWNrIjoKICAgICAgY2FzZSAiZGJsY2xpY2siOgogICAgICBjYXNlICJtb3VzZWRvd24iOgogICAgICBjYXNlICJtb3VzZW1vdmUiOgogICAgICBjYXNlICJtb3VzZXVwIjoKICAgICAgY2FzZSAibW91c2VvdXQiOgogICAgICBjYXNlICJtb3VzZW92ZXIiOgogICAgICBjYXNlICJjb250ZXh0bWVudSI6CiAgICAgICAgYSA9IFZlOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAiZHJhZyI6CiAgICAgIGNhc2UgImRyYWdlbmQiOgogICAgICBjYXNlICJkcmFnZW50ZXIiOgogICAgICBjYXNlICJkcmFnZXhpdCI6CiAgICAgIGNhc2UgImRyYWdsZWF2ZSI6CiAgICAgIGNhc2UgImRyYWdvdmVyIjoKICAgICAgY2FzZSAiZHJhZ3N0YXJ0IjoKICAgICAgY2FzZSAiZHJvcCI6CiAgICAgICAgYSA9IHNmOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAidG91Y2hjYW5jZWwiOgogICAgICBjYXNlICJ0b3VjaGVuZCI6CiAgICAgIGNhc2UgInRvdWNobW92ZSI6CiAgICAgIGNhc2UgInRvdWNoc3RhcnQiOgogICAgICAgIGEgPSB0ZjsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgWGI6CiAgICAgIGNhc2UgWWI6CiAgICAgIGNhc2UgWmI6CiAgICAgICAgYSA9IGxmOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAkYjoKICAgICAgICBhID0gdWY7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICJzY3JvbGwiOgogICAgICAgIGEgPSBOZTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgIndoZWVsIjoKICAgICAgICBhID0gdmY7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICJjb3B5IjoKICAgICAgY2FzZSAiY3V0IjoKICAgICAgY2FzZSAicGFzdGUiOgogICAgICAgIGEgPSBtZjsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjoKICAgICAgY2FzZSAibG9zdHBvaW50ZXJjYXB0dXJlIjoKICAgICAgY2FzZSAicG9pbnRlcmNhbmNlbCI6CiAgICAgIGNhc2UgInBvaW50ZXJkb3duIjoKICAgICAgY2FzZSAicG9pbnRlcm1vdmUiOgogICAgICBjYXNlICJwb2ludGVyb3V0IjoKICAgICAgY2FzZSAicG9pbnRlcm92ZXIiOgogICAgICBjYXNlICJwb2ludGVydXAiOgogICAgICAgIGEgPSBXZTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYSA9IEc7CiAgICB9CgogICAgYiA9IGEuZ2V0UG9vbGVkKGUsIGIsIGMsIGQpOwogICAgWGQoYik7CiAgICByZXR1cm4gYjsKICB9Cn07CmlmIChwYSkgdGhyb3cgRXJyb3IodSgxMDEpKTsKcGEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCgiUmVzcG9uZGVyRXZlbnRQbHVnaW4gU2ltcGxlRXZlbnRQbHVnaW4gRW50ZXJMZWF2ZUV2ZW50UGx1Z2luIENoYW5nZUV2ZW50UGx1Z2luIFNlbGVjdEV2ZW50UGx1Z2luIEJlZm9yZUlucHV0RXZlbnRQbHVnaW4iLnNwbGl0KCIgIikpOwpyYSgpOwp2YXIgeGYgPSBOYzsKbGEgPSBRZDsKbWEgPSB4ZjsKbmEgPSBQZDsKeGEoewogIFNpbXBsZUV2ZW50UGx1Z2luOiB3ZiwKICBFbnRlckxlYXZlRXZlbnRQbHVnaW46IFllLAogIENoYW5nZUV2ZW50UGx1Z2luOiBNZSwKICBTZWxlY3RFdmVudFBsdWdpbjoga2YsCiAgQmVmb3JlSW5wdXRFdmVudFBsdWdpbjogdmUKfSk7CnZhciB5ZiA9IFtdLAogICAgemYgPSAtMTsKCmZ1bmN0aW9uIEgoYSkgewogIDAgPiB6ZiB8fCAoYS5jdXJyZW50ID0geWZbemZdLCB5Zlt6Zl0gPSBudWxsLCB6Zi0tKTsKfQoKZnVuY3Rpb24gSShhLCBiKSB7CiAgemYrKzsKICB5Zlt6Zl0gPSBhLmN1cnJlbnQ7CiAgYS5jdXJyZW50ID0gYjsKfQoKdmFyIEFmID0ge30sCiAgICBKID0gewogIGN1cnJlbnQ6IEFmCn0sCiAgICBLID0gewogIGN1cnJlbnQ6ICExCn0sCiAgICBCZiA9IEFmOwoKZnVuY3Rpb24gQ2YoYSwgYikgewogIHZhciBjID0gYS50eXBlLmNvbnRleHRUeXBlczsKICBpZiAoIWMpIHJldHVybiBBZjsKICB2YXIgZCA9IGEuc3RhdGVOb2RlOwogIGlmIChkICYmIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dCA9PT0gYikgcmV0dXJuIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQ7CiAgdmFyIGUgPSB7fSwKICAgICAgZjsKCiAgZm9yIChmIGluIGMpIHsKICAgIGVbZl0gPSBiW2ZdOwogIH0KCiAgZCAmJiAoYSA9IGEuc3RhdGVOb2RlLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQgPSBiLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0ID0gZSk7CiAgcmV0dXJuIGU7Cn0KCmZ1bmN0aW9uIEwoYSkgewogIGEgPSBhLmNoaWxkQ29udGV4dFR5cGVzOwogIHJldHVybiBudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYTsKfQoKZnVuY3Rpb24gRGYoKSB7CiAgSChLKTsKICBIKEopOwp9CgpmdW5jdGlvbiBFZihhLCBiLCBjKSB7CiAgaWYgKEouY3VycmVudCAhPT0gQWYpIHRocm93IEVycm9yKHUoMTY4KSk7CiAgSShKLCBiKTsKICBJKEssIGMpOwp9CgpmdW5jdGlvbiBGZihhLCBiLCBjKSB7CiAgdmFyIGQgPSBhLnN0YXRlTm9kZTsKICBhID0gYi5jaGlsZENvbnRleHRUeXBlczsKICBpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGQuZ2V0Q2hpbGRDb250ZXh0KSByZXR1cm4gYzsKICBkID0gZC5nZXRDaGlsZENvbnRleHQoKTsKCiAgZm9yICh2YXIgZSBpbiBkKSB7CiAgICBpZiAoIShlIGluIGEpKSB0aHJvdyBFcnJvcih1KDEwOCwgcGIoYikgfHwgIlVua25vd24iLCBlKSk7CiAgfQoKICByZXR1cm4gbih7fSwgYywge30sIGQpOwp9CgpmdW5jdGlvbiBHZihhKSB7CiAgYSA9IChhID0gYS5zdGF0ZU5vZGUpICYmIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQgfHwgQWY7CiAgQmYgPSBKLmN1cnJlbnQ7CiAgSShKLCBhKTsKICBJKEssIEsuY3VycmVudCk7CiAgcmV0dXJuICEwOwp9CgpmdW5jdGlvbiBIZihhLCBiLCBjKSB7CiAgdmFyIGQgPSBhLnN0YXRlTm9kZTsKICBpZiAoIWQpIHRocm93IEVycm9yKHUoMTY5KSk7CiAgYyA/IChhID0gRmYoYSwgYiwgQmYpLCBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0ID0gYSwgSChLKSwgSChKKSwgSShKLCBhKSkgOiBIKEspOwogIEkoSywgYyk7Cn0KCnZhciBJZiA9IHIudW5zdGFibGVfcnVuV2l0aFByaW9yaXR5LAogICAgSmYgPSByLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2ssCiAgICBLZiA9IHIudW5zdGFibGVfY2FuY2VsQ2FsbGJhY2ssCiAgICBMZiA9IHIudW5zdGFibGVfcmVxdWVzdFBhaW50LAogICAgTWYgPSByLnVuc3RhYmxlX25vdywKICAgIE5mID0gci51bnN0YWJsZV9nZXRDdXJyZW50UHJpb3JpdHlMZXZlbCwKICAgIE9mID0gci51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eSwKICAgIFBmID0gci51bnN0YWJsZV9Vc2VyQmxvY2tpbmdQcmlvcml0eSwKICAgIFFmID0gci51bnN0YWJsZV9Ob3JtYWxQcmlvcml0eSwKICAgIFJmID0gci51bnN0YWJsZV9Mb3dQcmlvcml0eSwKICAgIFNmID0gci51bnN0YWJsZV9JZGxlUHJpb3JpdHksCiAgICBUZiA9IHt9LAogICAgVWYgPSByLnVuc3RhYmxlX3Nob3VsZFlpZWxkLAogICAgVmYgPSB2b2lkIDAgIT09IExmID8gTGYgOiBmdW5jdGlvbiAoKSB7fSwKICAgIFdmID0gbnVsbCwKICAgIFhmID0gbnVsbCwKICAgIFlmID0gITEsCiAgICBaZiA9IE1mKCksCiAgICAkZiA9IDFFNCA+IFpmID8gTWYgOiBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIE1mKCkgLSBaZjsKfTsKCmZ1bmN0aW9uIGFnKCkgewogIHN3aXRjaCAoTmYoKSkgewogICAgY2FzZSBPZjoKICAgICAgcmV0dXJuIDk5OwoKICAgIGNhc2UgUGY6CiAgICAgIHJldHVybiA5ODsKCiAgICBjYXNlIFFmOgogICAgICByZXR1cm4gOTc7CgogICAgY2FzZSBSZjoKICAgICAgcmV0dXJuIDk2OwoKICAgIGNhc2UgU2Y6CiAgICAgIHJldHVybiA5NTsKCiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBFcnJvcih1KDMzMikpOwogIH0KfQoKZnVuY3Rpb24gYmcoYSkgewogIHN3aXRjaCAoYSkgewogICAgY2FzZSA5OToKICAgICAgcmV0dXJuIE9mOwoKICAgIGNhc2UgOTg6CiAgICAgIHJldHVybiBQZjsKCiAgICBjYXNlIDk3OgogICAgICByZXR1cm4gUWY7CgogICAgY2FzZSA5NjoKICAgICAgcmV0dXJuIFJmOwoKICAgIGNhc2UgOTU6CiAgICAgIHJldHVybiBTZjsKCiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBFcnJvcih1KDMzMikpOwogIH0KfQoKZnVuY3Rpb24gY2coYSwgYikgewogIGEgPSBiZyhhKTsKICByZXR1cm4gSWYoYSwgYik7Cn0KCmZ1bmN0aW9uIGRnKGEsIGIsIGMpIHsKICBhID0gYmcoYSk7CiAgcmV0dXJuIEpmKGEsIGIsIGMpOwp9CgpmdW5jdGlvbiBlZyhhKSB7CiAgbnVsbCA9PT0gV2YgPyAoV2YgPSBbYV0sIFhmID0gSmYoT2YsIGZnKSkgOiBXZi5wdXNoKGEpOwogIHJldHVybiBUZjsKfQoKZnVuY3Rpb24gZ2coKSB7CiAgaWYgKG51bGwgIT09IFhmKSB7CiAgICB2YXIgYSA9IFhmOwogICAgWGYgPSBudWxsOwogICAgS2YoYSk7CiAgfQoKICBmZygpOwp9CgpmdW5jdGlvbiBmZygpIHsKICBpZiAoIVlmICYmIG51bGwgIT09IFdmKSB7CiAgICBZZiA9ICEwOwogICAgdmFyIGEgPSAwOwoKICAgIHRyeSB7CiAgICAgIHZhciBiID0gV2Y7CiAgICAgIGNnKDk5LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZm9yICg7IGEgPCBiLmxlbmd0aDsgYSsrKSB7CiAgICAgICAgICB2YXIgYyA9IGJbYV07CgogICAgICAgICAgZG8gewogICAgICAgICAgICBjID0gYyghMCk7CiAgICAgICAgICB9IHdoaWxlIChudWxsICE9PSBjKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBXZiA9IG51bGw7CiAgICB9IGNhdGNoIChjKSB7CiAgICAgIHRocm93IG51bGwgIT09IFdmICYmIChXZiA9IFdmLnNsaWNlKGEgKyAxKSksIEpmKE9mLCBnZyksIGM7CiAgICB9IGZpbmFsbHkgewogICAgICBZZiA9ICExOwogICAgfQogIH0KfQoKZnVuY3Rpb24gaGcoYSwgYiwgYykgewogIGMgLz0gMTA7CiAgcmV0dXJuIDEwNzM3NDE4MjEgLSAoKCgxMDczNzQxODIxIC0gYSArIGIgLyAxMCkgLyBjIHwgMCkgKyAxKSAqIGM7Cn0KCmZ1bmN0aW9uIGlnKGEsIGIpIHsKICBpZiAoYSAmJiBhLmRlZmF1bHRQcm9wcykgewogICAgYiA9IG4oe30sIGIpOwogICAgYSA9IGEuZGVmYXVsdFByb3BzOwoKICAgIGZvciAodmFyIGMgaW4gYSkgewogICAgICB2b2lkIDAgPT09IGJbY10gJiYgKGJbY10gPSBhW2NdKTsKICAgIH0KICB9CgogIHJldHVybiBiOwp9Cgp2YXIgamcgPSB7CiAgY3VycmVudDogbnVsbAp9LAogICAga2cgPSBudWxsLAogICAgbGcgPSBudWxsLAogICAgbWcgPSBudWxsOwoKZnVuY3Rpb24gbmcoKSB7CiAgbWcgPSBsZyA9IGtnID0gbnVsbDsKfQoKZnVuY3Rpb24gb2coYSkgewogIHZhciBiID0gamcuY3VycmVudDsKICBIKGpnKTsKICBhLnR5cGUuX2NvbnRleHQuX2N1cnJlbnRWYWx1ZSA9IGI7Cn0KCmZ1bmN0aW9uIHBnKGEsIGIpIHsKICBmb3IgKDsgbnVsbCAhPT0gYTspIHsKICAgIHZhciBjID0gYS5hbHRlcm5hdGU7CiAgICBpZiAoYS5jaGlsZEV4cGlyYXRpb25UaW1lIDwgYikgYS5jaGlsZEV4cGlyYXRpb25UaW1lID0gYiwgbnVsbCAhPT0gYyAmJiBjLmNoaWxkRXhwaXJhdGlvblRpbWUgPCBiICYmIChjLmNoaWxkRXhwaXJhdGlvblRpbWUgPSBiKTtlbHNlIGlmIChudWxsICE9PSBjICYmIGMuY2hpbGRFeHBpcmF0aW9uVGltZSA8IGIpIGMuY2hpbGRFeHBpcmF0aW9uVGltZSA9IGI7ZWxzZSBicmVhazsKICAgIGEgPSBhLnJldHVybjsKICB9Cn0KCmZ1bmN0aW9uIHFnKGEsIGIpIHsKICBrZyA9IGE7CiAgbWcgPSBsZyA9IG51bGw7CiAgYSA9IGEuZGVwZW5kZW5jaWVzOwogIG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5maXJzdENvbnRleHQgJiYgKGEuZXhwaXJhdGlvblRpbWUgPj0gYiAmJiAocmcgPSAhMCksIGEuZmlyc3RDb250ZXh0ID0gbnVsbCk7Cn0KCmZ1bmN0aW9uIHNnKGEsIGIpIHsKICBpZiAobWcgIT09IGEgJiYgITEgIT09IGIgJiYgMCAhPT0gYikgewogICAgaWYgKCJudW1iZXIiICE9PSB0eXBlb2YgYiB8fCAxMDczNzQxODIzID09PSBiKSBtZyA9IGEsIGIgPSAxMDczNzQxODIzOwogICAgYiA9IHsKICAgICAgY29udGV4dDogYSwKICAgICAgb2JzZXJ2ZWRCaXRzOiBiLAogICAgICBuZXh0OiBudWxsCiAgICB9OwoKICAgIGlmIChudWxsID09PSBsZykgewogICAgICBpZiAobnVsbCA9PT0ga2cpIHRocm93IEVycm9yKHUoMzA4KSk7CiAgICAgIGxnID0gYjsKICAgICAga2cuZGVwZW5kZW5jaWVzID0gewogICAgICAgIGV4cGlyYXRpb25UaW1lOiAwLAogICAgICAgIGZpcnN0Q29udGV4dDogYiwKICAgICAgICByZXNwb25kZXJzOiBudWxsCiAgICAgIH07CiAgICB9IGVsc2UgbGcgPSBsZy5uZXh0ID0gYjsKICB9CgogIHJldHVybiBhLl9jdXJyZW50VmFsdWU7Cn0KCnZhciB0ZyA9ICExOwoKZnVuY3Rpb24gdWcoYSkgewogIGEudXBkYXRlUXVldWUgPSB7CiAgICBiYXNlU3RhdGU6IGEubWVtb2l6ZWRTdGF0ZSwKICAgIGJhc2VRdWV1ZTogbnVsbCwKICAgIHNoYXJlZDogewogICAgICBwZW5kaW5nOiBudWxsCiAgICB9LAogICAgZWZmZWN0czogbnVsbAogIH07Cn0KCmZ1bmN0aW9uIHZnKGEsIGIpIHsKICBhID0gYS51cGRhdGVRdWV1ZTsKICBiLnVwZGF0ZVF1ZXVlID09PSBhICYmIChiLnVwZGF0ZVF1ZXVlID0gewogICAgYmFzZVN0YXRlOiBhLmJhc2VTdGF0ZSwKICAgIGJhc2VRdWV1ZTogYS5iYXNlUXVldWUsCiAgICBzaGFyZWQ6IGEuc2hhcmVkLAogICAgZWZmZWN0czogYS5lZmZlY3RzCiAgfSk7Cn0KCmZ1bmN0aW9uIHdnKGEsIGIpIHsKICBhID0gewogICAgZXhwaXJhdGlvblRpbWU6IGEsCiAgICBzdXNwZW5zZUNvbmZpZzogYiwKICAgIHRhZzogMCwKICAgIHBheWxvYWQ6IG51bGwsCiAgICBjYWxsYmFjazogbnVsbCwKICAgIG5leHQ6IG51bGwKICB9OwogIHJldHVybiBhLm5leHQgPSBhOwp9CgpmdW5jdGlvbiB4ZyhhLCBiKSB7CiAgYSA9IGEudXBkYXRlUXVldWU7CgogIGlmIChudWxsICE9PSBhKSB7CiAgICBhID0gYS5zaGFyZWQ7CiAgICB2YXIgYyA9IGEucGVuZGluZzsKICAgIG51bGwgPT09IGMgPyBiLm5leHQgPSBiIDogKGIubmV4dCA9IGMubmV4dCwgYy5uZXh0ID0gYik7CiAgICBhLnBlbmRpbmcgPSBiOwogIH0KfQoKZnVuY3Rpb24geWcoYSwgYikgewogIHZhciBjID0gYS5hbHRlcm5hdGU7CiAgbnVsbCAhPT0gYyAmJiB2ZyhjLCBhKTsKICBhID0gYS51cGRhdGVRdWV1ZTsKICBjID0gYS5iYXNlUXVldWU7CiAgbnVsbCA9PT0gYyA/IChhLmJhc2VRdWV1ZSA9IGIubmV4dCA9IGIsIGIubmV4dCA9IGIpIDogKGIubmV4dCA9IGMubmV4dCwgYy5uZXh0ID0gYik7Cn0KCmZ1bmN0aW9uIHpnKGEsIGIsIGMsIGQpIHsKICB2YXIgZSA9IGEudXBkYXRlUXVldWU7CiAgdGcgPSAhMTsKICB2YXIgZiA9IGUuYmFzZVF1ZXVlLAogICAgICBnID0gZS5zaGFyZWQucGVuZGluZzsKCiAgaWYgKG51bGwgIT09IGcpIHsKICAgIGlmIChudWxsICE9PSBmKSB7CiAgICAgIHZhciBoID0gZi5uZXh0OwogICAgICBmLm5leHQgPSBnLm5leHQ7CiAgICAgIGcubmV4dCA9IGg7CiAgICB9CgogICAgZiA9IGc7CiAgICBlLnNoYXJlZC5wZW5kaW5nID0gbnVsbDsKICAgIGggPSBhLmFsdGVybmF0ZTsKICAgIG51bGwgIT09IGggJiYgKGggPSBoLnVwZGF0ZVF1ZXVlLCBudWxsICE9PSBoICYmIChoLmJhc2VRdWV1ZSA9IGcpKTsKICB9CgogIGlmIChudWxsICE9PSBmKSB7CiAgICBoID0gZi5uZXh0OwogICAgdmFyIGsgPSBlLmJhc2VTdGF0ZSwKICAgICAgICBsID0gMCwKICAgICAgICBtID0gbnVsbCwKICAgICAgICBwID0gbnVsbCwKICAgICAgICB4ID0gbnVsbDsKCiAgICBpZiAobnVsbCAhPT0gaCkgewogICAgICB2YXIgeiA9IGg7CgogICAgICBkbyB7CiAgICAgICAgZyA9IHouZXhwaXJhdGlvblRpbWU7CgogICAgICAgIGlmIChnIDwgZCkgewogICAgICAgICAgdmFyIGNhID0gewogICAgICAgICAgICBleHBpcmF0aW9uVGltZTogei5leHBpcmF0aW9uVGltZSwKICAgICAgICAgICAgc3VzcGVuc2VDb25maWc6IHouc3VzcGVuc2VDb25maWcsCiAgICAgICAgICAgIHRhZzogei50YWcsCiAgICAgICAgICAgIHBheWxvYWQ6IHoucGF5bG9hZCwKICAgICAgICAgICAgY2FsbGJhY2s6IHouY2FsbGJhY2ssCiAgICAgICAgICAgIG5leHQ6IG51bGwKICAgICAgICAgIH07CiAgICAgICAgICBudWxsID09PSB4ID8gKHAgPSB4ID0gY2EsIG0gPSBrKSA6IHggPSB4Lm5leHQgPSBjYTsKICAgICAgICAgIGcgPiBsICYmIChsID0gZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG51bGwgIT09IHggJiYgKHggPSB4Lm5leHQgPSB7CiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lOiAxMDczNzQxODIzLAogICAgICAgICAgICBzdXNwZW5zZUNvbmZpZzogei5zdXNwZW5zZUNvbmZpZywKICAgICAgICAgICAgdGFnOiB6LnRhZywKICAgICAgICAgICAgcGF5bG9hZDogei5wYXlsb2FkLAogICAgICAgICAgICBjYWxsYmFjazogei5jYWxsYmFjaywKICAgICAgICAgICAgbmV4dDogbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgICBBZyhnLCB6LnN1c3BlbnNlQ29uZmlnKTsKCiAgICAgICAgICBhOiB7CiAgICAgICAgICAgIHZhciBEID0gYSwKICAgICAgICAgICAgICAgIHQgPSB6OwogICAgICAgICAgICBnID0gYjsKICAgICAgICAgICAgY2EgPSBjOwoKICAgICAgICAgICAgc3dpdGNoICh0LnRhZykgewogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIEQgPSB0LnBheWxvYWQ7CgogICAgICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBEKSB7CiAgICAgICAgICAgICAgICAgIGsgPSBELmNhbGwoY2EsIGssIGcpOwogICAgICAgICAgICAgICAgICBicmVhayBhOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGsgPSBEOwogICAgICAgICAgICAgICAgYnJlYWsgYTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgRC5lZmZlY3RUYWcgPSBELmVmZmVjdFRhZyAmIC00MDk3IHwgNjQ7CgogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIEQgPSB0LnBheWxvYWQ7CiAgICAgICAgICAgICAgICBnID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIEQgPyBELmNhbGwoY2EsIGssIGcpIDogRDsKICAgICAgICAgICAgICAgIGlmIChudWxsID09PSBnIHx8IHZvaWQgMCA9PT0gZykgYnJlYWsgYTsKICAgICAgICAgICAgICAgIGsgPSBuKHt9LCBrLCBnKTsKICAgICAgICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHRnID0gITA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBudWxsICE9PSB6LmNhbGxiYWNrICYmIChhLmVmZmVjdFRhZyB8PSAzMiwgZyA9IGUuZWZmZWN0cywgbnVsbCA9PT0gZyA/IGUuZWZmZWN0cyA9IFt6XSA6IGcucHVzaCh6KSk7CiAgICAgICAgfQoKICAgICAgICB6ID0gei5uZXh0OwogICAgICAgIGlmIChudWxsID09PSB6IHx8IHogPT09IGgpIGlmIChnID0gZS5zaGFyZWQucGVuZGluZywgbnVsbCA9PT0gZykgYnJlYWs7ZWxzZSB6ID0gZi5uZXh0ID0gZy5uZXh0LCBnLm5leHQgPSBoLCBlLmJhc2VRdWV1ZSA9IGYgPSBnLCBlLnNoYXJlZC5wZW5kaW5nID0gbnVsbDsKICAgICAgfSB3aGlsZSAoMSk7CiAgICB9CgogICAgbnVsbCA9PT0geCA/IG0gPSBrIDogeC5uZXh0ID0gcDsKICAgIGUuYmFzZVN0YXRlID0gbTsKICAgIGUuYmFzZVF1ZXVlID0geDsKICAgIEJnKGwpOwogICAgYS5leHBpcmF0aW9uVGltZSA9IGw7CiAgICBhLm1lbW9pemVkU3RhdGUgPSBrOwogIH0KfQoKZnVuY3Rpb24gQ2coYSwgYiwgYykgewogIGEgPSBiLmVmZmVjdHM7CiAgYi5lZmZlY3RzID0gbnVsbDsKICBpZiAobnVsbCAhPT0gYSkgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIHsKICAgIHZhciBkID0gYVtiXSwKICAgICAgICBlID0gZC5jYWxsYmFjazsKCiAgICBpZiAobnVsbCAhPT0gZSkgewogICAgICBkLmNhbGxiYWNrID0gbnVsbDsKICAgICAgZCA9IGU7CiAgICAgIGUgPSBjOwogICAgICBpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGQpIHRocm93IEVycm9yKHUoMTkxLCBkKSk7CiAgICAgIGQuY2FsbChlKTsKICAgIH0KICB9Cn0KCnZhciBEZyA9IFdhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLAogICAgRWcgPSBuZXcgYWEuQ29tcG9uZW50KCkucmVmczsKCmZ1bmN0aW9uIEZnKGEsIGIsIGMsIGQpIHsKICBiID0gYS5tZW1vaXplZFN0YXRlOwogIGMgPSBjKGQsIGIpOwogIGMgPSBudWxsID09PSBjIHx8IHZvaWQgMCA9PT0gYyA/IGIgOiBuKHt9LCBiLCBjKTsKICBhLm1lbW9pemVkU3RhdGUgPSBjOwogIDAgPT09IGEuZXhwaXJhdGlvblRpbWUgJiYgKGEudXBkYXRlUXVldWUuYmFzZVN0YXRlID0gYyk7Cn0KCnZhciBKZyA9IHsKICBpc01vdW50ZWQ6IGZ1bmN0aW9uIGlzTW91bnRlZChhKSB7CiAgICByZXR1cm4gKGEgPSBhLl9yZWFjdEludGVybmFsRmliZXIpID8gZGMoYSkgPT09IGEgOiAhMTsKICB9LAogIGVucXVldWVTZXRTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVNldFN0YXRlKGEsIGIsIGMpIHsKICAgIGEgPSBhLl9yZWFjdEludGVybmFsRmliZXI7CiAgICB2YXIgZCA9IEdnKCksCiAgICAgICAgZSA9IERnLnN1c3BlbnNlOwogICAgZCA9IEhnKGQsIGEsIGUpOwogICAgZSA9IHdnKGQsIGUpOwogICAgZS5wYXlsb2FkID0gYjsKICAgIHZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIChlLmNhbGxiYWNrID0gYyk7CiAgICB4ZyhhLCBlKTsKICAgIElnKGEsIGQpOwogIH0sCiAgZW5xdWV1ZVJlcGxhY2VTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVJlcGxhY2VTdGF0ZShhLCBiLCBjKSB7CiAgICBhID0gYS5fcmVhY3RJbnRlcm5hbEZpYmVyOwogICAgdmFyIGQgPSBHZygpLAogICAgICAgIGUgPSBEZy5zdXNwZW5zZTsKICAgIGQgPSBIZyhkLCBhLCBlKTsKICAgIGUgPSB3ZyhkLCBlKTsKICAgIGUudGFnID0gMTsKICAgIGUucGF5bG9hZCA9IGI7CiAgICB2b2lkIDAgIT09IGMgJiYgbnVsbCAhPT0gYyAmJiAoZS5jYWxsYmFjayA9IGMpOwogICAgeGcoYSwgZSk7CiAgICBJZyhhLCBkKTsKICB9LAogIGVucXVldWVGb3JjZVVwZGF0ZTogZnVuY3Rpb24gZW5xdWV1ZUZvcmNlVXBkYXRlKGEsIGIpIHsKICAgIGEgPSBhLl9yZWFjdEludGVybmFsRmliZXI7CiAgICB2YXIgYyA9IEdnKCksCiAgICAgICAgZCA9IERnLnN1c3BlbnNlOwogICAgYyA9IEhnKGMsIGEsIGQpOwogICAgZCA9IHdnKGMsIGQpOwogICAgZC50YWcgPSAyOwogICAgdm9pZCAwICE9PSBiICYmIG51bGwgIT09IGIgJiYgKGQuY2FsbGJhY2sgPSBiKTsKICAgIHhnKGEsIGQpOwogICAgSWcoYSwgYyk7CiAgfQp9OwoKZnVuY3Rpb24gS2coYSwgYiwgYywgZCwgZSwgZiwgZykgewogIGEgPSBhLnN0YXRlTm9kZTsKICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEuc2hvdWxkQ29tcG9uZW50VXBkYXRlID8gYS5zaG91bGRDb21wb25lbnRVcGRhdGUoZCwgZiwgZykgOiBiLnByb3RvdHlwZSAmJiBiLnByb3RvdHlwZS5pc1B1cmVSZWFjdENvbXBvbmVudCA/ICFiZihjLCBkKSB8fCAhYmYoZSwgZikgOiAhMDsKfQoKZnVuY3Rpb24gTGcoYSwgYiwgYykgewogIHZhciBkID0gITEsCiAgICAgIGUgPSBBZjsKICB2YXIgZiA9IGIuY29udGV4dFR5cGU7CiAgIm9iamVjdCIgPT09IF90eXBlb2YoZikgJiYgbnVsbCAhPT0gZiA/IGYgPSBzZyhmKSA6IChlID0gTChiKSA/IEJmIDogSi5jdXJyZW50LCBkID0gYi5jb250ZXh0VHlwZXMsIGYgPSAoZCA9IG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKSA/IENmKGEsIGUpIDogQWYpOwogIGIgPSBuZXcgYihjLCBmKTsKICBhLm1lbW9pemVkU3RhdGUgPSBudWxsICE9PSBiLnN0YXRlICYmIHZvaWQgMCAhPT0gYi5zdGF0ZSA/IGIuc3RhdGUgOiBudWxsOwogIGIudXBkYXRlciA9IEpnOwogIGEuc3RhdGVOb2RlID0gYjsKICBiLl9yZWFjdEludGVybmFsRmliZXIgPSBhOwogIGQgJiYgKGEgPSBhLnN0YXRlTm9kZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0ID0gZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dCA9IGYpOwogIHJldHVybiBiOwp9CgpmdW5jdGlvbiBNZyhhLCBiLCBjLCBkKSB7CiAgYSA9IGIuc3RhdGU7CiAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoYywgZCk7CiAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLCBkKTsKICBiLnN0YXRlICE9PSBhICYmIEpnLmVucXVldWVSZXBsYWNlU3RhdGUoYiwgYi5zdGF0ZSwgbnVsbCk7Cn0KCmZ1bmN0aW9uIE5nKGEsIGIsIGMsIGQpIHsKICB2YXIgZSA9IGEuc3RhdGVOb2RlOwogIGUucHJvcHMgPSBjOwogIGUuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGU7CiAgZS5yZWZzID0gRWc7CiAgdWcoYSk7CiAgdmFyIGYgPSBiLmNvbnRleHRUeXBlOwogICJvYmplY3QiID09PSBfdHlwZW9mKGYpICYmIG51bGwgIT09IGYgPyBlLmNvbnRleHQgPSBzZyhmKSA6IChmID0gTChiKSA/IEJmIDogSi5jdXJyZW50LCBlLmNvbnRleHQgPSBDZihhLCBmKSk7CiAgemcoYSwgYywgZSwgZCk7CiAgZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTsKICBmID0gYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7CiAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYgJiYgKEZnKGEsIGIsIGYsIGMpLCBlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlKTsKICAiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnQgfHwgKGIgPSBlLnN0YXRlLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnQgJiYgZS5jb21wb25lbnRXaWxsTW91bnQoKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSwgYiAhPT0gZS5zdGF0ZSAmJiBKZy5lbnF1ZXVlUmVwbGFjZVN0YXRlKGUsIGUuc3RhdGUsIG51bGwpLCB6ZyhhLCBjLCBlLCBkKSwgZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZSk7CiAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuY29tcG9uZW50RGlkTW91bnQgJiYgKGEuZWZmZWN0VGFnIHw9IDQpOwp9Cgp2YXIgT2cgPSBBcnJheS5pc0FycmF5OwoKZnVuY3Rpb24gUGcoYSwgYiwgYykgewogIGEgPSBjLnJlZjsKCiAgaWYgKG51bGwgIT09IGEgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGEgJiYgIm9iamVjdCIgIT09IF90eXBlb2YoYSkpIHsKICAgIGlmIChjLl9vd25lcikgewogICAgICBjID0gYy5fb3duZXI7CgogICAgICBpZiAoYykgewogICAgICAgIGlmICgxICE9PSBjLnRhZykgdGhyb3cgRXJyb3IodSgzMDkpKTsKICAgICAgICB2YXIgZCA9IGMuc3RhdGVOb2RlOwogICAgICB9CgogICAgICBpZiAoIWQpIHRocm93IEVycm9yKHUoMTQ3LCBhKSk7CiAgICAgIHZhciBlID0gIiIgKyBhOwogICAgICBpZiAobnVsbCAhPT0gYiAmJiBudWxsICE9PSBiLnJlZiAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5yZWYgJiYgYi5yZWYuX3N0cmluZ1JlZiA9PT0gZSkgcmV0dXJuIGIucmVmOwoKICAgICAgYiA9IGZ1bmN0aW9uIGIoYSkgewogICAgICAgIHZhciBiID0gZC5yZWZzOwogICAgICAgIGIgPT09IEVnICYmIChiID0gZC5yZWZzID0ge30pOwogICAgICAgIG51bGwgPT09IGEgPyBkZWxldGUgYltlXSA6IGJbZV0gPSBhOwogICAgICB9OwoKICAgICAgYi5fc3RyaW5nUmVmID0gZTsKICAgICAgcmV0dXJuIGI7CiAgICB9CgogICAgaWYgKCJzdHJpbmciICE9PSB0eXBlb2YgYSkgdGhyb3cgRXJyb3IodSgyODQpKTsKICAgIGlmICghYy5fb3duZXIpIHRocm93IEVycm9yKHUoMjkwLCBhKSk7CiAgfQoKICByZXR1cm4gYTsKfQoKZnVuY3Rpb24gUWcoYSwgYikgewogIGlmICgidGV4dGFyZWEiICE9PSBhLnR5cGUpIHRocm93IEVycm9yKHUoMzEsICJbb2JqZWN0IE9iamVjdF0iID09PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYikgPyAib2JqZWN0IHdpdGgga2V5cyB7IiArIE9iamVjdC5rZXlzKGIpLmpvaW4oIiwgIikgKyAifSIgOiBiLCAiIikpOwp9CgpmdW5jdGlvbiBSZyhhKSB7CiAgZnVuY3Rpb24gYihiLCBjKSB7CiAgICBpZiAoYSkgewogICAgICB2YXIgZCA9IGIubGFzdEVmZmVjdDsKICAgICAgbnVsbCAhPT0gZCA/IChkLm5leHRFZmZlY3QgPSBjLCBiLmxhc3RFZmZlY3QgPSBjKSA6IGIuZmlyc3RFZmZlY3QgPSBiLmxhc3RFZmZlY3QgPSBjOwogICAgICBjLm5leHRFZmZlY3QgPSBudWxsOwogICAgICBjLmVmZmVjdFRhZyA9IDg7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjKGMsIGQpIHsKICAgIGlmICghYSkgcmV0dXJuIG51bGw7CgogICAgZm9yICg7IG51bGwgIT09IGQ7KSB7CiAgICAgIGIoYywgZCksIGQgPSBkLnNpYmxpbmc7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiBkKGEsIGIpIHsKICAgIGZvciAoYSA9IG5ldyBNYXAoKTsgbnVsbCAhPT0gYjspIHsKICAgICAgbnVsbCAhPT0gYi5rZXkgPyBhLnNldChiLmtleSwgYikgOiBhLnNldChiLmluZGV4LCBiKSwgYiA9IGIuc2libGluZzsKICAgIH0KCiAgICByZXR1cm4gYTsKICB9CgogIGZ1bmN0aW9uIGUoYSwgYikgewogICAgYSA9IFNnKGEsIGIpOwogICAgYS5pbmRleCA9IDA7CiAgICBhLnNpYmxpbmcgPSBudWxsOwogICAgcmV0dXJuIGE7CiAgfQoKICBmdW5jdGlvbiBmKGIsIGMsIGQpIHsKICAgIGIuaW5kZXggPSBkOwogICAgaWYgKCFhKSByZXR1cm4gYzsKICAgIGQgPSBiLmFsdGVybmF0ZTsKICAgIGlmIChudWxsICE9PSBkKSByZXR1cm4gZCA9IGQuaW5kZXgsIGQgPCBjID8gKGIuZWZmZWN0VGFnID0gMiwgYykgOiBkOwogICAgYi5lZmZlY3RUYWcgPSAyOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBnKGIpIHsKICAgIGEgJiYgbnVsbCA9PT0gYi5hbHRlcm5hdGUgJiYgKGIuZWZmZWN0VGFnID0gMik7CiAgICByZXR1cm4gYjsKICB9CgogIGZ1bmN0aW9uIGgoYSwgYiwgYywgZCkgewogICAgaWYgKG51bGwgPT09IGIgfHwgNiAhPT0gYi50YWcpIHJldHVybiBiID0gVGcoYywgYS5tb2RlLCBkKSwgYi5yZXR1cm4gPSBhLCBiOwogICAgYiA9IGUoYiwgYyk7CiAgICBiLnJldHVybiA9IGE7CiAgICByZXR1cm4gYjsKICB9CgogIGZ1bmN0aW9uIGsoYSwgYiwgYywgZCkgewogICAgaWYgKG51bGwgIT09IGIgJiYgYi5lbGVtZW50VHlwZSA9PT0gYy50eXBlKSByZXR1cm4gZCA9IGUoYiwgYy5wcm9wcyksIGQucmVmID0gUGcoYSwgYiwgYyksIGQucmV0dXJuID0gYSwgZDsKICAgIGQgPSBVZyhjLnR5cGUsIGMua2V5LCBjLnByb3BzLCBudWxsLCBhLm1vZGUsIGQpOwogICAgZC5yZWYgPSBQZyhhLCBiLCBjKTsKICAgIGQucmV0dXJuID0gYTsKICAgIHJldHVybiBkOwogIH0KCiAgZnVuY3Rpb24gbChhLCBiLCBjLCBkKSB7CiAgICBpZiAobnVsbCA9PT0gYiB8fCA0ICE9PSBiLnRhZyB8fCBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvICE9PSBjLmNvbnRhaW5lckluZm8gfHwgYi5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb24gIT09IGMuaW1wbGVtZW50YXRpb24pIHJldHVybiBiID0gVmcoYywgYS5tb2RlLCBkKSwgYi5yZXR1cm4gPSBhLCBiOwogICAgYiA9IGUoYiwgYy5jaGlsZHJlbiB8fCBbXSk7CiAgICBiLnJldHVybiA9IGE7CiAgICByZXR1cm4gYjsKICB9CgogIGZ1bmN0aW9uIG0oYSwgYiwgYywgZCwgZikgewogICAgaWYgKG51bGwgPT09IGIgfHwgNyAhPT0gYi50YWcpIHJldHVybiBiID0gV2coYywgYS5tb2RlLCBkLCBmKSwgYi5yZXR1cm4gPSBhLCBiOwogICAgYiA9IGUoYiwgYyk7CiAgICBiLnJldHVybiA9IGE7CiAgICByZXR1cm4gYjsKICB9CgogIGZ1bmN0aW9uIHAoYSwgYiwgYykgewogICAgaWYgKCJzdHJpbmciID09PSB0eXBlb2YgYiB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGIpIHJldHVybiBiID0gVGcoIiIgKyBiLCBhLm1vZGUsIGMpLCBiLnJldHVybiA9IGEsIGI7CgogICAgaWYgKCJvYmplY3QiID09PSBfdHlwZW9mKGIpICYmIG51bGwgIT09IGIpIHsKICAgICAgc3dpdGNoIChiLiQkdHlwZW9mKSB7CiAgICAgICAgY2FzZSBaYToKICAgICAgICAgIHJldHVybiBjID0gVWcoYi50eXBlLCBiLmtleSwgYi5wcm9wcywgbnVsbCwgYS5tb2RlLCBjKSwgYy5yZWYgPSBQZyhhLCBudWxsLCBiKSwgYy5yZXR1cm4gPSBhLCBjOwoKICAgICAgICBjYXNlICRhOgogICAgICAgICAgcmV0dXJuIGIgPSBWZyhiLCBhLm1vZGUsIGMpLCBiLnJldHVybiA9IGEsIGI7CiAgICAgIH0KCiAgICAgIGlmIChPZyhiKSB8fCBuYihiKSkgcmV0dXJuIGIgPSBXZyhiLCBhLm1vZGUsIGMsIG51bGwpLCBiLnJldHVybiA9IGEsIGI7CiAgICAgIFFnKGEsIGIpOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24geChhLCBiLCBjLCBkKSB7CiAgICB2YXIgZSA9IG51bGwgIT09IGIgPyBiLmtleSA6IG51bGw7CiAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBjIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYykgcmV0dXJuIG51bGwgIT09IGUgPyBudWxsIDogaChhLCBiLCAiIiArIGMsIGQpOwoKICAgIGlmICgib2JqZWN0IiA9PT0gX3R5cGVvZihjKSAmJiBudWxsICE9PSBjKSB7CiAgICAgIHN3aXRjaCAoYy4kJHR5cGVvZikgewogICAgICAgIGNhc2UgWmE6CiAgICAgICAgICByZXR1cm4gYy5rZXkgPT09IGUgPyBjLnR5cGUgPT09IGFiID8gbShhLCBiLCBjLnByb3BzLmNoaWxkcmVuLCBkLCBlKSA6IGsoYSwgYiwgYywgZCkgOiBudWxsOwoKICAgICAgICBjYXNlICRhOgogICAgICAgICAgcmV0dXJuIGMua2V5ID09PSBlID8gbChhLCBiLCBjLCBkKSA6IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChPZyhjKSB8fCBuYihjKSkgcmV0dXJuIG51bGwgIT09IGUgPyBudWxsIDogbShhLCBiLCBjLCBkLCBudWxsKTsKICAgICAgUWcoYSwgYyk7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiB6KGEsIGIsIGMsIGQsIGUpIHsKICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGQgfHwgIm51bWJlciIgPT09IHR5cGVvZiBkKSByZXR1cm4gYSA9IGEuZ2V0KGMpIHx8IG51bGwsIGgoYiwgYSwgIiIgKyBkLCBlKTsKCiAgICBpZiAoIm9iamVjdCIgPT09IF90eXBlb2YoZCkgJiYgbnVsbCAhPT0gZCkgewogICAgICBzd2l0Y2ggKGQuJCR0eXBlb2YpIHsKICAgICAgICBjYXNlIFphOgogICAgICAgICAgcmV0dXJuIGEgPSBhLmdldChudWxsID09PSBkLmtleSA/IGMgOiBkLmtleSkgfHwgbnVsbCwgZC50eXBlID09PSBhYiA/IG0oYiwgYSwgZC5wcm9wcy5jaGlsZHJlbiwgZSwgZC5rZXkpIDogayhiLCBhLCBkLCBlKTsKCiAgICAgICAgY2FzZSAkYToKICAgICAgICAgIHJldHVybiBhID0gYS5nZXQobnVsbCA9PT0gZC5rZXkgPyBjIDogZC5rZXkpIHx8IG51bGwsIGwoYiwgYSwgZCwgZSk7CiAgICAgIH0KCiAgICAgIGlmIChPZyhkKSB8fCBuYihkKSkgcmV0dXJuIGEgPSBhLmdldChjKSB8fCBudWxsLCBtKGIsIGEsIGQsIGUsIG51bGwpOwogICAgICBRZyhiLCBkKTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIGNhKGUsIGcsIGgsIGspIHsKICAgIGZvciAodmFyIGwgPSBudWxsLCB0ID0gbnVsbCwgbSA9IGcsIHkgPSBnID0gMCwgQSA9IG51bGw7IG51bGwgIT09IG0gJiYgeSA8IGgubGVuZ3RoOyB5KyspIHsKICAgICAgbS5pbmRleCA+IHkgPyAoQSA9IG0sIG0gPSBudWxsKSA6IEEgPSBtLnNpYmxpbmc7CiAgICAgIHZhciBxID0geChlLCBtLCBoW3ldLCBrKTsKCiAgICAgIGlmIChudWxsID09PSBxKSB7CiAgICAgICAgbnVsbCA9PT0gbSAmJiAobSA9IEEpOwogICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICBhICYmIG0gJiYgbnVsbCA9PT0gcS5hbHRlcm5hdGUgJiYgYihlLCBtKTsKICAgICAgZyA9IGYocSwgZywgeSk7CiAgICAgIG51bGwgPT09IHQgPyBsID0gcSA6IHQuc2libGluZyA9IHE7CiAgICAgIHQgPSBxOwogICAgICBtID0gQTsKICAgIH0KCiAgICBpZiAoeSA9PT0gaC5sZW5ndGgpIHJldHVybiBjKGUsIG0pLCBsOwoKICAgIGlmIChudWxsID09PSBtKSB7CiAgICAgIGZvciAoOyB5IDwgaC5sZW5ndGg7IHkrKykgewogICAgICAgIG0gPSBwKGUsIGhbeV0sIGspLCBudWxsICE9PSBtICYmIChnID0gZihtLCBnLCB5KSwgbnVsbCA9PT0gdCA/IGwgPSBtIDogdC5zaWJsaW5nID0gbSwgdCA9IG0pOwogICAgICB9CgogICAgICByZXR1cm4gbDsKICAgIH0KCiAgICBmb3IgKG0gPSBkKGUsIG0pOyB5IDwgaC5sZW5ndGg7IHkrKykgewogICAgICBBID0geihtLCBlLCB5LCBoW3ldLCBrKSwgbnVsbCAhPT0gQSAmJiAoYSAmJiBudWxsICE9PSBBLmFsdGVybmF0ZSAmJiBtLmRlbGV0ZShudWxsID09PSBBLmtleSA/IHkgOiBBLmtleSksIGcgPSBmKEEsIGcsIHkpLCBudWxsID09PSB0ID8gbCA9IEEgOiB0LnNpYmxpbmcgPSBBLCB0ID0gQSk7CiAgICB9CgogICAgYSAmJiBtLmZvckVhY2goZnVuY3Rpb24gKGEpIHsKICAgICAgcmV0dXJuIGIoZSwgYSk7CiAgICB9KTsKICAgIHJldHVybiBsOwogIH0KCiAgZnVuY3Rpb24gRChlLCBnLCBoLCBsKSB7CiAgICB2YXIgayA9IG5iKGgpOwogICAgaWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBrKSB0aHJvdyBFcnJvcih1KDE1MCkpOwogICAgaCA9IGsuY2FsbChoKTsKICAgIGlmIChudWxsID09IGgpIHRocm93IEVycm9yKHUoMTUxKSk7CgogICAgZm9yICh2YXIgbSA9IGsgPSBudWxsLCB0ID0gZywgeSA9IGcgPSAwLCBBID0gbnVsbCwgcSA9IGgubmV4dCgpOyBudWxsICE9PSB0ICYmICFxLmRvbmU7IHkrKywgcSA9IGgubmV4dCgpKSB7CiAgICAgIHQuaW5kZXggPiB5ID8gKEEgPSB0LCB0ID0gbnVsbCkgOiBBID0gdC5zaWJsaW5nOwogICAgICB2YXIgRCA9IHgoZSwgdCwgcS52YWx1ZSwgbCk7CgogICAgICBpZiAobnVsbCA9PT0gRCkgewogICAgICAgIG51bGwgPT09IHQgJiYgKHQgPSBBKTsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgYSAmJiB0ICYmIG51bGwgPT09IEQuYWx0ZXJuYXRlICYmIGIoZSwgdCk7CiAgICAgIGcgPSBmKEQsIGcsIHkpOwogICAgICBudWxsID09PSBtID8gayA9IEQgOiBtLnNpYmxpbmcgPSBEOwogICAgICBtID0gRDsKICAgICAgdCA9IEE7CiAgICB9CgogICAgaWYgKHEuZG9uZSkgcmV0dXJuIGMoZSwgdCksIGs7CgogICAgaWYgKG51bGwgPT09IHQpIHsKICAgICAgZm9yICg7ICFxLmRvbmU7IHkrKywgcSA9IGgubmV4dCgpKSB7CiAgICAgICAgcSA9IHAoZSwgcS52YWx1ZSwgbCksIG51bGwgIT09IHEgJiYgKGcgPSBmKHEsIGcsIHkpLCBudWxsID09PSBtID8gayA9IHEgOiBtLnNpYmxpbmcgPSBxLCBtID0gcSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBrOwogICAgfQoKICAgIGZvciAodCA9IGQoZSwgdCk7ICFxLmRvbmU7IHkrKywgcSA9IGgubmV4dCgpKSB7CiAgICAgIHEgPSB6KHQsIGUsIHksIHEudmFsdWUsIGwpLCBudWxsICE9PSBxICYmIChhICYmIG51bGwgIT09IHEuYWx0ZXJuYXRlICYmIHQuZGVsZXRlKG51bGwgPT09IHEua2V5ID8geSA6IHEua2V5KSwgZyA9IGYocSwgZywgeSksIG51bGwgPT09IG0gPyBrID0gcSA6IG0uc2libGluZyA9IHEsIG0gPSBxKTsKICAgIH0KCiAgICBhICYmIHQuZm9yRWFjaChmdW5jdGlvbiAoYSkgewogICAgICByZXR1cm4gYihlLCBhKTsKICAgIH0pOwogICAgcmV0dXJuIGs7CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gKGEsIGQsIGYsIGgpIHsKICAgIHZhciBrID0gIm9iamVjdCIgPT09IF90eXBlb2YoZikgJiYgbnVsbCAhPT0gZiAmJiBmLnR5cGUgPT09IGFiICYmIG51bGwgPT09IGYua2V5OwogICAgayAmJiAoZiA9IGYucHJvcHMuY2hpbGRyZW4pOwogICAgdmFyIGwgPSAib2JqZWN0IiA9PT0gX3R5cGVvZihmKSAmJiBudWxsICE9PSBmOwogICAgaWYgKGwpIHN3aXRjaCAoZi4kJHR5cGVvZikgewogICAgICBjYXNlIFphOgogICAgICAgIGE6IHsKICAgICAgICAgIGwgPSBmLmtleTsKCiAgICAgICAgICBmb3IgKGsgPSBkOyBudWxsICE9PSBrOykgewogICAgICAgICAgICBpZiAoay5rZXkgPT09IGwpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKGsudGFnKSB7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgIGlmIChmLnR5cGUgPT09IGFiKSB7CiAgICAgICAgICAgICAgICAgICAgYyhhLCBrLnNpYmxpbmcpOwogICAgICAgICAgICAgICAgICAgIGQgPSBlKGssIGYucHJvcHMuY2hpbGRyZW4pOwogICAgICAgICAgICAgICAgICAgIGQucmV0dXJuID0gYTsKICAgICAgICAgICAgICAgICAgICBhID0gZDsKICAgICAgICAgICAgICAgICAgICBicmVhayBhOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBpZiAoay5lbGVtZW50VHlwZSA9PT0gZi50eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgYyhhLCBrLnNpYmxpbmcpOwogICAgICAgICAgICAgICAgICAgIGQgPSBlKGssIGYucHJvcHMpOwogICAgICAgICAgICAgICAgICAgIGQucmVmID0gUGcoYSwgaywgZik7CiAgICAgICAgICAgICAgICAgICAgZC5yZXR1cm4gPSBhOwogICAgICAgICAgICAgICAgICAgIGEgPSBkOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjKGEsIGspOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9IGVsc2UgYihhLCBrKTsKCiAgICAgICAgICAgIGsgPSBrLnNpYmxpbmc7CiAgICAgICAgICB9CgogICAgICAgICAgZi50eXBlID09PSBhYiA/IChkID0gV2coZi5wcm9wcy5jaGlsZHJlbiwgYS5tb2RlLCBoLCBmLmtleSksIGQucmV0dXJuID0gYSwgYSA9IGQpIDogKGggPSBVZyhmLnR5cGUsIGYua2V5LCBmLnByb3BzLCBudWxsLCBhLm1vZGUsIGgpLCBoLnJlZiA9IFBnKGEsIGQsIGYpLCBoLnJldHVybiA9IGEsIGEgPSBoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBnKGEpOwoKICAgICAgY2FzZSAkYToKICAgICAgICBhOiB7CiAgICAgICAgICBmb3IgKGsgPSBmLmtleTsgbnVsbCAhPT0gZDspIHsKICAgICAgICAgICAgaWYgKGQua2V5ID09PSBrKSB7CiAgICAgICAgICAgICAgaWYgKDQgPT09IGQudGFnICYmIGQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gPT09IGYuY29udGFpbmVySW5mbyAmJiBkLnN0YXRlTm9kZS5pbXBsZW1lbnRhdGlvbiA9PT0gZi5pbXBsZW1lbnRhdGlvbikgewogICAgICAgICAgICAgICAgYyhhLCBkLnNpYmxpbmcpOwogICAgICAgICAgICAgICAgZCA9IGUoZCwgZi5jaGlsZHJlbiB8fCBbXSk7CiAgICAgICAgICAgICAgICBkLnJldHVybiA9IGE7CiAgICAgICAgICAgICAgICBhID0gZDsKICAgICAgICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGMoYSwgZCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBiKGEsIGQpOwogICAgICAgICAgICBkID0gZC5zaWJsaW5nOwogICAgICAgICAgfQoKICAgICAgICAgIGQgPSBWZyhmLCBhLm1vZGUsIGgpOwogICAgICAgICAgZC5yZXR1cm4gPSBhOwogICAgICAgICAgYSA9IGQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZyhhKTsKICAgIH0KICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGYgfHwgIm51bWJlciIgPT09IHR5cGVvZiBmKSByZXR1cm4gZiA9ICIiICsgZiwgbnVsbCAhPT0gZCAmJiA2ID09PSBkLnRhZyA/IChjKGEsIGQuc2libGluZyksIGQgPSBlKGQsIGYpLCBkLnJldHVybiA9IGEsIGEgPSBkKSA6IChjKGEsIGQpLCBkID0gVGcoZiwgYS5tb2RlLCBoKSwgZC5yZXR1cm4gPSBhLCBhID0gZCksIGcoYSk7CiAgICBpZiAoT2coZikpIHJldHVybiBjYShhLCBkLCBmLCBoKTsKICAgIGlmIChuYihmKSkgcmV0dXJuIEQoYSwgZCwgZiwgaCk7CiAgICBsICYmIFFnKGEsIGYpOwogICAgaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgZiAmJiAhaykgc3dpdGNoIChhLnRhZykgewogICAgICBjYXNlIDE6CiAgICAgIGNhc2UgMDoKICAgICAgICB0aHJvdyBhID0gYS50eXBlLCBFcnJvcih1KDE1MiwgYS5kaXNwbGF5TmFtZSB8fCBhLm5hbWUgfHwgIkNvbXBvbmVudCIpKTsKICAgIH0KICAgIHJldHVybiBjKGEsIGQpOwogIH07Cn0KCnZhciBYZyA9IFJnKCEwKSwKICAgIFlnID0gUmcoITEpLAogICAgWmcgPSB7fSwKICAgICRnID0gewogIGN1cnJlbnQ6IFpnCn0sCiAgICBhaCA9IHsKICBjdXJyZW50OiBaZwp9LAogICAgYmggPSB7CiAgY3VycmVudDogWmcKfTsKCmZ1bmN0aW9uIGNoKGEpIHsKICBpZiAoYSA9PT0gWmcpIHRocm93IEVycm9yKHUoMTc0KSk7CiAgcmV0dXJuIGE7Cn0KCmZ1bmN0aW9uIGRoKGEsIGIpIHsKICBJKGJoLCBiKTsKICBJKGFoLCBhKTsKICBJKCRnLCBaZyk7CiAgYSA9IGIubm9kZVR5cGU7CgogIHN3aXRjaCAoYSkgewogICAgY2FzZSA5OgogICAgY2FzZSAxMToKICAgICAgYiA9IChiID0gYi5kb2N1bWVudEVsZW1lbnQpID8gYi5uYW1lc3BhY2VVUkkgOiBPYihudWxsLCAiIik7CiAgICAgIGJyZWFrOwoKICAgIGRlZmF1bHQ6CiAgICAgIGEgPSA4ID09PSBhID8gYi5wYXJlbnROb2RlIDogYiwgYiA9IGEubmFtZXNwYWNlVVJJIHx8IG51bGwsIGEgPSBhLnRhZ05hbWUsIGIgPSBPYihiLCBhKTsKICB9CgogIEgoJGcpOwogIEkoJGcsIGIpOwp9CgpmdW5jdGlvbiBlaCgpIHsKICBIKCRnKTsKICBIKGFoKTsKICBIKGJoKTsKfQoKZnVuY3Rpb24gZmgoYSkgewogIGNoKGJoLmN1cnJlbnQpOwogIHZhciBiID0gY2goJGcuY3VycmVudCk7CiAgdmFyIGMgPSBPYihiLCBhLnR5cGUpOwogIGIgIT09IGMgJiYgKEkoYWgsIGEpLCBJKCRnLCBjKSk7Cn0KCmZ1bmN0aW9uIGdoKGEpIHsKICBhaC5jdXJyZW50ID09PSBhICYmIChIKCRnKSwgSChhaCkpOwp9Cgp2YXIgTSA9IHsKICBjdXJyZW50OiAwCn07CgpmdW5jdGlvbiBoaChhKSB7CiAgZm9yICh2YXIgYiA9IGE7IG51bGwgIT09IGI7KSB7CiAgICBpZiAoMTMgPT09IGIudGFnKSB7CiAgICAgIHZhciBjID0gYi5tZW1vaXplZFN0YXRlOwogICAgICBpZiAobnVsbCAhPT0gYyAmJiAoYyA9IGMuZGVoeWRyYXRlZCwgbnVsbCA9PT0gYyB8fCBjLmRhdGEgPT09IEJkIHx8IGMuZGF0YSA9PT0gQ2QpKSByZXR1cm4gYjsKICAgIH0gZWxzZSBpZiAoMTkgPT09IGIudGFnICYmIHZvaWQgMCAhPT0gYi5tZW1vaXplZFByb3BzLnJldmVhbE9yZGVyKSB7CiAgICAgIGlmICgwICE9PSAoYi5lZmZlY3RUYWcgJiA2NCkpIHJldHVybiBiOwogICAgfSBlbHNlIGlmIChudWxsICE9PSBiLmNoaWxkKSB7CiAgICAgIGIuY2hpbGQucmV0dXJuID0gYjsKICAgICAgYiA9IGIuY2hpbGQ7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChiID09PSBhKSBicmVhazsKCiAgICBmb3IgKDsgbnVsbCA9PT0gYi5zaWJsaW5nOykgewogICAgICBpZiAobnVsbCA9PT0gYi5yZXR1cm4gfHwgYi5yZXR1cm4gPT09IGEpIHJldHVybiBudWxsOwogICAgICBiID0gYi5yZXR1cm47CiAgICB9CgogICAgYi5zaWJsaW5nLnJldHVybiA9IGIucmV0dXJuOwogICAgYiA9IGIuc2libGluZzsKICB9CgogIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBpaChhLCBiKSB7CiAgcmV0dXJuIHsKICAgIHJlc3BvbmRlcjogYSwKICAgIHByb3BzOiBiCiAgfTsKfQoKdmFyIGpoID0gV2EuUmVhY3RDdXJyZW50RGlzcGF0Y2hlciwKICAgIGtoID0gV2EuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsCiAgICBsaCA9IDAsCiAgICBOID0gbnVsbCwKICAgIE8gPSBudWxsLAogICAgUCA9IG51bGwsCiAgICBtaCA9ICExOwoKZnVuY3Rpb24gUSgpIHsKICB0aHJvdyBFcnJvcih1KDMyMSkpOwp9CgpmdW5jdGlvbiBuaChhLCBiKSB7CiAgaWYgKG51bGwgPT09IGIpIHJldHVybiAhMTsKCiAgZm9yICh2YXIgYyA9IDA7IGMgPCBiLmxlbmd0aCAmJiBjIDwgYS5sZW5ndGg7IGMrKykgewogICAgaWYgKCEkZShhW2NdLCBiW2NdKSkgcmV0dXJuICExOwogIH0KCiAgcmV0dXJuICEwOwp9CgpmdW5jdGlvbiBvaChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgbGggPSBmOwogIE4gPSBiOwogIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGw7CiAgYi51cGRhdGVRdWV1ZSA9IG51bGw7CiAgYi5leHBpcmF0aW9uVGltZSA9IDA7CiAgamguY3VycmVudCA9IG51bGwgPT09IGEgfHwgbnVsbCA9PT0gYS5tZW1vaXplZFN0YXRlID8gcGggOiBxaDsKICBhID0gYyhkLCBlKTsKCiAgaWYgKGIuZXhwaXJhdGlvblRpbWUgPT09IGxoKSB7CiAgICBmID0gMDsKCiAgICBkbyB7CiAgICAgIGIuZXhwaXJhdGlvblRpbWUgPSAwOwogICAgICBpZiAoISgyNSA+IGYpKSB0aHJvdyBFcnJvcih1KDMwMSkpOwogICAgICBmICs9IDE7CiAgICAgIFAgPSBPID0gbnVsbDsKICAgICAgYi51cGRhdGVRdWV1ZSA9IG51bGw7CiAgICAgIGpoLmN1cnJlbnQgPSByaDsKICAgICAgYSA9IGMoZCwgZSk7CiAgICB9IHdoaWxlIChiLmV4cGlyYXRpb25UaW1lID09PSBsaCk7CiAgfQoKICBqaC5jdXJyZW50ID0gc2g7CiAgYiA9IG51bGwgIT09IE8gJiYgbnVsbCAhPT0gTy5uZXh0OwogIGxoID0gMDsKICBQID0gTyA9IE4gPSBudWxsOwogIG1oID0gITE7CiAgaWYgKGIpIHRocm93IEVycm9yKHUoMzAwKSk7CiAgcmV0dXJuIGE7Cn0KCmZ1bmN0aW9uIHRoKCkgewogIHZhciBhID0gewogICAgbWVtb2l6ZWRTdGF0ZTogbnVsbCwKICAgIGJhc2VTdGF0ZTogbnVsbCwKICAgIGJhc2VRdWV1ZTogbnVsbCwKICAgIHF1ZXVlOiBudWxsLAogICAgbmV4dDogbnVsbAogIH07CiAgbnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA9IFAgPSBhIDogUCA9IFAubmV4dCA9IGE7CiAgcmV0dXJuIFA7Cn0KCmZ1bmN0aW9uIHVoKCkgewogIGlmIChudWxsID09PSBPKSB7CiAgICB2YXIgYSA9IE4uYWx0ZXJuYXRlOwogICAgYSA9IG51bGwgIT09IGEgPyBhLm1lbW9pemVkU3RhdGUgOiBudWxsOwogIH0gZWxzZSBhID0gTy5uZXh0OwoKICB2YXIgYiA9IG51bGwgPT09IFAgPyBOLm1lbW9pemVkU3RhdGUgOiBQLm5leHQ7CiAgaWYgKG51bGwgIT09IGIpIFAgPSBiLCBPID0gYTtlbHNlIHsKICAgIGlmIChudWxsID09PSBhKSB0aHJvdyBFcnJvcih1KDMxMCkpOwogICAgTyA9IGE7CiAgICBhID0gewogICAgICBtZW1vaXplZFN0YXRlOiBPLm1lbW9pemVkU3RhdGUsCiAgICAgIGJhc2VTdGF0ZTogTy5iYXNlU3RhdGUsCiAgICAgIGJhc2VRdWV1ZTogTy5iYXNlUXVldWUsCiAgICAgIHF1ZXVlOiBPLnF1ZXVlLAogICAgICBuZXh0OiBudWxsCiAgICB9OwogICAgbnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA9IFAgPSBhIDogUCA9IFAubmV4dCA9IGE7CiAgfQogIHJldHVybiBQOwp9CgpmdW5jdGlvbiB2aChhLCBiKSB7CiAgcmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBiID8gYihhKSA6IGI7Cn0KCmZ1bmN0aW9uIHdoKGEpIHsKICB2YXIgYiA9IHVoKCksCiAgICAgIGMgPSBiLnF1ZXVlOwogIGlmIChudWxsID09PSBjKSB0aHJvdyBFcnJvcih1KDMxMSkpOwogIGMubGFzdFJlbmRlcmVkUmVkdWNlciA9IGE7CiAgdmFyIGQgPSBPLAogICAgICBlID0gZC5iYXNlUXVldWUsCiAgICAgIGYgPSBjLnBlbmRpbmc7CgogIGlmIChudWxsICE9PSBmKSB7CiAgICBpZiAobnVsbCAhPT0gZSkgewogICAgICB2YXIgZyA9IGUubmV4dDsKICAgICAgZS5uZXh0ID0gZi5uZXh0OwogICAgICBmLm5leHQgPSBnOwogICAgfQoKICAgIGQuYmFzZVF1ZXVlID0gZSA9IGY7CiAgICBjLnBlbmRpbmcgPSBudWxsOwogIH0KCiAgaWYgKG51bGwgIT09IGUpIHsKICAgIGUgPSBlLm5leHQ7CiAgICBkID0gZC5iYXNlU3RhdGU7CiAgICB2YXIgaCA9IGcgPSBmID0gbnVsbCwKICAgICAgICBrID0gZTsKCiAgICBkbyB7CiAgICAgIHZhciBsID0gay5leHBpcmF0aW9uVGltZTsKCiAgICAgIGlmIChsIDwgbGgpIHsKICAgICAgICB2YXIgbSA9IHsKICAgICAgICAgIGV4cGlyYXRpb25UaW1lOiBrLmV4cGlyYXRpb25UaW1lLAogICAgICAgICAgc3VzcGVuc2VDb25maWc6IGsuc3VzcGVuc2VDb25maWcsCiAgICAgICAgICBhY3Rpb246IGsuYWN0aW9uLAogICAgICAgICAgZWFnZXJSZWR1Y2VyOiBrLmVhZ2VyUmVkdWNlciwKICAgICAgICAgIGVhZ2VyU3RhdGU6IGsuZWFnZXJTdGF0ZSwKICAgICAgICAgIG5leHQ6IG51bGwKICAgICAgICB9OwogICAgICAgIG51bGwgPT09IGggPyAoZyA9IGggPSBtLCBmID0gZCkgOiBoID0gaC5uZXh0ID0gbTsKICAgICAgICBsID4gTi5leHBpcmF0aW9uVGltZSAmJiAoTi5leHBpcmF0aW9uVGltZSA9IGwsIEJnKGwpKTsKICAgICAgfSBlbHNlIG51bGwgIT09IGggJiYgKGggPSBoLm5leHQgPSB7CiAgICAgICAgZXhwaXJhdGlvblRpbWU6IDEwNzM3NDE4MjMsCiAgICAgICAgc3VzcGVuc2VDb25maWc6IGsuc3VzcGVuc2VDb25maWcsCiAgICAgICAgYWN0aW9uOiBrLmFjdGlvbiwKICAgICAgICBlYWdlclJlZHVjZXI6IGsuZWFnZXJSZWR1Y2VyLAogICAgICAgIGVhZ2VyU3RhdGU6IGsuZWFnZXJTdGF0ZSwKICAgICAgICBuZXh0OiBudWxsCiAgICAgIH0pLCBBZyhsLCBrLnN1c3BlbnNlQ29uZmlnKSwgZCA9IGsuZWFnZXJSZWR1Y2VyID09PSBhID8gay5lYWdlclN0YXRlIDogYShkLCBrLmFjdGlvbik7CgogICAgICBrID0gay5uZXh0OwogICAgfSB3aGlsZSAobnVsbCAhPT0gayAmJiBrICE9PSBlKTsKCiAgICBudWxsID09PSBoID8gZiA9IGQgOiBoLm5leHQgPSBnOwogICAgJGUoZCwgYi5tZW1vaXplZFN0YXRlKSB8fCAocmcgPSAhMCk7CiAgICBiLm1lbW9pemVkU3RhdGUgPSBkOwogICAgYi5iYXNlU3RhdGUgPSBmOwogICAgYi5iYXNlUXVldWUgPSBoOwogICAgYy5sYXN0UmVuZGVyZWRTdGF0ZSA9IGQ7CiAgfQoKICByZXR1cm4gW2IubWVtb2l6ZWRTdGF0ZSwgYy5kaXNwYXRjaF07Cn0KCmZ1bmN0aW9uIHhoKGEpIHsKICB2YXIgYiA9IHVoKCksCiAgICAgIGMgPSBiLnF1ZXVlOwogIGlmIChudWxsID09PSBjKSB0aHJvdyBFcnJvcih1KDMxMSkpOwogIGMubGFzdFJlbmRlcmVkUmVkdWNlciA9IGE7CiAgdmFyIGQgPSBjLmRpc3BhdGNoLAogICAgICBlID0gYy5wZW5kaW5nLAogICAgICBmID0gYi5tZW1vaXplZFN0YXRlOwoKICBpZiAobnVsbCAhPT0gZSkgewogICAgYy5wZW5kaW5nID0gbnVsbDsKICAgIHZhciBnID0gZSA9IGUubmV4dDsKCiAgICBkbyB7CiAgICAgIGYgPSBhKGYsIGcuYWN0aW9uKSwgZyA9IGcubmV4dDsKICAgIH0gd2hpbGUgKGcgIT09IGUpOwoKICAgICRlKGYsIGIubWVtb2l6ZWRTdGF0ZSkgfHwgKHJnID0gITApOwogICAgYi5tZW1vaXplZFN0YXRlID0gZjsKICAgIG51bGwgPT09IGIuYmFzZVF1ZXVlICYmIChiLmJhc2VTdGF0ZSA9IGYpOwogICAgYy5sYXN0UmVuZGVyZWRTdGF0ZSA9IGY7CiAgfQoKICByZXR1cm4gW2YsIGRdOwp9CgpmdW5jdGlvbiB5aChhKSB7CiAgdmFyIGIgPSB0aCgpOwogICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhICYmIChhID0gYSgpKTsKICBiLm1lbW9pemVkU3RhdGUgPSBiLmJhc2VTdGF0ZSA9IGE7CiAgYSA9IGIucXVldWUgPSB7CiAgICBwZW5kaW5nOiBudWxsLAogICAgZGlzcGF0Y2g6IG51bGwsCiAgICBsYXN0UmVuZGVyZWRSZWR1Y2VyOiB2aCwKICAgIGxhc3RSZW5kZXJlZFN0YXRlOiBhCiAgfTsKICBhID0gYS5kaXNwYXRjaCA9IHpoLmJpbmQobnVsbCwgTiwgYSk7CiAgcmV0dXJuIFtiLm1lbW9pemVkU3RhdGUsIGFdOwp9CgpmdW5jdGlvbiBBaChhLCBiLCBjLCBkKSB7CiAgYSA9IHsKICAgIHRhZzogYSwKICAgIGNyZWF0ZTogYiwKICAgIGRlc3Ryb3k6IGMsCiAgICBkZXBzOiBkLAogICAgbmV4dDogbnVsbAogIH07CiAgYiA9IE4udXBkYXRlUXVldWU7CiAgbnVsbCA9PT0gYiA/IChiID0gewogICAgbGFzdEVmZmVjdDogbnVsbAogIH0sIE4udXBkYXRlUXVldWUgPSBiLCBiLmxhc3RFZmZlY3QgPSBhLm5leHQgPSBhKSA6IChjID0gYi5sYXN0RWZmZWN0LCBudWxsID09PSBjID8gYi5sYXN0RWZmZWN0ID0gYS5uZXh0ID0gYSA6IChkID0gYy5uZXh0LCBjLm5leHQgPSBhLCBhLm5leHQgPSBkLCBiLmxhc3RFZmZlY3QgPSBhKSk7CiAgcmV0dXJuIGE7Cn0KCmZ1bmN0aW9uIEJoKCkgewogIHJldHVybiB1aCgpLm1lbW9pemVkU3RhdGU7Cn0KCmZ1bmN0aW9uIENoKGEsIGIsIGMsIGQpIHsKICB2YXIgZSA9IHRoKCk7CiAgTi5lZmZlY3RUYWcgfD0gYTsKICBlLm1lbW9pemVkU3RhdGUgPSBBaCgxIHwgYiwgYywgdm9pZCAwLCB2b2lkIDAgPT09IGQgPyBudWxsIDogZCk7Cn0KCmZ1bmN0aW9uIERoKGEsIGIsIGMsIGQpIHsKICB2YXIgZSA9IHVoKCk7CiAgZCA9IHZvaWQgMCA9PT0gZCA/IG51bGwgOiBkOwogIHZhciBmID0gdm9pZCAwOwoKICBpZiAobnVsbCAhPT0gTykgewogICAgdmFyIGcgPSBPLm1lbW9pemVkU3RhdGU7CiAgICBmID0gZy5kZXN0cm95OwoKICAgIGlmIChudWxsICE9PSBkICYmIG5oKGQsIGcuZGVwcykpIHsKICAgICAgQWgoYiwgYywgZiwgZCk7CiAgICAgIHJldHVybjsKICAgIH0KICB9CgogIE4uZWZmZWN0VGFnIHw9IGE7CiAgZS5tZW1vaXplZFN0YXRlID0gQWgoMSB8IGIsIGMsIGYsIGQpOwp9CgpmdW5jdGlvbiBFaChhLCBiKSB7CiAgcmV0dXJuIENoKDUxNiwgNCwgYSwgYik7Cn0KCmZ1bmN0aW9uIEZoKGEsIGIpIHsKICByZXR1cm4gRGgoNTE2LCA0LCBhLCBiKTsKfQoKZnVuY3Rpb24gR2goYSwgYikgewogIHJldHVybiBEaCg0LCAyLCBhLCBiKTsKfQoKZnVuY3Rpb24gSGgoYSwgYikgewogIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYikgcmV0dXJuIGEgPSBhKCksIGIoYSksIGZ1bmN0aW9uICgpIHsKICAgIGIobnVsbCk7CiAgfTsKICBpZiAobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpIHJldHVybiBhID0gYSgpLCBiLmN1cnJlbnQgPSBhLCBmdW5jdGlvbiAoKSB7CiAgICBiLmN1cnJlbnQgPSBudWxsOwogIH07Cn0KCmZ1bmN0aW9uIEloKGEsIGIsIGMpIHsKICBjID0gbnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgPyBjLmNvbmNhdChbYV0pIDogbnVsbDsKICByZXR1cm4gRGgoNCwgMiwgSGguYmluZChudWxsLCBiLCBhKSwgYyk7Cn0KCmZ1bmN0aW9uIEpoKCkge30KCmZ1bmN0aW9uIEtoKGEsIGIpIHsKICB0aCgpLm1lbW9pemVkU3RhdGUgPSBbYSwgdm9pZCAwID09PSBiID8gbnVsbCA6IGJdOwogIHJldHVybiBhOwp9CgpmdW5jdGlvbiBMaChhLCBiKSB7CiAgdmFyIGMgPSB1aCgpOwogIGIgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjsKICB2YXIgZCA9IGMubWVtb2l6ZWRTdGF0ZTsKICBpZiAobnVsbCAhPT0gZCAmJiBudWxsICE9PSBiICYmIG5oKGIsIGRbMV0pKSByZXR1cm4gZFswXTsKICBjLm1lbW9pemVkU3RhdGUgPSBbYSwgYl07CiAgcmV0dXJuIGE7Cn0KCmZ1bmN0aW9uIE1oKGEsIGIpIHsKICB2YXIgYyA9IHVoKCk7CiAgYiA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiOwogIHZhciBkID0gYy5tZW1vaXplZFN0YXRlOwogIGlmIChudWxsICE9PSBkICYmIG51bGwgIT09IGIgJiYgbmgoYiwgZFsxXSkpIHJldHVybiBkWzBdOwogIGEgPSBhKCk7CiAgYy5tZW1vaXplZFN0YXRlID0gW2EsIGJdOwogIHJldHVybiBhOwp9CgpmdW5jdGlvbiBOaChhLCBiLCBjKSB7CiAgdmFyIGQgPSBhZygpOwogIGNnKDk4ID4gZCA/IDk4IDogZCwgZnVuY3Rpb24gKCkgewogICAgYSghMCk7CiAgfSk7CiAgY2coOTcgPCBkID8gOTcgOiBkLCBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZCA9IGtoLnN1c3BlbnNlOwogICAga2guc3VzcGVuc2UgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjsKCiAgICB0cnkgewogICAgICBhKCExKSwgYygpOwogICAgfSBmaW5hbGx5IHsKICAgICAga2guc3VzcGVuc2UgPSBkOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiB6aChhLCBiLCBjKSB7CiAgdmFyIGQgPSBHZygpLAogICAgICBlID0gRGcuc3VzcGVuc2U7CiAgZCA9IEhnKGQsIGEsIGUpOwogIGUgPSB7CiAgICBleHBpcmF0aW9uVGltZTogZCwKICAgIHN1c3BlbnNlQ29uZmlnOiBlLAogICAgYWN0aW9uOiBjLAogICAgZWFnZXJSZWR1Y2VyOiBudWxsLAogICAgZWFnZXJTdGF0ZTogbnVsbCwKICAgIG5leHQ6IG51bGwKICB9OwogIHZhciBmID0gYi5wZW5kaW5nOwogIG51bGwgPT09IGYgPyBlLm5leHQgPSBlIDogKGUubmV4dCA9IGYubmV4dCwgZi5uZXh0ID0gZSk7CiAgYi5wZW5kaW5nID0gZTsKICBmID0gYS5hbHRlcm5hdGU7CiAgaWYgKGEgPT09IE4gfHwgbnVsbCAhPT0gZiAmJiBmID09PSBOKSBtaCA9ICEwLCBlLmV4cGlyYXRpb25UaW1lID0gbGgsIE4uZXhwaXJhdGlvblRpbWUgPSBsaDtlbHNlIHsKICAgIGlmICgwID09PSBhLmV4cGlyYXRpb25UaW1lICYmIChudWxsID09PSBmIHx8IDAgPT09IGYuZXhwaXJhdGlvblRpbWUpICYmIChmID0gYi5sYXN0UmVuZGVyZWRSZWR1Y2VyLCBudWxsICE9PSBmKSkgdHJ5IHsKICAgICAgdmFyIGcgPSBiLmxhc3RSZW5kZXJlZFN0YXRlLAogICAgICAgICAgaCA9IGYoZywgYyk7CiAgICAgIGUuZWFnZXJSZWR1Y2VyID0gZjsKICAgICAgZS5lYWdlclN0YXRlID0gaDsKICAgICAgaWYgKCRlKGgsIGcpKSByZXR1cm47CiAgICB9IGNhdGNoIChrKSB7fSBmaW5hbGx5IHt9CiAgICBJZyhhLCBkKTsKICB9Cn0KCnZhciBzaCA9IHsKICByZWFkQ29udGV4dDogc2csCiAgdXNlQ2FsbGJhY2s6IFEsCiAgdXNlQ29udGV4dDogUSwKICB1c2VFZmZlY3Q6IFEsCiAgdXNlSW1wZXJhdGl2ZUhhbmRsZTogUSwKICB1c2VMYXlvdXRFZmZlY3Q6IFEsCiAgdXNlTWVtbzogUSwKICB1c2VSZWR1Y2VyOiBRLAogIHVzZVJlZjogUSwKICB1c2VTdGF0ZTogUSwKICB1c2VEZWJ1Z1ZhbHVlOiBRLAogIHVzZVJlc3BvbmRlcjogUSwKICB1c2VEZWZlcnJlZFZhbHVlOiBRLAogIHVzZVRyYW5zaXRpb246IFEKfSwKICAgIHBoID0gewogIHJlYWRDb250ZXh0OiBzZywKICB1c2VDYWxsYmFjazogS2gsCiAgdXNlQ29udGV4dDogc2csCiAgdXNlRWZmZWN0OiBFaCwKICB1c2VJbXBlcmF0aXZlSGFuZGxlOiBmdW5jdGlvbiB1c2VJbXBlcmF0aXZlSGFuZGxlKGEsIGIsIGMpIHsKICAgIGMgPSBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyA/IGMuY29uY2F0KFthXSkgOiBudWxsOwogICAgcmV0dXJuIENoKDQsIDIsIEhoLmJpbmQobnVsbCwgYiwgYSksIGMpOwogIH0sCiAgdXNlTGF5b3V0RWZmZWN0OiBmdW5jdGlvbiB1c2VMYXlvdXRFZmZlY3QoYSwgYikgewogICAgcmV0dXJuIENoKDQsIDIsIGEsIGIpOwogIH0sCiAgdXNlTWVtbzogZnVuY3Rpb24gdXNlTWVtbyhhLCBiKSB7CiAgICB2YXIgYyA9IHRoKCk7CiAgICBiID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7CiAgICBhID0gYSgpOwogICAgYy5tZW1vaXplZFN0YXRlID0gW2EsIGJdOwogICAgcmV0dXJuIGE7CiAgfSwKICB1c2VSZWR1Y2VyOiBmdW5jdGlvbiB1c2VSZWR1Y2VyKGEsIGIsIGMpIHsKICAgIHZhciBkID0gdGgoKTsKICAgIGIgPSB2b2lkIDAgIT09IGMgPyBjKGIpIDogYjsKICAgIGQubWVtb2l6ZWRTdGF0ZSA9IGQuYmFzZVN0YXRlID0gYjsKICAgIGEgPSBkLnF1ZXVlID0gewogICAgICBwZW5kaW5nOiBudWxsLAogICAgICBkaXNwYXRjaDogbnVsbCwKICAgICAgbGFzdFJlbmRlcmVkUmVkdWNlcjogYSwKICAgICAgbGFzdFJlbmRlcmVkU3RhdGU6IGIKICAgIH07CiAgICBhID0gYS5kaXNwYXRjaCA9IHpoLmJpbmQobnVsbCwgTiwgYSk7CiAgICByZXR1cm4gW2QubWVtb2l6ZWRTdGF0ZSwgYV07CiAgfSwKICB1c2VSZWY6IGZ1bmN0aW9uIHVzZVJlZihhKSB7CiAgICB2YXIgYiA9IHRoKCk7CiAgICBhID0gewogICAgICBjdXJyZW50OiBhCiAgICB9OwogICAgcmV0dXJuIGIubWVtb2l6ZWRTdGF0ZSA9IGE7CiAgfSwKICB1c2VTdGF0ZTogeWgsCiAgdXNlRGVidWdWYWx1ZTogSmgsCiAgdXNlUmVzcG9uZGVyOiBpaCwKICB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEsIGIpIHsKICAgIHZhciBjID0geWgoYSksCiAgICAgICAgZCA9IGNbMF0sCiAgICAgICAgZSA9IGNbMV07CiAgICBFaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjID0ga2guc3VzcGVuc2U7CiAgICAgIGtoLnN1c3BlbnNlID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7CgogICAgICB0cnkgewogICAgICAgIGUoYSk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAga2guc3VzcGVuc2UgPSBjOwogICAgICB9CiAgICB9LCBbYSwgYl0pOwogICAgcmV0dXJuIGQ7CiAgfSwKICB1c2VUcmFuc2l0aW9uOiBmdW5jdGlvbiB1c2VUcmFuc2l0aW9uKGEpIHsKICAgIHZhciBiID0geWgoITEpLAogICAgICAgIGMgPSBiWzBdOwogICAgYiA9IGJbMV07CiAgICByZXR1cm4gW0toKE5oLmJpbmQobnVsbCwgYiwgYSksIFtiLCBhXSksIGNdOwogIH0KfSwKICAgIHFoID0gewogIHJlYWRDb250ZXh0OiBzZywKICB1c2VDYWxsYmFjazogTGgsCiAgdXNlQ29udGV4dDogc2csCiAgdXNlRWZmZWN0OiBGaCwKICB1c2VJbXBlcmF0aXZlSGFuZGxlOiBJaCwKICB1c2VMYXlvdXRFZmZlY3Q6IEdoLAogIHVzZU1lbW86IE1oLAogIHVzZVJlZHVjZXI6IHdoLAogIHVzZVJlZjogQmgsCiAgdXNlU3RhdGU6IGZ1bmN0aW9uIHVzZVN0YXRlKCkgewogICAgcmV0dXJuIHdoKHZoKTsKICB9LAogIHVzZURlYnVnVmFsdWU6IEpoLAogIHVzZVJlc3BvbmRlcjogaWgsCiAgdXNlRGVmZXJyZWRWYWx1ZTogZnVuY3Rpb24gdXNlRGVmZXJyZWRWYWx1ZShhLCBiKSB7CiAgICB2YXIgYyA9IHdoKHZoKSwKICAgICAgICBkID0gY1swXSwKICAgICAgICBlID0gY1sxXTsKICAgIEZoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGMgPSBraC5zdXNwZW5zZTsKICAgICAga2guc3VzcGVuc2UgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjsKCiAgICAgIHRyeSB7CiAgICAgICAgZShhKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBraC5zdXNwZW5zZSA9IGM7CiAgICAgIH0KICAgIH0sIFthLCBiXSk7CiAgICByZXR1cm4gZDsKICB9LAogIHVzZVRyYW5zaXRpb246IGZ1bmN0aW9uIHVzZVRyYW5zaXRpb24oYSkgewogICAgdmFyIGIgPSB3aCh2aCksCiAgICAgICAgYyA9IGJbMF07CiAgICBiID0gYlsxXTsKICAgIHJldHVybiBbTGgoTmguYmluZChudWxsLCBiLCBhKSwgW2IsIGFdKSwgY107CiAgfQp9LAogICAgcmggPSB7CiAgcmVhZENvbnRleHQ6IHNnLAogIHVzZUNhbGxiYWNrOiBMaCwKICB1c2VDb250ZXh0OiBzZywKICB1c2VFZmZlY3Q6IEZoLAogIHVzZUltcGVyYXRpdmVIYW5kbGU6IEloLAogIHVzZUxheW91dEVmZmVjdDogR2gsCiAgdXNlTWVtbzogTWgsCiAgdXNlUmVkdWNlcjogeGgsCiAgdXNlUmVmOiBCaCwKICB1c2VTdGF0ZTogZnVuY3Rpb24gdXNlU3RhdGUoKSB7CiAgICByZXR1cm4geGgodmgpOwogIH0sCiAgdXNlRGVidWdWYWx1ZTogSmgsCiAgdXNlUmVzcG9uZGVyOiBpaCwKICB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEsIGIpIHsKICAgIHZhciBjID0geGgodmgpLAogICAgICAgIGQgPSBjWzBdLAogICAgICAgIGUgPSBjWzFdOwogICAgRmgoZnVuY3Rpb24gKCkgewogICAgICB2YXIgYyA9IGtoLnN1c3BlbnNlOwogICAgICBraC5zdXNwZW5zZSA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiOwoKICAgICAgdHJ5IHsKICAgICAgICBlKGEpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGtoLnN1c3BlbnNlID0gYzsKICAgICAgfQogICAgfSwgW2EsIGJdKTsKICAgIHJldHVybiBkOwogIH0sCiAgdXNlVHJhbnNpdGlvbjogZnVuY3Rpb24gdXNlVHJhbnNpdGlvbihhKSB7CiAgICB2YXIgYiA9IHhoKHZoKSwKICAgICAgICBjID0gYlswXTsKICAgIGIgPSBiWzFdOwogICAgcmV0dXJuIFtMaChOaC5iaW5kKG51bGwsIGIsIGEpLCBbYiwgYV0pLCBjXTsKICB9Cn0sCiAgICBPaCA9IG51bGwsCiAgICBQaCA9IG51bGwsCiAgICBRaCA9ICExOwoKZnVuY3Rpb24gUmgoYSwgYikgewogIHZhciBjID0gU2goNSwgbnVsbCwgbnVsbCwgMCk7CiAgYy5lbGVtZW50VHlwZSA9ICJERUxFVEVEIjsKICBjLnR5cGUgPSAiREVMRVRFRCI7CiAgYy5zdGF0ZU5vZGUgPSBiOwogIGMucmV0dXJuID0gYTsKICBjLmVmZmVjdFRhZyA9IDg7CiAgbnVsbCAhPT0gYS5sYXN0RWZmZWN0ID8gKGEubGFzdEVmZmVjdC5uZXh0RWZmZWN0ID0gYywgYS5sYXN0RWZmZWN0ID0gYykgOiBhLmZpcnN0RWZmZWN0ID0gYS5sYXN0RWZmZWN0ID0gYzsKfQoKZnVuY3Rpb24gVGgoYSwgYikgewogIHN3aXRjaCAoYS50YWcpIHsKICAgIGNhc2UgNToKICAgICAgdmFyIGMgPSBhLnR5cGU7CiAgICAgIGIgPSAxICE9PSBiLm5vZGVUeXBlIHx8IGMudG9Mb3dlckNhc2UoKSAhPT0gYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID8gbnVsbCA6IGI7CiAgICAgIHJldHVybiBudWxsICE9PSBiID8gKGEuc3RhdGVOb2RlID0gYiwgITApIDogITE7CgogICAgY2FzZSA2OgogICAgICByZXR1cm4gYiA9ICIiID09PSBhLnBlbmRpbmdQcm9wcyB8fCAzICE9PSBiLm5vZGVUeXBlID8gbnVsbCA6IGIsIG51bGwgIT09IGIgPyAoYS5zdGF0ZU5vZGUgPSBiLCAhMCkgOiAhMTsKCiAgICBjYXNlIDEzOgogICAgICByZXR1cm4gITE7CgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuICExOwogIH0KfQoKZnVuY3Rpb24gVWgoYSkgewogIGlmIChRaCkgewogICAgdmFyIGIgPSBQaDsKCiAgICBpZiAoYikgewogICAgICB2YXIgYyA9IGI7CgogICAgICBpZiAoIVRoKGEsIGIpKSB7CiAgICAgICAgYiA9IEpkKGMubmV4dFNpYmxpbmcpOwoKICAgICAgICBpZiAoIWIgfHwgIVRoKGEsIGIpKSB7CiAgICAgICAgICBhLmVmZmVjdFRhZyA9IGEuZWZmZWN0VGFnICYgLTEwMjUgfCAyOwogICAgICAgICAgUWggPSAhMTsKICAgICAgICAgIE9oID0gYTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFJoKE9oLCBjKTsKICAgICAgfQoKICAgICAgT2ggPSBhOwogICAgICBQaCA9IEpkKGIuZmlyc3RDaGlsZCk7CiAgICB9IGVsc2UgYS5lZmZlY3RUYWcgPSBhLmVmZmVjdFRhZyAmIC0xMDI1IHwgMiwgUWggPSAhMSwgT2ggPSBhOwogIH0KfQoKZnVuY3Rpb24gVmgoYSkgewogIGZvciAoYSA9IGEucmV0dXJuOyBudWxsICE9PSBhICYmIDUgIT09IGEudGFnICYmIDMgIT09IGEudGFnICYmIDEzICE9PSBhLnRhZzspIHsKICAgIGEgPSBhLnJldHVybjsKICB9CgogIE9oID0gYTsKfQoKZnVuY3Rpb24gV2goYSkgewogIGlmIChhICE9PSBPaCkgcmV0dXJuICExOwogIGlmICghUWgpIHJldHVybiBWaChhKSwgUWggPSAhMCwgITE7CiAgdmFyIGIgPSBhLnR5cGU7CiAgaWYgKDUgIT09IGEudGFnIHx8ICJoZWFkIiAhPT0gYiAmJiAiYm9keSIgIT09IGIgJiYgIUdkKGIsIGEubWVtb2l6ZWRQcm9wcykpIGZvciAoYiA9IFBoOyBiOykgewogICAgUmgoYSwgYiksIGIgPSBKZChiLm5leHRTaWJsaW5nKTsKICB9CiAgVmgoYSk7CgogIGlmICgxMyA9PT0gYS50YWcpIHsKICAgIGEgPSBhLm1lbW9pemVkU3RhdGU7CiAgICBhID0gbnVsbCAhPT0gYSA/IGEuZGVoeWRyYXRlZCA6IG51bGw7CiAgICBpZiAoIWEpIHRocm93IEVycm9yKHUoMzE3KSk7CgogICAgYTogewogICAgICBhID0gYS5uZXh0U2libGluZzsKCiAgICAgIGZvciAoYiA9IDA7IGE7KSB7CiAgICAgICAgaWYgKDggPT09IGEubm9kZVR5cGUpIHsKICAgICAgICAgIHZhciBjID0gYS5kYXRhOwoKICAgICAgICAgIGlmIChjID09PSBBZCkgewogICAgICAgICAgICBpZiAoMCA9PT0gYikgewogICAgICAgICAgICAgIFBoID0gSmQoYS5uZXh0U2libGluZyk7CiAgICAgICAgICAgICAgYnJlYWsgYTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYi0tOwogICAgICAgICAgfSBlbHNlIGMgIT09IHpkICYmIGMgIT09IENkICYmIGMgIT09IEJkIHx8IGIrKzsKICAgICAgICB9CgogICAgICAgIGEgPSBhLm5leHRTaWJsaW5nOwogICAgICB9CgogICAgICBQaCA9IG51bGw7CiAgICB9CiAgfSBlbHNlIFBoID0gT2ggPyBKZChhLnN0YXRlTm9kZS5uZXh0U2libGluZykgOiBudWxsOwoKICByZXR1cm4gITA7Cn0KCmZ1bmN0aW9uIFhoKCkgewogIFBoID0gT2ggPSBudWxsOwogIFFoID0gITE7Cn0KCnZhciBZaCA9IFdhLlJlYWN0Q3VycmVudE93bmVyLAogICAgcmcgPSAhMTsKCmZ1bmN0aW9uIFIoYSwgYiwgYywgZCkgewogIGIuY2hpbGQgPSBudWxsID09PSBhID8gWWcoYiwgbnVsbCwgYywgZCkgOiBYZyhiLCBhLmNoaWxkLCBjLCBkKTsKfQoKZnVuY3Rpb24gWmgoYSwgYiwgYywgZCwgZSkgewogIGMgPSBjLnJlbmRlcjsKICB2YXIgZiA9IGIucmVmOwogIHFnKGIsIGUpOwogIGQgPSBvaChhLCBiLCBjLCBkLCBmLCBlKTsKICBpZiAobnVsbCAhPT0gYSAmJiAhcmcpIHJldHVybiBiLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZSwgYi5lZmZlY3RUYWcgJj0gLTUxNywgYS5leHBpcmF0aW9uVGltZSA8PSBlICYmIChhLmV4cGlyYXRpb25UaW1lID0gMCksICRoKGEsIGIsIGUpOwogIGIuZWZmZWN0VGFnIHw9IDE7CiAgUihhLCBiLCBkLCBlKTsKICByZXR1cm4gYi5jaGlsZDsKfQoKZnVuY3Rpb24gYWkoYSwgYiwgYywgZCwgZSwgZikgewogIGlmIChudWxsID09PSBhKSB7CiAgICB2YXIgZyA9IGMudHlwZTsKICAgIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZyAmJiAhYmkoZykgJiYgdm9pZCAwID09PSBnLmRlZmF1bHRQcm9wcyAmJiBudWxsID09PSBjLmNvbXBhcmUgJiYgdm9pZCAwID09PSBjLmRlZmF1bHRQcm9wcykgcmV0dXJuIGIudGFnID0gMTUsIGIudHlwZSA9IGcsIGNpKGEsIGIsIGcsIGQsIGUsIGYpOwogICAgYSA9IFVnKGMudHlwZSwgbnVsbCwgZCwgbnVsbCwgYi5tb2RlLCBmKTsKICAgIGEucmVmID0gYi5yZWY7CiAgICBhLnJldHVybiA9IGI7CiAgICByZXR1cm4gYi5jaGlsZCA9IGE7CiAgfQoKICBnID0gYS5jaGlsZDsKICBpZiAoZSA8IGYgJiYgKGUgPSBnLm1lbW9pemVkUHJvcHMsIGMgPSBjLmNvbXBhcmUsIGMgPSBudWxsICE9PSBjID8gYyA6IGJmLCBjKGUsIGQpICYmIGEucmVmID09PSBiLnJlZikpIHJldHVybiAkaChhLCBiLCBmKTsKICBiLmVmZmVjdFRhZyB8PSAxOwogIGEgPSBTZyhnLCBkKTsKICBhLnJlZiA9IGIucmVmOwogIGEucmV0dXJuID0gYjsKICByZXR1cm4gYi5jaGlsZCA9IGE7Cn0KCmZ1bmN0aW9uIGNpKGEsIGIsIGMsIGQsIGUsIGYpIHsKICByZXR1cm4gbnVsbCAhPT0gYSAmJiBiZihhLm1lbW9pemVkUHJvcHMsIGQpICYmIGEucmVmID09PSBiLnJlZiAmJiAocmcgPSAhMSwgZSA8IGYpID8gKGIuZXhwaXJhdGlvblRpbWUgPSBhLmV4cGlyYXRpb25UaW1lLCAkaChhLCBiLCBmKSkgOiBkaShhLCBiLCBjLCBkLCBmKTsKfQoKZnVuY3Rpb24gZWkoYSwgYikgewogIHZhciBjID0gYi5yZWY7CiAgaWYgKG51bGwgPT09IGEgJiYgbnVsbCAhPT0gYyB8fCBudWxsICE9PSBhICYmIGEucmVmICE9PSBjKSBiLmVmZmVjdFRhZyB8PSAxMjg7Cn0KCmZ1bmN0aW9uIGRpKGEsIGIsIGMsIGQsIGUpIHsKICB2YXIgZiA9IEwoYykgPyBCZiA6IEouY3VycmVudDsKICBmID0gQ2YoYiwgZik7CiAgcWcoYiwgZSk7CiAgYyA9IG9oKGEsIGIsIGMsIGQsIGYsIGUpOwogIGlmIChudWxsICE9PSBhICYmICFyZykgcmV0dXJuIGIudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlLCBiLmVmZmVjdFRhZyAmPSAtNTE3LCBhLmV4cGlyYXRpb25UaW1lIDw9IGUgJiYgKGEuZXhwaXJhdGlvblRpbWUgPSAwKSwgJGgoYSwgYiwgZSk7CiAgYi5lZmZlY3RUYWcgfD0gMTsKICBSKGEsIGIsIGMsIGUpOwogIHJldHVybiBiLmNoaWxkOwp9CgpmdW5jdGlvbiBmaShhLCBiLCBjLCBkLCBlKSB7CiAgaWYgKEwoYykpIHsKICAgIHZhciBmID0gITA7CiAgICBHZihiKTsKICB9IGVsc2UgZiA9ICExOwoKICBxZyhiLCBlKTsKICBpZiAobnVsbCA9PT0gYi5zdGF0ZU5vZGUpIG51bGwgIT09IGEgJiYgKGEuYWx0ZXJuYXRlID0gbnVsbCwgYi5hbHRlcm5hdGUgPSBudWxsLCBiLmVmZmVjdFRhZyB8PSAyKSwgTGcoYiwgYywgZCksIE5nKGIsIGMsIGQsIGUpLCBkID0gITA7ZWxzZSBpZiAobnVsbCA9PT0gYSkgewogICAgdmFyIGcgPSBiLnN0YXRlTm9kZSwKICAgICAgICBoID0gYi5tZW1vaXplZFByb3BzOwogICAgZy5wcm9wcyA9IGg7CiAgICB2YXIgayA9IGcuY29udGV4dCwKICAgICAgICBsID0gYy5jb250ZXh0VHlwZTsKICAgICJvYmplY3QiID09PSBfdHlwZW9mKGwpICYmIG51bGwgIT09IGwgPyBsID0gc2cobCkgOiAobCA9IEwoYykgPyBCZiA6IEouY3VycmVudCwgbCA9IENmKGIsIGwpKTsKICAgIHZhciBtID0gYy5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMsCiAgICAgICAgcCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBtIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlOwogICAgcCB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIHx8IChoICE9PSBkIHx8IGsgIT09IGwpICYmIE1nKGIsIGcsIGQsIGwpOwogICAgdGcgPSAhMTsKICAgIHZhciB4ID0gYi5tZW1vaXplZFN0YXRlOwogICAgZy5zdGF0ZSA9IHg7CiAgICB6ZyhiLCBkLCBnLCBlKTsKICAgIGsgPSBiLm1lbW9pemVkU3RhdGU7CiAgICBoICE9PSBkIHx8IHggIT09IGsgfHwgSy5jdXJyZW50IHx8IHRnID8gKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBtICYmIChGZyhiLCBjLCBtLCBkKSwgayA9IGIubWVtb2l6ZWRTdGF0ZSksIChoID0gdGcgfHwgS2coYiwgYywgaCwgZCwgeCwgaywgbCkpID8gKHAgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsTW91bnQgfHwgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxNb3VudCAmJiBnLmNvbXBvbmVudFdpbGxNb3VudCgpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQgJiYgKGIuZWZmZWN0VGFnIHw9IDQpKSA6ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5lZmZlY3RUYWcgfD0gNCksIGIubWVtb2l6ZWRQcm9wcyA9IGQsIGIubWVtb2l6ZWRTdGF0ZSA9IGspLCBnLnByb3BzID0gZCwgZy5zdGF0ZSA9IGssIGcuY29udGV4dCA9IGwsIGQgPSBoKSA6ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5lZmZlY3RUYWcgfD0gNCksIGQgPSAhMSk7CiAgfSBlbHNlIGcgPSBiLnN0YXRlTm9kZSwgdmcoYSwgYiksIGggPSBiLm1lbW9pemVkUHJvcHMsIGcucHJvcHMgPSBiLnR5cGUgPT09IGIuZWxlbWVudFR5cGUgPyBoIDogaWcoYi50eXBlLCBoKSwgayA9IGcuY29udGV4dCwgbCA9IGMuY29udGV4dFR5cGUsICJvYmplY3QiID09PSBfdHlwZW9mKGwpICYmIG51bGwgIT09IGwgPyBsID0gc2cobCkgOiAobCA9IEwoYykgPyBCZiA6IEouY3VycmVudCwgbCA9IENmKGIsIGwpKSwgbSA9IGMuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzLCAocCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBtIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlKSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIHx8IChoICE9PSBkIHx8IGsgIT09IGwpICYmIE1nKGIsIGcsIGQsIGwpLCB0ZyA9ICExLCBrID0gYi5tZW1vaXplZFN0YXRlLCBnLnN0YXRlID0gaywgemcoYiwgZCwgZywgZSksIHggPSBiLm1lbW9pemVkU3RhdGUsIGggIT09IGQgfHwgayAhPT0geCB8fCBLLmN1cnJlbnQgfHwgdGcgPyAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG0gJiYgKEZnKGIsIGMsIG0sIGQpLCB4ID0gYi5tZW1vaXplZFN0YXRlKSwgKG0gPSB0ZyB8fCBLZyhiLCBjLCBoLCBkLCBrLCB4LCBsKSkgPyAocCB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsVXBkYXRlIHx8ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsVXBkYXRlICYmIGcuY29tcG9uZW50V2lsbFVwZGF0ZShkLCB4LCBsKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUgJiYgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZShkLCB4LCBsKSksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSAmJiAoYi5lZmZlY3RUYWcgfD0gNCksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlICYmIChiLmVmZmVjdFRhZyB8PSAyNTYpKSA6ICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIGsgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5lZmZlY3RUYWcgfD0gNCksICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiBrID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZWZmZWN0VGFnIHw9IDI1NiksIGIubWVtb2l6ZWRQcm9wcyA9IGQsIGIubWVtb2l6ZWRTdGF0ZSA9IHgpLCBnLnByb3BzID0gZCwgZy5zdGF0ZSA9IHgsIGcuY29udGV4dCA9IGwsIGQgPSBtKSA6ICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIGsgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5lZmZlY3RUYWcgfD0gNCksICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiBrID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZWZmZWN0VGFnIHw9IDI1NiksIGQgPSAhMSk7CiAgcmV0dXJuIGdpKGEsIGIsIGMsIGQsIGYsIGUpOwp9CgpmdW5jdGlvbiBnaShhLCBiLCBjLCBkLCBlLCBmKSB7CiAgZWkoYSwgYik7CiAgdmFyIGcgPSAwICE9PSAoYi5lZmZlY3RUYWcgJiA2NCk7CiAgaWYgKCFkICYmICFnKSByZXR1cm4gZSAmJiBIZihiLCBjLCAhMSksICRoKGEsIGIsIGYpOwogIGQgPSBiLnN0YXRlTm9kZTsKICBZaC5jdXJyZW50ID0gYjsKICB2YXIgaCA9IGcgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGMuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yID8gbnVsbCA6IGQucmVuZGVyKCk7CiAgYi5lZmZlY3RUYWcgfD0gMTsKICBudWxsICE9PSBhICYmIGcgPyAoYi5jaGlsZCA9IFhnKGIsIGEuY2hpbGQsIG51bGwsIGYpLCBiLmNoaWxkID0gWGcoYiwgbnVsbCwgaCwgZikpIDogUihhLCBiLCBoLCBmKTsKICBiLm1lbW9pemVkU3RhdGUgPSBkLnN0YXRlOwogIGUgJiYgSGYoYiwgYywgITApOwogIHJldHVybiBiLmNoaWxkOwp9CgpmdW5jdGlvbiBoaShhKSB7CiAgdmFyIGIgPSBhLnN0YXRlTm9kZTsKICBiLnBlbmRpbmdDb250ZXh0ID8gRWYoYSwgYi5wZW5kaW5nQ29udGV4dCwgYi5wZW5kaW5nQ29udGV4dCAhPT0gYi5jb250ZXh0KSA6IGIuY29udGV4dCAmJiBFZihhLCBiLmNvbnRleHQsICExKTsKICBkaChhLCBiLmNvbnRhaW5lckluZm8pOwp9Cgp2YXIgaWkgPSB7CiAgZGVoeWRyYXRlZDogbnVsbCwKICByZXRyeVRpbWU6IDAKfTsKCmZ1bmN0aW9uIGppKGEsIGIsIGMpIHsKICB2YXIgZCA9IGIubW9kZSwKICAgICAgZSA9IGIucGVuZGluZ1Byb3BzLAogICAgICBmID0gTS5jdXJyZW50LAogICAgICBnID0gITEsCiAgICAgIGg7CiAgKGggPSAwICE9PSAoYi5lZmZlY3RUYWcgJiA2NCkpIHx8IChoID0gMCAhPT0gKGYgJiAyKSAmJiAobnVsbCA9PT0gYSB8fCBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUpKTsKICBoID8gKGcgPSAhMCwgYi5lZmZlY3RUYWcgJj0gLTY1KSA6IG51bGwgIT09IGEgJiYgbnVsbCA9PT0gYS5tZW1vaXplZFN0YXRlIHx8IHZvaWQgMCA9PT0gZS5mYWxsYmFjayB8fCAhMCA9PT0gZS51bnN0YWJsZV9hdm9pZFRoaXNGYWxsYmFjayB8fCAoZiB8PSAxKTsKICBJKE0sIGYgJiAxKTsKCiAgaWYgKG51bGwgPT09IGEpIHsKICAgIHZvaWQgMCAhPT0gZS5mYWxsYmFjayAmJiBVaChiKTsKCiAgICBpZiAoZykgewogICAgICBnID0gZS5mYWxsYmFjazsKICAgICAgZSA9IFdnKG51bGwsIGQsIDAsIG51bGwpOwogICAgICBlLnJldHVybiA9IGI7CiAgICAgIGlmICgwID09PSAoYi5tb2RlICYgMikpIGZvciAoYSA9IG51bGwgIT09IGIubWVtb2l6ZWRTdGF0ZSA/IGIuY2hpbGQuY2hpbGQgOiBiLmNoaWxkLCBlLmNoaWxkID0gYTsgbnVsbCAhPT0gYTspIHsKICAgICAgICBhLnJldHVybiA9IGUsIGEgPSBhLnNpYmxpbmc7CiAgICAgIH0KICAgICAgYyA9IFdnKGcsIGQsIGMsIG51bGwpOwogICAgICBjLnJldHVybiA9IGI7CiAgICAgIGUuc2libGluZyA9IGM7CiAgICAgIGIubWVtb2l6ZWRTdGF0ZSA9IGlpOwogICAgICBiLmNoaWxkID0gZTsKICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZCA9IGUuY2hpbGRyZW47CiAgICBiLm1lbW9pemVkU3RhdGUgPSBudWxsOwogICAgcmV0dXJuIGIuY2hpbGQgPSBZZyhiLCBudWxsLCBkLCBjKTsKICB9CgogIGlmIChudWxsICE9PSBhLm1lbW9pemVkU3RhdGUpIHsKICAgIGEgPSBhLmNoaWxkOwogICAgZCA9IGEuc2libGluZzsKCiAgICBpZiAoZykgewogICAgICBlID0gZS5mYWxsYmFjazsKICAgICAgYyA9IFNnKGEsIGEucGVuZGluZ1Byb3BzKTsKICAgICAgYy5yZXR1cm4gPSBiOwogICAgICBpZiAoMCA9PT0gKGIubW9kZSAmIDIpICYmIChnID0gbnVsbCAhPT0gYi5tZW1vaXplZFN0YXRlID8gYi5jaGlsZC5jaGlsZCA6IGIuY2hpbGQsIGcgIT09IGEuY2hpbGQpKSBmb3IgKGMuY2hpbGQgPSBnOyBudWxsICE9PSBnOykgewogICAgICAgIGcucmV0dXJuID0gYywgZyA9IGcuc2libGluZzsKICAgICAgfQogICAgICBkID0gU2coZCwgZSk7CiAgICAgIGQucmV0dXJuID0gYjsKICAgICAgYy5zaWJsaW5nID0gZDsKICAgICAgYy5jaGlsZEV4cGlyYXRpb25UaW1lID0gMDsKICAgICAgYi5tZW1vaXplZFN0YXRlID0gaWk7CiAgICAgIGIuY2hpbGQgPSBjOwogICAgICByZXR1cm4gZDsKICAgIH0KCiAgICBjID0gWGcoYiwgYS5jaGlsZCwgZS5jaGlsZHJlbiwgYyk7CiAgICBiLm1lbW9pemVkU3RhdGUgPSBudWxsOwogICAgcmV0dXJuIGIuY2hpbGQgPSBjOwogIH0KCiAgYSA9IGEuY2hpbGQ7CgogIGlmIChnKSB7CiAgICBnID0gZS5mYWxsYmFjazsKICAgIGUgPSBXZyhudWxsLCBkLCAwLCBudWxsKTsKICAgIGUucmV0dXJuID0gYjsKICAgIGUuY2hpbGQgPSBhOwogICAgbnVsbCAhPT0gYSAmJiAoYS5yZXR1cm4gPSBlKTsKICAgIGlmICgwID09PSAoYi5tb2RlICYgMikpIGZvciAoYSA9IG51bGwgIT09IGIubWVtb2l6ZWRTdGF0ZSA/IGIuY2hpbGQuY2hpbGQgOiBiLmNoaWxkLCBlLmNoaWxkID0gYTsgbnVsbCAhPT0gYTspIHsKICAgICAgYS5yZXR1cm4gPSBlLCBhID0gYS5zaWJsaW5nOwogICAgfQogICAgYyA9IFdnKGcsIGQsIGMsIG51bGwpOwogICAgYy5yZXR1cm4gPSBiOwogICAgZS5zaWJsaW5nID0gYzsKICAgIGMuZWZmZWN0VGFnIHw9IDI7CiAgICBlLmNoaWxkRXhwaXJhdGlvblRpbWUgPSAwOwogICAgYi5tZW1vaXplZFN0YXRlID0gaWk7CiAgICBiLmNoaWxkID0gZTsKICAgIHJldHVybiBjOwogIH0KCiAgYi5tZW1vaXplZFN0YXRlID0gbnVsbDsKICByZXR1cm4gYi5jaGlsZCA9IFhnKGIsIGEsIGUuY2hpbGRyZW4sIGMpOwp9CgpmdW5jdGlvbiBraShhLCBiKSB7CiAgYS5leHBpcmF0aW9uVGltZSA8IGIgJiYgKGEuZXhwaXJhdGlvblRpbWUgPSBiKTsKICB2YXIgYyA9IGEuYWx0ZXJuYXRlOwogIG51bGwgIT09IGMgJiYgYy5leHBpcmF0aW9uVGltZSA8IGIgJiYgKGMuZXhwaXJhdGlvblRpbWUgPSBiKTsKICBwZyhhLnJldHVybiwgYik7Cn0KCmZ1bmN0aW9uIGxpKGEsIGIsIGMsIGQsIGUsIGYpIHsKICB2YXIgZyA9IGEubWVtb2l6ZWRTdGF0ZTsKICBudWxsID09PSBnID8gYS5tZW1vaXplZFN0YXRlID0gewogICAgaXNCYWNrd2FyZHM6IGIsCiAgICByZW5kZXJpbmc6IG51bGwsCiAgICByZW5kZXJpbmdTdGFydFRpbWU6IDAsCiAgICBsYXN0OiBkLAogICAgdGFpbDogYywKICAgIHRhaWxFeHBpcmF0aW9uOiAwLAogICAgdGFpbE1vZGU6IGUsCiAgICBsYXN0RWZmZWN0OiBmCiAgfSA6IChnLmlzQmFja3dhcmRzID0gYiwgZy5yZW5kZXJpbmcgPSBudWxsLCBnLnJlbmRlcmluZ1N0YXJ0VGltZSA9IDAsIGcubGFzdCA9IGQsIGcudGFpbCA9IGMsIGcudGFpbEV4cGlyYXRpb24gPSAwLCBnLnRhaWxNb2RlID0gZSwgZy5sYXN0RWZmZWN0ID0gZik7Cn0KCmZ1bmN0aW9uIG1pKGEsIGIsIGMpIHsKICB2YXIgZCA9IGIucGVuZGluZ1Byb3BzLAogICAgICBlID0gZC5yZXZlYWxPcmRlciwKICAgICAgZiA9IGQudGFpbDsKICBSKGEsIGIsIGQuY2hpbGRyZW4sIGMpOwogIGQgPSBNLmN1cnJlbnQ7CiAgaWYgKDAgIT09IChkICYgMikpIGQgPSBkICYgMSB8IDIsIGIuZWZmZWN0VGFnIHw9IDY0O2Vsc2UgewogICAgaWYgKG51bGwgIT09IGEgJiYgMCAhPT0gKGEuZWZmZWN0VGFnICYgNjQpKSBhOiBmb3IgKGEgPSBiLmNoaWxkOyBudWxsICE9PSBhOykgewogICAgICBpZiAoMTMgPT09IGEudGFnKSBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUgJiYga2koYSwgYyk7ZWxzZSBpZiAoMTkgPT09IGEudGFnKSBraShhLCBjKTtlbHNlIGlmIChudWxsICE9PSBhLmNoaWxkKSB7CiAgICAgICAgYS5jaGlsZC5yZXR1cm4gPSBhOwogICAgICAgIGEgPSBhLmNoaWxkOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChhID09PSBiKSBicmVhayBhOwoKICAgICAgZm9yICg7IG51bGwgPT09IGEuc2libGluZzspIHsKICAgICAgICBpZiAobnVsbCA9PT0gYS5yZXR1cm4gfHwgYS5yZXR1cm4gPT09IGIpIGJyZWFrIGE7CiAgICAgICAgYSA9IGEucmV0dXJuOwogICAgICB9CgogICAgICBhLnNpYmxpbmcucmV0dXJuID0gYS5yZXR1cm47CiAgICAgIGEgPSBhLnNpYmxpbmc7CiAgICB9CiAgICBkICY9IDE7CiAgfQogIEkoTSwgZCk7CiAgaWYgKDAgPT09IChiLm1vZGUgJiAyKSkgYi5tZW1vaXplZFN0YXRlID0gbnVsbDtlbHNlIHN3aXRjaCAoZSkgewogICAgY2FzZSAiZm9yd2FyZHMiOgogICAgICBjID0gYi5jaGlsZDsKCiAgICAgIGZvciAoZSA9IG51bGw7IG51bGwgIT09IGM7KSB7CiAgICAgICAgYSA9IGMuYWx0ZXJuYXRlLCBudWxsICE9PSBhICYmIG51bGwgPT09IGhoKGEpICYmIChlID0gYyksIGMgPSBjLnNpYmxpbmc7CiAgICAgIH0KCiAgICAgIGMgPSBlOwogICAgICBudWxsID09PSBjID8gKGUgPSBiLmNoaWxkLCBiLmNoaWxkID0gbnVsbCkgOiAoZSA9IGMuc2libGluZywgYy5zaWJsaW5nID0gbnVsbCk7CiAgICAgIGxpKGIsICExLCBlLCBjLCBmLCBiLmxhc3RFZmZlY3QpOwogICAgICBicmVhazsKCiAgICBjYXNlICJiYWNrd2FyZHMiOgogICAgICBjID0gbnVsbDsKICAgICAgZSA9IGIuY2hpbGQ7CgogICAgICBmb3IgKGIuY2hpbGQgPSBudWxsOyBudWxsICE9PSBlOykgewogICAgICAgIGEgPSBlLmFsdGVybmF0ZTsKCiAgICAgICAgaWYgKG51bGwgIT09IGEgJiYgbnVsbCA9PT0gaGgoYSkpIHsKICAgICAgICAgIGIuY2hpbGQgPSBlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBhID0gZS5zaWJsaW5nOwogICAgICAgIGUuc2libGluZyA9IGM7CiAgICAgICAgYyA9IGU7CiAgICAgICAgZSA9IGE7CiAgICAgIH0KCiAgICAgIGxpKGIsICEwLCBjLCBudWxsLCBmLCBiLmxhc3RFZmZlY3QpOwogICAgICBicmVhazsKCiAgICBjYXNlICJ0b2dldGhlciI6CiAgICAgIGxpKGIsICExLCBudWxsLCBudWxsLCB2b2lkIDAsIGIubGFzdEVmZmVjdCk7CiAgICAgIGJyZWFrOwoKICAgIGRlZmF1bHQ6CiAgICAgIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGw7CiAgfQogIHJldHVybiBiLmNoaWxkOwp9CgpmdW5jdGlvbiAkaChhLCBiLCBjKSB7CiAgbnVsbCAhPT0gYSAmJiAoYi5kZXBlbmRlbmNpZXMgPSBhLmRlcGVuZGVuY2llcyk7CiAgdmFyIGQgPSBiLmV4cGlyYXRpb25UaW1lOwogIDAgIT09IGQgJiYgQmcoZCk7CiAgaWYgKGIuY2hpbGRFeHBpcmF0aW9uVGltZSA8IGMpIHJldHVybiBudWxsOwogIGlmIChudWxsICE9PSBhICYmIGIuY2hpbGQgIT09IGEuY2hpbGQpIHRocm93IEVycm9yKHUoMTUzKSk7CgogIGlmIChudWxsICE9PSBiLmNoaWxkKSB7CiAgICBhID0gYi5jaGlsZDsKICAgIGMgPSBTZyhhLCBhLnBlbmRpbmdQcm9wcyk7CiAgICBiLmNoaWxkID0gYzsKCiAgICBmb3IgKGMucmV0dXJuID0gYjsgbnVsbCAhPT0gYS5zaWJsaW5nOykgewogICAgICBhID0gYS5zaWJsaW5nLCBjID0gYy5zaWJsaW5nID0gU2coYSwgYS5wZW5kaW5nUHJvcHMpLCBjLnJldHVybiA9IGI7CiAgICB9CgogICAgYy5zaWJsaW5nID0gbnVsbDsKICB9CgogIHJldHVybiBiLmNoaWxkOwp9Cgp2YXIgbmksIG9pLCBwaSwgcWk7CgpuaSA9IGZ1bmN0aW9uIG5pKGEsIGIpIHsKICBmb3IgKHZhciBjID0gYi5jaGlsZDsgbnVsbCAhPT0gYzspIHsKICAgIGlmICg1ID09PSBjLnRhZyB8fCA2ID09PSBjLnRhZykgYS5hcHBlbmRDaGlsZChjLnN0YXRlTm9kZSk7ZWxzZSBpZiAoNCAhPT0gYy50YWcgJiYgbnVsbCAhPT0gYy5jaGlsZCkgewogICAgICBjLmNoaWxkLnJldHVybiA9IGM7CiAgICAgIGMgPSBjLmNoaWxkOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChjID09PSBiKSBicmVhazsKCiAgICBmb3IgKDsgbnVsbCA9PT0gYy5zaWJsaW5nOykgewogICAgICBpZiAobnVsbCA9PT0gYy5yZXR1cm4gfHwgYy5yZXR1cm4gPT09IGIpIHJldHVybjsKICAgICAgYyA9IGMucmV0dXJuOwogICAgfQoKICAgIGMuc2libGluZy5yZXR1cm4gPSBjLnJldHVybjsKICAgIGMgPSBjLnNpYmxpbmc7CiAgfQp9OwoKb2kgPSBmdW5jdGlvbiBvaSgpIHt9OwoKcGkgPSBmdW5jdGlvbiBwaShhLCBiLCBjLCBkLCBlKSB7CiAgdmFyIGYgPSBhLm1lbW9pemVkUHJvcHM7CgogIGlmIChmICE9PSBkKSB7CiAgICB2YXIgZyA9IGIuc3RhdGVOb2RlOwogICAgY2goJGcuY3VycmVudCk7CiAgICBhID0gbnVsbDsKCiAgICBzd2l0Y2ggKGMpIHsKICAgICAgY2FzZSAiaW5wdXQiOgogICAgICAgIGYgPSB6YihnLCBmKTsKICAgICAgICBkID0gemIoZywgZCk7CiAgICAgICAgYSA9IFtdOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAib3B0aW9uIjoKICAgICAgICBmID0gR2IoZywgZik7CiAgICAgICAgZCA9IEdiKGcsIGQpOwogICAgICAgIGEgPSBbXTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInNlbGVjdCI6CiAgICAgICAgZiA9IG4oe30sIGYsIHsKICAgICAgICAgIHZhbHVlOiB2b2lkIDAKICAgICAgICB9KTsKICAgICAgICBkID0gbih7fSwgZCwgewogICAgICAgICAgdmFsdWU6IHZvaWQgMAogICAgICAgIH0pOwogICAgICAgIGEgPSBbXTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInRleHRhcmVhIjoKICAgICAgICBmID0gSWIoZywgZik7CiAgICAgICAgZCA9IEliKGcsIGQpOwogICAgICAgIGEgPSBbXTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGYub25DbGljayAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5vbkNsaWNrICYmIChnLm9uY2xpY2sgPSBzZCk7CiAgICB9CgogICAgb2QoYywgZCk7CiAgICB2YXIgaCwgazsKICAgIGMgPSBudWxsOwoKICAgIGZvciAoaCBpbiBmKSB7CiAgICAgIGlmICghZC5oYXNPd25Qcm9wZXJ0eShoKSAmJiBmLmhhc093blByb3BlcnR5KGgpICYmIG51bGwgIT0gZltoXSkgaWYgKCJzdHlsZSIgPT09IGgpIGZvciAoayBpbiBnID0gZltoXSwgZykgewogICAgICAgIGcuaGFzT3duUHJvcGVydHkoaykgJiYgKGMgfHwgKGMgPSB7fSksIGNba10gPSAiIik7CiAgICAgIH0gZWxzZSAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiICE9PSBoICYmICJjaGlsZHJlbiIgIT09IGggJiYgInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGggJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGggJiYgImF1dG9Gb2N1cyIgIT09IGggJiYgKHZhLmhhc093blByb3BlcnR5KGgpID8gYSB8fCAoYSA9IFtdKSA6IChhID0gYSB8fCBbXSkucHVzaChoLCBudWxsKSk7CiAgICB9CgogICAgZm9yIChoIGluIGQpIHsKICAgICAgdmFyIGwgPSBkW2hdOwogICAgICBnID0gbnVsbCAhPSBmID8gZltoXSA6IHZvaWQgMDsKICAgICAgaWYgKGQuaGFzT3duUHJvcGVydHkoaCkgJiYgbCAhPT0gZyAmJiAobnVsbCAhPSBsIHx8IG51bGwgIT0gZykpIGlmICgic3R5bGUiID09PSBoKSB7CiAgICAgICAgaWYgKGcpIHsKICAgICAgICAgIGZvciAoayBpbiBnKSB7CiAgICAgICAgICAgICFnLmhhc093blByb3BlcnR5KGspIHx8IGwgJiYgbC5oYXNPd25Qcm9wZXJ0eShrKSB8fCAoYyB8fCAoYyA9IHt9KSwgY1trXSA9ICIiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKGsgaW4gbCkgewogICAgICAgICAgICBsLmhhc093blByb3BlcnR5KGspICYmIGdba10gIT09IGxba10gJiYgKGMgfHwgKGMgPSB7fSksIGNba10gPSBsW2tdKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgYyB8fCAoYSB8fCAoYSA9IFtdKSwgYS5wdXNoKGgsIGMpKSwgYyA9IGw7CiAgICAgIH0gZWxzZSAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBoID8gKGwgPSBsID8gbC5fX2h0bWwgOiB2b2lkIDAsIGcgPSBnID8gZy5fX2h0bWwgOiB2b2lkIDAsIG51bGwgIT0gbCAmJiBnICE9PSBsICYmIChhID0gYSB8fCBbXSkucHVzaChoLCBsKSkgOiAiY2hpbGRyZW4iID09PSBoID8gZyA9PT0gbCB8fCAic3RyaW5nIiAhPT0gdHlwZW9mIGwgJiYgIm51bWJlciIgIT09IHR5cGVvZiBsIHx8IChhID0gYSB8fCBbXSkucHVzaChoLCAiIiArIGwpIDogInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGggJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGggJiYgKHZhLmhhc093blByb3BlcnR5KGgpID8gKG51bGwgIT0gbCAmJiByZChlLCBoKSwgYSB8fCBnID09PSBsIHx8IChhID0gW10pKSA6IChhID0gYSB8fCBbXSkucHVzaChoLCBsKSk7CiAgICB9CgogICAgYyAmJiAoYSA9IGEgfHwgW10pLnB1c2goInN0eWxlIiwgYyk7CiAgICBlID0gYTsKICAgIGlmIChiLnVwZGF0ZVF1ZXVlID0gZSkgYi5lZmZlY3RUYWcgfD0gNDsKICB9Cn07CgpxaSA9IGZ1bmN0aW9uIHFpKGEsIGIsIGMsIGQpIHsKICBjICE9PSBkICYmIChiLmVmZmVjdFRhZyB8PSA0KTsKfTsKCmZ1bmN0aW9uIHJpKGEsIGIpIHsKICBzd2l0Y2ggKGEudGFpbE1vZGUpIHsKICAgIGNhc2UgImhpZGRlbiI6CiAgICAgIGIgPSBhLnRhaWw7CgogICAgICBmb3IgKHZhciBjID0gbnVsbDsgbnVsbCAhPT0gYjspIHsKICAgICAgICBudWxsICE9PSBiLmFsdGVybmF0ZSAmJiAoYyA9IGIpLCBiID0gYi5zaWJsaW5nOwogICAgICB9CgogICAgICBudWxsID09PSBjID8gYS50YWlsID0gbnVsbCA6IGMuc2libGluZyA9IG51bGw7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgImNvbGxhcHNlZCI6CiAgICAgIGMgPSBhLnRhaWw7CgogICAgICBmb3IgKHZhciBkID0gbnVsbDsgbnVsbCAhPT0gYzspIHsKICAgICAgICBudWxsICE9PSBjLmFsdGVybmF0ZSAmJiAoZCA9IGMpLCBjID0gYy5zaWJsaW5nOwogICAgICB9CgogICAgICBudWxsID09PSBkID8gYiB8fCBudWxsID09PSBhLnRhaWwgPyBhLnRhaWwgPSBudWxsIDogYS50YWlsLnNpYmxpbmcgPSBudWxsIDogZC5zaWJsaW5nID0gbnVsbDsKICB9Cn0KCmZ1bmN0aW9uIHNpKGEsIGIsIGMpIHsKICB2YXIgZCA9IGIucGVuZGluZ1Byb3BzOwoKICBzd2l0Y2ggKGIudGFnKSB7CiAgICBjYXNlIDI6CiAgICBjYXNlIDE2OgogICAgY2FzZSAxNToKICAgIGNhc2UgMDoKICAgIGNhc2UgMTE6CiAgICBjYXNlIDc6CiAgICBjYXNlIDg6CiAgICBjYXNlIDEyOgogICAgY2FzZSA5OgogICAgY2FzZSAxNDoKICAgICAgcmV0dXJuIG51bGw7CgogICAgY2FzZSAxOgogICAgICByZXR1cm4gTChiLnR5cGUpICYmIERmKCksIG51bGw7CgogICAgY2FzZSAzOgogICAgICByZXR1cm4gZWgoKSwgSChLKSwgSChKKSwgYyA9IGIuc3RhdGVOb2RlLCBjLnBlbmRpbmdDb250ZXh0ICYmIChjLmNvbnRleHQgPSBjLnBlbmRpbmdDb250ZXh0LCBjLnBlbmRpbmdDb250ZXh0ID0gbnVsbCksIG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5jaGlsZCB8fCAhV2goYikgfHwgKGIuZWZmZWN0VGFnIHw9IDQpLCBvaShiKSwgbnVsbDsKCiAgICBjYXNlIDU6CiAgICAgIGdoKGIpOwogICAgICBjID0gY2goYmguY3VycmVudCk7CiAgICAgIHZhciBlID0gYi50eXBlOwogICAgICBpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9IGIuc3RhdGVOb2RlKSBwaShhLCBiLCBlLCBkLCBjKSwgYS5yZWYgIT09IGIucmVmICYmIChiLmVmZmVjdFRhZyB8PSAxMjgpO2Vsc2UgewogICAgICAgIGlmICghZCkgewogICAgICAgICAgaWYgKG51bGwgPT09IGIuc3RhdGVOb2RlKSB0aHJvdyBFcnJvcih1KDE2NikpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBhID0gY2goJGcuY3VycmVudCk7CgogICAgICAgIGlmIChXaChiKSkgewogICAgICAgICAgZCA9IGIuc3RhdGVOb2RlOwogICAgICAgICAgZSA9IGIudHlwZTsKICAgICAgICAgIHZhciBmID0gYi5tZW1vaXplZFByb3BzOwogICAgICAgICAgZFtNZF0gPSBiOwogICAgICAgICAgZFtOZF0gPSBmOwoKICAgICAgICAgIHN3aXRjaCAoZSkgewogICAgICAgICAgICBjYXNlICJpZnJhbWUiOgogICAgICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgICBjYXNlICJlbWJlZCI6CiAgICAgICAgICAgICAgRigibG9hZCIsIGQpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAidmlkZW8iOgogICAgICAgICAgICBjYXNlICJhdWRpbyI6CiAgICAgICAgICAgICAgZm9yIChhID0gMDsgYSA8IGFjLmxlbmd0aDsgYSsrKSB7CiAgICAgICAgICAgICAgICBGKGFjW2FdLCBkKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAic291cmNlIjoKICAgICAgICAgICAgICBGKCJlcnJvciIsIGQpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiaW1nIjoKICAgICAgICAgICAgY2FzZSAiaW1hZ2UiOgogICAgICAgICAgICBjYXNlICJsaW5rIjoKICAgICAgICAgICAgICBGKCJlcnJvciIsIGQpOwogICAgICAgICAgICAgIEYoImxvYWQiLCBkKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgImZvcm0iOgogICAgICAgICAgICAgIEYoInJlc2V0IiwgZCk7CiAgICAgICAgICAgICAgRigic3VibWl0IiwgZCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJkZXRhaWxzIjoKICAgICAgICAgICAgICBGKCJ0b2dnbGUiLCBkKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgImlucHV0IjoKICAgICAgICAgICAgICBBYihkLCBmKTsKICAgICAgICAgICAgICBGKCJpbnZhbGlkIiwgZCk7CiAgICAgICAgICAgICAgcmQoYywgIm9uQ2hhbmdlIik7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgIGQuX3dyYXBwZXJTdGF0ZSA9IHsKICAgICAgICAgICAgICAgIHdhc011bHRpcGxlOiAhIWYubXVsdGlwbGUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIEYoImludmFsaWQiLCBkKTsKICAgICAgICAgICAgICByZChjLCAib25DaGFuZ2UiKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInRleHRhcmVhIjoKICAgICAgICAgICAgICBKYihkLCBmKSwgRigiaW52YWxpZCIsIGQpLCByZChjLCAib25DaGFuZ2UiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBvZChlLCBmKTsKICAgICAgICAgIGEgPSBudWxsOwoKICAgICAgICAgIGZvciAodmFyIGcgaW4gZikgewogICAgICAgICAgICBpZiAoZi5oYXNPd25Qcm9wZXJ0eShnKSkgewogICAgICAgICAgICAgIHZhciBoID0gZltnXTsKICAgICAgICAgICAgICAiY2hpbGRyZW4iID09PSBnID8gInN0cmluZyIgPT09IHR5cGVvZiBoID8gZC50ZXh0Q29udGVudCAhPT0gaCAmJiAoYSA9IFsiY2hpbGRyZW4iLCBoXSkgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGggJiYgZC50ZXh0Q29udGVudCAhPT0gIiIgKyBoICYmIChhID0gWyJjaGlsZHJlbiIsICIiICsgaF0pIDogdmEuaGFzT3duUHJvcGVydHkoZykgJiYgbnVsbCAhPSBoICYmIHJkKGMsIGcpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgc3dpdGNoIChlKSB7CiAgICAgICAgICAgIGNhc2UgImlucHV0IjoKICAgICAgICAgICAgICB4YihkKTsKICAgICAgICAgICAgICBFYihkLCBmLCAhMCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJ0ZXh0YXJlYSI6CiAgICAgICAgICAgICAgeGIoZCk7CiAgICAgICAgICAgICAgTGIoZCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICBjYXNlICJvcHRpb24iOgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgZi5vbkNsaWNrICYmIChkLm9uY2xpY2sgPSBzZCk7CiAgICAgICAgICB9CgogICAgICAgICAgYyA9IGE7CiAgICAgICAgICBiLnVwZGF0ZVF1ZXVlID0gYzsKICAgICAgICAgIG51bGwgIT09IGMgJiYgKGIuZWZmZWN0VGFnIHw9IDQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnID0gOSA9PT0gYy5ub2RlVHlwZSA/IGMgOiBjLm93bmVyRG9jdW1lbnQ7CiAgICAgICAgICBhID09PSBxZCAmJiAoYSA9IE5iKGUpKTsKICAgICAgICAgIGEgPT09IHFkID8gInNjcmlwdCIgPT09IGUgPyAoYSA9IGcuY3JlYXRlRWxlbWVudCgiZGl2IiksIGEuaW5uZXJIVE1MID0gIjxzY3JpcHQ+XHgzYy9zY3JpcHQ+IiwgYSA9IGEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKSkgOiAic3RyaW5nIiA9PT0gdHlwZW9mIGQuaXMgPyBhID0gZy5jcmVhdGVFbGVtZW50KGUsIHsKICAgICAgICAgICAgaXM6IGQuaXMKICAgICAgICAgIH0pIDogKGEgPSBnLmNyZWF0ZUVsZW1lbnQoZSksICJzZWxlY3QiID09PSBlICYmIChnID0gYSwgZC5tdWx0aXBsZSA/IGcubXVsdGlwbGUgPSAhMCA6IGQuc2l6ZSAmJiAoZy5zaXplID0gZC5zaXplKSkpIDogYSA9IGcuY3JlYXRlRWxlbWVudE5TKGEsIGUpOwogICAgICAgICAgYVtNZF0gPSBiOwogICAgICAgICAgYVtOZF0gPSBkOwogICAgICAgICAgbmkoYSwgYiwgITEsICExKTsKICAgICAgICAgIGIuc3RhdGVOb2RlID0gYTsKICAgICAgICAgIGcgPSBwZChlLCBkKTsKCiAgICAgICAgICBzd2l0Y2ggKGUpIHsKICAgICAgICAgICAgY2FzZSAiaWZyYW1lIjoKICAgICAgICAgICAgY2FzZSAib2JqZWN0IjoKICAgICAgICAgICAgY2FzZSAiZW1iZWQiOgogICAgICAgICAgICAgIEYoImxvYWQiLCBhKTsKICAgICAgICAgICAgICBoID0gZDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInZpZGVvIjoKICAgICAgICAgICAgY2FzZSAiYXVkaW8iOgogICAgICAgICAgICAgIGZvciAoaCA9IDA7IGggPCBhYy5sZW5ndGg7IGgrKykgewogICAgICAgICAgICAgICAgRihhY1toXSwgYSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBoID0gZDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInNvdXJjZSI6CiAgICAgICAgICAgICAgRigiZXJyb3IiLCBhKTsKICAgICAgICAgICAgICBoID0gZDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgImltZyI6CiAgICAgICAgICAgIGNhc2UgImltYWdlIjoKICAgICAgICAgICAgY2FzZSAibGluayI6CiAgICAgICAgICAgICAgRigiZXJyb3IiLCBhKTsKICAgICAgICAgICAgICBGKCJsb2FkIiwgYSk7CiAgICAgICAgICAgICAgaCA9IGQ7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJmb3JtIjoKICAgICAgICAgICAgICBGKCJyZXNldCIsIGEpOwogICAgICAgICAgICAgIEYoInN1Ym1pdCIsIGEpOwogICAgICAgICAgICAgIGggPSBkOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiZGV0YWlscyI6CiAgICAgICAgICAgICAgRigidG9nZ2xlIiwgYSk7CiAgICAgICAgICAgICAgaCA9IGQ7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJpbnB1dCI6CiAgICAgICAgICAgICAgQWIoYSwgZCk7CiAgICAgICAgICAgICAgaCA9IHpiKGEsIGQpOwogICAgICAgICAgICAgIEYoImludmFsaWQiLCBhKTsKICAgICAgICAgICAgICByZChjLCAib25DaGFuZ2UiKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIm9wdGlvbiI6CiAgICAgICAgICAgICAgaCA9IEdiKGEsIGQpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAic2VsZWN0IjoKICAgICAgICAgICAgICBhLl93cmFwcGVyU3RhdGUgPSB7CiAgICAgICAgICAgICAgICB3YXNNdWx0aXBsZTogISFkLm11bHRpcGxlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBoID0gbih7fSwgZCwgewogICAgICAgICAgICAgICAgdmFsdWU6IHZvaWQgMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIEYoImludmFsaWQiLCBhKTsKICAgICAgICAgICAgICByZChjLCAib25DaGFuZ2UiKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInRleHRhcmVhIjoKICAgICAgICAgICAgICBKYihhLCBkKTsKICAgICAgICAgICAgICBoID0gSWIoYSwgZCk7CiAgICAgICAgICAgICAgRigiaW52YWxpZCIsIGEpOwogICAgICAgICAgICAgIHJkKGMsICJvbkNoYW5nZSIpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBoID0gZDsKICAgICAgICAgIH0KCiAgICAgICAgICBvZChlLCBoKTsKICAgICAgICAgIHZhciBrID0gaDsKCiAgICAgICAgICBmb3IgKGYgaW4gaykgewogICAgICAgICAgICBpZiAoay5oYXNPd25Qcm9wZXJ0eShmKSkgewogICAgICAgICAgICAgIHZhciBsID0ga1tmXTsKICAgICAgICAgICAgICAic3R5bGUiID09PSBmID8gbWQoYSwgbCkgOiAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBmID8gKGwgPSBsID8gbC5fX2h0bWwgOiB2b2lkIDAsIG51bGwgIT0gbCAmJiBRYihhLCBsKSkgOiAiY2hpbGRyZW4iID09PSBmID8gInN0cmluZyIgPT09IHR5cGVvZiBsID8gKCJ0ZXh0YXJlYSIgIT09IGUgfHwgIiIgIT09IGwpICYmIFJiKGEsIGwpIDogIm51bWJlciIgPT09IHR5cGVvZiBsICYmIFJiKGEsICIiICsgbCkgOiAic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiAhPT0gZiAmJiAic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiAhPT0gZiAmJiAiYXV0b0ZvY3VzIiAhPT0gZiAmJiAodmEuaGFzT3duUHJvcGVydHkoZikgPyBudWxsICE9IGwgJiYgcmQoYywgZikgOiBudWxsICE9IGwgJiYgWGEoYSwgZiwgbCwgZykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgc3dpdGNoIChlKSB7CiAgICAgICAgICAgIGNhc2UgImlucHV0IjoKICAgICAgICAgICAgICB4YihhKTsKICAgICAgICAgICAgICBFYihhLCBkLCAhMSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJ0ZXh0YXJlYSI6CiAgICAgICAgICAgICAgeGIoYSk7CiAgICAgICAgICAgICAgTGIoYSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJvcHRpb24iOgogICAgICAgICAgICAgIG51bGwgIT0gZC52YWx1ZSAmJiBhLnNldEF0dHJpYnV0ZSgidmFsdWUiLCAiIiArIHJiKGQudmFsdWUpKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInNlbGVjdCI6CiAgICAgICAgICAgICAgYS5tdWx0aXBsZSA9ICEhZC5tdWx0aXBsZTsKICAgICAgICAgICAgICBjID0gZC52YWx1ZTsKICAgICAgICAgICAgICBudWxsICE9IGMgPyBIYihhLCAhIWQubXVsdGlwbGUsIGMsICExKSA6IG51bGwgIT0gZC5kZWZhdWx0VmFsdWUgJiYgSGIoYSwgISFkLm11bHRpcGxlLCBkLmRlZmF1bHRWYWx1ZSwgITApOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgaC5vbkNsaWNrICYmIChhLm9uY2xpY2sgPSBzZCk7CiAgICAgICAgICB9CgogICAgICAgICAgRmQoZSwgZCkgJiYgKGIuZWZmZWN0VGFnIHw9IDQpOwogICAgICAgIH0KCiAgICAgICAgbnVsbCAhPT0gYi5yZWYgJiYgKGIuZWZmZWN0VGFnIHw9IDEyOCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CgogICAgY2FzZSA2OgogICAgICBpZiAoYSAmJiBudWxsICE9IGIuc3RhdGVOb2RlKSBxaShhLCBiLCBhLm1lbW9pemVkUHJvcHMsIGQpO2Vsc2UgewogICAgICAgIGlmICgic3RyaW5nIiAhPT0gdHlwZW9mIGQgJiYgbnVsbCA9PT0gYi5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHUoMTY2KSk7CiAgICAgICAgYyA9IGNoKGJoLmN1cnJlbnQpOwogICAgICAgIGNoKCRnLmN1cnJlbnQpOwogICAgICAgIFdoKGIpID8gKGMgPSBiLnN0YXRlTm9kZSwgZCA9IGIubWVtb2l6ZWRQcm9wcywgY1tNZF0gPSBiLCBjLm5vZGVWYWx1ZSAhPT0gZCAmJiAoYi5lZmZlY3RUYWcgfD0gNCkpIDogKGMgPSAoOSA9PT0gYy5ub2RlVHlwZSA/IGMgOiBjLm93bmVyRG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKGQpLCBjW01kXSA9IGIsIGIuc3RhdGVOb2RlID0gYyk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CgogICAgY2FzZSAxMzoKICAgICAgSChNKTsKICAgICAgZCA9IGIubWVtb2l6ZWRTdGF0ZTsKICAgICAgaWYgKDAgIT09IChiLmVmZmVjdFRhZyAmIDY0KSkgcmV0dXJuIGIuZXhwaXJhdGlvblRpbWUgPSBjLCBiOwogICAgICBjID0gbnVsbCAhPT0gZDsKICAgICAgZCA9ICExOwogICAgICBudWxsID09PSBhID8gdm9pZCAwICE9PSBiLm1lbW9pemVkUHJvcHMuZmFsbGJhY2sgJiYgV2goYikgOiAoZSA9IGEubWVtb2l6ZWRTdGF0ZSwgZCA9IG51bGwgIT09IGUsIGMgfHwgbnVsbCA9PT0gZSB8fCAoZSA9IGEuY2hpbGQuc2libGluZywgbnVsbCAhPT0gZSAmJiAoZiA9IGIuZmlyc3RFZmZlY3QsIG51bGwgIT09IGYgPyAoYi5maXJzdEVmZmVjdCA9IGUsIGUubmV4dEVmZmVjdCA9IGYpIDogKGIuZmlyc3RFZmZlY3QgPSBiLmxhc3RFZmZlY3QgPSBlLCBlLm5leHRFZmZlY3QgPSBudWxsKSwgZS5lZmZlY3RUYWcgPSA4KSkpOwogICAgICBpZiAoYyAmJiAhZCAmJiAwICE9PSAoYi5tb2RlICYgMikpIGlmIChudWxsID09PSBhICYmICEwICE9PSBiLm1lbW9pemVkUHJvcHMudW5zdGFibGVfYXZvaWRUaGlzRmFsbGJhY2sgfHwgMCAhPT0gKE0uY3VycmVudCAmIDEpKSBTID09PSB0aSAmJiAoUyA9IHVpKTtlbHNlIHsKICAgICAgICBpZiAoUyA9PT0gdGkgfHwgUyA9PT0gdWkpIFMgPSB2aTsKICAgICAgICAwICE9PSB3aSAmJiBudWxsICE9PSBUICYmICh4aShULCBVKSwgeWkoVCwgd2kpKTsKICAgICAgfQogICAgICBpZiAoYyB8fCBkKSBiLmVmZmVjdFRhZyB8PSA0OwogICAgICByZXR1cm4gbnVsbDsKCiAgICBjYXNlIDQ6CiAgICAgIHJldHVybiBlaCgpLCBvaShiKSwgbnVsbDsKCiAgICBjYXNlIDEwOgogICAgICByZXR1cm4gb2coYiksIG51bGw7CgogICAgY2FzZSAxNzoKICAgICAgcmV0dXJuIEwoYi50eXBlKSAmJiBEZigpLCBudWxsOwoKICAgIGNhc2UgMTk6CiAgICAgIEgoTSk7CiAgICAgIGQgPSBiLm1lbW9pemVkU3RhdGU7CiAgICAgIGlmIChudWxsID09PSBkKSByZXR1cm4gbnVsbDsKICAgICAgZSA9IDAgIT09IChiLmVmZmVjdFRhZyAmIDY0KTsKICAgICAgZiA9IGQucmVuZGVyaW5nOwogICAgICBpZiAobnVsbCA9PT0gZikgewogICAgICAgIGlmIChlKSByaShkLCAhMSk7ZWxzZSB7CiAgICAgICAgICBpZiAoUyAhPT0gdGkgfHwgbnVsbCAhPT0gYSAmJiAwICE9PSAoYS5lZmZlY3RUYWcgJiA2NCkpIGZvciAoZiA9IGIuY2hpbGQ7IG51bGwgIT09IGY7KSB7CiAgICAgICAgICAgIGEgPSBoaChmKTsKCiAgICAgICAgICAgIGlmIChudWxsICE9PSBhKSB7CiAgICAgICAgICAgICAgYi5lZmZlY3RUYWcgfD0gNjQ7CiAgICAgICAgICAgICAgcmkoZCwgITEpOwogICAgICAgICAgICAgIGUgPSBhLnVwZGF0ZVF1ZXVlOwogICAgICAgICAgICAgIG51bGwgIT09IGUgJiYgKGIudXBkYXRlUXVldWUgPSBlLCBiLmVmZmVjdFRhZyB8PSA0KTsKICAgICAgICAgICAgICBudWxsID09PSBkLmxhc3RFZmZlY3QgJiYgKGIuZmlyc3RFZmZlY3QgPSBudWxsKTsKICAgICAgICAgICAgICBiLmxhc3RFZmZlY3QgPSBkLmxhc3RFZmZlY3Q7CgogICAgICAgICAgICAgIGZvciAoZCA9IGIuY2hpbGQ7IG51bGwgIT09IGQ7KSB7CiAgICAgICAgICAgICAgICBlID0gZCwgZiA9IGMsIGUuZWZmZWN0VGFnICY9IDIsIGUubmV4dEVmZmVjdCA9IG51bGwsIGUuZmlyc3RFZmZlY3QgPSBudWxsLCBlLmxhc3RFZmZlY3QgPSBudWxsLCBhID0gZS5hbHRlcm5hdGUsIG51bGwgPT09IGEgPyAoZS5jaGlsZEV4cGlyYXRpb25UaW1lID0gMCwgZS5leHBpcmF0aW9uVGltZSA9IGYsIGUuY2hpbGQgPSBudWxsLCBlLm1lbW9pemVkUHJvcHMgPSBudWxsLCBlLm1lbW9pemVkU3RhdGUgPSBudWxsLCBlLnVwZGF0ZVF1ZXVlID0gbnVsbCwgZS5kZXBlbmRlbmNpZXMgPSBudWxsKSA6IChlLmNoaWxkRXhwaXJhdGlvblRpbWUgPSBhLmNoaWxkRXhwaXJhdGlvblRpbWUsIGUuZXhwaXJhdGlvblRpbWUgPSBhLmV4cGlyYXRpb25UaW1lLCBlLmNoaWxkID0gYS5jaGlsZCwgZS5tZW1vaXplZFByb3BzID0gYS5tZW1vaXplZFByb3BzLCBlLm1lbW9pemVkU3RhdGUgPSBhLm1lbW9pemVkU3RhdGUsIGUudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlLCBmID0gYS5kZXBlbmRlbmNpZXMsIGUuZGVwZW5kZW5jaWVzID0gbnVsbCA9PT0gZiA/IG51bGwgOiB7CiAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lOiBmLmV4cGlyYXRpb25UaW1lLAogICAgICAgICAgICAgICAgICBmaXJzdENvbnRleHQ6IGYuZmlyc3RDb250ZXh0LAogICAgICAgICAgICAgICAgICByZXNwb25kZXJzOiBmLnJlc3BvbmRlcnMKICAgICAgICAgICAgICAgIH0pLCBkID0gZC5zaWJsaW5nOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgSShNLCBNLmN1cnJlbnQgJiAxIHwgMik7CiAgICAgICAgICAgICAgcmV0dXJuIGIuY2hpbGQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGYgPSBmLnNpYmxpbmc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghZSkgaWYgKGEgPSBoaChmKSwgbnVsbCAhPT0gYSkgewogICAgICAgICAgaWYgKGIuZWZmZWN0VGFnIHw9IDY0LCBlID0gITAsIGMgPSBhLnVwZGF0ZVF1ZXVlLCBudWxsICE9PSBjICYmIChiLnVwZGF0ZVF1ZXVlID0gYywgYi5lZmZlY3RUYWcgfD0gNCksIHJpKGQsICEwKSwgbnVsbCA9PT0gZC50YWlsICYmICJoaWRkZW4iID09PSBkLnRhaWxNb2RlICYmICFmLmFsdGVybmF0ZSkgcmV0dXJuIGIgPSBiLmxhc3RFZmZlY3QgPSBkLmxhc3RFZmZlY3QsIG51bGwgIT09IGIgJiYgKGIubmV4dEVmZmVjdCA9IG51bGwpLCBudWxsOwogICAgICAgIH0gZWxzZSAyICogJGYoKSAtIGQucmVuZGVyaW5nU3RhcnRUaW1lID4gZC50YWlsRXhwaXJhdGlvbiAmJiAxIDwgYyAmJiAoYi5lZmZlY3RUYWcgfD0gNjQsIGUgPSAhMCwgcmkoZCwgITEpLCBiLmV4cGlyYXRpb25UaW1lID0gYi5jaGlsZEV4cGlyYXRpb25UaW1lID0gYyAtIDEpOwogICAgICAgIGQuaXNCYWNrd2FyZHMgPyAoZi5zaWJsaW5nID0gYi5jaGlsZCwgYi5jaGlsZCA9IGYpIDogKGMgPSBkLmxhc3QsIG51bGwgIT09IGMgPyBjLnNpYmxpbmcgPSBmIDogYi5jaGlsZCA9IGYsIGQubGFzdCA9IGYpOwogICAgICB9CiAgICAgIHJldHVybiBudWxsICE9PSBkLnRhaWwgPyAoMCA9PT0gZC50YWlsRXhwaXJhdGlvbiAmJiAoZC50YWlsRXhwaXJhdGlvbiA9ICRmKCkgKyA1MDApLCBjID0gZC50YWlsLCBkLnJlbmRlcmluZyA9IGMsIGQudGFpbCA9IGMuc2libGluZywgZC5sYXN0RWZmZWN0ID0gYi5sYXN0RWZmZWN0LCBkLnJlbmRlcmluZ1N0YXJ0VGltZSA9ICRmKCksIGMuc2libGluZyA9IG51bGwsIGIgPSBNLmN1cnJlbnQsIEkoTSwgZSA/IGIgJiAxIHwgMiA6IGIgJiAxKSwgYykgOiBudWxsOwogIH0KCiAgdGhyb3cgRXJyb3IodSgxNTYsIGIudGFnKSk7Cn0KCmZ1bmN0aW9uIHppKGEpIHsKICBzd2l0Y2ggKGEudGFnKSB7CiAgICBjYXNlIDE6CiAgICAgIEwoYS50eXBlKSAmJiBEZigpOwogICAgICB2YXIgYiA9IGEuZWZmZWN0VGFnOwogICAgICByZXR1cm4gYiAmIDQwOTYgPyAoYS5lZmZlY3RUYWcgPSBiICYgLTQwOTcgfCA2NCwgYSkgOiBudWxsOwoKICAgIGNhc2UgMzoKICAgICAgZWgoKTsKICAgICAgSChLKTsKICAgICAgSChKKTsKICAgICAgYiA9IGEuZWZmZWN0VGFnOwogICAgICBpZiAoMCAhPT0gKGIgJiA2NCkpIHRocm93IEVycm9yKHUoMjg1KSk7CiAgICAgIGEuZWZmZWN0VGFnID0gYiAmIC00MDk3IHwgNjQ7CiAgICAgIHJldHVybiBhOwoKICAgIGNhc2UgNToKICAgICAgcmV0dXJuIGdoKGEpLCBudWxsOwoKICAgIGNhc2UgMTM6CiAgICAgIHJldHVybiBIKE0pLCBiID0gYS5lZmZlY3RUYWcsIGIgJiA0MDk2ID8gKGEuZWZmZWN0VGFnID0gYiAmIC00MDk3IHwgNjQsIGEpIDogbnVsbDsKCiAgICBjYXNlIDE5OgogICAgICByZXR1cm4gSChNKSwgbnVsbDsKCiAgICBjYXNlIDQ6CiAgICAgIHJldHVybiBlaCgpLCBudWxsOwoKICAgIGNhc2UgMTA6CiAgICAgIHJldHVybiBvZyhhKSwgbnVsbDsKCiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gbnVsbDsKICB9Cn0KCmZ1bmN0aW9uIEFpKGEsIGIpIHsKICByZXR1cm4gewogICAgdmFsdWU6IGEsCiAgICBzb3VyY2U6IGIsCiAgICBzdGFjazogcWIoYikKICB9Owp9Cgp2YXIgQmkgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgV2Vha1NldCA/IFdlYWtTZXQgOiBTZXQ7CgpmdW5jdGlvbiBDaShhLCBiKSB7CiAgdmFyIGMgPSBiLnNvdXJjZSwKICAgICAgZCA9IGIuc3RhY2s7CiAgbnVsbCA9PT0gZCAmJiBudWxsICE9PSBjICYmIChkID0gcWIoYykpOwogIG51bGwgIT09IGMgJiYgcGIoYy50eXBlKTsKICBiID0gYi52YWx1ZTsKICBudWxsICE9PSBhICYmIDEgPT09IGEudGFnICYmIHBiKGEudHlwZSk7CgogIHRyeSB7CiAgICBjb25zb2xlLmVycm9yKGIpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICB0aHJvdyBlOwogICAgfSk7CiAgfQp9CgpmdW5jdGlvbiBEaShhLCBiKSB7CiAgdHJ5IHsKICAgIGIucHJvcHMgPSBhLm1lbW9pemVkUHJvcHMsIGIuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGUsIGIuY29tcG9uZW50V2lsbFVubW91bnQoKTsKICB9IGNhdGNoIChjKSB7CiAgICBFaShhLCBjKTsKICB9Cn0KCmZ1bmN0aW9uIEZpKGEpIHsKICB2YXIgYiA9IGEucmVmOwogIGlmIChudWxsICE9PSBiKSBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIpIHRyeSB7CiAgICBiKG51bGwpOwogIH0gY2F0Y2ggKGMpIHsKICAgIEVpKGEsIGMpOwogIH0gZWxzZSBiLmN1cnJlbnQgPSBudWxsOwp9CgpmdW5jdGlvbiBHaShhLCBiKSB7CiAgc3dpdGNoIChiLnRhZykgewogICAgY2FzZSAwOgogICAgY2FzZSAxMToKICAgIGNhc2UgMTU6CiAgICBjYXNlIDIyOgogICAgICByZXR1cm47CgogICAgY2FzZSAxOgogICAgICBpZiAoYi5lZmZlY3RUYWcgJiAyNTYgJiYgbnVsbCAhPT0gYSkgewogICAgICAgIHZhciBjID0gYS5tZW1vaXplZFByb3BzLAogICAgICAgICAgICBkID0gYS5tZW1vaXplZFN0YXRlOwogICAgICAgIGEgPSBiLnN0YXRlTm9kZTsKICAgICAgICBiID0gYS5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZShiLmVsZW1lbnRUeXBlID09PSBiLnR5cGUgPyBjIDogaWcoYi50eXBlLCBjKSwgZCk7CiAgICAgICAgYS5fX3JlYWN0SW50ZXJuYWxTbmFwc2hvdEJlZm9yZVVwZGF0ZSA9IGI7CiAgICAgIH0KCiAgICAgIHJldHVybjsKCiAgICBjYXNlIDM6CiAgICBjYXNlIDU6CiAgICBjYXNlIDY6CiAgICBjYXNlIDQ6CiAgICBjYXNlIDE3OgogICAgICByZXR1cm47CiAgfQoKICB0aHJvdyBFcnJvcih1KDE2MykpOwp9CgpmdW5jdGlvbiBIaShhLCBiKSB7CiAgYiA9IGIudXBkYXRlUXVldWU7CiAgYiA9IG51bGwgIT09IGIgPyBiLmxhc3RFZmZlY3QgOiBudWxsOwoKICBpZiAobnVsbCAhPT0gYikgewogICAgdmFyIGMgPSBiID0gYi5uZXh0OwoKICAgIGRvIHsKICAgICAgaWYgKChjLnRhZyAmIGEpID09PSBhKSB7CiAgICAgICAgdmFyIGQgPSBjLmRlc3Ryb3k7CiAgICAgICAgYy5kZXN0cm95ID0gdm9pZCAwOwogICAgICAgIHZvaWQgMCAhPT0gZCAmJiBkKCk7CiAgICAgIH0KCiAgICAgIGMgPSBjLm5leHQ7CiAgICB9IHdoaWxlIChjICE9PSBiKTsKICB9Cn0KCmZ1bmN0aW9uIElpKGEsIGIpIHsKICBiID0gYi51cGRhdGVRdWV1ZTsKICBiID0gbnVsbCAhPT0gYiA/IGIubGFzdEVmZmVjdCA6IG51bGw7CgogIGlmIChudWxsICE9PSBiKSB7CiAgICB2YXIgYyA9IGIgPSBiLm5leHQ7CgogICAgZG8gewogICAgICBpZiAoKGMudGFnICYgYSkgPT09IGEpIHsKICAgICAgICB2YXIgZCA9IGMuY3JlYXRlOwogICAgICAgIGMuZGVzdHJveSA9IGQoKTsKICAgICAgfQoKICAgICAgYyA9IGMubmV4dDsKICAgIH0gd2hpbGUgKGMgIT09IGIpOwogIH0KfQoKZnVuY3Rpb24gSmkoYSwgYiwgYykgewogIHN3aXRjaCAoYy50YWcpIHsKICAgIGNhc2UgMDoKICAgIGNhc2UgMTE6CiAgICBjYXNlIDE1OgogICAgY2FzZSAyMjoKICAgICAgSWkoMywgYyk7CiAgICAgIHJldHVybjsKCiAgICBjYXNlIDE6CiAgICAgIGEgPSBjLnN0YXRlTm9kZTsKICAgICAgaWYgKGMuZWZmZWN0VGFnICYgNCkgaWYgKG51bGwgPT09IGIpIGEuY29tcG9uZW50RGlkTW91bnQoKTtlbHNlIHsKICAgICAgICB2YXIgZCA9IGMuZWxlbWVudFR5cGUgPT09IGMudHlwZSA/IGIubWVtb2l6ZWRQcm9wcyA6IGlnKGMudHlwZSwgYi5tZW1vaXplZFByb3BzKTsKICAgICAgICBhLmNvbXBvbmVudERpZFVwZGF0ZShkLCBiLm1lbW9pemVkU3RhdGUsIGEuX19yZWFjdEludGVybmFsU25hcHNob3RCZWZvcmVVcGRhdGUpOwogICAgICB9CiAgICAgIGIgPSBjLnVwZGF0ZVF1ZXVlOwogICAgICBudWxsICE9PSBiICYmIENnKGMsIGIsIGEpOwogICAgICByZXR1cm47CgogICAgY2FzZSAzOgogICAgICBiID0gYy51cGRhdGVRdWV1ZTsKCiAgICAgIGlmIChudWxsICE9PSBiKSB7CiAgICAgICAgYSA9IG51bGw7CiAgICAgICAgaWYgKG51bGwgIT09IGMuY2hpbGQpIHN3aXRjaCAoYy5jaGlsZC50YWcpIHsKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgYSA9IGMuY2hpbGQuc3RhdGVOb2RlOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGEgPSBjLmNoaWxkLnN0YXRlTm9kZTsKICAgICAgICB9CiAgICAgICAgQ2coYywgYiwgYSk7CiAgICAgIH0KCiAgICAgIHJldHVybjsKCiAgICBjYXNlIDU6CiAgICAgIGEgPSBjLnN0YXRlTm9kZTsKICAgICAgbnVsbCA9PT0gYiAmJiBjLmVmZmVjdFRhZyAmIDQgJiYgRmQoYy50eXBlLCBjLm1lbW9pemVkUHJvcHMpICYmIGEuZm9jdXMoKTsKICAgICAgcmV0dXJuOwoKICAgIGNhc2UgNjoKICAgICAgcmV0dXJuOwoKICAgIGNhc2UgNDoKICAgICAgcmV0dXJuOwoKICAgIGNhc2UgMTI6CiAgICAgIHJldHVybjsKCiAgICBjYXNlIDEzOgogICAgICBudWxsID09PSBjLm1lbW9pemVkU3RhdGUgJiYgKGMgPSBjLmFsdGVybmF0ZSwgbnVsbCAhPT0gYyAmJiAoYyA9IGMubWVtb2l6ZWRTdGF0ZSwgbnVsbCAhPT0gYyAmJiAoYyA9IGMuZGVoeWRyYXRlZCwgbnVsbCAhPT0gYyAmJiBWYyhjKSkpKTsKICAgICAgcmV0dXJuOwoKICAgIGNhc2UgMTk6CiAgICBjYXNlIDE3OgogICAgY2FzZSAyMDoKICAgIGNhc2UgMjE6CiAgICAgIHJldHVybjsKICB9CgogIHRocm93IEVycm9yKHUoMTYzKSk7Cn0KCmZ1bmN0aW9uIEtpKGEsIGIsIGMpIHsKICAiZnVuY3Rpb24iID09PSB0eXBlb2YgTGkgJiYgTGkoYik7CgogIHN3aXRjaCAoYi50YWcpIHsKICAgIGNhc2UgMDoKICAgIGNhc2UgMTE6CiAgICBjYXNlIDE0OgogICAgY2FzZSAxNToKICAgIGNhc2UgMjI6CiAgICAgIGEgPSBiLnVwZGF0ZVF1ZXVlOwoKICAgICAgaWYgKG51bGwgIT09IGEgJiYgKGEgPSBhLmxhc3RFZmZlY3QsIG51bGwgIT09IGEpKSB7CiAgICAgICAgdmFyIGQgPSBhLm5leHQ7CiAgICAgICAgY2coOTcgPCBjID8gOTcgOiBjLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgYSA9IGQ7CgogICAgICAgICAgZG8gewogICAgICAgICAgICB2YXIgYyA9IGEuZGVzdHJveTsKCiAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMpIHsKICAgICAgICAgICAgICB2YXIgZyA9IGI7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjKCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoaCkgewogICAgICAgICAgICAgICAgRWkoZywgaCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBhID0gYS5uZXh0OwogICAgICAgICAgfSB3aGlsZSAoYSAhPT0gZCk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGJyZWFrOwoKICAgIGNhc2UgMToKICAgICAgRmkoYik7CiAgICAgIGMgPSBiLnN0YXRlTm9kZTsKICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuY29tcG9uZW50V2lsbFVubW91bnQgJiYgRGkoYiwgYyk7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgNToKICAgICAgRmkoYik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgNDoKICAgICAgTWkoYSwgYiwgYyk7CiAgfQp9CgpmdW5jdGlvbiBOaShhKSB7CiAgdmFyIGIgPSBhLmFsdGVybmF0ZTsKICBhLnJldHVybiA9IG51bGw7CiAgYS5jaGlsZCA9IG51bGw7CiAgYS5tZW1vaXplZFN0YXRlID0gbnVsbDsKICBhLnVwZGF0ZVF1ZXVlID0gbnVsbDsKICBhLmRlcGVuZGVuY2llcyA9IG51bGw7CiAgYS5hbHRlcm5hdGUgPSBudWxsOwogIGEuZmlyc3RFZmZlY3QgPSBudWxsOwogIGEubGFzdEVmZmVjdCA9IG51bGw7CiAgYS5wZW5kaW5nUHJvcHMgPSBudWxsOwogIGEubWVtb2l6ZWRQcm9wcyA9IG51bGw7CiAgYS5zdGF0ZU5vZGUgPSBudWxsOwogIG51bGwgIT09IGIgJiYgTmkoYik7Cn0KCmZ1bmN0aW9uIE9pKGEpIHsKICByZXR1cm4gNSA9PT0gYS50YWcgfHwgMyA9PT0gYS50YWcgfHwgNCA9PT0gYS50YWc7Cn0KCmZ1bmN0aW9uIFBpKGEpIHsKICBhOiB7CiAgICBmb3IgKHZhciBiID0gYS5yZXR1cm47IG51bGwgIT09IGI7KSB7CiAgICAgIGlmIChPaShiKSkgewogICAgICAgIHZhciBjID0gYjsKICAgICAgICBicmVhayBhOwogICAgICB9CgogICAgICBiID0gYi5yZXR1cm47CiAgICB9CgogICAgdGhyb3cgRXJyb3IodSgxNjApKTsKICB9CgogIGIgPSBjLnN0YXRlTm9kZTsKCiAgc3dpdGNoIChjLnRhZykgewogICAgY2FzZSA1OgogICAgICB2YXIgZCA9ICExOwogICAgICBicmVhazsKCiAgICBjYXNlIDM6CiAgICAgIGIgPSBiLmNvbnRhaW5lckluZm87CiAgICAgIGQgPSAhMDsKICAgICAgYnJlYWs7CgogICAgY2FzZSA0OgogICAgICBiID0gYi5jb250YWluZXJJbmZvOwogICAgICBkID0gITA7CiAgICAgIGJyZWFrOwoKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IEVycm9yKHUoMTYxKSk7CiAgfQoKICBjLmVmZmVjdFRhZyAmIDE2ICYmIChSYihiLCAiIiksIGMuZWZmZWN0VGFnICY9IC0xNyk7CgogIGE6IGI6IGZvciAoYyA9IGE7OykgewogICAgZm9yICg7IG51bGwgPT09IGMuc2libGluZzspIHsKICAgICAgaWYgKG51bGwgPT09IGMucmV0dXJuIHx8IE9pKGMucmV0dXJuKSkgewogICAgICAgIGMgPSBudWxsOwogICAgICAgIGJyZWFrIGE7CiAgICAgIH0KCiAgICAgIGMgPSBjLnJldHVybjsKICAgIH0KCiAgICBjLnNpYmxpbmcucmV0dXJuID0gYy5yZXR1cm47CgogICAgZm9yIChjID0gYy5zaWJsaW5nOyA1ICE9PSBjLnRhZyAmJiA2ICE9PSBjLnRhZyAmJiAxOCAhPT0gYy50YWc7KSB7CiAgICAgIGlmIChjLmVmZmVjdFRhZyAmIDIpIGNvbnRpbnVlIGI7CiAgICAgIGlmIChudWxsID09PSBjLmNoaWxkIHx8IDQgPT09IGMudGFnKSBjb250aW51ZSBiO2Vsc2UgYy5jaGlsZC5yZXR1cm4gPSBjLCBjID0gYy5jaGlsZDsKICAgIH0KCiAgICBpZiAoIShjLmVmZmVjdFRhZyAmIDIpKSB7CiAgICAgIGMgPSBjLnN0YXRlTm9kZTsKICAgICAgYnJlYWsgYTsKICAgIH0KICB9CgogIGQgPyBRaShhLCBjLCBiKSA6IFJpKGEsIGMsIGIpOwp9CgpmdW5jdGlvbiBRaShhLCBiLCBjKSB7CiAgdmFyIGQgPSBhLnRhZywKICAgICAgZSA9IDUgPT09IGQgfHwgNiA9PT0gZDsKICBpZiAoZSkgYSA9IGUgPyBhLnN0YXRlTm9kZSA6IGEuc3RhdGVOb2RlLmluc3RhbmNlLCBiID8gOCA9PT0gYy5ub2RlVHlwZSA/IGMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSwgYikgOiBjLmluc2VydEJlZm9yZShhLCBiKSA6ICg4ID09PSBjLm5vZGVUeXBlID8gKGIgPSBjLnBhcmVudE5vZGUsIGIuaW5zZXJ0QmVmb3JlKGEsIGMpKSA6IChiID0gYywgYi5hcHBlbmRDaGlsZChhKSksIGMgPSBjLl9yZWFjdFJvb3RDb250YWluZXIsIG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjIHx8IG51bGwgIT09IGIub25jbGljayB8fCAoYi5vbmNsaWNrID0gc2QpKTtlbHNlIGlmICg0ICE9PSBkICYmIChhID0gYS5jaGlsZCwgbnVsbCAhPT0gYSkpIGZvciAoUWkoYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7IG51bGwgIT09IGE7KSB7CiAgICBRaShhLCBiLCBjKSwgYSA9IGEuc2libGluZzsKICB9Cn0KCmZ1bmN0aW9uIFJpKGEsIGIsIGMpIHsKICB2YXIgZCA9IGEudGFnLAogICAgICBlID0gNSA9PT0gZCB8fCA2ID09PSBkOwogIGlmIChlKSBhID0gZSA/IGEuc3RhdGVOb2RlIDogYS5zdGF0ZU5vZGUuaW5zdGFuY2UsIGIgPyBjLmluc2VydEJlZm9yZShhLCBiKSA6IGMuYXBwZW5kQ2hpbGQoYSk7ZWxzZSBpZiAoNCAhPT0gZCAmJiAoYSA9IGEuY2hpbGQsIG51bGwgIT09IGEpKSBmb3IgKFJpKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nOyBudWxsICE9PSBhOykgewogICAgUmkoYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7CiAgfQp9CgpmdW5jdGlvbiBNaShhLCBiLCBjKSB7CiAgZm9yICh2YXIgZCA9IGIsIGUgPSAhMSwgZiwgZzs7KSB7CiAgICBpZiAoIWUpIHsKICAgICAgZSA9IGQucmV0dXJuOwoKICAgICAgYTogZm9yICg7OykgewogICAgICAgIGlmIChudWxsID09PSBlKSB0aHJvdyBFcnJvcih1KDE2MCkpOwogICAgICAgIGYgPSBlLnN0YXRlTm9kZTsKCiAgICAgICAgc3dpdGNoIChlLnRhZykgewogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBnID0gITE7CiAgICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBmID0gZi5jb250YWluZXJJbmZvOwogICAgICAgICAgICBnID0gITA7CiAgICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBmID0gZi5jb250YWluZXJJbmZvOwogICAgICAgICAgICBnID0gITA7CiAgICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgfQoKICAgICAgICBlID0gZS5yZXR1cm47CiAgICAgIH0KCiAgICAgIGUgPSAhMDsKICAgIH0KCiAgICBpZiAoNSA9PT0gZC50YWcgfHwgNiA9PT0gZC50YWcpIHsKICAgICAgYTogZm9yICh2YXIgaCA9IGEsIGsgPSBkLCBsID0gYywgbSA9IGs7OykgewogICAgICAgIGlmIChLaShoLCBtLCBsKSwgbnVsbCAhPT0gbS5jaGlsZCAmJiA0ICE9PSBtLnRhZykgbS5jaGlsZC5yZXR1cm4gPSBtLCBtID0gbS5jaGlsZDtlbHNlIHsKICAgICAgICAgIGlmIChtID09PSBrKSBicmVhayBhOwoKICAgICAgICAgIGZvciAoOyBudWxsID09PSBtLnNpYmxpbmc7KSB7CiAgICAgICAgICAgIGlmIChudWxsID09PSBtLnJldHVybiB8fCBtLnJldHVybiA9PT0gaykgYnJlYWsgYTsKICAgICAgICAgICAgbSA9IG0ucmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIG0uc2libGluZy5yZXR1cm4gPSBtLnJldHVybjsKICAgICAgICAgIG0gPSBtLnNpYmxpbmc7CiAgICAgICAgfQogICAgICB9CgogICAgICBnID8gKGggPSBmLCBrID0gZC5zdGF0ZU5vZGUsIDggPT09IGgubm9kZVR5cGUgPyBoLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaykgOiBoLnJlbW92ZUNoaWxkKGspKSA6IGYucmVtb3ZlQ2hpbGQoZC5zdGF0ZU5vZGUpOwogICAgfSBlbHNlIGlmICg0ID09PSBkLnRhZykgewogICAgICBpZiAobnVsbCAhPT0gZC5jaGlsZCkgewogICAgICAgIGYgPSBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvOwogICAgICAgIGcgPSAhMDsKICAgICAgICBkLmNoaWxkLnJldHVybiA9IGQ7CiAgICAgICAgZCA9IGQuY2hpbGQ7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoS2koYSwgZCwgYyksIG51bGwgIT09IGQuY2hpbGQpIHsKICAgICAgZC5jaGlsZC5yZXR1cm4gPSBkOwogICAgICBkID0gZC5jaGlsZDsKICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGQgPT09IGIpIGJyZWFrOwoKICAgIGZvciAoOyBudWxsID09PSBkLnNpYmxpbmc7KSB7CiAgICAgIGlmIChudWxsID09PSBkLnJldHVybiB8fCBkLnJldHVybiA9PT0gYikgcmV0dXJuOwogICAgICBkID0gZC5yZXR1cm47CiAgICAgIDQgPT09IGQudGFnICYmIChlID0gITEpOwogICAgfQoKICAgIGQuc2libGluZy5yZXR1cm4gPSBkLnJldHVybjsKICAgIGQgPSBkLnNpYmxpbmc7CiAgfQp9CgpmdW5jdGlvbiBTaShhLCBiKSB7CiAgc3dpdGNoIChiLnRhZykgewogICAgY2FzZSAwOgogICAgY2FzZSAxMToKICAgIGNhc2UgMTQ6CiAgICBjYXNlIDE1OgogICAgY2FzZSAyMjoKICAgICAgSGkoMywgYik7CiAgICAgIHJldHVybjsKCiAgICBjYXNlIDE6CiAgICAgIHJldHVybjsKCiAgICBjYXNlIDU6CiAgICAgIHZhciBjID0gYi5zdGF0ZU5vZGU7CgogICAgICBpZiAobnVsbCAhPSBjKSB7CiAgICAgICAgdmFyIGQgPSBiLm1lbW9pemVkUHJvcHMsCiAgICAgICAgICAgIGUgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFByb3BzIDogZDsKICAgICAgICBhID0gYi50eXBlOwogICAgICAgIHZhciBmID0gYi51cGRhdGVRdWV1ZTsKICAgICAgICBiLnVwZGF0ZVF1ZXVlID0gbnVsbDsKCiAgICAgICAgaWYgKG51bGwgIT09IGYpIHsKICAgICAgICAgIGNbTmRdID0gZDsKICAgICAgICAgICJpbnB1dCIgPT09IGEgJiYgInJhZGlvIiA9PT0gZC50eXBlICYmIG51bGwgIT0gZC5uYW1lICYmIEJiKGMsIGQpOwogICAgICAgICAgcGQoYSwgZSk7CiAgICAgICAgICBiID0gcGQoYSwgZCk7CgogICAgICAgICAgZm9yIChlID0gMDsgZSA8IGYubGVuZ3RoOyBlICs9IDIpIHsKICAgICAgICAgICAgdmFyIGcgPSBmW2VdLAogICAgICAgICAgICAgICAgaCA9IGZbZSArIDFdOwogICAgICAgICAgICAic3R5bGUiID09PSBnID8gbWQoYywgaCkgOiAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBnID8gUWIoYywgaCkgOiAiY2hpbGRyZW4iID09PSBnID8gUmIoYywgaCkgOiBYYShjLCBnLCBoLCBiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAiaW5wdXQiOgogICAgICAgICAgICAgIENiKGMsIGQpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAidGV4dGFyZWEiOgogICAgICAgICAgICAgIEtiKGMsIGQpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAic2VsZWN0IjoKICAgICAgICAgICAgICBiID0gYy5fd3JhcHBlclN0YXRlLndhc011bHRpcGxlLCBjLl93cmFwcGVyU3RhdGUud2FzTXVsdGlwbGUgPSAhIWQubXVsdGlwbGUsIGEgPSBkLnZhbHVlLCBudWxsICE9IGEgPyBIYihjLCAhIWQubXVsdGlwbGUsIGEsICExKSA6IGIgIT09ICEhZC5tdWx0aXBsZSAmJiAobnVsbCAhPSBkLmRlZmF1bHRWYWx1ZSA/IEhiKGMsICEhZC5tdWx0aXBsZSwgZC5kZWZhdWx0VmFsdWUsICEwKSA6IEhiKGMsICEhZC5tdWx0aXBsZSwgZC5tdWx0aXBsZSA/IFtdIDogIiIsICExKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm47CgogICAgY2FzZSA2OgogICAgICBpZiAobnVsbCA9PT0gYi5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHUoMTYyKSk7CiAgICAgIGIuc3RhdGVOb2RlLm5vZGVWYWx1ZSA9IGIubWVtb2l6ZWRQcm9wczsKICAgICAgcmV0dXJuOwoKICAgIGNhc2UgMzoKICAgICAgYiA9IGIuc3RhdGVOb2RlOwogICAgICBiLmh5ZHJhdGUgJiYgKGIuaHlkcmF0ZSA9ICExLCBWYyhiLmNvbnRhaW5lckluZm8pKTsKICAgICAgcmV0dXJuOwoKICAgIGNhc2UgMTI6CiAgICAgIHJldHVybjsKCiAgICBjYXNlIDEzOgogICAgICBjID0gYjsKICAgICAgbnVsbCA9PT0gYi5tZW1vaXplZFN0YXRlID8gZCA9ICExIDogKGQgPSAhMCwgYyA9IGIuY2hpbGQsIFRpID0gJGYoKSk7CiAgICAgIGlmIChudWxsICE9PSBjKSBhOiBmb3IgKGEgPSBjOzspIHsKICAgICAgICBpZiAoNSA9PT0gYS50YWcpIGYgPSBhLnN0YXRlTm9kZSwgZCA/IChmID0gZi5zdHlsZSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYuc2V0UHJvcGVydHkgPyBmLnNldFByb3BlcnR5KCJkaXNwbGF5IiwgIm5vbmUiLCAiaW1wb3J0YW50IikgOiBmLmRpc3BsYXkgPSAibm9uZSIpIDogKGYgPSBhLnN0YXRlTm9kZSwgZSA9IGEubWVtb2l6ZWRQcm9wcy5zdHlsZSwgZSA9IHZvaWQgMCAhPT0gZSAmJiBudWxsICE9PSBlICYmIGUuaGFzT3duUHJvcGVydHkoImRpc3BsYXkiKSA/IGUuZGlzcGxheSA6IG51bGwsIGYuc3R5bGUuZGlzcGxheSA9IGxkKCJkaXNwbGF5IiwgZSkpO2Vsc2UgaWYgKDYgPT09IGEudGFnKSBhLnN0YXRlTm9kZS5ub2RlVmFsdWUgPSBkID8gIiIgOiBhLm1lbW9pemVkUHJvcHM7ZWxzZSBpZiAoMTMgPT09IGEudGFnICYmIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSAmJiBudWxsID09PSBhLm1lbW9pemVkU3RhdGUuZGVoeWRyYXRlZCkgewogICAgICAgICAgZiA9IGEuY2hpbGQuc2libGluZzsKICAgICAgICAgIGYucmV0dXJuID0gYTsKICAgICAgICAgIGEgPSBmOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSBlbHNlIGlmIChudWxsICE9PSBhLmNoaWxkKSB7CiAgICAgICAgICBhLmNoaWxkLnJldHVybiA9IGE7CiAgICAgICAgICBhID0gYS5jaGlsZDsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYSA9PT0gYykgYnJlYWs7CgogICAgICAgIGZvciAoOyBudWxsID09PSBhLnNpYmxpbmc7KSB7CiAgICAgICAgICBpZiAobnVsbCA9PT0gYS5yZXR1cm4gfHwgYS5yZXR1cm4gPT09IGMpIGJyZWFrIGE7CiAgICAgICAgICBhID0gYS5yZXR1cm47CiAgICAgICAgfQoKICAgICAgICBhLnNpYmxpbmcucmV0dXJuID0gYS5yZXR1cm47CiAgICAgICAgYSA9IGEuc2libGluZzsKICAgICAgfQogICAgICBVaShiKTsKICAgICAgcmV0dXJuOwoKICAgIGNhc2UgMTk6CiAgICAgIFVpKGIpOwogICAgICByZXR1cm47CgogICAgY2FzZSAxNzoKICAgICAgcmV0dXJuOwogIH0KCiAgdGhyb3cgRXJyb3IodSgxNjMpKTsKfQoKZnVuY3Rpb24gVWkoYSkgewogIHZhciBiID0gYS51cGRhdGVRdWV1ZTsKCiAgaWYgKG51bGwgIT09IGIpIHsKICAgIGEudXBkYXRlUXVldWUgPSBudWxsOwogICAgdmFyIGMgPSBhLnN0YXRlTm9kZTsKICAgIG51bGwgPT09IGMgJiYgKGMgPSBhLnN0YXRlTm9kZSA9IG5ldyBCaSgpKTsKICAgIGIuZm9yRWFjaChmdW5jdGlvbiAoYikgewogICAgICB2YXIgZCA9IFZpLmJpbmQobnVsbCwgYSwgYik7CiAgICAgIGMuaGFzKGIpIHx8IChjLmFkZChiKSwgYi50aGVuKGQsIGQpKTsKICAgIH0pOwogIH0KfQoKdmFyIFdpID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFdlYWtNYXAgPyBXZWFrTWFwIDogTWFwOwoKZnVuY3Rpb24gWGkoYSwgYiwgYykgewogIGMgPSB3ZyhjLCBudWxsKTsKICBjLnRhZyA9IDM7CiAgYy5wYXlsb2FkID0gewogICAgZWxlbWVudDogbnVsbAogIH07CiAgdmFyIGQgPSBiLnZhbHVlOwoKICBjLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkgewogICAgWWkgfHwgKFlpID0gITAsIFppID0gZCk7CiAgICBDaShhLCBiKTsKICB9OwoKICByZXR1cm4gYzsKfQoKZnVuY3Rpb24gJGkoYSwgYiwgYykgewogIGMgPSB3ZyhjLCBudWxsKTsKICBjLnRhZyA9IDM7CiAgdmFyIGQgPSBhLnR5cGUuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yOwoKICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHsKICAgIHZhciBlID0gYi52YWx1ZTsKCiAgICBjLnBheWxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIENpKGEsIGIpOwogICAgICByZXR1cm4gZChlKTsKICAgIH07CiAgfQoKICB2YXIgZiA9IGEuc3RhdGVOb2RlOwogIG51bGwgIT09IGYgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKGMuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZCAmJiAobnVsbCA9PT0gYWogPyBhaiA9IG5ldyBTZXQoW3RoaXNdKSA6IGFqLmFkZCh0aGlzKSwgQ2koYSwgYikpOwogICAgdmFyIGMgPSBiLnN0YWNrOwogICAgdGhpcy5jb21wb25lbnREaWRDYXRjaChiLnZhbHVlLCB7CiAgICAgIGNvbXBvbmVudFN0YWNrOiBudWxsICE9PSBjID8gYyA6ICIiCiAgICB9KTsKICB9KTsKICByZXR1cm4gYzsKfQoKdmFyIGJqID0gTWF0aC5jZWlsLAogICAgY2ogPSBXYS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLAogICAgZGogPSBXYS5SZWFjdEN1cnJlbnRPd25lciwKICAgIFYgPSAwLAogICAgZWogPSA4LAogICAgZmogPSAxNiwKICAgIGdqID0gMzIsCiAgICB0aSA9IDAsCiAgICBoaiA9IDEsCiAgICBpaiA9IDIsCiAgICB1aSA9IDMsCiAgICB2aSA9IDQsCiAgICBqaiA9IDUsCiAgICBXID0gViwKICAgIFQgPSBudWxsLAogICAgWCA9IG51bGwsCiAgICBVID0gMCwKICAgIFMgPSB0aSwKICAgIGtqID0gbnVsbCwKICAgIGxqID0gMTA3Mzc0MTgyMywKICAgIG1qID0gMTA3Mzc0MTgyMywKICAgIG5qID0gbnVsbCwKICAgIHdpID0gMCwKICAgIG9qID0gITEsCiAgICBUaSA9IDAsCiAgICBwaiA9IDUwMCwKICAgIFkgPSBudWxsLAogICAgWWkgPSAhMSwKICAgIFppID0gbnVsbCwKICAgIGFqID0gbnVsbCwKICAgIHFqID0gITEsCiAgICByaiA9IG51bGwsCiAgICBzaiA9IDkwLAogICAgdGogPSBudWxsLAogICAgdWogPSAwLAogICAgdmogPSBudWxsLAogICAgd2ogPSAwOwoKZnVuY3Rpb24gR2coKSB7CiAgcmV0dXJuIChXICYgKGZqIHwgZ2opKSAhPT0gViA/IDEwNzM3NDE4MjEgLSAoJGYoKSAvIDEwIHwgMCkgOiAwICE9PSB3aiA/IHdqIDogd2ogPSAxMDczNzQxODIxIC0gKCRmKCkgLyAxMCB8IDApOwp9CgpmdW5jdGlvbiBIZyhhLCBiLCBjKSB7CiAgYiA9IGIubW9kZTsKICBpZiAoMCA9PT0gKGIgJiAyKSkgcmV0dXJuIDEwNzM3NDE4MjM7CiAgdmFyIGQgPSBhZygpOwogIGlmICgwID09PSAoYiAmIDQpKSByZXR1cm4gOTkgPT09IGQgPyAxMDczNzQxODIzIDogMTA3Mzc0MTgyMjsKICBpZiAoKFcgJiBmaikgIT09IFYpIHJldHVybiBVOwogIGlmIChudWxsICE9PSBjKSBhID0gaGcoYSwgYy50aW1lb3V0TXMgfCAwIHx8IDVFMywgMjUwKTtlbHNlIHN3aXRjaCAoZCkgewogICAgY2FzZSA5OToKICAgICAgYSA9IDEwNzM3NDE4MjM7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgOTg6CiAgICAgIGEgPSBoZyhhLCAxNTAsIDEwMCk7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgOTc6CiAgICBjYXNlIDk2OgogICAgICBhID0gaGcoYSwgNUUzLCAyNTApOwogICAgICBicmVhazsKCiAgICBjYXNlIDk1OgogICAgICBhID0gMjsKICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgRXJyb3IodSgzMjYpKTsKICB9CiAgbnVsbCAhPT0gVCAmJiBhID09PSBVICYmIC0tYTsKICByZXR1cm4gYTsKfQoKZnVuY3Rpb24gSWcoYSwgYikgewogIGlmICg1MCA8IHVqKSB0aHJvdyB1aiA9IDAsIHZqID0gbnVsbCwgRXJyb3IodSgxODUpKTsKICBhID0geGooYSwgYik7CgogIGlmIChudWxsICE9PSBhKSB7CiAgICB2YXIgYyA9IGFnKCk7CiAgICAxMDczNzQxODIzID09PSBiID8gKFcgJiBlaikgIT09IFYgJiYgKFcgJiAoZmogfCBnaikpID09PSBWID8geWooYSkgOiAoWihhKSwgVyA9PT0gViAmJiBnZygpKSA6IFooYSk7CiAgICAoVyAmIDQpID09PSBWIHx8IDk4ICE9PSBjICYmIDk5ICE9PSBjIHx8IChudWxsID09PSB0aiA/IHRqID0gbmV3IE1hcChbW2EsIGJdXSkgOiAoYyA9IHRqLmdldChhKSwgKHZvaWQgMCA9PT0gYyB8fCBjID4gYikgJiYgdGouc2V0KGEsIGIpKSk7CiAgfQp9CgpmdW5jdGlvbiB4aihhLCBiKSB7CiAgYS5leHBpcmF0aW9uVGltZSA8IGIgJiYgKGEuZXhwaXJhdGlvblRpbWUgPSBiKTsKICB2YXIgYyA9IGEuYWx0ZXJuYXRlOwogIG51bGwgIT09IGMgJiYgYy5leHBpcmF0aW9uVGltZSA8IGIgJiYgKGMuZXhwaXJhdGlvblRpbWUgPSBiKTsKICB2YXIgZCA9IGEucmV0dXJuLAogICAgICBlID0gbnVsbDsKICBpZiAobnVsbCA9PT0gZCAmJiAzID09PSBhLnRhZykgZSA9IGEuc3RhdGVOb2RlO2Vsc2UgZm9yICg7IG51bGwgIT09IGQ7KSB7CiAgICBjID0gZC5hbHRlcm5hdGU7CiAgICBkLmNoaWxkRXhwaXJhdGlvblRpbWUgPCBiICYmIChkLmNoaWxkRXhwaXJhdGlvblRpbWUgPSBiKTsKICAgIG51bGwgIT09IGMgJiYgYy5jaGlsZEV4cGlyYXRpb25UaW1lIDwgYiAmJiAoYy5jaGlsZEV4cGlyYXRpb25UaW1lID0gYik7CgogICAgaWYgKG51bGwgPT09IGQucmV0dXJuICYmIDMgPT09IGQudGFnKSB7CiAgICAgIGUgPSBkLnN0YXRlTm9kZTsKICAgICAgYnJlYWs7CiAgICB9CgogICAgZCA9IGQucmV0dXJuOwogIH0KICBudWxsICE9PSBlICYmIChUID09PSBlICYmIChCZyhiKSwgUyA9PT0gdmkgJiYgeGkoZSwgVSkpLCB5aShlLCBiKSk7CiAgcmV0dXJuIGU7Cn0KCmZ1bmN0aW9uIHpqKGEpIHsKICB2YXIgYiA9IGEubGFzdEV4cGlyZWRUaW1lOwogIGlmICgwICE9PSBiKSByZXR1cm4gYjsKICBiID0gYS5maXJzdFBlbmRpbmdUaW1lOwogIGlmICghQWooYSwgYikpIHJldHVybiBiOwogIHZhciBjID0gYS5sYXN0UGluZ2VkVGltZTsKICBhID0gYS5uZXh0S25vd25QZW5kaW5nTGV2ZWw7CiAgYSA9IGMgPiBhID8gYyA6IGE7CiAgcmV0dXJuIDIgPj0gYSAmJiBiICE9PSBhID8gMCA6IGE7Cn0KCmZ1bmN0aW9uIFooYSkgewogIGlmICgwICE9PSBhLmxhc3RFeHBpcmVkVGltZSkgYS5jYWxsYmFja0V4cGlyYXRpb25UaW1lID0gMTA3Mzc0MTgyMywgYS5jYWxsYmFja1ByaW9yaXR5ID0gOTksIGEuY2FsbGJhY2tOb2RlID0gZWcoeWouYmluZChudWxsLCBhKSk7ZWxzZSB7CiAgICB2YXIgYiA9IHpqKGEpLAogICAgICAgIGMgPSBhLmNhbGxiYWNrTm9kZTsKICAgIGlmICgwID09PSBiKSBudWxsICE9PSBjICYmIChhLmNhbGxiYWNrTm9kZSA9IG51bGwsIGEuY2FsbGJhY2tFeHBpcmF0aW9uVGltZSA9IDAsIGEuY2FsbGJhY2tQcmlvcml0eSA9IDkwKTtlbHNlIHsKICAgICAgdmFyIGQgPSBHZygpOwogICAgICAxMDczNzQxODIzID09PSBiID8gZCA9IDk5IDogMSA9PT0gYiB8fCAyID09PSBiID8gZCA9IDk1IDogKGQgPSAxMCAqICgxMDczNzQxODIxIC0gYikgLSAxMCAqICgxMDczNzQxODIxIC0gZCksIGQgPSAwID49IGQgPyA5OSA6IDI1MCA+PSBkID8gOTggOiA1MjUwID49IGQgPyA5NyA6IDk1KTsKCiAgICAgIGlmIChudWxsICE9PSBjKSB7CiAgICAgICAgdmFyIGUgPSBhLmNhbGxiYWNrUHJpb3JpdHk7CiAgICAgICAgaWYgKGEuY2FsbGJhY2tFeHBpcmF0aW9uVGltZSA9PT0gYiAmJiBlID49IGQpIHJldHVybjsKICAgICAgICBjICE9PSBUZiAmJiBLZihjKTsKICAgICAgfQoKICAgICAgYS5jYWxsYmFja0V4cGlyYXRpb25UaW1lID0gYjsKICAgICAgYS5jYWxsYmFja1ByaW9yaXR5ID0gZDsKICAgICAgYiA9IDEwNzM3NDE4MjMgPT09IGIgPyBlZyh5ai5iaW5kKG51bGwsIGEpKSA6IGRnKGQsIEJqLmJpbmQobnVsbCwgYSksIHsKICAgICAgICB0aW1lb3V0OiAxMCAqICgxMDczNzQxODIxIC0gYikgLSAkZigpCiAgICAgIH0pOwogICAgICBhLmNhbGxiYWNrTm9kZSA9IGI7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBCaihhLCBiKSB7CiAgd2ogPSAwOwogIGlmIChiKSByZXR1cm4gYiA9IEdnKCksIENqKGEsIGIpLCBaKGEpLCBudWxsOwogIHZhciBjID0gemooYSk7CgogIGlmICgwICE9PSBjKSB7CiAgICBiID0gYS5jYWxsYmFja05vZGU7CiAgICBpZiAoKFcgJiAoZmogfCBnaikpICE9PSBWKSB0aHJvdyBFcnJvcih1KDMyNykpOwogICAgRGooKTsKICAgIGEgPT09IFQgJiYgYyA9PT0gVSB8fCBFaihhLCBjKTsKCiAgICBpZiAobnVsbCAhPT0gWCkgewogICAgICB2YXIgZCA9IFc7CiAgICAgIFcgfD0gZmo7CiAgICAgIHZhciBlID0gRmooKTsKCiAgICAgIGRvIHsKICAgICAgICB0cnkgewogICAgICAgICAgR2ooKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gY2F0Y2ggKGgpIHsKICAgICAgICAgIEhqKGEsIGgpOwogICAgICAgIH0KICAgICAgfSB3aGlsZSAoMSk7CgogICAgICBuZygpOwogICAgICBXID0gZDsKICAgICAgY2ouY3VycmVudCA9IGU7CiAgICAgIGlmIChTID09PSBoaikgdGhyb3cgYiA9IGtqLCBFaihhLCBjKSwgeGkoYSwgYyksIFooYSksIGI7CiAgICAgIGlmIChudWxsID09PSBYKSBzd2l0Y2ggKGUgPSBhLmZpbmlzaGVkV29yayA9IGEuY3VycmVudC5hbHRlcm5hdGUsIGEuZmluaXNoZWRFeHBpcmF0aW9uVGltZSA9IGMsIGQgPSBTLCBUID0gbnVsbCwgZCkgewogICAgICAgIGNhc2UgdGk6CiAgICAgICAgY2FzZSBoajoKICAgICAgICAgIHRocm93IEVycm9yKHUoMzQ1KSk7CgogICAgICAgIGNhc2UgaWo6CiAgICAgICAgICBDaihhLCAyIDwgYyA/IDIgOiBjKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIHVpOgogICAgICAgICAgeGkoYSwgYyk7CiAgICAgICAgICBkID0gYS5sYXN0U3VzcGVuZGVkVGltZTsKICAgICAgICAgIGMgPT09IGQgJiYgKGEubmV4dEtub3duUGVuZGluZ0xldmVsID0gSWooZSkpOwoKICAgICAgICAgIGlmICgxMDczNzQxODIzID09PSBsaiAmJiAoZSA9IFRpICsgcGogLSAkZigpLCAxMCA8IGUpKSB7CiAgICAgICAgICAgIGlmIChvaikgewogICAgICAgICAgICAgIHZhciBmID0gYS5sYXN0UGluZ2VkVGltZTsKCiAgICAgICAgICAgICAgaWYgKDAgPT09IGYgfHwgZiA+PSBjKSB7CiAgICAgICAgICAgICAgICBhLmxhc3RQaW5nZWRUaW1lID0gYzsKICAgICAgICAgICAgICAgIEVqKGEsIGMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmID0gemooYSk7CiAgICAgICAgICAgIGlmICgwICE9PSBmICYmIGYgIT09IGMpIGJyZWFrOwoKICAgICAgICAgICAgaWYgKDAgIT09IGQgJiYgZCAhPT0gYykgewogICAgICAgICAgICAgIGEubGFzdFBpbmdlZFRpbWUgPSBkOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhLnRpbWVvdXRIYW5kbGUgPSBIZChKai5iaW5kKG51bGwsIGEpLCBlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgSmooYSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSB2aToKICAgICAgICAgIHhpKGEsIGMpOwogICAgICAgICAgZCA9IGEubGFzdFN1c3BlbmRlZFRpbWU7CiAgICAgICAgICBjID09PSBkICYmIChhLm5leHRLbm93blBlbmRpbmdMZXZlbCA9IElqKGUpKTsKCiAgICAgICAgICBpZiAob2ogJiYgKGUgPSBhLmxhc3RQaW5nZWRUaW1lLCAwID09PSBlIHx8IGUgPj0gYykpIHsKICAgICAgICAgICAgYS5sYXN0UGluZ2VkVGltZSA9IGM7CiAgICAgICAgICAgIEVqKGEsIGMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBlID0gemooYSk7CiAgICAgICAgICBpZiAoMCAhPT0gZSAmJiBlICE9PSBjKSBicmVhazsKCiAgICAgICAgICBpZiAoMCAhPT0gZCAmJiBkICE9PSBjKSB7CiAgICAgICAgICAgIGEubGFzdFBpbmdlZFRpbWUgPSBkOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICAxMDczNzQxODIzICE9PSBtaiA/IGQgPSAxMCAqICgxMDczNzQxODIxIC0gbWopIC0gJGYoKSA6IDEwNzM3NDE4MjMgPT09IGxqID8gZCA9IDAgOiAoZCA9IDEwICogKDEwNzM3NDE4MjEgLSBsaikgLSA1RTMsIGUgPSAkZigpLCBjID0gMTAgKiAoMTA3Mzc0MTgyMSAtIGMpIC0gZSwgZCA9IGUgLSBkLCAwID4gZCAmJiAoZCA9IDApLCBkID0gKDEyMCA+IGQgPyAxMjAgOiA0ODAgPiBkID8gNDgwIDogMTA4MCA+IGQgPyAxMDgwIDogMTkyMCA+IGQgPyAxOTIwIDogM0UzID4gZCA/IDNFMyA6IDQzMjAgPiBkID8gNDMyMCA6IDE5NjAgKiBiaihkIC8gMTk2MCkpIC0gZCwgYyA8IGQgJiYgKGQgPSBjKSk7CgogICAgICAgICAgaWYgKDEwIDwgZCkgewogICAgICAgICAgICBhLnRpbWVvdXRIYW5kbGUgPSBIZChKai5iaW5kKG51bGwsIGEpLCBkKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgSmooYSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBqajoKICAgICAgICAgIGlmICgxMDczNzQxODIzICE9PSBsaiAmJiBudWxsICE9PSBuaikgewogICAgICAgICAgICBmID0gbGo7CiAgICAgICAgICAgIHZhciBnID0gbmo7CiAgICAgICAgICAgIGQgPSBnLmJ1c3lNaW5EdXJhdGlvbk1zIHwgMDsKICAgICAgICAgICAgMCA+PSBkID8gZCA9IDAgOiAoZSA9IGcuYnVzeURlbGF5TXMgfCAwLCBmID0gJGYoKSAtICgxMCAqICgxMDczNzQxODIxIC0gZikgLSAoZy50aW1lb3V0TXMgfCAwIHx8IDVFMykpLCBkID0gZiA8PSBlID8gMCA6IGUgKyBkIC0gZik7CgogICAgICAgICAgICBpZiAoMTAgPCBkKSB7CiAgICAgICAgICAgICAgeGkoYSwgYyk7CiAgICAgICAgICAgICAgYS50aW1lb3V0SGFuZGxlID0gSGQoSmouYmluZChudWxsLCBhKSwgZCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBKaihhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgRXJyb3IodSgzMjkpKTsKICAgICAgfQogICAgICBaKGEpOwogICAgICBpZiAoYS5jYWxsYmFja05vZGUgPT09IGIpIHJldHVybiBCai5iaW5kKG51bGwsIGEpOwogICAgfQogIH0KCiAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIHlqKGEpIHsKICB2YXIgYiA9IGEubGFzdEV4cGlyZWRUaW1lOwogIGIgPSAwICE9PSBiID8gYiA6IDEwNzM3NDE4MjM7CiAgaWYgKChXICYgKGZqIHwgZ2opKSAhPT0gVikgdGhyb3cgRXJyb3IodSgzMjcpKTsKICBEaigpOwogIGEgPT09IFQgJiYgYiA9PT0gVSB8fCBFaihhLCBiKTsKCiAgaWYgKG51bGwgIT09IFgpIHsKICAgIHZhciBjID0gVzsKICAgIFcgfD0gZmo7CiAgICB2YXIgZCA9IEZqKCk7CgogICAgZG8gewogICAgICB0cnkgewogICAgICAgIEtqKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBIaihhLCBlKTsKICAgICAgfQogICAgfSB3aGlsZSAoMSk7CgogICAgbmcoKTsKICAgIFcgPSBjOwogICAgY2ouY3VycmVudCA9IGQ7CiAgICBpZiAoUyA9PT0gaGopIHRocm93IGMgPSBraiwgRWooYSwgYiksIHhpKGEsIGIpLCBaKGEpLCBjOwogICAgaWYgKG51bGwgIT09IFgpIHRocm93IEVycm9yKHUoMjYxKSk7CiAgICBhLmZpbmlzaGVkV29yayA9IGEuY3VycmVudC5hbHRlcm5hdGU7CiAgICBhLmZpbmlzaGVkRXhwaXJhdGlvblRpbWUgPSBiOwogICAgVCA9IG51bGw7CiAgICBKaihhKTsKICAgIFooYSk7CiAgfQoKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gTGooKSB7CiAgaWYgKG51bGwgIT09IHRqKSB7CiAgICB2YXIgYSA9IHRqOwogICAgdGogPSBudWxsOwogICAgYS5mb3JFYWNoKGZ1bmN0aW9uIChhLCBjKSB7CiAgICAgIENqKGMsIGEpOwogICAgICBaKGMpOwogICAgfSk7CiAgICBnZygpOwogIH0KfQoKZnVuY3Rpb24gTWooYSwgYikgewogIHZhciBjID0gVzsKICBXIHw9IDE7CgogIHRyeSB7CiAgICByZXR1cm4gYShiKTsKICB9IGZpbmFsbHkgewogICAgVyA9IGMsIFcgPT09IFYgJiYgZ2coKTsKICB9Cn0KCmZ1bmN0aW9uIE5qKGEsIGIpIHsKICB2YXIgYyA9IFc7CiAgVyAmPSAtMjsKICBXIHw9IGVqOwoKICB0cnkgewogICAgcmV0dXJuIGEoYik7CiAgfSBmaW5hbGx5IHsKICAgIFcgPSBjLCBXID09PSBWICYmIGdnKCk7CiAgfQp9CgpmdW5jdGlvbiBFaihhLCBiKSB7CiAgYS5maW5pc2hlZFdvcmsgPSBudWxsOwogIGEuZmluaXNoZWRFeHBpcmF0aW9uVGltZSA9IDA7CiAgdmFyIGMgPSBhLnRpbWVvdXRIYW5kbGU7CiAgLTEgIT09IGMgJiYgKGEudGltZW91dEhhbmRsZSA9IC0xLCBJZChjKSk7CiAgaWYgKG51bGwgIT09IFgpIGZvciAoYyA9IFgucmV0dXJuOyBudWxsICE9PSBjOykgewogICAgdmFyIGQgPSBjOwoKICAgIHN3aXRjaCAoZC50YWcpIHsKICAgICAgY2FzZSAxOgogICAgICAgIGQgPSBkLnR5cGUuY2hpbGRDb250ZXh0VHlwZXM7CiAgICAgICAgbnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQgJiYgRGYoKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzoKICAgICAgICBlaCgpOwogICAgICAgIEgoSyk7CiAgICAgICAgSChKKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNToKICAgICAgICBnaChkKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICBlaCgpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMzoKICAgICAgICBIKE0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxOToKICAgICAgICBIKE0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMDoKICAgICAgICBvZyhkKTsKICAgIH0KCiAgICBjID0gYy5yZXR1cm47CiAgfQogIFQgPSBhOwogIFggPSBTZyhhLmN1cnJlbnQsIG51bGwpOwogIFUgPSBiOwogIFMgPSB0aTsKICBraiA9IG51bGw7CiAgbWogPSBsaiA9IDEwNzM3NDE4MjM7CiAgbmogPSBudWxsOwogIHdpID0gMDsKICBvaiA9ICExOwp9CgpmdW5jdGlvbiBIaihhLCBiKSB7CiAgZG8gewogICAgdHJ5IHsKICAgICAgbmcoKTsKICAgICAgamguY3VycmVudCA9IHNoOwogICAgICBpZiAobWgpIGZvciAodmFyIGMgPSBOLm1lbW9pemVkU3RhdGU7IG51bGwgIT09IGM7KSB7CiAgICAgICAgdmFyIGQgPSBjLnF1ZXVlOwogICAgICAgIG51bGwgIT09IGQgJiYgKGQucGVuZGluZyA9IG51bGwpOwogICAgICAgIGMgPSBjLm5leHQ7CiAgICAgIH0KICAgICAgbGggPSAwOwogICAgICBQID0gTyA9IE4gPSBudWxsOwogICAgICBtaCA9ICExOwogICAgICBpZiAobnVsbCA9PT0gWCB8fCBudWxsID09PSBYLnJldHVybikgcmV0dXJuIFMgPSBoaiwga2ogPSBiLCBYID0gbnVsbDsKCiAgICAgIGE6IHsKICAgICAgICB2YXIgZSA9IGEsCiAgICAgICAgICAgIGYgPSBYLnJldHVybiwKICAgICAgICAgICAgZyA9IFgsCiAgICAgICAgICAgIGggPSBiOwogICAgICAgIGIgPSBVOwogICAgICAgIGcuZWZmZWN0VGFnIHw9IDIwNDg7CiAgICAgICAgZy5maXJzdEVmZmVjdCA9IGcubGFzdEVmZmVjdCA9IG51bGw7CgogICAgICAgIGlmIChudWxsICE9PSBoICYmICJvYmplY3QiID09PSBfdHlwZW9mKGgpICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBoLnRoZW4pIHsKICAgICAgICAgIHZhciBrID0gaDsKCiAgICAgICAgICBpZiAoMCA9PT0gKGcubW9kZSAmIDIpKSB7CiAgICAgICAgICAgIHZhciBsID0gZy5hbHRlcm5hdGU7CiAgICAgICAgICAgIGwgPyAoZy51cGRhdGVRdWV1ZSA9IGwudXBkYXRlUXVldWUsIGcubWVtb2l6ZWRTdGF0ZSA9IGwubWVtb2l6ZWRTdGF0ZSwgZy5leHBpcmF0aW9uVGltZSA9IGwuZXhwaXJhdGlvblRpbWUpIDogKGcudXBkYXRlUXVldWUgPSBudWxsLCBnLm1lbW9pemVkU3RhdGUgPSBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbSA9IDAgIT09IChNLmN1cnJlbnQgJiAxKSwKICAgICAgICAgICAgICBwID0gZjsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHZhciB4OwoKICAgICAgICAgICAgaWYgKHggPSAxMyA9PT0gcC50YWcpIHsKICAgICAgICAgICAgICB2YXIgeiA9IHAubWVtb2l6ZWRTdGF0ZTsKICAgICAgICAgICAgICBpZiAobnVsbCAhPT0geikgeCA9IG51bGwgIT09IHouZGVoeWRyYXRlZCA/ICEwIDogITE7ZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgY2EgPSBwLm1lbW9pemVkUHJvcHM7CiAgICAgICAgICAgICAgICB4ID0gdm9pZCAwID09PSBjYS5mYWxsYmFjayA/ICExIDogITAgIT09IGNhLnVuc3RhYmxlX2F2b2lkVGhpc0ZhbGxiYWNrID8gITAgOiBtID8gITEgOiAhMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh4KSB7CiAgICAgICAgICAgICAgdmFyIEQgPSBwLnVwZGF0ZVF1ZXVlOwoKICAgICAgICAgICAgICBpZiAobnVsbCA9PT0gRCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgICB0LmFkZChrKTsKICAgICAgICAgICAgICAgIHAudXBkYXRlUXVldWUgPSB0OwogICAgICAgICAgICAgIH0gZWxzZSBELmFkZChrKTsKCiAgICAgICAgICAgICAgaWYgKDAgPT09IChwLm1vZGUgJiAyKSkgewogICAgICAgICAgICAgICAgcC5lZmZlY3RUYWcgfD0gNjQ7CiAgICAgICAgICAgICAgICBnLmVmZmVjdFRhZyAmPSAtMjk4MTsKICAgICAgICAgICAgICAgIGlmICgxID09PSBnLnRhZykgaWYgKG51bGwgPT09IGcuYWx0ZXJuYXRlKSBnLnRhZyA9IDE3O2Vsc2UgewogICAgICAgICAgICAgICAgICB2YXIgeSA9IHdnKDEwNzM3NDE4MjMsIG51bGwpOwogICAgICAgICAgICAgICAgICB5LnRhZyA9IDI7CiAgICAgICAgICAgICAgICAgIHhnKGcsIHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZy5leHBpcmF0aW9uVGltZSA9IDEwNzM3NDE4MjM7CiAgICAgICAgICAgICAgICBicmVhayBhOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaCA9IHZvaWQgMDsKICAgICAgICAgICAgICBnID0gYjsKICAgICAgICAgICAgICB2YXIgQSA9IGUucGluZ0NhY2hlOwogICAgICAgICAgICAgIG51bGwgPT09IEEgPyAoQSA9IGUucGluZ0NhY2hlID0gbmV3IFdpKCksIGggPSBuZXcgU2V0KCksIEEuc2V0KGssIGgpKSA6IChoID0gQS5nZXQoayksIHZvaWQgMCA9PT0gaCAmJiAoaCA9IG5ldyBTZXQoKSwgQS5zZXQoaywgaCkpKTsKCiAgICAgICAgICAgICAgaWYgKCFoLmhhcyhnKSkgewogICAgICAgICAgICAgICAgaC5hZGQoZyk7CiAgICAgICAgICAgICAgICB2YXIgcSA9IE9qLmJpbmQobnVsbCwgZSwgaywgZyk7CiAgICAgICAgICAgICAgICBrLnRoZW4ocSwgcSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwLmVmZmVjdFRhZyB8PSA0MDk2OwogICAgICAgICAgICAgIHAuZXhwaXJhdGlvblRpbWUgPSBiOwogICAgICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHAgPSBwLnJldHVybjsKICAgICAgICAgIH0gd2hpbGUgKG51bGwgIT09IHApOwoKICAgICAgICAgIGggPSBFcnJvcigocGIoZy50eXBlKSB8fCAiQSBSZWFjdCBjb21wb25lbnQiKSArICIgc3VzcGVuZGVkIHdoaWxlIHJlbmRlcmluZywgYnV0IG5vIGZhbGxiYWNrIFVJIHdhcyBzcGVjaWZpZWQuXG5cbkFkZCBhIDxTdXNwZW5zZSBmYWxsYmFjaz0uLi4+IGNvbXBvbmVudCBoaWdoZXIgaW4gdGhlIHRyZWUgdG8gcHJvdmlkZSBhIGxvYWRpbmcgaW5kaWNhdG9yIG9yIHBsYWNlaG9sZGVyIHRvIGRpc3BsYXkuIiArIHFiKGcpKTsKICAgICAgICB9CgogICAgICAgIFMgIT09IGpqICYmIChTID0gaWopOwogICAgICAgIGggPSBBaShoLCBnKTsKICAgICAgICBwID0gZjsKCiAgICAgICAgZG8gewogICAgICAgICAgc3dpdGNoIChwLnRhZykgewogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgayA9IGg7CiAgICAgICAgICAgICAgcC5lZmZlY3RUYWcgfD0gNDA5NjsKICAgICAgICAgICAgICBwLmV4cGlyYXRpb25UaW1lID0gYjsKICAgICAgICAgICAgICB2YXIgQiA9IFhpKHAsIGssIGIpOwogICAgICAgICAgICAgIHlnKHAsIEIpOwogICAgICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgayA9IGg7CiAgICAgICAgICAgICAgdmFyIHcgPSBwLnR5cGUsCiAgICAgICAgICAgICAgICAgIHViID0gcC5zdGF0ZU5vZGU7CgogICAgICAgICAgICAgIGlmICgwID09PSAocC5lZmZlY3RUYWcgJiA2NCkgJiYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiB3LmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciB8fCBudWxsICE9PSB1YiAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgdWIuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKG51bGwgPT09IGFqIHx8ICFhai5oYXModWIpKSkpIHsKICAgICAgICAgICAgICAgIHAuZWZmZWN0VGFnIHw9IDQwOTY7CiAgICAgICAgICAgICAgICBwLmV4cGlyYXRpb25UaW1lID0gYjsKICAgICAgICAgICAgICAgIHZhciB2YiA9ICRpKHAsIGssIGIpOwogICAgICAgICAgICAgICAgeWcocCwgdmIpOwogICAgICAgICAgICAgICAgYnJlYWsgYTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgfQoKICAgICAgICAgIHAgPSBwLnJldHVybjsKICAgICAgICB9IHdoaWxlIChudWxsICE9PSBwKTsKICAgICAgfQoKICAgICAgWCA9IFBqKFgpOwogICAgfSBjYXRjaCAoWGMpIHsKICAgICAgYiA9IFhjOwogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBicmVhazsKICB9IHdoaWxlICgxKTsKfQoKZnVuY3Rpb24gRmooKSB7CiAgdmFyIGEgPSBjai5jdXJyZW50OwogIGNqLmN1cnJlbnQgPSBzaDsKICByZXR1cm4gbnVsbCA9PT0gYSA/IHNoIDogYTsKfQoKZnVuY3Rpb24gQWcoYSwgYikgewogIGEgPCBsaiAmJiAyIDwgYSAmJiAobGogPSBhKTsKICBudWxsICE9PSBiICYmIGEgPCBtaiAmJiAyIDwgYSAmJiAobWogPSBhLCBuaiA9IGIpOwp9CgpmdW5jdGlvbiBCZyhhKSB7CiAgYSA+IHdpICYmICh3aSA9IGEpOwp9CgpmdW5jdGlvbiBLaigpIHsKICBmb3IgKDsgbnVsbCAhPT0gWDspIHsKICAgIFggPSBRaihYKTsKICB9Cn0KCmZ1bmN0aW9uIEdqKCkgewogIGZvciAoOyBudWxsICE9PSBYICYmICFVZigpOykgewogICAgWCA9IFFqKFgpOwogIH0KfQoKZnVuY3Rpb24gUWooYSkgewogIHZhciBiID0gUmooYS5hbHRlcm5hdGUsIGEsIFUpOwogIGEubWVtb2l6ZWRQcm9wcyA9IGEucGVuZGluZ1Byb3BzOwogIG51bGwgPT09IGIgJiYgKGIgPSBQaihhKSk7CiAgZGouY3VycmVudCA9IG51bGw7CiAgcmV0dXJuIGI7Cn0KCmZ1bmN0aW9uIFBqKGEpIHsKICBYID0gYTsKCiAgZG8gewogICAgdmFyIGIgPSBYLmFsdGVybmF0ZTsKICAgIGEgPSBYLnJldHVybjsKCiAgICBpZiAoMCA9PT0gKFguZWZmZWN0VGFnICYgMjA0OCkpIHsKICAgICAgYiA9IHNpKGIsIFgsIFUpOwoKICAgICAgaWYgKDEgPT09IFUgfHwgMSAhPT0gWC5jaGlsZEV4cGlyYXRpb25UaW1lKSB7CiAgICAgICAgZm9yICh2YXIgYyA9IDAsIGQgPSBYLmNoaWxkOyBudWxsICE9PSBkOykgewogICAgICAgICAgdmFyIGUgPSBkLmV4cGlyYXRpb25UaW1lLAogICAgICAgICAgICAgIGYgPSBkLmNoaWxkRXhwaXJhdGlvblRpbWU7CiAgICAgICAgICBlID4gYyAmJiAoYyA9IGUpOwogICAgICAgICAgZiA+IGMgJiYgKGMgPSBmKTsKICAgICAgICAgIGQgPSBkLnNpYmxpbmc7CiAgICAgICAgfQoKICAgICAgICBYLmNoaWxkRXhwaXJhdGlvblRpbWUgPSBjOwogICAgICB9CgogICAgICBpZiAobnVsbCAhPT0gYikgcmV0dXJuIGI7CiAgICAgIG51bGwgIT09IGEgJiYgMCA9PT0gKGEuZWZmZWN0VGFnICYgMjA0OCkgJiYgKG51bGwgPT09IGEuZmlyc3RFZmZlY3QgJiYgKGEuZmlyc3RFZmZlY3QgPSBYLmZpcnN0RWZmZWN0KSwgbnVsbCAhPT0gWC5sYXN0RWZmZWN0ICYmIChudWxsICE9PSBhLmxhc3RFZmZlY3QgJiYgKGEubGFzdEVmZmVjdC5uZXh0RWZmZWN0ID0gWC5maXJzdEVmZmVjdCksIGEubGFzdEVmZmVjdCA9IFgubGFzdEVmZmVjdCksIDEgPCBYLmVmZmVjdFRhZyAmJiAobnVsbCAhPT0gYS5sYXN0RWZmZWN0ID8gYS5sYXN0RWZmZWN0Lm5leHRFZmZlY3QgPSBYIDogYS5maXJzdEVmZmVjdCA9IFgsIGEubGFzdEVmZmVjdCA9IFgpKTsKICAgIH0gZWxzZSB7CiAgICAgIGIgPSB6aShYKTsKICAgICAgaWYgKG51bGwgIT09IGIpIHJldHVybiBiLmVmZmVjdFRhZyAmPSAyMDQ3LCBiOwogICAgICBudWxsICE9PSBhICYmIChhLmZpcnN0RWZmZWN0ID0gYS5sYXN0RWZmZWN0ID0gbnVsbCwgYS5lZmZlY3RUYWcgfD0gMjA0OCk7CiAgICB9CgogICAgYiA9IFguc2libGluZzsKICAgIGlmIChudWxsICE9PSBiKSByZXR1cm4gYjsKICAgIFggPSBhOwogIH0gd2hpbGUgKG51bGwgIT09IFgpOwoKICBTID09PSB0aSAmJiAoUyA9IGpqKTsKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gSWooYSkgewogIHZhciBiID0gYS5leHBpcmF0aW9uVGltZTsKICBhID0gYS5jaGlsZEV4cGlyYXRpb25UaW1lOwogIHJldHVybiBiID4gYSA/IGIgOiBhOwp9CgpmdW5jdGlvbiBKaihhKSB7CiAgdmFyIGIgPSBhZygpOwogIGNnKDk5LCBTai5iaW5kKG51bGwsIGEsIGIpKTsKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gU2ooYSwgYikgewogIGRvIHsKICAgIERqKCk7CiAgfSB3aGlsZSAobnVsbCAhPT0gcmopOwoKICBpZiAoKFcgJiAoZmogfCBnaikpICE9PSBWKSB0aHJvdyBFcnJvcih1KDMyNykpOwogIHZhciBjID0gYS5maW5pc2hlZFdvcmssCiAgICAgIGQgPSBhLmZpbmlzaGVkRXhwaXJhdGlvblRpbWU7CiAgaWYgKG51bGwgPT09IGMpIHJldHVybiBudWxsOwogIGEuZmluaXNoZWRXb3JrID0gbnVsbDsKICBhLmZpbmlzaGVkRXhwaXJhdGlvblRpbWUgPSAwOwogIGlmIChjID09PSBhLmN1cnJlbnQpIHRocm93IEVycm9yKHUoMTc3KSk7CiAgYS5jYWxsYmFja05vZGUgPSBudWxsOwogIGEuY2FsbGJhY2tFeHBpcmF0aW9uVGltZSA9IDA7CiAgYS5jYWxsYmFja1ByaW9yaXR5ID0gOTA7CiAgYS5uZXh0S25vd25QZW5kaW5nTGV2ZWwgPSAwOwogIHZhciBlID0gSWooYyk7CiAgYS5maXJzdFBlbmRpbmdUaW1lID0gZTsKICBkIDw9IGEubGFzdFN1c3BlbmRlZFRpbWUgPyBhLmZpcnN0U3VzcGVuZGVkVGltZSA9IGEubGFzdFN1c3BlbmRlZFRpbWUgPSBhLm5leHRLbm93blBlbmRpbmdMZXZlbCA9IDAgOiBkIDw9IGEuZmlyc3RTdXNwZW5kZWRUaW1lICYmIChhLmZpcnN0U3VzcGVuZGVkVGltZSA9IGQgLSAxKTsKICBkIDw9IGEubGFzdFBpbmdlZFRpbWUgJiYgKGEubGFzdFBpbmdlZFRpbWUgPSAwKTsKICBkIDw9IGEubGFzdEV4cGlyZWRUaW1lICYmIChhLmxhc3RFeHBpcmVkVGltZSA9IDApOwogIGEgPT09IFQgJiYgKFggPSBUID0gbnVsbCwgVSA9IDApOwogIDEgPCBjLmVmZmVjdFRhZyA/IG51bGwgIT09IGMubGFzdEVmZmVjdCA/IChjLmxhc3RFZmZlY3QubmV4dEVmZmVjdCA9IGMsIGUgPSBjLmZpcnN0RWZmZWN0KSA6IGUgPSBjIDogZSA9IGMuZmlyc3RFZmZlY3Q7CgogIGlmIChudWxsICE9PSBlKSB7CiAgICB2YXIgZiA9IFc7CiAgICBXIHw9IGdqOwogICAgZGouY3VycmVudCA9IG51bGw7CiAgICBEZCA9IGZkOwogICAgdmFyIGcgPSB4ZCgpOwoKICAgIGlmICh5ZChnKSkgewogICAgICBpZiAoInNlbGVjdGlvblN0YXJ0IiBpbiBnKSB2YXIgaCA9IHsKICAgICAgICBzdGFydDogZy5zZWxlY3Rpb25TdGFydCwKICAgICAgICBlbmQ6IGcuc2VsZWN0aW9uRW5kCiAgICAgIH07ZWxzZSBhOiB7CiAgICAgICAgaCA9IChoID0gZy5vd25lckRvY3VtZW50KSAmJiBoLmRlZmF1bHRWaWV3IHx8IHdpbmRvdzsKICAgICAgICB2YXIgayA9IGguZ2V0U2VsZWN0aW9uICYmIGguZ2V0U2VsZWN0aW9uKCk7CgogICAgICAgIGlmIChrICYmIDAgIT09IGsucmFuZ2VDb3VudCkgewogICAgICAgICAgaCA9IGsuYW5jaG9yTm9kZTsKICAgICAgICAgIHZhciBsID0gay5hbmNob3JPZmZzZXQsCiAgICAgICAgICAgICAgbSA9IGsuZm9jdXNOb2RlOwogICAgICAgICAgayA9IGsuZm9jdXNPZmZzZXQ7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaC5ub2RlVHlwZSwgbS5ub2RlVHlwZTsKICAgICAgICAgIH0gY2F0Y2ggKHdiKSB7CiAgICAgICAgICAgIGggPSBudWxsOwogICAgICAgICAgICBicmVhayBhOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwID0gMCwKICAgICAgICAgICAgICB4ID0gLTEsCiAgICAgICAgICAgICAgeiA9IC0xLAogICAgICAgICAgICAgIGNhID0gMCwKICAgICAgICAgICAgICBEID0gMCwKICAgICAgICAgICAgICB0ID0gZywKICAgICAgICAgICAgICB5ID0gbnVsbDsKCiAgICAgICAgICBiOiBmb3IgKDs7KSB7CiAgICAgICAgICAgIGZvciAodmFyIEE7OykgewogICAgICAgICAgICAgIHQgIT09IGggfHwgMCAhPT0gbCAmJiAzICE9PSB0Lm5vZGVUeXBlIHx8ICh4ID0gcCArIGwpOwogICAgICAgICAgICAgIHQgIT09IG0gfHwgMCAhPT0gayAmJiAzICE9PSB0Lm5vZGVUeXBlIHx8ICh6ID0gcCArIGspOwogICAgICAgICAgICAgIDMgPT09IHQubm9kZVR5cGUgJiYgKHAgKz0gdC5ub2RlVmFsdWUubGVuZ3RoKTsKICAgICAgICAgICAgICBpZiAobnVsbCA9PT0gKEEgPSB0LmZpcnN0Q2hpbGQpKSBicmVhazsKICAgICAgICAgICAgICB5ID0gdDsKICAgICAgICAgICAgICB0ID0gQTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgIGlmICh0ID09PSBnKSBicmVhayBiOwogICAgICAgICAgICAgIHkgPT09IGggJiYgKytjYSA9PT0gbCAmJiAoeCA9IHApOwogICAgICAgICAgICAgIHkgPT09IG0gJiYgKytEID09PSBrICYmICh6ID0gcCk7CiAgICAgICAgICAgICAgaWYgKG51bGwgIT09IChBID0gdC5uZXh0U2libGluZykpIGJyZWFrOwogICAgICAgICAgICAgIHQgPSB5OwogICAgICAgICAgICAgIHkgPSB0LnBhcmVudE5vZGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHQgPSBBOwogICAgICAgICAgfQoKICAgICAgICAgIGggPSAtMSA9PT0geCB8fCAtMSA9PT0geiA/IG51bGwgOiB7CiAgICAgICAgICAgIHN0YXJ0OiB4LAogICAgICAgICAgICBlbmQ6IHoKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGggPSBudWxsOwogICAgICB9CiAgICAgIGggPSBoIHx8IHsKICAgICAgICBzdGFydDogMCwKICAgICAgICBlbmQ6IDAKICAgICAgfTsKICAgIH0gZWxzZSBoID0gbnVsbDsKCiAgICBFZCA9IHsKICAgICAgYWN0aXZlRWxlbWVudERldGFjaGVkOiBudWxsLAogICAgICBmb2N1c2VkRWxlbTogZywKICAgICAgc2VsZWN0aW9uUmFuZ2U6IGgKICAgIH07CiAgICBmZCA9ICExOwogICAgWSA9IGU7CgogICAgZG8gewogICAgICB0cnkgewogICAgICAgIFRqKCk7CiAgICAgIH0gY2F0Y2ggKHdiKSB7CiAgICAgICAgaWYgKG51bGwgPT09IFkpIHRocm93IEVycm9yKHUoMzMwKSk7CiAgICAgICAgRWkoWSwgd2IpOwogICAgICAgIFkgPSBZLm5leHRFZmZlY3Q7CiAgICAgIH0KICAgIH0gd2hpbGUgKG51bGwgIT09IFkpOwoKICAgIFkgPSBlOwoKICAgIGRvIHsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKGcgPSBhLCBoID0gYjsgbnVsbCAhPT0gWTspIHsKICAgICAgICAgIHZhciBxID0gWS5lZmZlY3RUYWc7CiAgICAgICAgICBxICYgMTYgJiYgUmIoWS5zdGF0ZU5vZGUsICIiKTsKCiAgICAgICAgICBpZiAocSAmIDEyOCkgewogICAgICAgICAgICB2YXIgQiA9IFkuYWx0ZXJuYXRlOwoKICAgICAgICAgICAgaWYgKG51bGwgIT09IEIpIHsKICAgICAgICAgICAgICB2YXIgdyA9IEIucmVmOwogICAgICAgICAgICAgIG51bGwgIT09IHcgJiYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiB3ID8gdyhudWxsKSA6IHcuY3VycmVudCA9IG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgc3dpdGNoIChxICYgMTAzOCkgewogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgUGkoWSk7CiAgICAgICAgICAgICAgWS5lZmZlY3RUYWcgJj0gLTM7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgUGkoWSk7CiAgICAgICAgICAgICAgWS5lZmZlY3RUYWcgJj0gLTM7CiAgICAgICAgICAgICAgU2koWS5hbHRlcm5hdGUsIFkpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxMDI0OgogICAgICAgICAgICAgIFkuZWZmZWN0VGFnICY9IC0xMDI1OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxMDI4OgogICAgICAgICAgICAgIFkuZWZmZWN0VGFnICY9IC0xMDI1OwogICAgICAgICAgICAgIFNpKFkuYWx0ZXJuYXRlLCBZKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBTaShZLmFsdGVybmF0ZSwgWSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgbCA9IFksIE1pKGcsIGwsIGgpLCBOaShsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBZID0gWS5uZXh0RWZmZWN0OwogICAgICAgIH0KICAgICAgfSBjYXRjaCAod2IpIHsKICAgICAgICBpZiAobnVsbCA9PT0gWSkgdGhyb3cgRXJyb3IodSgzMzApKTsKICAgICAgICBFaShZLCB3Yik7CiAgICAgICAgWSA9IFkubmV4dEVmZmVjdDsKICAgICAgfQogICAgfSB3aGlsZSAobnVsbCAhPT0gWSk7CgogICAgdyA9IEVkOwogICAgQiA9IHhkKCk7CiAgICBxID0gdy5mb2N1c2VkRWxlbTsKICAgIGggPSB3LnNlbGVjdGlvblJhbmdlOwoKICAgIGlmIChCICE9PSBxICYmIHEgJiYgcS5vd25lckRvY3VtZW50ICYmIHdkKHEub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHEpKSB7CiAgICAgIG51bGwgIT09IGggJiYgeWQocSkgJiYgKEIgPSBoLnN0YXJ0LCB3ID0gaC5lbmQsIHZvaWQgMCA9PT0gdyAmJiAodyA9IEIpLCAic2VsZWN0aW9uU3RhcnQiIGluIHEgPyAocS5zZWxlY3Rpb25TdGFydCA9IEIsIHEuc2VsZWN0aW9uRW5kID0gTWF0aC5taW4odywgcS52YWx1ZS5sZW5ndGgpKSA6ICh3ID0gKEIgPSBxLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpICYmIEIuZGVmYXVsdFZpZXcgfHwgd2luZG93LCB3LmdldFNlbGVjdGlvbiAmJiAodyA9IHcuZ2V0U2VsZWN0aW9uKCksIGwgPSBxLnRleHRDb250ZW50Lmxlbmd0aCwgZyA9IE1hdGgubWluKGguc3RhcnQsIGwpLCBoID0gdm9pZCAwID09PSBoLmVuZCA/IGcgOiBNYXRoLm1pbihoLmVuZCwgbCksICF3LmV4dGVuZCAmJiBnID4gaCAmJiAobCA9IGgsIGggPSBnLCBnID0gbCksIGwgPSB2ZChxLCBnKSwgbSA9IHZkKHEsIGgpLCBsICYmIG0gJiYgKDEgIT09IHcucmFuZ2VDb3VudCB8fCB3LmFuY2hvck5vZGUgIT09IGwubm9kZSB8fCB3LmFuY2hvck9mZnNldCAhPT0gbC5vZmZzZXQgfHwgdy5mb2N1c05vZGUgIT09IG0ubm9kZSB8fCB3LmZvY3VzT2Zmc2V0ICE9PSBtLm9mZnNldCkgJiYgKEIgPSBCLmNyZWF0ZVJhbmdlKCksIEIuc2V0U3RhcnQobC5ub2RlLCBsLm9mZnNldCksIHcucmVtb3ZlQWxsUmFuZ2VzKCksIGcgPiBoID8gKHcuYWRkUmFuZ2UoQiksIHcuZXh0ZW5kKG0ubm9kZSwgbS5vZmZzZXQpKSA6IChCLnNldEVuZChtLm5vZGUsIG0ub2Zmc2V0KSwgdy5hZGRSYW5nZShCKSkpKSkpOwogICAgICBCID0gW107CgogICAgICBmb3IgKHcgPSBxOyB3ID0gdy5wYXJlbnROb2RlOykgewogICAgICAgIDEgPT09IHcubm9kZVR5cGUgJiYgQi5wdXNoKHsKICAgICAgICAgIGVsZW1lbnQ6IHcsCiAgICAgICAgICBsZWZ0OiB3LnNjcm9sbExlZnQsCiAgICAgICAgICB0b3A6IHcuc2Nyb2xsVG9wCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBxLmZvY3VzICYmIHEuZm9jdXMoKTsKCiAgICAgIGZvciAocSA9IDA7IHEgPCBCLmxlbmd0aDsgcSsrKSB7CiAgICAgICAgdyA9IEJbcV0sIHcuZWxlbWVudC5zY3JvbGxMZWZ0ID0gdy5sZWZ0LCB3LmVsZW1lbnQuc2Nyb2xsVG9wID0gdy50b3A7CiAgICAgIH0KICAgIH0KCiAgICBmZCA9ICEhRGQ7CiAgICBFZCA9IERkID0gbnVsbDsKICAgIGEuY3VycmVudCA9IGM7CiAgICBZID0gZTsKCiAgICBkbyB7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChxID0gYTsgbnVsbCAhPT0gWTspIHsKICAgICAgICAgIHZhciB1YiA9IFkuZWZmZWN0VGFnOwogICAgICAgICAgdWIgJiAzNiAmJiBKaShxLCBZLmFsdGVybmF0ZSwgWSk7CgogICAgICAgICAgaWYgKHViICYgMTI4KSB7CiAgICAgICAgICAgIEIgPSB2b2lkIDA7CiAgICAgICAgICAgIHZhciB2YiA9IFkucmVmOwoKICAgICAgICAgICAgaWYgKG51bGwgIT09IHZiKSB7CiAgICAgICAgICAgICAgdmFyIFhjID0gWS5zdGF0ZU5vZGU7CgogICAgICAgICAgICAgIHN3aXRjaCAoWS50YWcpIHsKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgQiA9IFhjOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBCID0gWGM7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgdmIgPyB2YihCKSA6IHZiLmN1cnJlbnQgPSBCOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgWSA9IFkubmV4dEVmZmVjdDsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKHdiKSB7CiAgICAgICAgaWYgKG51bGwgPT09IFkpIHRocm93IEVycm9yKHUoMzMwKSk7CiAgICAgICAgRWkoWSwgd2IpOwogICAgICAgIFkgPSBZLm5leHRFZmZlY3Q7CiAgICAgIH0KICAgIH0gd2hpbGUgKG51bGwgIT09IFkpOwoKICAgIFkgPSBudWxsOwogICAgVmYoKTsKICAgIFcgPSBmOwogIH0gZWxzZSBhLmN1cnJlbnQgPSBjOwoKICBpZiAocWopIHFqID0gITEsIHJqID0gYSwgc2ogPSBiO2Vsc2UgZm9yIChZID0gZTsgbnVsbCAhPT0gWTspIHsKICAgIGIgPSBZLm5leHRFZmZlY3QsIFkubmV4dEVmZmVjdCA9IG51bGwsIFkgPSBiOwogIH0KICBiID0gYS5maXJzdFBlbmRpbmdUaW1lOwogIDAgPT09IGIgJiYgKGFqID0gbnVsbCk7CiAgMTA3Mzc0MTgyMyA9PT0gYiA/IGEgPT09IHZqID8gdWorKyA6ICh1aiA9IDAsIHZqID0gYSkgOiB1aiA9IDA7CiAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFVqICYmIFVqKGMuc3RhdGVOb2RlLCBkKTsKICBaKGEpOwogIGlmIChZaSkgdGhyb3cgWWkgPSAhMSwgYSA9IFppLCBaaSA9IG51bGwsIGE7CiAgaWYgKChXICYgZWopICE9PSBWKSByZXR1cm4gbnVsbDsKICBnZygpOwogIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBUaigpIHsKICBmb3IgKDsgbnVsbCAhPT0gWTspIHsKICAgIHZhciBhID0gWS5lZmZlY3RUYWc7CiAgICAwICE9PSAoYSAmIDI1NikgJiYgR2koWS5hbHRlcm5hdGUsIFkpOwogICAgMCA9PT0gKGEgJiA1MTIpIHx8IHFqIHx8IChxaiA9ICEwLCBkZyg5NywgZnVuY3Rpb24gKCkgewogICAgICBEaigpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0pKTsKICAgIFkgPSBZLm5leHRFZmZlY3Q7CiAgfQp9CgpmdW5jdGlvbiBEaigpIHsKICBpZiAoOTAgIT09IHNqKSB7CiAgICB2YXIgYSA9IDk3IDwgc2ogPyA5NyA6IHNqOwogICAgc2ogPSA5MDsKICAgIHJldHVybiBjZyhhLCBWaik7CiAgfQp9CgpmdW5jdGlvbiBWaigpIHsKICBpZiAobnVsbCA9PT0gcmopIHJldHVybiAhMTsKICB2YXIgYSA9IHJqOwogIHJqID0gbnVsbDsKICBpZiAoKFcgJiAoZmogfCBnaikpICE9PSBWKSB0aHJvdyBFcnJvcih1KDMzMSkpOwogIHZhciBiID0gVzsKICBXIHw9IGdqOwoKICBmb3IgKGEgPSBhLmN1cnJlbnQuZmlyc3RFZmZlY3Q7IG51bGwgIT09IGE7KSB7CiAgICB0cnkgewogICAgICB2YXIgYyA9IGE7CiAgICAgIGlmICgwICE9PSAoYy5lZmZlY3RUYWcgJiA1MTIpKSBzd2l0Y2ggKGMudGFnKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgIGNhc2UgMTE6CiAgICAgICAgY2FzZSAxNToKICAgICAgICBjYXNlIDIyOgogICAgICAgICAgSGkoNSwgYyksIElpKDUsIGMpOwogICAgICB9CiAgICB9IGNhdGNoIChkKSB7CiAgICAgIGlmIChudWxsID09PSBhKSB0aHJvdyBFcnJvcih1KDMzMCkpOwogICAgICBFaShhLCBkKTsKICAgIH0KCiAgICBjID0gYS5uZXh0RWZmZWN0OwogICAgYS5uZXh0RWZmZWN0ID0gbnVsbDsKICAgIGEgPSBjOwogIH0KCiAgVyA9IGI7CiAgZ2coKTsKICByZXR1cm4gITA7Cn0KCmZ1bmN0aW9uIFdqKGEsIGIsIGMpIHsKICBiID0gQWkoYywgYik7CiAgYiA9IFhpKGEsIGIsIDEwNzM3NDE4MjMpOwogIHhnKGEsIGIpOwogIGEgPSB4aihhLCAxMDczNzQxODIzKTsKICBudWxsICE9PSBhICYmIFooYSk7Cn0KCmZ1bmN0aW9uIEVpKGEsIGIpIHsKICBpZiAoMyA9PT0gYS50YWcpIFdqKGEsIGEsIGIpO2Vsc2UgZm9yICh2YXIgYyA9IGEucmV0dXJuOyBudWxsICE9PSBjOykgewogICAgaWYgKDMgPT09IGMudGFnKSB7CiAgICAgIFdqKGMsIGEsIGIpOwogICAgICBicmVhazsKICAgIH0gZWxzZSBpZiAoMSA9PT0gYy50YWcpIHsKICAgICAgdmFyIGQgPSBjLnN0YXRlTm9kZTsKCiAgICAgIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYy50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5jb21wb25lbnREaWRDYXRjaCAmJiAobnVsbCA9PT0gYWogfHwgIWFqLmhhcyhkKSkpIHsKICAgICAgICBhID0gQWkoYiwgYSk7CiAgICAgICAgYSA9ICRpKGMsIGEsIDEwNzM3NDE4MjMpOwogICAgICAgIHhnKGMsIGEpOwogICAgICAgIGMgPSB4aihjLCAxMDczNzQxODIzKTsKICAgICAgICBudWxsICE9PSBjICYmIFooYyk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICBjID0gYy5yZXR1cm47CiAgfQp9CgpmdW5jdGlvbiBPaihhLCBiLCBjKSB7CiAgdmFyIGQgPSBhLnBpbmdDYWNoZTsKICBudWxsICE9PSBkICYmIGQuZGVsZXRlKGIpOwogIFQgPT09IGEgJiYgVSA9PT0gYyA/IFMgPT09IHZpIHx8IFMgPT09IHVpICYmIDEwNzM3NDE4MjMgPT09IGxqICYmICRmKCkgLSBUaSA8IHBqID8gRWooYSwgVSkgOiBvaiA9ICEwIDogQWooYSwgYykgJiYgKGIgPSBhLmxhc3RQaW5nZWRUaW1lLCAwICE9PSBiICYmIGIgPCBjIHx8IChhLmxhc3RQaW5nZWRUaW1lID0gYywgWihhKSkpOwp9CgpmdW5jdGlvbiBWaShhLCBiKSB7CiAgdmFyIGMgPSBhLnN0YXRlTm9kZTsKICBudWxsICE9PSBjICYmIGMuZGVsZXRlKGIpOwogIGIgPSAwOwogIDAgPT09IGIgJiYgKGIgPSBHZygpLCBiID0gSGcoYiwgYSwgbnVsbCkpOwogIGEgPSB4aihhLCBiKTsKICBudWxsICE9PSBhICYmIFooYSk7Cn0KCnZhciBSajsKClJqID0gZnVuY3Rpb24gUmooYSwgYiwgYykgewogIHZhciBkID0gYi5leHBpcmF0aW9uVGltZTsKCiAgaWYgKG51bGwgIT09IGEpIHsKICAgIHZhciBlID0gYi5wZW5kaW5nUHJvcHM7CiAgICBpZiAoYS5tZW1vaXplZFByb3BzICE9PSBlIHx8IEsuY3VycmVudCkgcmcgPSAhMDtlbHNlIHsKICAgICAgaWYgKGQgPCBjKSB7CiAgICAgICAgcmcgPSAhMTsKCiAgICAgICAgc3dpdGNoIChiLnRhZykgewogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBoaShiKTsKICAgICAgICAgICAgWGgoKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBmaChiKTsKICAgICAgICAgICAgaWYgKGIubW9kZSAmIDQgJiYgMSAhPT0gYyAmJiBlLmhpZGRlbikgcmV0dXJuIGIuZXhwaXJhdGlvblRpbWUgPSBiLmNoaWxkRXhwaXJhdGlvblRpbWUgPSAxLCBudWxsOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIEwoYi50eXBlKSAmJiBHZihiKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBkaChiLCBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgZCA9IGIubWVtb2l6ZWRQcm9wcy52YWx1ZTsKICAgICAgICAgICAgZSA9IGIudHlwZS5fY29udGV4dDsKICAgICAgICAgICAgSShqZywgZS5fY3VycmVudFZhbHVlKTsKICAgICAgICAgICAgZS5fY3VycmVudFZhbHVlID0gZDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgaWYgKG51bGwgIT09IGIubWVtb2l6ZWRTdGF0ZSkgewogICAgICAgICAgICAgIGQgPSBiLmNoaWxkLmNoaWxkRXhwaXJhdGlvblRpbWU7CiAgICAgICAgICAgICAgaWYgKDAgIT09IGQgJiYgZCA+PSBjKSByZXR1cm4gamkoYSwgYiwgYyk7CiAgICAgICAgICAgICAgSShNLCBNLmN1cnJlbnQgJiAxKTsKICAgICAgICAgICAgICBiID0gJGgoYSwgYiwgYyk7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09IGIgPyBiLnNpYmxpbmcgOiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBJKE0sIE0uY3VycmVudCAmIDEpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICBkID0gYi5jaGlsZEV4cGlyYXRpb25UaW1lID49IGM7CgogICAgICAgICAgICBpZiAoMCAhPT0gKGEuZWZmZWN0VGFnICYgNjQpKSB7CiAgICAgICAgICAgICAgaWYgKGQpIHJldHVybiBtaShhLCBiLCBjKTsKICAgICAgICAgICAgICBiLmVmZmVjdFRhZyB8PSA2NDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZSA9IGIubWVtb2l6ZWRTdGF0ZTsKICAgICAgICAgICAgbnVsbCAhPT0gZSAmJiAoZS5yZW5kZXJpbmcgPSBudWxsLCBlLnRhaWwgPSBudWxsKTsKICAgICAgICAgICAgSShNLCBNLmN1cnJlbnQpOwogICAgICAgICAgICBpZiAoIWQpIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRoKGEsIGIsIGMpOwogICAgICB9CgogICAgICByZyA9ICExOwogICAgfQogIH0gZWxzZSByZyA9ICExOwoKICBiLmV4cGlyYXRpb25UaW1lID0gMDsKCiAgc3dpdGNoIChiLnRhZykgewogICAgY2FzZSAyOgogICAgICBkID0gYi50eXBlOwogICAgICBudWxsICE9PSBhICYmIChhLmFsdGVybmF0ZSA9IG51bGwsIGIuYWx0ZXJuYXRlID0gbnVsbCwgYi5lZmZlY3RUYWcgfD0gMik7CiAgICAgIGEgPSBiLnBlbmRpbmdQcm9wczsKICAgICAgZSA9IENmKGIsIEouY3VycmVudCk7CiAgICAgIHFnKGIsIGMpOwogICAgICBlID0gb2gobnVsbCwgYiwgZCwgYSwgZSwgYyk7CiAgICAgIGIuZWZmZWN0VGFnIHw9IDE7CgogICAgICBpZiAoIm9iamVjdCIgPT09IF90eXBlb2YoZSkgJiYgbnVsbCAhPT0gZSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5yZW5kZXIgJiYgdm9pZCAwID09PSBlLiQkdHlwZW9mKSB7CiAgICAgICAgYi50YWcgPSAxOwogICAgICAgIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGw7CiAgICAgICAgYi51cGRhdGVRdWV1ZSA9IG51bGw7CgogICAgICAgIGlmIChMKGQpKSB7CiAgICAgICAgICB2YXIgZiA9ICEwOwogICAgICAgICAgR2YoYik7CiAgICAgICAgfSBlbHNlIGYgPSAhMTsKCiAgICAgICAgYi5tZW1vaXplZFN0YXRlID0gbnVsbCAhPT0gZS5zdGF0ZSAmJiB2b2lkIDAgIT09IGUuc3RhdGUgPyBlLnN0YXRlIDogbnVsbDsKICAgICAgICB1ZyhiKTsKICAgICAgICB2YXIgZyA9IGQuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzOwogICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnICYmIEZnKGIsIGQsIGcsIGEpOwogICAgICAgIGUudXBkYXRlciA9IEpnOwogICAgICAgIGIuc3RhdGVOb2RlID0gZTsKICAgICAgICBlLl9yZWFjdEludGVybmFsRmliZXIgPSBiOwogICAgICAgIE5nKGIsIGQsIGEsIGMpOwogICAgICAgIGIgPSBnaShudWxsLCBiLCBkLCAhMCwgZiwgYyk7CiAgICAgIH0gZWxzZSBiLnRhZyA9IDAsIFIobnVsbCwgYiwgZSwgYyksIGIgPSBiLmNoaWxkOwoKICAgICAgcmV0dXJuIGI7CgogICAgY2FzZSAxNjoKICAgICAgYTogewogICAgICAgIGUgPSBiLmVsZW1lbnRUeXBlOwogICAgICAgIG51bGwgIT09IGEgJiYgKGEuYWx0ZXJuYXRlID0gbnVsbCwgYi5hbHRlcm5hdGUgPSBudWxsLCBiLmVmZmVjdFRhZyB8PSAyKTsKICAgICAgICBhID0gYi5wZW5kaW5nUHJvcHM7CiAgICAgICAgb2IoZSk7CiAgICAgICAgaWYgKDEgIT09IGUuX3N0YXR1cykgdGhyb3cgZS5fcmVzdWx0OwogICAgICAgIGUgPSBlLl9yZXN1bHQ7CiAgICAgICAgYi50eXBlID0gZTsKICAgICAgICBmID0gYi50YWcgPSBYaihlKTsKICAgICAgICBhID0gaWcoZSwgYSk7CgogICAgICAgIHN3aXRjaCAoZikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBiID0gZGkobnVsbCwgYiwgZSwgYSwgYyk7CiAgICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBiID0gZmkobnVsbCwgYiwgZSwgYSwgYyk7CiAgICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgYiA9IFpoKG51bGwsIGIsIGUsIGEsIGMpOwogICAgICAgICAgICBicmVhayBhOwoKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIGIgPSBhaShudWxsLCBiLCBlLCBpZyhlLnR5cGUsIGEpLCBkLCBjKTsKICAgICAgICAgICAgYnJlYWsgYTsKICAgICAgICB9CgogICAgICAgIHRocm93IEVycm9yKHUoMzA2LCBlLCAiIikpOwogICAgICB9CgogICAgICByZXR1cm4gYjsKCiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IGlnKGQsIGUpLCBkaShhLCBiLCBkLCBlLCBjKTsKCiAgICBjYXNlIDE6CiAgICAgIHJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IGlnKGQsIGUpLCBmaShhLCBiLCBkLCBlLCBjKTsKCiAgICBjYXNlIDM6CiAgICAgIGhpKGIpOwogICAgICBkID0gYi51cGRhdGVRdWV1ZTsKICAgICAgaWYgKG51bGwgPT09IGEgfHwgbnVsbCA9PT0gZCkgdGhyb3cgRXJyb3IodSgyODIpKTsKICAgICAgZCA9IGIucGVuZGluZ1Byb3BzOwogICAgICBlID0gYi5tZW1vaXplZFN0YXRlOwogICAgICBlID0gbnVsbCAhPT0gZSA/IGUuZWxlbWVudCA6IG51bGw7CiAgICAgIHZnKGEsIGIpOwogICAgICB6ZyhiLCBkLCBudWxsLCBjKTsKICAgICAgZCA9IGIubWVtb2l6ZWRTdGF0ZS5lbGVtZW50OwogICAgICBpZiAoZCA9PT0gZSkgWGgoKSwgYiA9ICRoKGEsIGIsIGMpO2Vsc2UgewogICAgICAgIGlmIChlID0gYi5zdGF0ZU5vZGUuaHlkcmF0ZSkgUGggPSBKZChiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLmZpcnN0Q2hpbGQpLCBPaCA9IGIsIGUgPSBRaCA9ICEwOwogICAgICAgIGlmIChlKSBmb3IgKGMgPSBZZyhiLCBudWxsLCBkLCBjKSwgYi5jaGlsZCA9IGM7IGM7KSB7CiAgICAgICAgICBjLmVmZmVjdFRhZyA9IGMuZWZmZWN0VGFnICYgLTMgfCAxMDI0LCBjID0gYy5zaWJsaW5nOwogICAgICAgIH0gZWxzZSBSKGEsIGIsIGQsIGMpLCBYaCgpOwogICAgICAgIGIgPSBiLmNoaWxkOwogICAgICB9CiAgICAgIHJldHVybiBiOwoKICAgIGNhc2UgNToKICAgICAgcmV0dXJuIGZoKGIpLCBudWxsID09PSBhICYmIFVoKGIpLCBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGYgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFByb3BzIDogbnVsbCwgZyA9IGUuY2hpbGRyZW4sIEdkKGQsIGUpID8gZyA9IG51bGwgOiBudWxsICE9PSBmICYmIEdkKGQsIGYpICYmIChiLmVmZmVjdFRhZyB8PSAxNiksIGVpKGEsIGIpLCBiLm1vZGUgJiA0ICYmIDEgIT09IGMgJiYgZS5oaWRkZW4gPyAoYi5leHBpcmF0aW9uVGltZSA9IGIuY2hpbGRFeHBpcmF0aW9uVGltZSA9IDEsIGIgPSBudWxsKSA6IChSKGEsIGIsIGcsIGMpLCBiID0gYi5jaGlsZCksIGI7CgogICAgY2FzZSA2OgogICAgICByZXR1cm4gbnVsbCA9PT0gYSAmJiBVaChiKSwgbnVsbDsKCiAgICBjYXNlIDEzOgogICAgICByZXR1cm4gamkoYSwgYiwgYyk7CgogICAgY2FzZSA0OgogICAgICByZXR1cm4gZGgoYiwgYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyksIGQgPSBiLnBlbmRpbmdQcm9wcywgbnVsbCA9PT0gYSA/IGIuY2hpbGQgPSBYZyhiLCBudWxsLCBkLCBjKSA6IFIoYSwgYiwgZCwgYyksIGIuY2hpbGQ7CgogICAgY2FzZSAxMToKICAgICAgcmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogaWcoZCwgZSksIFpoKGEsIGIsIGQsIGUsIGMpOwoKICAgIGNhc2UgNzoKICAgICAgcmV0dXJuIFIoYSwgYiwgYi5wZW5kaW5nUHJvcHMsIGMpLCBiLmNoaWxkOwoKICAgIGNhc2UgODoKICAgICAgcmV0dXJuIFIoYSwgYiwgYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sIGMpLCBiLmNoaWxkOwoKICAgIGNhc2UgMTI6CiAgICAgIHJldHVybiBSKGEsIGIsIGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLCBjKSwgYi5jaGlsZDsKCiAgICBjYXNlIDEwOgogICAgICBhOiB7CiAgICAgICAgZCA9IGIudHlwZS5fY29udGV4dDsKICAgICAgICBlID0gYi5wZW5kaW5nUHJvcHM7CiAgICAgICAgZyA9IGIubWVtb2l6ZWRQcm9wczsKICAgICAgICBmID0gZS52YWx1ZTsKICAgICAgICB2YXIgaCA9IGIudHlwZS5fY29udGV4dDsKICAgICAgICBJKGpnLCBoLl9jdXJyZW50VmFsdWUpOwogICAgICAgIGguX2N1cnJlbnRWYWx1ZSA9IGY7CiAgICAgICAgaWYgKG51bGwgIT09IGcpIGlmIChoID0gZy52YWx1ZSwgZiA9ICRlKGgsIGYpID8gMCA6ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5fY2FsY3VsYXRlQ2hhbmdlZEJpdHMgPyBkLl9jYWxjdWxhdGVDaGFuZ2VkQml0cyhoLCBmKSA6IDEwNzM3NDE4MjMpIHwgMCwgMCA9PT0gZikgewogICAgICAgICAgaWYgKGcuY2hpbGRyZW4gPT09IGUuY2hpbGRyZW4gJiYgIUsuY3VycmVudCkgewogICAgICAgICAgICBiID0gJGgoYSwgYiwgYyk7CiAgICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGZvciAoaCA9IGIuY2hpbGQsIG51bGwgIT09IGggJiYgKGgucmV0dXJuID0gYik7IG51bGwgIT09IGg7KSB7CiAgICAgICAgICB2YXIgayA9IGguZGVwZW5kZW5jaWVzOwoKICAgICAgICAgIGlmIChudWxsICE9PSBrKSB7CiAgICAgICAgICAgIGcgPSBoLmNoaWxkOwoKICAgICAgICAgICAgZm9yICh2YXIgbCA9IGsuZmlyc3RDb250ZXh0OyBudWxsICE9PSBsOykgewogICAgICAgICAgICAgIGlmIChsLmNvbnRleHQgPT09IGQgJiYgMCAhPT0gKGwub2JzZXJ2ZWRCaXRzICYgZikpIHsKICAgICAgICAgICAgICAgIDEgPT09IGgudGFnICYmIChsID0gd2coYywgbnVsbCksIGwudGFnID0gMiwgeGcoaCwgbCkpOwogICAgICAgICAgICAgICAgaC5leHBpcmF0aW9uVGltZSA8IGMgJiYgKGguZXhwaXJhdGlvblRpbWUgPSBjKTsKICAgICAgICAgICAgICAgIGwgPSBoLmFsdGVybmF0ZTsKICAgICAgICAgICAgICAgIG51bGwgIT09IGwgJiYgbC5leHBpcmF0aW9uVGltZSA8IGMgJiYgKGwuZXhwaXJhdGlvblRpbWUgPSBjKTsKICAgICAgICAgICAgICAgIHBnKGgucmV0dXJuLCBjKTsKICAgICAgICAgICAgICAgIGsuZXhwaXJhdGlvblRpbWUgPCBjICYmIChrLmV4cGlyYXRpb25UaW1lID0gYyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGwgPSBsLm5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBnID0gMTAgPT09IGgudGFnID8gaC50eXBlID09PSBiLnR5cGUgPyBudWxsIDogaC5jaGlsZCA6IGguY2hpbGQ7CgogICAgICAgICAgaWYgKG51bGwgIT09IGcpIGcucmV0dXJuID0gaDtlbHNlIGZvciAoZyA9IGg7IG51bGwgIT09IGc7KSB7CiAgICAgICAgICAgIGlmIChnID09PSBiKSB7CiAgICAgICAgICAgICAgZyA9IG51bGw7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGggPSBnLnNpYmxpbmc7CgogICAgICAgICAgICBpZiAobnVsbCAhPT0gaCkgewogICAgICAgICAgICAgIGgucmV0dXJuID0gZy5yZXR1cm47CiAgICAgICAgICAgICAgZyA9IGg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGcgPSBnLnJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGggPSBnOwogICAgICAgIH0KICAgICAgICBSKGEsIGIsIGUuY2hpbGRyZW4sIGMpOwogICAgICAgIGIgPSBiLmNoaWxkOwogICAgICB9CgogICAgICByZXR1cm4gYjsKCiAgICBjYXNlIDk6CiAgICAgIHJldHVybiBlID0gYi50eXBlLCBmID0gYi5wZW5kaW5nUHJvcHMsIGQgPSBmLmNoaWxkcmVuLCBxZyhiLCBjKSwgZSA9IHNnKGUsIGYudW5zdGFibGVfb2JzZXJ2ZWRCaXRzKSwgZCA9IGQoZSksIGIuZWZmZWN0VGFnIHw9IDEsIFIoYSwgYiwgZCwgYyksIGIuY2hpbGQ7CgogICAgY2FzZSAxNDoKICAgICAgcmV0dXJuIGUgPSBiLnR5cGUsIGYgPSBpZyhlLCBiLnBlbmRpbmdQcm9wcyksIGYgPSBpZyhlLnR5cGUsIGYpLCBhaShhLCBiLCBlLCBmLCBkLCBjKTsKCiAgICBjYXNlIDE1OgogICAgICByZXR1cm4gY2koYSwgYiwgYi50eXBlLCBiLnBlbmRpbmdQcm9wcywgZCwgYyk7CgogICAgY2FzZSAxNzoKICAgICAgcmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogaWcoZCwgZSksIG51bGwgIT09IGEgJiYgKGEuYWx0ZXJuYXRlID0gbnVsbCwgYi5hbHRlcm5hdGUgPSBudWxsLCBiLmVmZmVjdFRhZyB8PSAyKSwgYi50YWcgPSAxLCBMKGQpID8gKGEgPSAhMCwgR2YoYikpIDogYSA9ICExLCBxZyhiLCBjKSwgTGcoYiwgZCwgZSksIE5nKGIsIGQsIGUsIGMpLCBnaShudWxsLCBiLCBkLCAhMCwgYSwgYyk7CgogICAgY2FzZSAxOToKICAgICAgcmV0dXJuIG1pKGEsIGIsIGMpOwogIH0KCiAgdGhyb3cgRXJyb3IodSgxNTYsIGIudGFnKSk7Cn07Cgp2YXIgVWogPSBudWxsLAogICAgTGkgPSBudWxsOwoKZnVuY3Rpb24gWWooYSkgewogIGlmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXykgcmV0dXJuICExOwogIHZhciBiID0gX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fOwogIGlmIChiLmlzRGlzYWJsZWQgfHwgIWIuc3VwcG9ydHNGaWJlcikgcmV0dXJuICEwOwoKICB0cnkgewogICAgdmFyIGMgPSBiLmluamVjdChhKTsKCiAgICBVaiA9IGZ1bmN0aW9uIFVqKGEpIHsKICAgICAgdHJ5IHsKICAgICAgICBiLm9uQ29tbWl0RmliZXJSb290KGMsIGEsIHZvaWQgMCwgNjQgPT09IChhLmN1cnJlbnQuZWZmZWN0VGFnICYgNjQpKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgIH07CgogICAgTGkgPSBmdW5jdGlvbiBMaShhKSB7CiAgICAgIHRyeSB7CiAgICAgICAgYi5vbkNvbW1pdEZpYmVyVW5tb3VudChjLCBhKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgIH07CiAgfSBjYXRjaCAoZCkge30KCiAgcmV0dXJuICEwOwp9CgpmdW5jdGlvbiBaaihhLCBiLCBjLCBkKSB7CiAgdGhpcy50YWcgPSBhOwogIHRoaXMua2V5ID0gYzsKICB0aGlzLnNpYmxpbmcgPSB0aGlzLmNoaWxkID0gdGhpcy5yZXR1cm4gPSB0aGlzLnN0YXRlTm9kZSA9IHRoaXMudHlwZSA9IHRoaXMuZWxlbWVudFR5cGUgPSBudWxsOwogIHRoaXMuaW5kZXggPSAwOwogIHRoaXMucmVmID0gbnVsbDsKICB0aGlzLnBlbmRpbmdQcm9wcyA9IGI7CiAgdGhpcy5kZXBlbmRlbmNpZXMgPSB0aGlzLm1lbW9pemVkU3RhdGUgPSB0aGlzLnVwZGF0ZVF1ZXVlID0gdGhpcy5tZW1vaXplZFByb3BzID0gbnVsbDsKICB0aGlzLm1vZGUgPSBkOwogIHRoaXMuZWZmZWN0VGFnID0gMDsKICB0aGlzLmxhc3RFZmZlY3QgPSB0aGlzLmZpcnN0RWZmZWN0ID0gdGhpcy5uZXh0RWZmZWN0ID0gbnVsbDsKICB0aGlzLmNoaWxkRXhwaXJhdGlvblRpbWUgPSB0aGlzLmV4cGlyYXRpb25UaW1lID0gMDsKICB0aGlzLmFsdGVybmF0ZSA9IG51bGw7Cn0KCmZ1bmN0aW9uIFNoKGEsIGIsIGMsIGQpIHsKICByZXR1cm4gbmV3IFpqKGEsIGIsIGMsIGQpOwp9CgpmdW5jdGlvbiBiaShhKSB7CiAgYSA9IGEucHJvdG90eXBlOwogIHJldHVybiAhKCFhIHx8ICFhLmlzUmVhY3RDb21wb25lbnQpOwp9CgpmdW5jdGlvbiBYaihhKSB7CiAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSByZXR1cm4gYmkoYSkgPyAxIDogMDsKCiAgaWYgKHZvaWQgMCAhPT0gYSAmJiBudWxsICE9PSBhKSB7CiAgICBhID0gYS4kJHR5cGVvZjsKICAgIGlmIChhID09PSBnYikgcmV0dXJuIDExOwogICAgaWYgKGEgPT09IGpiKSByZXR1cm4gMTQ7CiAgfQoKICByZXR1cm4gMjsKfQoKZnVuY3Rpb24gU2coYSwgYikgewogIHZhciBjID0gYS5hbHRlcm5hdGU7CiAgbnVsbCA9PT0gYyA/IChjID0gU2goYS50YWcsIGIsIGEua2V5LCBhLm1vZGUpLCBjLmVsZW1lbnRUeXBlID0gYS5lbGVtZW50VHlwZSwgYy50eXBlID0gYS50eXBlLCBjLnN0YXRlTm9kZSA9IGEuc3RhdGVOb2RlLCBjLmFsdGVybmF0ZSA9IGEsIGEuYWx0ZXJuYXRlID0gYykgOiAoYy5wZW5kaW5nUHJvcHMgPSBiLCBjLmVmZmVjdFRhZyA9IDAsIGMubmV4dEVmZmVjdCA9IG51bGwsIGMuZmlyc3RFZmZlY3QgPSBudWxsLCBjLmxhc3RFZmZlY3QgPSBudWxsKTsKICBjLmNoaWxkRXhwaXJhdGlvblRpbWUgPSBhLmNoaWxkRXhwaXJhdGlvblRpbWU7CiAgYy5leHBpcmF0aW9uVGltZSA9IGEuZXhwaXJhdGlvblRpbWU7CiAgYy5jaGlsZCA9IGEuY2hpbGQ7CiAgYy5tZW1vaXplZFByb3BzID0gYS5tZW1vaXplZFByb3BzOwogIGMubWVtb2l6ZWRTdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTsKICBjLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZTsKICBiID0gYS5kZXBlbmRlbmNpZXM7CiAgYy5kZXBlbmRlbmNpZXMgPSBudWxsID09PSBiID8gbnVsbCA6IHsKICAgIGV4cGlyYXRpb25UaW1lOiBiLmV4cGlyYXRpb25UaW1lLAogICAgZmlyc3RDb250ZXh0OiBiLmZpcnN0Q29udGV4dCwKICAgIHJlc3BvbmRlcnM6IGIucmVzcG9uZGVycwogIH07CiAgYy5zaWJsaW5nID0gYS5zaWJsaW5nOwogIGMuaW5kZXggPSBhLmluZGV4OwogIGMucmVmID0gYS5yZWY7CiAgcmV0dXJuIGM7Cn0KCmZ1bmN0aW9uIFVnKGEsIGIsIGMsIGQsIGUsIGYpIHsKICB2YXIgZyA9IDI7CiAgZCA9IGE7CiAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSBiaShhKSAmJiAoZyA9IDEpO2Vsc2UgaWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgZyA9IDU7ZWxzZSBhOiBzd2l0Y2ggKGEpIHsKICAgIGNhc2UgYWI6CiAgICAgIHJldHVybiBXZyhjLmNoaWxkcmVuLCBlLCBmLCBiKTsKCiAgICBjYXNlIGZiOgogICAgICBnID0gODsKICAgICAgZSB8PSA3OwogICAgICBicmVhazsKCiAgICBjYXNlIGJiOgogICAgICBnID0gODsKICAgICAgZSB8PSAxOwogICAgICBicmVhazsKCiAgICBjYXNlIGNiOgogICAgICByZXR1cm4gYSA9IFNoKDEyLCBjLCBiLCBlIHwgOCksIGEuZWxlbWVudFR5cGUgPSBjYiwgYS50eXBlID0gY2IsIGEuZXhwaXJhdGlvblRpbWUgPSBmLCBhOwoKICAgIGNhc2UgaGI6CiAgICAgIHJldHVybiBhID0gU2goMTMsIGMsIGIsIGUpLCBhLnR5cGUgPSBoYiwgYS5lbGVtZW50VHlwZSA9IGhiLCBhLmV4cGlyYXRpb25UaW1lID0gZiwgYTsKCiAgICBjYXNlIGliOgogICAgICByZXR1cm4gYSA9IFNoKDE5LCBjLCBiLCBlKSwgYS5lbGVtZW50VHlwZSA9IGliLCBhLmV4cGlyYXRpb25UaW1lID0gZiwgYTsKCiAgICBkZWZhdWx0OgogICAgICBpZiAoIm9iamVjdCIgPT09IF90eXBlb2YoYSkgJiYgbnVsbCAhPT0gYSkgc3dpdGNoIChhLiQkdHlwZW9mKSB7CiAgICAgICAgY2FzZSBkYjoKICAgICAgICAgIGcgPSAxMDsKICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgIGNhc2UgZWI6CiAgICAgICAgICBnID0gOTsKICAgICAgICAgIGJyZWFrIGE7CgogICAgICAgIGNhc2UgZ2I6CiAgICAgICAgICBnID0gMTE7CiAgICAgICAgICBicmVhayBhOwoKICAgICAgICBjYXNlIGpiOgogICAgICAgICAgZyA9IDE0OwogICAgICAgICAgYnJlYWsgYTsKCiAgICAgICAgY2FzZSBrYjoKICAgICAgICAgIGcgPSAxNjsKICAgICAgICAgIGQgPSBudWxsOwogICAgICAgICAgYnJlYWsgYTsKCiAgICAgICAgY2FzZSBsYjoKICAgICAgICAgIGcgPSAyMjsKICAgICAgICAgIGJyZWFrIGE7CiAgICAgIH0KICAgICAgdGhyb3cgRXJyb3IodSgxMzAsIG51bGwgPT0gYSA/IGEgOiBfdHlwZW9mKGEpLCAiIikpOwogIH0KICBiID0gU2goZywgYywgYiwgZSk7CiAgYi5lbGVtZW50VHlwZSA9IGE7CiAgYi50eXBlID0gZDsKICBiLmV4cGlyYXRpb25UaW1lID0gZjsKICByZXR1cm4gYjsKfQoKZnVuY3Rpb24gV2coYSwgYiwgYywgZCkgewogIGEgPSBTaCg3LCBhLCBkLCBiKTsKICBhLmV4cGlyYXRpb25UaW1lID0gYzsKICByZXR1cm4gYTsKfQoKZnVuY3Rpb24gVGcoYSwgYiwgYykgewogIGEgPSBTaCg2LCBhLCBudWxsLCBiKTsKICBhLmV4cGlyYXRpb25UaW1lID0gYzsKICByZXR1cm4gYTsKfQoKZnVuY3Rpb24gVmcoYSwgYiwgYykgewogIGIgPSBTaCg0LCBudWxsICE9PSBhLmNoaWxkcmVuID8gYS5jaGlsZHJlbiA6IFtdLCBhLmtleSwgYik7CiAgYi5leHBpcmF0aW9uVGltZSA9IGM7CiAgYi5zdGF0ZU5vZGUgPSB7CiAgICBjb250YWluZXJJbmZvOiBhLmNvbnRhaW5lckluZm8sCiAgICBwZW5kaW5nQ2hpbGRyZW46IG51bGwsCiAgICBpbXBsZW1lbnRhdGlvbjogYS5pbXBsZW1lbnRhdGlvbgogIH07CiAgcmV0dXJuIGI7Cn0KCmZ1bmN0aW9uIGFrKGEsIGIsIGMpIHsKICB0aGlzLnRhZyA9IGI7CiAgdGhpcy5jdXJyZW50ID0gbnVsbDsKICB0aGlzLmNvbnRhaW5lckluZm8gPSBhOwogIHRoaXMucGluZ0NhY2hlID0gdGhpcy5wZW5kaW5nQ2hpbGRyZW4gPSBudWxsOwogIHRoaXMuZmluaXNoZWRFeHBpcmF0aW9uVGltZSA9IDA7CiAgdGhpcy5maW5pc2hlZFdvcmsgPSBudWxsOwogIHRoaXMudGltZW91dEhhbmRsZSA9IC0xOwogIHRoaXMucGVuZGluZ0NvbnRleHQgPSB0aGlzLmNvbnRleHQgPSBudWxsOwogIHRoaXMuaHlkcmF0ZSA9IGM7CiAgdGhpcy5jYWxsYmFja05vZGUgPSBudWxsOwogIHRoaXMuY2FsbGJhY2tQcmlvcml0eSA9IDkwOwogIHRoaXMubGFzdEV4cGlyZWRUaW1lID0gdGhpcy5sYXN0UGluZ2VkVGltZSA9IHRoaXMubmV4dEtub3duUGVuZGluZ0xldmVsID0gdGhpcy5sYXN0U3VzcGVuZGVkVGltZSA9IHRoaXMuZmlyc3RTdXNwZW5kZWRUaW1lID0gdGhpcy5maXJzdFBlbmRpbmdUaW1lID0gMDsKfQoKZnVuY3Rpb24gQWooYSwgYikgewogIHZhciBjID0gYS5maXJzdFN1c3BlbmRlZFRpbWU7CiAgYSA9IGEubGFzdFN1c3BlbmRlZFRpbWU7CiAgcmV0dXJuIDAgIT09IGMgJiYgYyA+PSBiICYmIGEgPD0gYjsKfQoKZnVuY3Rpb24geGkoYSwgYikgewogIHZhciBjID0gYS5maXJzdFN1c3BlbmRlZFRpbWUsCiAgICAgIGQgPSBhLmxhc3RTdXNwZW5kZWRUaW1lOwogIGMgPCBiICYmIChhLmZpcnN0U3VzcGVuZGVkVGltZSA9IGIpOwogIGlmIChkID4gYiB8fCAwID09PSBjKSBhLmxhc3RTdXNwZW5kZWRUaW1lID0gYjsKICBiIDw9IGEubGFzdFBpbmdlZFRpbWUgJiYgKGEubGFzdFBpbmdlZFRpbWUgPSAwKTsKICBiIDw9IGEubGFzdEV4cGlyZWRUaW1lICYmIChhLmxhc3RFeHBpcmVkVGltZSA9IDApOwp9CgpmdW5jdGlvbiB5aShhLCBiKSB7CiAgYiA+IGEuZmlyc3RQZW5kaW5nVGltZSAmJiAoYS5maXJzdFBlbmRpbmdUaW1lID0gYik7CiAgdmFyIGMgPSBhLmZpcnN0U3VzcGVuZGVkVGltZTsKICAwICE9PSBjICYmIChiID49IGMgPyBhLmZpcnN0U3VzcGVuZGVkVGltZSA9IGEubGFzdFN1c3BlbmRlZFRpbWUgPSBhLm5leHRLbm93blBlbmRpbmdMZXZlbCA9IDAgOiBiID49IGEubGFzdFN1c3BlbmRlZFRpbWUgJiYgKGEubGFzdFN1c3BlbmRlZFRpbWUgPSBiICsgMSksIGIgPiBhLm5leHRLbm93blBlbmRpbmdMZXZlbCAmJiAoYS5uZXh0S25vd25QZW5kaW5nTGV2ZWwgPSBiKSk7Cn0KCmZ1bmN0aW9uIENqKGEsIGIpIHsKICB2YXIgYyA9IGEubGFzdEV4cGlyZWRUaW1lOwogIGlmICgwID09PSBjIHx8IGMgPiBiKSBhLmxhc3RFeHBpcmVkVGltZSA9IGI7Cn0KCmZ1bmN0aW9uIGJrKGEsIGIsIGMsIGQpIHsKICB2YXIgZSA9IGIuY3VycmVudCwKICAgICAgZiA9IEdnKCksCiAgICAgIGcgPSBEZy5zdXNwZW5zZTsKICBmID0gSGcoZiwgZSwgZyk7CgogIGE6IGlmIChjKSB7CiAgICBjID0gYy5fcmVhY3RJbnRlcm5hbEZpYmVyOwoKICAgIGI6IHsKICAgICAgaWYgKGRjKGMpICE9PSBjIHx8IDEgIT09IGMudGFnKSB0aHJvdyBFcnJvcih1KDE3MCkpOwogICAgICB2YXIgaCA9IGM7CgogICAgICBkbyB7CiAgICAgICAgc3dpdGNoIChoLnRhZykgewogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBoID0gaC5zdGF0ZU5vZGUuY29udGV4dDsKICAgICAgICAgICAgYnJlYWsgYjsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGlmIChMKGgudHlwZSkpIHsKICAgICAgICAgICAgICBoID0gaC5zdGF0ZU5vZGUuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQ7CiAgICAgICAgICAgICAgYnJlYWsgYjsKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIGggPSBoLnJldHVybjsKICAgICAgfSB3aGlsZSAobnVsbCAhPT0gaCk7CgogICAgICB0aHJvdyBFcnJvcih1KDE3MSkpOwogICAgfQoKICAgIGlmICgxID09PSBjLnRhZykgewogICAgICB2YXIgayA9IGMudHlwZTsKCiAgICAgIGlmIChMKGspKSB7CiAgICAgICAgYyA9IEZmKGMsIGssIGgpOwogICAgICAgIGJyZWFrIGE7CiAgICAgIH0KICAgIH0KCiAgICBjID0gaDsKICB9IGVsc2UgYyA9IEFmOwoKICBudWxsID09PSBiLmNvbnRleHQgPyBiLmNvbnRleHQgPSBjIDogYi5wZW5kaW5nQ29udGV4dCA9IGM7CiAgYiA9IHdnKGYsIGcpOwogIGIucGF5bG9hZCA9IHsKICAgIGVsZW1lbnQ6IGEKICB9OwogIGQgPSB2b2lkIDAgPT09IGQgPyBudWxsIDogZDsKICBudWxsICE9PSBkICYmIChiLmNhbGxiYWNrID0gZCk7CiAgeGcoZSwgYik7CiAgSWcoZSwgZik7CiAgcmV0dXJuIGY7Cn0KCmZ1bmN0aW9uIGNrKGEpIHsKICBhID0gYS5jdXJyZW50OwogIGlmICghYS5jaGlsZCkgcmV0dXJuIG51bGw7CgogIHN3aXRjaCAoYS5jaGlsZC50YWcpIHsKICAgIGNhc2UgNToKICAgICAgcmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlOwoKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBhLmNoaWxkLnN0YXRlTm9kZTsKICB9Cn0KCmZ1bmN0aW9uIGRrKGEsIGIpIHsKICBhID0gYS5tZW1vaXplZFN0YXRlOwogIG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5kZWh5ZHJhdGVkICYmIGEucmV0cnlUaW1lIDwgYiAmJiAoYS5yZXRyeVRpbWUgPSBiKTsKfQoKZnVuY3Rpb24gZWsoYSwgYikgewogIGRrKGEsIGIpOwogIChhID0gYS5hbHRlcm5hdGUpICYmIGRrKGEsIGIpOwp9CgpmdW5jdGlvbiBmayhhLCBiLCBjKSB7CiAgYyA9IG51bGwgIT0gYyAmJiAhMCA9PT0gYy5oeWRyYXRlOwogIHZhciBkID0gbmV3IGFrKGEsIGIsIGMpLAogICAgICBlID0gU2goMywgbnVsbCwgbnVsbCwgMiA9PT0gYiA/IDcgOiAxID09PSBiID8gMyA6IDApOwogIGQuY3VycmVudCA9IGU7CiAgZS5zdGF0ZU5vZGUgPSBkOwogIHVnKGUpOwogIGFbT2RdID0gZC5jdXJyZW50OwogIGMgJiYgMCAhPT0gYiAmJiBKYyhhLCA5ID09PSBhLm5vZGVUeXBlID8gYSA6IGEub3duZXJEb2N1bWVudCk7CiAgdGhpcy5faW50ZXJuYWxSb290ID0gZDsKfQoKZmsucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChhKSB7CiAgYmsoYSwgdGhpcy5faW50ZXJuYWxSb290LCBudWxsLCBudWxsKTsKfTsKCmZrLnByb3RvdHlwZS51bm1vdW50ID0gZnVuY3Rpb24gKCkgewogIHZhciBhID0gdGhpcy5faW50ZXJuYWxSb290LAogICAgICBiID0gYS5jb250YWluZXJJbmZvOwogIGJrKG51bGwsIGEsIG51bGwsIGZ1bmN0aW9uICgpIHsKICAgIGJbT2RdID0gbnVsbDsKICB9KTsKfTsKCmZ1bmN0aW9uIGdrKGEpIHsKICByZXR1cm4gISghYSB8fCAxICE9PSBhLm5vZGVUeXBlICYmIDkgIT09IGEubm9kZVR5cGUgJiYgMTEgIT09IGEubm9kZVR5cGUgJiYgKDggIT09IGEubm9kZVR5cGUgfHwgIiByZWFjdC1tb3VudC1wb2ludC11bnN0YWJsZSAiICE9PSBhLm5vZGVWYWx1ZSkpOwp9CgpmdW5jdGlvbiBoayhhLCBiKSB7CiAgYiB8fCAoYiA9IGEgPyA5ID09PSBhLm5vZGVUeXBlID8gYS5kb2N1bWVudEVsZW1lbnQgOiBhLmZpcnN0Q2hpbGQgOiBudWxsLCBiID0gISghYiB8fCAxICE9PSBiLm5vZGVUeXBlIHx8ICFiLmhhc0F0dHJpYnV0ZSgiZGF0YS1yZWFjdHJvb3QiKSkpOwogIGlmICghYikgZm9yICh2YXIgYzsgYyA9IGEubGFzdENoaWxkOykgewogICAgYS5yZW1vdmVDaGlsZChjKTsKICB9CiAgcmV0dXJuIG5ldyBmayhhLCAwLCBiID8gewogICAgaHlkcmF0ZTogITAKICB9IDogdm9pZCAwKTsKfQoKZnVuY3Rpb24gaWsoYSwgYiwgYywgZCwgZSkgewogIHZhciBmID0gYy5fcmVhY3RSb290Q29udGFpbmVyOwoKICBpZiAoZikgewogICAgdmFyIGcgPSBmLl9pbnRlcm5hbFJvb3Q7CgogICAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBlKSB7CiAgICAgIHZhciBoID0gZTsKCiAgICAgIGUgPSBmdW5jdGlvbiBlKCkgewogICAgICAgIHZhciBhID0gY2soZyk7CiAgICAgICAgaC5jYWxsKGEpOwogICAgICB9OwogICAgfQoKICAgIGJrKGIsIGcsIGEsIGUpOwogIH0gZWxzZSB7CiAgICBmID0gYy5fcmVhY3RSb290Q29udGFpbmVyID0gaGsoYywgZCk7CiAgICBnID0gZi5faW50ZXJuYWxSb290OwoKICAgIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZSkgewogICAgICB2YXIgayA9IGU7CgogICAgICBlID0gZnVuY3Rpb24gZSgpIHsKICAgICAgICB2YXIgYSA9IGNrKGcpOwogICAgICAgIGsuY2FsbChhKTsKICAgICAgfTsKICAgIH0KCiAgICBOaihmdW5jdGlvbiAoKSB7CiAgICAgIGJrKGIsIGcsIGEsIGUpOwogICAgfSk7CiAgfQoKICByZXR1cm4gY2soZyk7Cn0KCmZ1bmN0aW9uIGprKGEsIGIsIGMpIHsKICB2YXIgZCA9IDMgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzNdID8gYXJndW1lbnRzWzNdIDogbnVsbDsKICByZXR1cm4gewogICAgJCR0eXBlb2Y6ICRhLAogICAga2V5OiBudWxsID09IGQgPyBudWxsIDogIiIgKyBkLAogICAgY2hpbGRyZW46IGEsCiAgICBjb250YWluZXJJbmZvOiBiLAogICAgaW1wbGVtZW50YXRpb246IGMKICB9Owp9Cgp3YyA9IGZ1bmN0aW9uIHdjKGEpIHsKICBpZiAoMTMgPT09IGEudGFnKSB7CiAgICB2YXIgYiA9IGhnKEdnKCksIDE1MCwgMTAwKTsKICAgIElnKGEsIGIpOwogICAgZWsoYSwgYik7CiAgfQp9OwoKeGMgPSBmdW5jdGlvbiB4YyhhKSB7CiAgMTMgPT09IGEudGFnICYmIChJZyhhLCAzKSwgZWsoYSwgMykpOwp9OwoKeWMgPSBmdW5jdGlvbiB5YyhhKSB7CiAgaWYgKDEzID09PSBhLnRhZykgewogICAgdmFyIGIgPSBHZygpOwogICAgYiA9IEhnKGIsIGEsIG51bGwpOwogICAgSWcoYSwgYik7CiAgICBlayhhLCBiKTsKICB9Cn07Cgp6YSA9IGZ1bmN0aW9uIHphKGEsIGIsIGMpIHsKICBzd2l0Y2ggKGIpIHsKICAgIGNhc2UgImlucHV0IjoKICAgICAgQ2IoYSwgYyk7CiAgICAgIGIgPSBjLm5hbWU7CgogICAgICBpZiAoInJhZGlvIiA9PT0gYy50eXBlICYmIG51bGwgIT0gYikgewogICAgICAgIGZvciAoYyA9IGE7IGMucGFyZW50Tm9kZTspIHsKICAgICAgICAgIGMgPSBjLnBhcmVudE5vZGU7CiAgICAgICAgfQoKICAgICAgICBjID0gYy5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dFtuYW1lPSIgKyBKU09OLnN0cmluZ2lmeSgiIiArIGIpICsgJ11bdHlwZT0icmFkaW8iXScpOwoKICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYy5sZW5ndGg7IGIrKykgewogICAgICAgICAgdmFyIGQgPSBjW2JdOwoKICAgICAgICAgIGlmIChkICE9PSBhICYmIGQuZm9ybSA9PT0gYS5mb3JtKSB7CiAgICAgICAgICAgIHZhciBlID0gUWQoZCk7CiAgICAgICAgICAgIGlmICghZSkgdGhyb3cgRXJyb3IodSg5MCkpOwogICAgICAgICAgICB5YihkKTsKICAgICAgICAgICAgQ2IoZCwgZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBicmVhazsKCiAgICBjYXNlICJ0ZXh0YXJlYSI6CiAgICAgIEtiKGEsIGMpOwogICAgICBicmVhazsKCiAgICBjYXNlICJzZWxlY3QiOgogICAgICBiID0gYy52YWx1ZSwgbnVsbCAhPSBiICYmIEhiKGEsICEhYy5tdWx0aXBsZSwgYiwgITEpOwogIH0KfTsKCkZhID0gTWo7CgpHYSA9IGZ1bmN0aW9uIEdhKGEsIGIsIGMsIGQsIGUpIHsKICB2YXIgZiA9IFc7CiAgVyB8PSA0OwoKICB0cnkgewogICAgcmV0dXJuIGNnKDk4LCBhLmJpbmQobnVsbCwgYiwgYywgZCwgZSkpOwogIH0gZmluYWxseSB7CiAgICBXID0gZiwgVyA9PT0gViAmJiBnZygpOwogIH0KfTsKCkhhID0gZnVuY3Rpb24gSGEoKSB7CiAgKFcgJiAoMSB8IGZqIHwgZ2opKSA9PT0gViAmJiAoTGooKSwgRGooKSk7Cn07CgpJYSA9IGZ1bmN0aW9uIElhKGEsIGIpIHsKICB2YXIgYyA9IFc7CiAgVyB8PSAyOwoKICB0cnkgewogICAgcmV0dXJuIGEoYik7CiAgfSBmaW5hbGx5IHsKICAgIFcgPSBjLCBXID09PSBWICYmIGdnKCk7CiAgfQp9OwoKZnVuY3Rpb24ga2soYSwgYikgewogIHZhciBjID0gMiA8IGFyZ3VtZW50cy5sZW5ndGggJiYgdm9pZCAwICE9PSBhcmd1bWVudHNbMl0gPyBhcmd1bWVudHNbMl0gOiBudWxsOwogIGlmICghZ2soYikpIHRocm93IEVycm9yKHUoMjAwKSk7CiAgcmV0dXJuIGprKGEsIGIsIG51bGwsIGMpOwp9Cgp2YXIgbGsgPSB7CiAgRXZlbnRzOiBbTmMsIFBkLCBRZCwgeGEsIHRhLCBYZCwgZnVuY3Rpb24gKGEpIHsKICAgIGpjKGEsIFdkKTsKICB9LCBEYSwgRWEsIGlkLCBtYywgRGosIHsKICAgIGN1cnJlbnQ6ICExCiAgfV0KfTsKCihmdW5jdGlvbiAoYSkgewogIHZhciBiID0gYS5maW5kRmliZXJCeUhvc3RJbnN0YW5jZTsKICByZXR1cm4gWWoobih7fSwgYSwgewogICAgb3ZlcnJpZGVIb29rU3RhdGU6IG51bGwsCiAgICBvdmVycmlkZVByb3BzOiBudWxsLAogICAgc2V0U3VzcGVuc2VIYW5kbGVyOiBudWxsLAogICAgc2NoZWR1bGVVcGRhdGU6IG51bGwsCiAgICBjdXJyZW50RGlzcGF0Y2hlclJlZjogV2EuUmVhY3RDdXJyZW50RGlzcGF0Y2hlciwKICAgIGZpbmRIb3N0SW5zdGFuY2VCeUZpYmVyOiBmdW5jdGlvbiBmaW5kSG9zdEluc3RhbmNlQnlGaWJlcihhKSB7CiAgICAgIGEgPSBoYyhhKTsKICAgICAgcmV0dXJuIG51bGwgPT09IGEgPyBudWxsIDogYS5zdGF0ZU5vZGU7CiAgICB9LAogICAgZmluZEZpYmVyQnlIb3N0SW5zdGFuY2U6IGZ1bmN0aW9uIGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlKGEpIHsKICAgICAgcmV0dXJuIGIgPyBiKGEpIDogbnVsbDsKICAgIH0sCiAgICBmaW5kSG9zdEluc3RhbmNlc0ZvclJlZnJlc2g6IG51bGwsCiAgICBzY2hlZHVsZVJlZnJlc2g6IG51bGwsCiAgICBzY2hlZHVsZVJvb3Q6IG51bGwsCiAgICBzZXRSZWZyZXNoSGFuZGxlcjogbnVsbCwKICAgIGdldEN1cnJlbnRGaWJlcjogbnVsbAogIH0pKTsKfSkoewogIGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOiB0YywKICBidW5kbGVUeXBlOiAwLAogIHZlcnNpb246ICIxNi4xNC4wIiwKICByZW5kZXJlclBhY2thZ2VOYW1lOiAicmVhY3QtZG9tIgp9KTsKCmV4cG9ydHMuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQgPSBsazsKZXhwb3J0cy5jcmVhdGVQb3J0YWwgPSBrazsKCmV4cG9ydHMuZmluZERPTU5vZGUgPSBmdW5jdGlvbiAoYSkgewogIGlmIChudWxsID09IGEpIHJldHVybiBudWxsOwogIGlmICgxID09PSBhLm5vZGVUeXBlKSByZXR1cm4gYTsKICB2YXIgYiA9IGEuX3JlYWN0SW50ZXJuYWxGaWJlcjsKCiAgaWYgKHZvaWQgMCA9PT0gYikgewogICAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhLnJlbmRlcikgdGhyb3cgRXJyb3IodSgxODgpKTsKICAgIHRocm93IEVycm9yKHUoMjY4LCBPYmplY3Qua2V5cyhhKSkpOwogIH0KCiAgYSA9IGhjKGIpOwogIGEgPSBudWxsID09PSBhID8gbnVsbCA6IGEuc3RhdGVOb2RlOwogIHJldHVybiBhOwp9OwoKZXhwb3J0cy5mbHVzaFN5bmMgPSBmdW5jdGlvbiAoYSwgYikgewogIGlmICgoVyAmIChmaiB8IGdqKSkgIT09IFYpIHRocm93IEVycm9yKHUoMTg3KSk7CiAgdmFyIGMgPSBXOwogIFcgfD0gMTsKCiAgdHJ5IHsKICAgIHJldHVybiBjZyg5OSwgYS5iaW5kKG51bGwsIGIpKTsKICB9IGZpbmFsbHkgewogICAgVyA9IGMsIGdnKCk7CiAgfQp9OwoKZXhwb3J0cy5oeWRyYXRlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICBpZiAoIWdrKGIpKSB0aHJvdyBFcnJvcih1KDIwMCkpOwogIHJldHVybiBpayhudWxsLCBhLCBiLCAhMCwgYyk7Cn07CgpleHBvcnRzLnJlbmRlciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgaWYgKCFnayhiKSkgdGhyb3cgRXJyb3IodSgyMDApKTsKICByZXR1cm4gaWsobnVsbCwgYSwgYiwgITEsIGMpOwp9OwoKZXhwb3J0cy51bm1vdW50Q29tcG9uZW50QXROb2RlID0gZnVuY3Rpb24gKGEpIHsKICBpZiAoIWdrKGEpKSB0aHJvdyBFcnJvcih1KDQwKSk7CiAgcmV0dXJuIGEuX3JlYWN0Um9vdENvbnRhaW5lciA/IChOaihmdW5jdGlvbiAoKSB7CiAgICBpayhudWxsLCBudWxsLCBhLCAhMSwgZnVuY3Rpb24gKCkgewogICAgICBhLl9yZWFjdFJvb3RDb250YWluZXIgPSBudWxsOwogICAgICBhW09kXSA9IG51bGw7CiAgICB9KTsKICB9KSwgITApIDogITE7Cn07CgpleHBvcnRzLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzID0gTWo7CgpleHBvcnRzLnVuc3RhYmxlX2NyZWF0ZVBvcnRhbCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgcmV0dXJuIGtrKGEsIGIsIDIgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzJdID8gYXJndW1lbnRzWzJdIDogbnVsbCk7Cn07CgpleHBvcnRzLnVuc3RhYmxlX3JlbmRlclN1YnRyZWVJbnRvQ29udGFpbmVyID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICBpZiAoIWdrKGMpKSB0aHJvdyBFcnJvcih1KDIwMCkpOwogIGlmIChudWxsID09IGEgfHwgdm9pZCAwID09PSBhLl9yZWFjdEludGVybmFsRmliZXIpIHRocm93IEVycm9yKHUoMzgpKTsKICByZXR1cm4gaWsoYSwgYiwgYywgITEsIGQpOwp9OwoKZXhwb3J0cy52ZXJzaW9uID0gIjE2LjE0LjAiOw=="},null]}