{"remainingRequest":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/babel-loader/lib/index.js??ref--4-2!/Users/Aaron/Desktop/work/qunar/work/sniperjs/packages/WebErrorReporter/dist/index.js","dependencies":[{"path":"/Users/Aaron/Desktop/work/qunar/work/sniperjs/packages/WebErrorReporter/dist/index.js","hash":"674971ca4513893ed00ca80bd4740151"},{"path":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/cache-loader-hash/dist/cjs.js","hash":"d62e2d390167bf8193569f1644327c55"},{"path":"/Users/Aaron/Desktop/work/qunar/work/ykit3/packages/ykit3-cli/node_modules/babel-loader/lib/index.js","hash":"19adf3159c902f1ed7907f3931384270"}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7IHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0KCmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB9CgpmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsgdmFyIF9pID0gYXJyID09IG51bGwgPyBudWxsIDogdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07IGlmIChfaSA9PSBudWxsKSByZXR1cm47IHZhciBfYXJyID0gW107IHZhciBfbiA9IHRydWU7IHZhciBfZCA9IGZhbHNlOyB2YXIgX3MsIF9lOyB0cnkgeyBmb3IgKF9pID0gX2kuY2FsbChhcnIpOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7IF9hcnIucHVzaChfcy52YWx1ZSk7IGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsgfSB9IGNhdGNoIChlcnIpIHsgX2QgPSB0cnVlOyBfZSA9IGVycjsgfSBmaW5hbGx5IHsgdHJ5IHsgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7IH0gZmluYWxseSB7IGlmIChfZCkgdGhyb3cgX2U7IH0gfSByZXR1cm4gX2FycjsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7CiAgKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihleHBvcnRzKSkgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOiB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOiAoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGdsb2JhbC5TbmlwZXJqcyA9IGZhY3RvcnkoKSk7Cn0pKHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICByZXR1cm4gQ29uc3RydWN0b3I7CiAgfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICAgIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgICB9CgogICAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9CiAgICB9KTsKICAgIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwogIH0KCiAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgICB9OwogICAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKICB9CgogIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgICAgby5fX3Byb3RvX18gPSBwOwogICAgICByZXR1cm4gbzsKICAgIH07CgogICAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKICB9CgogIGZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7CiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTsKICAgIGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOwoKICAgIHRyeSB7CiAgICAgIERhdGUucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoRGF0ZSwgW10sIGZ1bmN0aW9uICgpIHt9KSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsKICAgIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICAgIH0KCiAgICByZXR1cm4gc2VsZjsKICB9CgogIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICAgIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgcmV0dXJuIGNhbGw7CiAgICB9CgogICAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7CiAgfQoKICBmdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkgewogICAgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkgewogICAgICB2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCksCiAgICAgICAgICByZXN1bHQ7CgogICAgICBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgewogICAgICAgIHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7CgogICAgICAgIHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogICAgaWYgKGtleSBpbiBvYmopIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgb2JqW2tleV0gPSB2YWx1ZTsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH0KCiAgZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgICAgfSk7CiAgICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICAgIH0KCiAgICByZXR1cm4ga2V5czsKICB9CgogIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQyKHRhcmdldCkgewogICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgICBpZiAoaSAlIDIpIHsKICAgICAgICBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhcmdldDsKICB9CiAgLyogZXNsaW50LWRpc2FibGUgbm8tZW1wdHkgKi8KCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi8KCgogIHZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CgogIGZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodGFyZ2V0KSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbCh0YXJnZXQpID09PSAnW29iamVjdCBPYmplY3RdJzsKICB9CgogIGZ1bmN0aW9uIGlzU3RyaW5nKHRhcmdldCkgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodGFyZ2V0KSA9PT0gJ1tvYmplY3QgU3RyaW5nXSc7CiAgfQoKICBmdW5jdGlvbiBpc0FycmF5KHRhcmdldCkgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodGFyZ2V0KSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKICB9CgogIGZ1bmN0aW9uIGlzRW1wdHlPYmplY3QodGFyZ2V0KSB7CiAgICBpZiAoIWlzUGxhaW5PYmplY3QodGFyZ2V0KSkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIE9iamVjdC5rZXlzKHRhcmdldCkubGVuZ3RoID4gMDsKICB9CgogIGZ1bmN0aW9uIGlzQm9vbGVhbih0YXJnZXQpIHsKICAgIHJldHVybiB0b1N0cmluZy5jYWxsKHRhcmdldCkgPT09ICdbb2JqZWN0IEJvb2xlYW5dJzsKICB9CgogIGZ1bmN0aW9uIGlzRnVuY3Rpb24odGFyZ2V0KSB7CiAgICByZXR1cm4gdHlwZW9mIHRhcmdldCA9PT0gJ2Z1bmN0aW9uJzsKICB9CgogIGZ1bmN0aW9uIGlzTnVtYmVyKHRhcmdldCkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscwogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwodGFyZ2V0KSA9PT0gJ1tvYmplY3QgTnVtYmVyXScgJiYgIWlzTmFOKHRhcmdldCk7CiAgfQoKICBmdW5jdGlvbiBpc1Byb21pc2Uob2JqZWN0KSB7CiAgICBpZiAoUHJvbWlzZSAmJiBQcm9taXNlLnJlc29sdmUpIHsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShvYmplY3QpID09IG9iamVjdDsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGV4dGVuZCh0YXJnZXQsIHNvdXJjZSkgewogICAgcmV0dXJuIF9vYmplY3RTcHJlYWQyKF9vYmplY3RTcHJlYWQyKHt9LCB0YXJnZXQpLCBzb3VyY2UpOwogIH0KCiAgZnVuY3Rpb24gZ2V0QWdlbnQoKSB7CiAgICB0cnkgewogICAgICBpZiAod2luZG93ICYmIHdpbmRvdy5oaXN0b3J5KSB7CiAgICAgICAgcmV0dXJuICdXRUJfQVBQJzsKICAgICAgfQoKICAgICAgaWYgKHd4KSB7CiAgICAgICAgcmV0dXJuICdXWF9NSU5JX0FQUCc7CiAgICAgIH0KCiAgICAgIGlmIChzd2FuKSB7CiAgICAgICAgcmV0dXJuICdCQUlEVV9NSU5JX0FQUCc7CiAgICAgIH0KCiAgICAgIGlmIChteSkgewogICAgICAgIHJldHVybiAnQUxJUEFZX01JTklfQVBQJzsKICAgICAgfQoKICAgICAgaWYgKHR0KSB7CiAgICAgICAgcmV0dXJuICdUVF9NSU5JX0FQUCc7CiAgICAgIH0KCiAgICAgIGlmIChxcSkgewogICAgICAgIHJldHVybiAnUVFfTUlOSV9BUFAnOwogICAgICB9CgogICAgICBpZiAocXVpY2spIHsKICAgICAgICByZXR1cm4gJ1FVSUNLX0FQUCc7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycikgewogICAgICByZXR1cm4gJ1VOS05PV05fQVBQJzsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldEdsb2JhbCgpIHsKICAgIHRyeSB7CiAgICAgIGlmICh3aW5kb3cgJiYgd2luZG93Lmhpc3RvcnkpIHsKICAgICAgICByZXR1cm4gd2luZG93OwogICAgICB9CgogICAgICBpZiAod3gpIHsKICAgICAgICByZXR1cm4gd3g7CiAgICAgIH0KCiAgICAgIGlmIChzd2FuKSB7CiAgICAgICAgcmV0dXJuIHN3YW47CiAgICAgIH0KCiAgICAgIGlmIChteSkgewogICAgICAgIHJldHVybiBteTsKICAgICAgfQoKICAgICAgaWYgKHR0KSB7CiAgICAgICAgcmV0dXJuIHR0OwogICAgICB9CgogICAgICBpZiAocXEpIHsKICAgICAgICByZXR1cm4gcXE7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycikgewogICAgICByZXR1cm4ge307CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRTeXN0ZW1JbmZvKCkgewogICAgLy8g6L+Z6YeM5YGa5Liq57yT5a2YCiAgICB2YXIgZ2xvYmFsT2JqID0gZ2V0R2xvYmFsKCk7CiAgICB2YXIga2V5ID0gJ19fc25pcGVyX19pbnRlcm5hbF9fZGF0YV9fJzsKCiAgICBpZiAoZ2xvYmFsT2JqW2tleV0gJiYgIWlzRW1wdHlPYmplY3QoZ2xvYmFsT2JqW2tleV0uc3lzdGVtSW5mbyB8fCB7fSkpIHsKICAgICAgcmV0dXJuIGdsb2JhbE9ialtrZXldLnN5c3RlbUluZm87CiAgICB9CgogICAgdHJ5IHsKICAgICAgdmFyIHN5c3RlbUluZm8gPSBnbG9iYWxPYmouZ2V0U3lzdGVtSW5mb1N5bmMoKTsKICAgICAgZ2xvYmFsT2JqW2tleV0gPSBnbG9iYWxPYmpba2V5XSB8fCB7fTsKICAgICAgZ2xvYmFsT2JqW2tleV0uc3lzdGVtSW5mbyA9IHN5c3RlbUluZm87CiAgICAgIHJldHVybiBzeXN0ZW1JbmZvOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIHJldHVybiB7fTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldE1ldGEoKSB7CiAgICByZXR1cm4gewogICAgICBhZ2VudDogZ2V0QWdlbnQoKSwKICAgICAgc3lzdGVtOiBPYmplY3QuYXNzaWduKHt9LCBnZXRTeXN0ZW1JbmZvKCkpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5JDEob2JqLCBrZXksIHZhbHVlKSB7CiAgICBpZiAoa2V5IGluIG9iaikgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBvYmpba2V5XSA9IHZhbHVlOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfQoKICBmdW5jdGlvbiBvd25LZXlzJDEob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICAgIH0pOwogICAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgICB9CgogICAgcmV0dXJuIGtleXM7CiAgfQoKICBmdW5jdGlvbiBfb2JqZWN0U3ByZWFkMiQxKHRhcmdldCkgewogICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgICBpZiAoaSAlIDIpIHsKICAgICAgICBvd25LZXlzJDEoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgX2RlZmluZVByb3BlcnR5JDEodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3duS2V5cyQxKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIGZ1bmN0aW9uIHRocm93RXJyKGVycikgewogICAgdGhyb3cgbmV3IEVycm9yKGVycik7CiAgfQoKICB2YXIgc3RyYXRlZ2llcyA9IHsKICAgIHVybDogewogICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsKSB7CiAgICAgICAgaWYgKCF2YWwpIHsKICAgICAgICAgIHRocm93RXJyKHRoaXMubXNnUmVxdXJlZCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBtc2dSZXF1cmVkOiAnU05JUEVSIEVSUk9SOiDphY3nva7kuK0gdXJsIOWtl+auteW/heWhqy4nCiAgICB9LAogICAgYXBwVmVyc2lvbjogewogICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsKSB7CiAgICAgICAgaWYgKCF2YWwpIHJldHVybjsKCiAgICAgICAgaWYgKCFpc1N0cmluZyh2YWwpKSB7CiAgICAgICAgICB0aHJvd0Vycih0aGlzLm1zZ1R5cGVFcnIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbXNnVHlwZUVycjogJ1NOSVBFUiBFUlJPUjog6YWN572u5LitIGFwcFZlcnNpb24g5a2X5q6157G75Z6L6ZyA5Li6IFN0cmluZy4nCiAgICB9LAogICAgZW52OiB7CiAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbiB2YWxpZGF0ZSh2YWwpIHsKICAgICAgICBpZiAoIXZhbCkgcmV0dXJuOwoKICAgICAgICBpZiAoIWlzU3RyaW5nKHZhbCkpIHsKICAgICAgICAgIHRocm93RXJyKHRoaXMubXNnVHlwZUVycik7CiAgICAgICAgfQogICAgICB9LAogICAgICBtc2dUeXBlRXJyOiAnU05JUEVSIEVSUk9SOiDphY3nva7kuK0gZW52IOWtl+auteexu+Wei+mcgOS4uiBTdHJpbmcuJwogICAgfSwKICAgIHJlcGVhdDogewogICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsKSB7CiAgICAgICAgaWYgKCFpc051bWJlcih2YWwpKSB7CiAgICAgICAgICB0aHJvd0Vycih0aGlzLm1zZ1R5cGVFcnIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbXNnVHlwZUVycjogJ1NOSVBFUiBFUlJPUjog6YWN572u5LitIHJlcGVhdCDlrZfmrrXnsbvlnovpnIDkuLogTnVtYmVyLicKICAgIH0sCiAgICBpZ25vcmVFcnJvcnM6IHsKICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbCkgewogICAgICAgIGlmICghaXNBcnJheSh2YWwpKSB7CiAgICAgICAgICB0aHJvd0Vycih0aGlzLm1zZ1R5cGVFcnIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbXNnVHlwZUVycjogJ1NOSVBFUiBFUlJPUjog6YWN572u5LitIGlnbm9yZUVycm9ycyDlrZfmrrXnsbvlnovpnIDkuLogQXJyYXkuJwogICAgfSwKICAgIGF1dG9CcmVhZGNydW1iczogewogICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsKSB7CiAgICAgICAgaWYgKCFpc0Jvb2xlYW4odmFsKSkgewogICAgICAgICAgdGhyb3dFcnIodGhpcy5tc2dUeXBlRXJyKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1zZ1R5cGVFcnI6ICdTTklQRVIgRVJST1I6IOmFjee9ruS4rSBhdXRvQnJlYWRjcnVtYnMg5a2X5q6157G75Z6L6ZyA5Li6IEFycmF5LicKICAgIH0sCiAgICBicmVhZGNydW1ic01heDogewogICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsKSB7CiAgICAgICAgaWYgKCFpc051bWJlcih2YWwpKSB7CiAgICAgICAgICB0aHJvd0Vycih0aGlzLm1zZ1R5cGVFcnIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbXNnVHlwZUVycjogJ1NOSVBFUiBFUlJPUjog6YWN572u5LitIGJyZWFkY3J1bWJzTWF4IOWtl+auteexu+Wei+mcgOS4uiBOdW1iZXIuJwogICAgfSwKICAgIHJhbmRvbTogewogICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodmFsKSB7CiAgICAgICAgaWYgKCFpc051bWJlcih2YWwpKSB7CiAgICAgICAgICB0aHJvd0Vycih0aGlzLm1zZ1R5cGVFcnIpOwogICAgICAgIH0gZWxzZSBpZiAoISh2YWwgPiAwICYmIHZhbCA8PSAxKSkgewogICAgICAgICAgdGhyb3dFcnIodGhpcy5tc2dSYW5nZUVycik7CiAgICAgICAgfQogICAgICB9LAogICAgICBtc2dUeXBlRXJyOiAnU05JUEVSIEVSUk9SOiDphY3nva7kuK0gYnJlYWRjcnVtYnNNYXgg5a2X5q6157G75Z6L6ZyA5Li6IE51bWJlci4nLAogICAgICBtc2dSYW5nZUVycjogJ1NOSVBFUiBFUlJPUjog6YWN572u5LitIGJyZWFkY3J1bWJzTWF4IOWtl+auteiMg+WbtOmcgOa7oei2syAoMCwgMV0nCiAgICB9LAogICAgZGVsYXk6IHsKICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbCkgewogICAgICAgIGlmICghaXNOdW1iZXIodmFsKSkgewogICAgICAgICAgdGhyb3dFcnIodGhpcy5tc2dUeXBlRXJyKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1zZ1R5cGVFcnI6ICdTTklQRVIgRVJST1I6IOmFjee9ruS4rSBkZWxheSDlrZfmrrXnsbvlnovpnIDkuLogTnVtYmVyLicKICAgIH0sCiAgICBiZWZvcmVSZXBvcnQ6IHsKICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbCkgewogICAgICAgIGlmICghaXNGdW5jdGlvbih2YWwpKSB7CiAgICAgICAgICB0aHJvd0Vycih0aGlzLm1zZ1R5cGVFcnIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbXNnVHlwZUVycjogJ1NOSVBFUiBFUlJPUjog6YWN572u5LitIGJlZm9yZVJlcG9ydCDlrZfmrrXnsbvlnovpnIDkuLogRnVuY3Rpb24uJwogICAgfQogIH07CgogIGZ1bmN0aW9uIHByb3h5VmFsaWRhdGUoKSB7CiAgICB2YXIgcHJveHlPYmogPSB7fTsKICAgIHJldHVybiBuZXcgUHJveHkocHJveHlPYmosIHsKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodGFyZ2V0LCBrZXksIHZhbCkgewogICAgICAgIHN0cmF0ZWdpZXNba2V5XS52YWxpZGF0ZSh2YWwpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24KCiAgICAgICAgdGFyZ2V0W2tleV0gPSB2YWw7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gdmFsaWRhdGVDb25maWcoY29uZmlnKSB7CiAgICB2YXIgcHJveHkgPSBwcm94eVZhbGlkYXRlKCk7CiAgICBPYmplY3Qua2V5cyhjb25maWcpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHsKICAgICAgcHJveHlbcHJvcF0gPSBjb25maWdbcHJvcF07CiAgICB9KTsKICB9CgogIHZhciBCZWhhdmlvclJlcG9ydGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEJlaGF2aW9yUmVwb3J0ZXIoKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCZWhhdmlvclJlcG9ydGVyKTsKCiAgICAgIHRoaXMubG9nUXVldWUgPSBbXTsKICAgICAgdGhpcy5jb25maWcgPSB7CiAgICAgICAgdXJsOiAnJywKICAgICAgICBhcHBrZXk6ICcnLAogICAgICAgIC8vIOS7peWQjuWVhuS4muWMluimgeeUqOWIsOeahAogICAgICAgIGRlbGF5OiAxMDAwLAogICAgICAgIC8vIOW7tui/nywg5ZCI5bm25LiK5oqlCiAgICAgICAgYXBwVmVyc2lvbjogJycsCiAgICAgICAgLy8g5bqU55SoVmVyc2lvbgogICAgICAgIGVudjogJycsCiAgICAgICAgLy8g546v5aKDCiAgICAgICAgYmVmb3JlUmVwb3J0OiBmdW5jdGlvbiBiZWZvcmVSZXBvcnQobG9nKSB7CiAgICAgICAgICAvLyAxLuWPr+WcqOi/memHjOWKq+aMgeS4iuaKpeeahOaVsOaNriwg5q+U5aaC5re75YqgdXNlcmlkLCBzZXNzaW9u562J562JCiAgICAgICAgICAvLyAyLuWmguaenHJldHVybiBmYWxzZSwg5YiZ5LiN55So5YaF572uaHR0cOS4iuaKpSwg5q2k5pe25Y+v5Lul5Zyo6L+Z6YeM6Ieq5a6a5LmJ6Ieq5bex55qEaHR0cOS4iuaKpeaWueW8jwogICAgICAgICAgLy8gICDmr5TlpoLku6XlkI7mtY/op4jlmajnq6/vvIzlj6/ku6Xoh6rlrprkuYkgYWpheCDkuIrmiqXov5jmmK/nlKjlm77niYfkuIrmiqUKICAgICAgICAgIHJldHVybiBsb2c7CiAgICAgICAgfQogICAgICB9OwogICAgICB0aGlzLmFwcGx5UmVxdWVzdGVkID0gZmFsc2U7CiAgICAgIHRoaXMuZGVsYXlUaW1lciA9IC0xOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhCZWhhdmlvclJlcG9ydGVyLCBbewogICAgICBrZXk6ICJtZXJnZUNvbmZpZyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBtZXJnZUNvbmZpZyhvcHRzKSB7CiAgICAgICAgdmFsaWRhdGVDb25maWcob3B0cyk7CiAgICAgICAgdGhpcy5jb25maWcgPSBleHRlbmQodGhpcy5jb25maWcsIG9wdHMpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImFkZExvZyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRMb2cobG9nKSB7CiAgICAgICAgdGhpcy5sb2dRdWV1ZS5wdXNoKGxvZyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0TG9nIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldExvZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5sb2dRdWV1ZS5zbGljZSgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImNsZWFyTG9nIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFyTG9nKCkgewogICAgICAgIHRoaXMubG9nUXVldWUgPSBbXTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJyZXBvcnQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVwb3J0KCkgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICB2YXIgY3VyTG9nUXVldWUgPSB0aGlzLmdldExvZygpOwoKICAgICAgICBpZiAodGhpcy5jb25maWcuZGVsYXkgPiAwKSB7CiAgICAgICAgICBpZiAodGhpcy5kZWxheVRpbWVyKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRlbGF5VGltZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZGVsYXlUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczIuc2VuZExvZyhjdXJMb2dRdWV1ZSk7CiAgICAgICAgICB9LCB0aGlzLmNvbmZpZy5kZWxheSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VuZExvZyhjdXJMb2dRdWV1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImdMb2ciLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ0xvZyhsb2cpIHsKICAgICAgICB2YXIgX3RoaXMkY29uZmlnID0gdGhpcy5jb25maWcsCiAgICAgICAgICAgIGFwcFZlcnNpb24gPSBfdGhpcyRjb25maWcuYXBwVmVyc2lvbiwKICAgICAgICAgICAgZW52ID0gX3RoaXMkY29uZmlnLmVudjsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZDIkMShfb2JqZWN0U3ByZWFkMiQxKHt9LCBnZXRNZXRhKCkpLCB7fSwgewogICAgICAgICAgYXBwVmVyc2lvbjogYXBwVmVyc2lvbiwKICAgICAgICAgIGVudjogZW52LAogICAgICAgICAgbG9nczogbG9nCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic2VuZExvZyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kTG9nKCkgewogICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICB2YXIgbG9nUXVldWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgICAgIHZhciBsb2cgPSBsb2dRdWV1ZS5zbGljZSgpOwogICAgICAgIGlmICghbG9nLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHZhciBkYXRhID0gdGhpcy5nTG9nKGxvZyk7CiAgICAgICAgdmFyIHJldCA9IGlzRnVuY3Rpb24odGhpcy5jb25maWcuYmVmb3JlUmVwb3J0KSAmJiB0aGlzLmNvbmZpZy5iZWZvcmVSZXBvcnQuY2FsbCh0aGlzLCBkYXRhKTsgLy8g5byC5q2l5Zue6LCDCgogICAgICAgIGlmIChpc1Byb21pc2UocmV0KSkgewogICAgICAgICAgcmV0LnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBpZiAoaXNCb29sZWFuKHJlcykgJiYgcmVzID09PSBmYWxzZSkgewogICAgICAgICAgICAgIC8vIOeUqOaIt+mYu+atoum7mOiupOS4iuaKpeWQju+8jOWPr+WcqCBiZWZvcmVSZXBvcnQg5Y+v6Ieq5a6a5LmJIHJlcXVlc3Qg5LiK5oqlCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczMuc3RhcnRSZXBvcnQocmVzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaXNCb29sZWFuKHJldCkgJiYgcmV0ID09PSBmYWxzZSkgewogICAgICAgICAgICAvLyDnlKjmiLfpmLvmraLpu5jorqTkuIrmiqXlkI7vvIzlj6/lnKggYmVmb3JlUmVwb3J0IOWPr+iHquWumuS5iSByZXF1ZXN0IOS4iuaKpQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zdGFydFJlcG9ydChyZXQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJzdGFydFJlcG9ydCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzdGFydFJlcG9ydChkYXRhKSB7CiAgICAgICAgdGhpcy5jbGVhckxvZygpOyAvLyDpu5jorqTkuIrmiqUKCiAgICAgICAgdGhpcy5yZXF1ZXN0KHsKICAgICAgICAgIHVybDogdGhpcy5jb25maWcudXJsLAogICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAidXNlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVzZShwbHVnaW4pIHsKICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgICB9CgogICAgICAgIHBsdWdpbi5pbml0LmFwcGx5KHBsdWdpbiwgW3RoaXNdLmNvbmNhdChhcmdzKSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiYXBwbHlSZXF1ZXN0IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGx5UmVxdWVzdChyZXF1ZXN0KSB7CiAgICAgICAgaWYgKHRoaXMuYXBwbHlSZXF1ZXN0ZWQpIHJldHVybiBmYWxzZTsKICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0OwogICAgICAgIHRoaXMuYXBwbHlSZXF1ZXN0ZWQgPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEJlaGF2aW9yUmVwb3J0ZXI7CiAgfSgpOwoKICB2YXIgZXJyb3JUeXBlUmVnID0gbmV3IFJlZ0V4cCgnKCcgKyBbJ0V2YWxFcnJvcjonLCAnSW50ZXJuYWxFcnJvcjonLCAnUmFuZ2VFcnJvcjonLCAnUmVmZXJlbmNlRXJyb3I6JywgJ1N5bnRheEVycm9yOicsICdUeXBlRXJyb3I6JywgJ1VSSUVycm9yOicsICdFcnJvcjonIC8vIG5ldyBFcnJvcgogIF0uam9pbignfCcpICsgJyknLCAnbWknKTsKICAvKiBlc2xpbnQtZGlzYWJsZSBrZXktc3BhY2luZyAqLwoKICBmdW5jdGlvbiBwYXJzZVNjcmlwdFJ1bnRpbWVFcnJvcigpIHsKICAgIHZhciBzdGFjayA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7CgogICAgdHJ5IHsKICAgICAgdmFyIGxpbmUgPSAnJywKICAgICAgICAgIGNvbCA9ICcnLAogICAgICAgICAgZmlsZSA9ICcnLAogICAgICAgICAgdXJsID0gJyc7CiAgICAgIHZhciBlcnJJbmZvTGlzdCA9IHN0YWNrLnNwbGl0KC9cblxzKy8pOwogICAgICB2YXIgZXJyTXNnID0gZXJySW5mb0xpc3RbMF07CiAgICAgIHZhciBlcnJTdGFjayA9IGVyckluZm9MaXN0LnNsaWNlKDEpOwogICAgICB2YXIgdHlwZSA9IGVyck1zZy5tYXRjaChlcnJvclR5cGVSZWcpWzBdLnJlcGxhY2UoLzokLywgJycpIHx8ICcnOwogICAgICB2YXIgdmFsdWUgPSBlcnJNc2cuc3BsaXQoL1xuLykucG9wKCkuc3BsaXQoJzonKVsxXS50cmltKCk7IC8vIOacieWPr+iDveayoeaciXN0YWNr5L+h5oGv77yM5aaC5ZyoYXBwLmpz55Sf5ZG95ZGo5pyf6YeM6Z2iCHRocm93IGVycm9yCgogICAgICBpZiAoZXJyU3RhY2subGVuZ3RoKSB7CiAgICAgICAgLy8gOihcZCs6XGQrKSA9PiAgOjI5OjEzCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgdmFyIF9zcGxpdCA9ICgvOihcZCs6XGQrKS8uZXhlYyhlcnJTdGFja1swXSlbMV0gfHwgJycpLnNwbGl0KCc6Jyk7CgogICAgICAgIHZhciBfc3BsaXQyID0gX3NsaWNlZFRvQXJyYXkoX3NwbGl0LCAyKTsKCiAgICAgICAgdmFyIF9zcGxpdDIkID0gX3NwbGl0MlswXTsKICAgICAgICBsaW5lID0gX3NwbGl0MiQgPT09IHZvaWQgMCA/ICcnIDogX3NwbGl0MiQ7CiAgICAgICAgdmFyIF9zcGxpdDIkMiA9IF9zcGxpdDJbMV07CiAgICAgICAgY29sID0gX3NwbGl0MiQyID09PSB2b2lkIDAgPyAnJyA6IF9zcGxpdDIkMjsKICAgICAgICAvLyBcdys6XC9cLysgICAgPT4gd2VhcHA6Ly8vCiAgICAgICAgLy8gaHR0cHM/OlwvXC8gID0+IGh0dHA6Ly8gb3IgaHR0cHM6Ly8KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKICAgICAgICBmaWxlID0gKC8oXHcrOlwvXC8rfGh0dHBzPzpcL1wvKS4rOlxkKzpcZCsvLmV4ZWMoZXJyU3RhY2tbMF0pWzBdIHx8ICcnKS5yZXBsYWNlKC86XGQrOlxkKyQvLCAnJykgfHwgJyc7CiAgICAgICAgdXJsID0gKC8oXHcrOlwvXC8rfGh0dHBzPzpcL1wvKS4rOlxkKzpcZCsvLmV4ZWMoZXJyU3RhY2tbMV0pWzBdIHx8ICcnKS5yZXBsYWNlKC86XGQrOlxkKyQvLCAnJykgfHwgJyc7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgbGluZTogbGluZSwKICAgICAgICBjb2w6IGNvbCwKICAgICAgICBmaWxlOiBmaWxlLAogICAgICAgIHVybDogdXJsLAogICAgICAgIHN0YWNrOiBzdGFjaywKICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICB9OwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGNvbnNvbGUubG9nKCdlcnJJbmZvTGlzdC0zLS0tJywgZXJyKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdGFjazogc3RhY2ssCiAgICAgICAgdHlwZTogJ0Vycm9yJwogICAgICB9OwogICAgfQogIH0KCiAgZnVuY3Rpb24gcGFyc2VTdGF0aWNFcnJvcihldmVudCwgdGFyZ2V0KSB7CiAgICB2YXIgdXJsID0gdGFyZ2V0LnNyYyB8fCB0YXJnZXQuaHJlZjsKICAgIHJldHVybiB7CiAgICAgIHN0YWNrOiB1cmwsCiAgICAgIGZpbGU6IHVybCwKICAgICAgdHlwZTogIlJlZmVyZW5jZUVycm9yIiwKICAgICAgdmFsdWU6ICfotYTmupDliqDovb3lvILluLgnCiAgICB9OwogIH0KICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqLwoKCiAgdmFyIHBsdWdpbkhvb2tBcHAgPSB7CiAgICBpbml0OiBmdW5jdGlvbiBpbml0KGNvcmUpIHsKICAgICAgLy8g5LiA77ya5o2V6I635q2j5bi46ZSZ6K+v5ZKM6LWE5rqQ5Yqg6L296ZSZ6K+vCiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIGNvbnNvbGUubG9nKCdNWjUtLS0nLCAxKTsKICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7CiAgICAgICAgdmFyIGlzRWxlbWVudFRhcmdldCA9IHRhcmdldCBpbnN0YW5jZW9mIEhUTUxTY3JpcHRFbGVtZW50IHx8IHRhcmdldCBpbnN0YW5jZW9mIEhUTUxMaW5rRWxlbWVudCB8fCB0YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50OwogICAgICAgIGNvbnNvbGUubG9nKCdNWjYtLS0nLCAxKTsKCiAgICAgICAgdmFyIF9fbG9nID0gaXNFbGVtZW50VGFyZ2V0ID8gcGFyc2VTdGF0aWNFcnJvcihldmVudCwgdGFyZ2V0KSA6IHBhcnNlU2NyaXB0UnVudGltZUVycm9yKGV2ZW50LmVycm9yLnN0YWNrKTsKCiAgICAgICAgY29yZS5hZGRMb2coX19sb2cpOwogICAgICAgIGNvbnNvbGUubG9nKCdNWi0tLScsIF9fbG9nKTsgLy8gICAgY29yZS5yZXBvcnQoKTsKICAgICAgfSwgdHJ1ZSk7IC8vIOS6jO+8muaNleiOt2NvbnNvbGUuZXJyb3LplJnor68KICAgICAgLy8gY29uc29sZS5lcnJvciA9IChmdW5jID0+IHsKICAgICAgLy8gICByZXR1cm4gKC4uLmFyZ3MpID0+IHsKICAgICAgLy8gICAgIGNvcmUuYWRkTG9nKC4uLmFyZ3MpOwogICAgICAvLyAgICAgZnVuYy5hcHBseShjb25zb2xlLCBhcmdzKTsKICAgICAgLy8gICB9CiAgICAgIC8vIH0pKGNvbnNvbGUuZXJyb3IpOwogICAgICAvLyDkuInvvJrmjZXojrdQcm9taXNl6ZSZ6K+vCgogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndW5oYW5kbGVkcmVqZWN0aW9uJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgX19sb2cgPSBwYXJzZVNjcmlwdFJ1bnRpbWVFcnJvcihlLnJlYXNvbi5zdGFjayk7CgogICAgICAgIGNvcmUuYWRkTG9nKF9fbG9nKTsKICAgICAgICBjb25zb2xlLmxvZygnTVo0LS0tJywgX19sb2cpOyAvLyAgY29yZS5yZXBvcnQoKTsKICAgICAgICAvLyBjb25zb2xlLmxvZyhgUHJvbWlzZS5yZWplY3QoKeS4reeahOWGheWuue+8jOWRiuivieS9oOWPkeeUn+mUmeivr+eahOWOn+WboDoke2UucmVhc29ufWApOwogICAgICAgIC8vIGNvbnNvbGUubG9nKGBQcm9taXNl5a+56LGhIDoke2UucHJvbWlzZX1gKTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gUmVxdWVzdChjb25maWcpIHsKICAgIHZhciB1cmwgPSBjb25maWcudXJsLAogICAgICAgIG1ldGhvZCA9IGNvbmZpZy5tZXRob2QsCiAgICAgICAgZGF0YSA9IGNvbmZpZy5kYXRhOwogICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgeGhyLm9wZW4obWV0aG9kLCB1cmwsIHRydWUpOwogICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ2NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTsKICAgIHhoci5zZW5kKCd1ZT0nICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgcmV0dXJuIHhocjsKICB9CgogIHZhciBSZXBvcnRvciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0JlaGF2aW9yUmVwb3J0ZXIpIHsKICAgIF9pbmhlcml0cyhSZXBvcnRvciwgX0JlaGF2aW9yUmVwb3J0ZXIpOwoKICAgIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoUmVwb3J0b3IpOwoKICAgIGZ1bmN0aW9uIFJlcG9ydG9yKCkgewogICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgICB2YXIgX3RoaXM7CgogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVwb3J0b3IpOwoKICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBvcHRzKTsgLy8g5ZCI5bm25Y+C5pWwCgogICAgICBfdGhpcy5tZXJnZUNvbmZpZyhvcHRzKTsKCiAgICAgIF90aGlzLmluaXQoKTsKCiAgICAgIHJldHVybiBfdGhpczsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoUmVwb3J0b3IsIFt7CiAgICAgIGtleTogImluaXQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAvLyDliqvmjIEgQXBwIG9uRXJyb3IKICAgICAgICAvLyB0aGlzLnVzZShhZGRFdmVudExpc3RlbmVyKTsKICAgICAgICB0aGlzLnVzZShwbHVnaW5Ib29rQXBwKTsgLy8gLy8g5Yqr5oyBIFJlcXVlc3QKICAgICAgICAvLyB0aGlzLnVzZShwbHVnaW5Ib29rUnEpOwogICAgICAgIC8vIHRoaXMudXNlKHBsdWdpblBhdGNoUHJvbWlzZSk7CgogICAgICAgIHRoaXMuYXBwbHlSZXF1ZXN0KFJlcXVlc3QpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFJlcG9ydG9yOwogIH0oQmVoYXZpb3JSZXBvcnRlcik7CgogIHJldHVybiBSZXBvcnRvcjsKfSk7"},null]}